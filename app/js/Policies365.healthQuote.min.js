"use strict";angular.module("healthInstantQuote",["CoreComponentApp","LocalStorageModule","checklist-model"]).controller("healthInstantQuoteController",["$scope","$rootScope","$window","$location","$filter","RestAPI","$http","localStorageService","$interval","$timeout","$sce","$anchorScroll",function($scope,$rootScope,$window,$location,$filter,RestAPI,$http,localStorageService,$interval,$timeout,$sce,$anchorScroll){$anchorScroll("home"),$scope.p365Labels=insHealthQuoteLabels,$rootScope.loaderContent={businessLine:"4",header:"Health Insurance",desc:$sce.trustAsHtml($scope.p365Labels.common.proverbInstantQuote)},"/health"==$location.path()?$rootScope.title=$scope.p365Labels.policies365Title.healthInstantQuoteLanding:$rootScope.title=$scope.p365Labels.policies365Title.healthInstantQuote,$rootScope.loading=!0,$rootScope.instantQuoteSummaryStatus=!0,$rootScope.disableLandingLeadBtn=!1,$rootScope.GSTTag=!1,$scope.quoteParam=defaultHealthQuoteParam.quoteParam,$scope.ratingParam=defaultHealthQuoteParam.ratingParam,$scope.personalInfo=defaultHealthQuoteParam.personalInfo,$scope.healthInstantQuoteCalculation=function(addOnCoverForHealth){addRidersToDefaultQuote(addOnCoverForHealth,localStorageService.get("selectedBusinessLineId"),function(defaultRiderList,defaultRiderArrayObject){var healthQuoteCookie=localStorageService.get("healthQuoteInputParamaters");$scope.quote={},$scope.quoteParam={},$scope.ratingParam={},$scope.personalInfo={},$scope.quote.quoteParam={},$scope.quoteFinalResult={},$scope.selectedDisease={},$scope.medicalInstant={},$scope.quoteFinalResult.quotes=[],$scope.selectedDisease.diseaseList=[],$scope.selectedFamilyArray=[],$scope.diseaseList=localStorageService.get("diseaseList"),$scope.hospitalizationLimitArray=localStorageService.get("hospitalizationLimitList"),$scope.familyList=healthFamilyListGeneric,$scope.genderType=genderTypeGeneric,$scope.preDiseaseStatus=preDiseaseStatusGeneric,$scope.personalInfo.selFamilyMember=selectedFamilyMemberId,$rootScope.tabSelectionStatus=!0,$scope.medicalInstant.collapseFamilyList=!1,$rootScope.wordPressEnabled?$scope.instantQuoteHealthForm=!1:$scope.instantQuoteHealthForm=!0;var DOBOption={changeMonth:!0,changeYear:!0};DOBOption.dateFormat=DATE_FORMAT,$scope.DOBOptions=setP365DatePickerProperties(DOBOption);var member,dateRange={};$scope.$watch(function(scope){return scope.familyList},function(){$scope.selectedFamilyArray=[];for(var i=0;i<$scope.familyList.length;i++)"S"!=$scope.familyList[i].relationship&&"SP"!=$scope.familyList[i].relationship&&"A"!=$scope.familyList[i].relationship||(dateRange.minimumYearLimit="-99Y",dateRange.maximumYearLimit="-18Y",dateRange.changeMonth=!0,dateRange.changeYear=!0,dateRange.dateFormat=DATE_FORMAT),"CH"==$scope.familyList[i].relationship&&(dateRange.minimumYearLimit="-25Y - 1D",dateRange.maximumYearLimit="00Y",dateRange.changeMonth=!0,dateRange.changeYear=!0,dateRange.dateFormat=DATE_FORMAT),1==$scope.familyList[i].val&&((member={}).id=$scope.familyList[i].id,member.display=$scope.familyList[i].member,member.age=$scope.familyList[i].age,member.dob=$scope.familyList[i].dob,member.relation=$scope.familyList[i].relationship,$scope["DOBOptions"+i]=setP365DatePickerProperties(dateRange),member.existSince="",member.existSinceError=!1,member.status=!1,"Son"==member.relation||"Daughter"==member.relation?member.label=$scope.familyList[i].member.concat(" aged ").concat($scope.familyList[i].age):member.label=$scope.familyList[i].member,$scope.selectedFamilyArray.push(member))},!0),$scope.getAgeArray=function(minAge,maxAge){for(var ageArray=[],j=minAge;j<=maxAge;0,j++)ageArray.push(j);return ageArray},$scope.getPinCodeAreaList=function(areaName){var docType;return docType=isNaN(areaName)?"Area":"Pincode",$http.get(getServiceLink+docType+"&q="+areaName).then(function(response){return JSON.parse(response.data).data})},$scope.calcDefaultAreaDetails=function(areaCode){$http.get(getServiceLink+"Pincode&q="+areaCode).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.p365Labels.responseCode.success&&$scope.onSelectPinOrArea(areaDetails.data[0],!1)})},$scope.onSelectPinOrArea=function(item,dirtyStatus){$scope.modalPIN=!1,$scope.selectedArea=item.area,$scope.personalInfo.pincode=item.pincode,item.area?$scope.personalInfo.displayArea=item.area+", "+item.district:$scope.personalInfo.displayArea=item.displayArea,item.city=item.district,$scope.personalInfo.city=item.district,$scope.displayPincodeInfo=item.pincode+" - "+$scope.personalInfo.displayArea,$scope.personalInfo.state=item.state,console.log("item.state",item.state),localStorageService.set("commAddressDetails",item),setTimeout(function(){"/healthLanding"==$location.path()&&(sourceOrigin="landing",console.log("sourceOrigin for health landing is : ",sourceOrigin),$scope.singleClickHealthQuote())},100)},$scope.getDisease=function(){if($scope.selectedDisease)return $scope.selectedDisease.diseaseList},$scope.removeFamilyMember=function(data){data.val=!1,setTimeout(function(){$scope.singleClickHealthQuote()},100)},$scope.removePreDisease=function(data){var i;for(i=0;i<$scope.selectedDisease.diseaseList.length;i++)if($scope.selectedDisease.diseaseList[i]==data.diseaseId){$scope.selectedDisease.diseaseList.splice(i,1);break}for(i=0;i<$scope.diseaseList.length;i++)if($scope.diseaseList[i].diseaseId==data.diseaseId){$scope.diseaseList[i].familyList=[];break}0==$scope.selectedDisease.diseaseList.length&&($scope.personalInfo.preDiseaseStatus="No",$scope.isDiseased=!1),$scope.submitPreDiseaseList()},$scope.checkDisease=function(value,checked){var idx=$scope.selectedDisease.diseaseList.indexOf(value);idx>=0&&!checked&&$scope.selectedDisease.diseaseList.splice(idx,1),idx<0&&checked&&$scope.selectedDisease.diseaseList.push(value)};if($scope.addNewSon=function(index){for(var i=0;i<$scope.familyList.length;i++)"Son"==$scope.familyList[i].member&&1;$scope.familyList[index].iconFlag=!1,$scope.calculatedDOB=calcDOBFromAge(5),$scope.familyList.push({member:"Son",relation:"SON",visible:!0,age:5,gender:"M",relationship:"CH",occupationClass:2,val:!0,other:!1,mandatory:!1,minAge:1,maxAge:82,iconFlag:!0,dob:$scope.calculatedDOB})},$scope.addNewDaughter=function(index){for(var i=0;i<$scope.familyList.length;i++)"Daughter"==$scope.familyList[i].member&&1;$scope.familyList[index].iconFlag=!1,$scope.calculatedDOB=calcDOBFromAge(5),$scope.familyList.push({member:"Daughter",relation:"DAUGHTER",visible:!0,age:5,gender:"F",relationship:"CH",occupationClass:2,val:!0,other:!1,mandatory:!1,minAge:1,maxAge:25,iconFlag:!0,dob:$scope.calculatedDOB})},$scope.validateFamilyForm=function(){$scope.familyErrors=[];for(var ageOfSelf,ageOfSpouse,ageOfFather,lesserAge,submitFamilyForm=!0,i=0;i<$scope.familyList.length;i++)"Self"==$scope.familyList[i].member?$scope.familyList[i].val?($scope.ratingParam.isSelf="Y",ageOfSelf=Number($scope.familyList[i].age)):$scope.ratingParam.isSelf="N":"Spouse"==$scope.familyList[i].member?$scope.familyList[i].val?($scope.ratingParam.isSpouse="Y",ageOfSpouse=Number($scope.familyList[i].age)):$scope.ratingParam.isSpouse="N":"Father"==$scope.familyList[i].member&&$scope.familyList[i].val&&(ageOfFather=Number($scope.familyList[i].age)),lesserAge="undefined"==ageOfSelf||""==ageOfSelf||null==ageOfSelf?ageOfSpouse:ageOfSpouse<ageOfSelf?ageOfSpouse:ageOfSelf,1==$scope.familyList[i].val&&("CH"==$scope.familyList[i].relationship&&$scope.familyList[i].age>lesserAge-1&&0==p365Includes($scope.familyErrors,"Please correct,Child age is same as or greater than the Parent's age")&&($scope.familyErrors.push("Please correct,Child age is same as or greater than the Parent's age"),submitFamilyForm=!1),("Father"==$scope.familyList[i].member||"Mother"==$scope.familyList[i].member)&&$scope.familyList[i].age<ageOfSelf+1&&0==p365Includes($scope.familyErrors,"Please correct,Your age is same as or greater than your Parent's age")&&($scope.familyErrors.push("Please correct,Your age is same as or greater than your Parent's age"),submitFamilyForm=!1),("Father-in-Law"==$scope.familyList[i].member||"Mother-in-Law"==$scope.familyList[i].member)&&$scope.familyList[i].age<ageOfSpouse+1&&0==p365Includes($scope.familyErrors,"Please correct, your Spouse's age is same as or greater than your In-Laws' age")&&($scope.familyErrors.push("Please correct, your Spouse's age is same as or greater than your In-Laws' age"),submitFamilyForm=!1),("Grand Father"==$scope.familyList[i].member||"Grand Mother"==$scope.familyList[i].member)&&$scope.familyList[i].age<ageOfFather+1&&$scope.familyList[i].age<ageOfSelf+2&&0==p365Includes($scope.familyErrors,"Please correct,your Father's age is same as or greater than your Grand Parents' age")&&($scope.familyErrors.push("Please correct,your Father's age is same as or greater than your Grand Parents' age"),submitFamilyForm=!1));return submitFamilyForm},$scope.updateDiseaseList=function(){var i;for(i=0;i<$scope.diseaseList.length;i++)for(var j=0;j<$scope.diseaseList[i].familyList.length;j++)p365Includes($scope.selectedDisease.diseaseList,$scope.diseaseList[j].diseaseId)&&p365Includes($scope.personalInfo.selFamilyMember,$scope.diseaseList[i].familyList[j].id)&&($scope.diseaseList[i].familyList.splice(j,1),j=0);var deleteList=[];for(i=0;i<$scope.diseaseList.length;i++)1==p365Includes($scope.selectedDisease.diseaseList,$scope.diseaseList[i].diseaseId)&&0==$scope.diseaseList[i].familyList.length&&deleteList.push($scope.diseaseList[i].diseaseId);$scope.selectedDisease.diseaseList=$scope.selectedDisease.diseaseList.filter(function(obj){return-1===deleteList.indexOf(obj)}),$scope.selectedDisease.diseaseList.length},$scope.submitFamily=function(){var submitFamilyForm;submitFamilyForm=$scope.validateFamilyForm(),$scope.personalInfo.selFamilyMember=[];for(var familyCounter=0,familyMemberExistStatus=!1,i=0;i<$scope.familyList.length;i++)1==$scope.familyList[i].val&&($scope.personalInfo.selFamilyMember.push($scope.familyList[i].id),familyMemberExistStatus=!0,familyCounter+=1);$scope.quoteParam.planType=familyCounter>1?"F":"I",$scope.updateDiseaseList(),familyMemberExistStatus?1==submitFamilyForm&&($scope.modalFamily=!1,setTimeout(function(){},100)):$scope.familyErrors.push("Please select atleast one member.")},$scope.closeFamilyMemberModal=function(){$scope.familyList=$scope.oldFamilyList,$scope.modalFamily=!1},$scope.closePreExistingDiseaseModal=function(){for(var deleteList=[],i=0;i<$scope.diseaseList.length;i++)1==p365Includes($scope.selectedDisease.diseaseList,$scope.diseaseList[i].diseaseId)&&0==$scope.diseaseList[i].familyList.length?deleteList.push($scope.diseaseList[i].diseaseId):0==p365Includes($scope.oldSelectedDiseaseList,$scope.diseaseList[i].diseaseId)&&deleteList.push($scope.diseaseList[i].diseaseId);$scope.selectedDisease.diseaseList=$scope.selectedDisease.diseaseList.filter(function(obj){return-1===deleteList.indexOf(obj)}),0==$scope.selectedDisease.diseaseList.length&&($scope.personalInfo.preDiseaseStatus="No",$scope.isDiseased=!1),$scope.modalHealth=!1},$scope.submitPreDiseaseList=function(){var i,submitDiseaseForm=!0;if($scope.ratingParam.criticalIllness="N",$scope.ratingParam.organDonar="N",$scope.selectedDisease.diseaseList.length>0)for(i=0;i<$scope.diseaseList.length;i++)1==p365Includes($scope.selectedDisease.diseaseList,$scope.diseaseList[i].diseaseId)&&("OrganDonar"==$scope.diseaseList[i].diseaseType&&($scope.ratingParam.organDonar="Y"),"Critical"==$scope.diseaseList[i].diseaseType&&($scope.ratingParam.criticalIllness="Y"),0==$scope.diseaseList[i].familyList.length&&($scope.diseaseError="Please select family members against each selected disease",submitDiseaseForm=!1));else submitDiseaseForm=!1,$scope.diseaseError="Please select disease before submit.";if(1==submitDiseaseForm)for($scope.modalHealth=!1,$scope.diseaseError="",0==$scope.selectedDisease.diseaseList.length&&($scope.personalInfo.preDiseaseStatus="No",$scope.isDiseased=!1),i=0;i<$scope.selectedFamilyArray.length;i++){$scope.selectedFamilyArray[i].dieaseDetails=[],$scope.dieaseDetails=[];for(var j=0;j<$scope.diseaseList.length;j++)if(1==p365Includes($scope.selectedDisease.diseaseList,$scope.diseaseList[j].diseaseId)){for(var k=0;k<$scope.diseaseList[j].familyList.length;k++)if($scope.selectedFamilyArray[i].id==$scope.diseaseList[j].familyList[k].id){$scope.diseaseList[j].familyList[k].status=!0;var dieaseDetails={};dieaseDetails.dieaseCode=$scope.diseaseList[j].diseaseId,dieaseDetails.dieaseName=$scope.diseaseList[j].disease,dieaseDetails.masterDieaseCode=$scope.diseaseList[j].diseaseCode,dieaseDetails.applicable=!0,$scope.dieaseDetails.push(dieaseDetails)}}else $scope.diseaseList[j].familyList=[];$scope.selectedFamilyArray[i].dieaseDetails.push($scope.dieaseDetails)}},$scope.diseaseClick=function(){if("Yes"==$scope.personalInfo.preDiseaseStatus)$scope.isDiseased=!0,$scope.toggleHealth();else{$scope.isDiseased=!1,$scope.selectedDisease.diseaseList.length=0,$scope.selectedDisease.diseaseList=[];for(var i=0;i<$scope.diseaseList.length;i++)$scope.diseaseList[i].familyList.length=0,$scope.diseaseList[i].familyList=[]}},$scope.modalHealth=!1,$scope.toggleHealth=function(){$scope.instantQuoteHealthForm||($scope.oldSelectedDiseaseList=angular.copy($scope.selectedDisease.diseaseList),$scope.modalHealth=!$scope.modalHealth,$(".md-click-catcher").click(function(){$(".md-select-menu-container").hide()}))},$scope.familyList.forEach(function(healthFamilyListGeneric){healthFamilyListGeneric.dob=calcDOBFromAge(healthFamilyListGeneric.age)}),$scope.modalFamily=!1,$scope.toggleFamily=function(){$scope.instantQuoteHealthForm||($scope.oldFamilyList=angular.copy($scope.familyList),$scope.modalFamily=!$scope.modalFamily),setTimeout(function(){$(".hiddenAge").each(function(){var hiddenVal=$(this).val();$(this).closest("span").find(".ageDropdown").val(hiddenVal)})},500)},$scope.validateAge=function(data,dob){var dateArr=dob.split("/"),newDOB=dateArr[1]+"/"+dateArr[0]+"/"+dateArr[2];data.age=calculateAgeByDOB(newDOB)},$scope.modalPIN=!1,$scope.togglePin=function(){$scope.instantQuoteHealthForm||($scope.modalPIN=!$scope.modalPIN,$scope.oldPincode=$scope.personalInfo.pincode,$scope.hideModal=function(){$scope.personalInfo.pincode=$scope.oldPincode,$scope.modalPIN=!1})},$scope.updateAnnualPremiumRange=function(minPremiumValue,maxPremiumValue){minPremiumValue>maxPremiumValue?($rootScope.minAnnualPremium=maxPremiumValue,$rootScope.maxAnnualPremium=minPremiumValue):($rootScope.minAnnualPremium=minPremiumValue,$rootScope.maxAnnualPremium=maxPremiumValue)},$scope.errorMessage=function(errorMsg){!$scope.errorRespCounter||"undefined"!==$rootScope.healthQuoteResult&&0!=$rootScope.healthQuoteResult.length?$rootScope.healthQuoteResult.length>0&&($rootScope.instantQuoteSummaryStatus=!0,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteHealthForm=!1,$rootScope.loading=!1):($scope.errorRespCounter=!1,$scope.updateAnnualPremiumRange(1e3,5e3),$rootScope.instantQuoteSummaryStatus=!1,$rootScope.instantQuoteSummaryError=errorMsg,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteHealthForm=!1,$rootScope.loading=!1)},$scope.tooltipPrepare=function(healthResult){var i;for($rootScope.riderOptionList="<ul style='text-align: left;' class='tickpoints'>",i=0;i<addOnCoverForHealth.length;i++)$rootScope.riderOptionList+="<li>"+addOnCoverForHealth[i].riderName+"</li>";$rootScope.riderOptionList+="</ul>";var resultCarrierId=[],testCarrierId=[];for(i=0;i<healthResult.length;i++)if(Number(healthResult[i].annualPremium)>0){var carrierInfo={};carrierInfo.id=healthResult[i].carrierId,carrierInfo.name=healthResult[i].insuranceCompany,carrierInfo.annualPremium=healthResult[i].annualPremium,carrierInfo.claimsRating=healthResult[i].insurerIndex,healthResult[i].totalCount&&(carrierInfo.totalCount=healthResult[i].totalCount),$rootScope.wordPressEnabled&&(carrierInfo.businessLineId="4",carrierInfo.sumInsured=healthResult[i].sumInsured),0==p365Includes(testCarrierId,healthResult[i].carrierId)&&(resultCarrierId.push(carrierInfo),testCarrierId.push(healthResult[i].carrierId))}for($rootScope.resultCarrierId=resultCarrierId,i=0;i<resultCarrierId.length;i++)$rootScope.quoteResultInsurerList+="<li>"+resultCarrierId[i].name+"</li>";$rootScope.quoteResultInsurerList+="</ul>",$rootScope.calculatedQuotesLength=2==String(healthResult.length).length?String(healthResult.length):"0"+String(healthResult.length),$rootScope.calculatedRidersLength=2==String(addOnCoverForHealth.length).length?String(addOnCoverForHealth.length):"0"+String(addOnCoverForHealth.length),setTimeout(function(){scrollv=new scrollable({wrapperid:"scrollable-v",moveby:4,mousedrag:!0})},3e3)},$scope.processResult=function(){if($rootScope.healthQuoteResult.length>0){$rootScope.enabledProgressLoader=!1,$rootScope.instantQuoteSummaryStatus=!0,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteHealthForm=!1,$rootScope.loading=!1,$rootScope.campaignFlag=!0,$rootScope.healthQuoteResult=$filter("orderBy")($rootScope.healthQuoteResult,"annualPremium");for(var minAnnualPremiumValue=$rootScope.healthQuoteResult[0].annualPremium,annualPremiumSliderArray=[],j=0;j<$rootScope.healthQuoteResult.length;j++){var calculatedDiscAmt=0,discountAmtList=$rootScope.healthQuoteResult[j].discountDetails;if("undefined"!=String(discountAmtList)){for(var i=0;i<discountAmtList.length;i++)calculatedDiscAmt+=discountAmtList[i]["com.sutrr.quote.healthquotecalc.DiscountDetails"].discountAmount;calculatedDiscAmt+=$rootScope.healthQuoteResult[j].annualPremium,annualPremiumSliderArray.push(calculatedDiscAmt)}else annualPremiumSliderArray.push($rootScope.healthQuoteResult[j].annualPremium)}annualPremiumSliderArray=$filter("orderBy")(annualPremiumSliderArray),$scope.updateAnnualPremiumRange(minAnnualPremiumValue,annualPremiumSliderArray[annualPremiumSliderArray.length-1]),localStorageService.get("selectedBusinessLineId")}},$scope.calculateHealthPremiumOnSubmit=function(){},$scope.changeHospitalLimit=function(hospitalisationLimit){$scope.hospitalisationLimit=hospitalisationLimit},$scope.singleClickHealthQuote=function(){setTimeout(function(){$rootScope.tabSelectionStatus=!1,$scope.errorRespCounter=!0,$scope.instantQuoteHealthForm=!1,$rootScope.loading=!0,$rootScope.quoteResultCount=0,$scope.quoteParam.dependent=[],$scope.quoteParam.preExistingDisease=[],$scope.personalInfo.selectedFamilyMembers=[],$scope.personalInfo.minHospitalisationLimit=$scope.hospitalisationLimit.minHosLimit,$scope.personalInfo.maxHospitalisationLimit=$scope.hospitalisationLimit.maxHosLimit,$scope.quoteParam.childCount=0,$scope.quoteParam.adultCount=0,$scope.quoteParam.totalCount=0;for(var familyCounter=0,i=0;i<$scope.familyList.length;i++)1==$scope.familyList[i].val&&(familyCounter+=1);for($scope.quoteParam.planType=familyCounter>1?"F":"I",1==$scope.isDiseased&&($scope.quoteParam.preExistingDisease=$scope.selectedDisease.diseaseList),i=0;i<$scope.familyList.length;i++)"Self"==$scope.familyList[i].member&&($scope.quoteParam.selfAge=Number($scope.familyList[i].age));for(i=0;i<$scope.familyList.length;i++)"Spouse"==$scope.familyList[i].member&&($scope.ratingParam.spouseAge=Number($scope.familyList[i].age));for($scope.ratingParam.minInsuredAge=Number($scope.familyList[0].age),$scope.ratingParam.maxInsuredAge=Number($scope.familyList[0].age),i=1;i<$scope.familyList.length;i++)$scope.familyList[i].age<$scope.ratingParam.minInsuredAge&&($scope.ratingParam.minInsuredAge=Number($scope.familyList[i].age)),$scope.familyList[i].age>$scope.ratingParam.minInsuredAge&&($scope.ratingParam.maxInsuredAge=Number($scope.familyList[i].age));for(i=0;i<$scope.familyList.length;i++)1==$scope.familyList[i].val&&((member={}).relationShip=$scope.familyList[i].relationship,member.age=Number($scope.familyList[i].age),"F"==$scope.quoteParam.selfGender&&"S"==$scope.quoteParam.selfRelationShip&&"S"==member.relationShip?member.gender="F":"F"==$scope.quoteParam.selfGender&&"S"==$scope.quoteParam.selfRelationShip&&"SP"==member.relationShip?member.gender="M":member.gender=$scope.familyList[i].gender,member.occupationClass=$scope.familyList[i].occupationClass,$scope.quoteParam.dependent.push(member));for($scope.personalInfo.selectedFamilyMembers=[],i=0;i<$scope.familyList.length;i++)1==$scope.familyList[i].val&&((member={}).id=Number($scope.familyList[i].id),member.age=Number($scope.familyList[i].age),member.dob=$scope.familyList[i].dob,member.existSince="",member.existSinceError=!1,member.status=!1,member.relationship=$scope.familyList[i].relationship,"F"==$scope.quoteParam.selfGender&&"S"==$scope.quoteParam.selfRelationShip&&"S"==member.relationship?member.gender="Female":"F"==$scope.quoteParam.selfGender&&"S"==$scope.quoteParam.selfRelationShip&&"SP"==member.relationship?member.gender="Male":member.gender="M"==$scope.familyList[i].gender?"Male":"Female",member.salutation="Male"==member.gender?"Mr":"Ms",member.relation=$scope.familyList[i].member,"Son"==member.relation||"Daughter"==member.relation?member.display=member.relation+" aged "+member.age:member.display=member.relation,$scope.personalInfo.selectedFamilyMembers.push(member));for(i=0;i<$scope.personalInfo.selectedFamilyMembers.length;i++){$scope.personalInfo.selectedFamilyMembers[i].dieaseDetails=[],$scope.dieaseDetails=[];for(var j=0;j<$scope.diseaseList.length;j++)if(1==p365Includes($scope.selectedDisease.diseaseList,$scope.diseaseList[j].diseaseId))for(var k=0;k<$scope.diseaseList[j].familyList.length;k++)if($scope.personalInfo.selectedFamilyMembers[i].id==$scope.diseaseList[j].familyList[k].id){$scope.diseaseList[j].familyList[k].status=!0;var dieaseDetails={};dieaseDetails.dieaseCode=$scope.diseaseList[j].diseaseId,dieaseDetails.dieaseName=$scope.diseaseList[j].disease,dieaseDetails.masterDieaseCode=$scope.diseaseList[j].diseaseCode,dieaseDetails.applicable=!0,$scope.dieaseDetails.push(dieaseDetails)}$scope.personalInfo.selectedFamilyMembers[i].dieaseDetails=$scope.dieaseDetails}for(i=0;i<$scope.quoteParam.dependent.length;i++)"CH"==$scope.quoteParam.dependent[i].relationShip&&$scope.quoteParam.dependent[i].age<=$scope.ratingParam.maxAllowedChildAge?$scope.quoteParam.childCount++:$scope.quoteParam.adultCount++;localStorageService.set("selectedBusinessLineId",4),$scope.quoteParam.totalCount=$scope.quoteParam.adultCount+$scope.quoteParam.childCount,$scope.quoteParam.documentType=$scope.p365Labels.documentType.quoteRequest,$scope.quoteParam.quoteType=localStorageService.get("selectedBusinessLineId"),$scope.quote.quoteParam=$scope.quoteParam,$scope.quote.ratingParam=$scope.ratingParam,$scope.quote.personalInfo=$scope.personalInfo,$scope.quote.requestType=$scope.p365Labels.request.healthRequestType,localStorageService.set("healthQuoteInputParamaters",$scope.quote),localStorageService.set("selectedArea",$scope.selectedArea),localStorageService.set("isDiseasedForHealth",$scope.isDiseased),localStorageService.set("selectedFamilyForHealth",$scope.familyList),localStorageService.set("selectedDisease",$scope.selectedDisease),localStorageService.set("selectedFamilyArray",$scope.selectedFamilyArray),localStorageService.set("diseaseList",$scope.diseaseList),$rootScope.hospitalisationLimit=$scope.hospitalisationLimit,localStorageService.set("hospitalisationLimitVal",$scope.hospitalisationLimit),localStorageService.set("healthQuoteInputParamatersReset",$scope.quote),localStorageService.set("selectedAreaReset",$scope.selectedArea),localStorageService.set("isDiseasedForHealthReset",$scope.isDiseased),localStorageService.set("selectedFamilyForHealthReset",$scope.familyList),localStorageService.set("selectedDiseaseReset",$scope.selectedDisease),localStorageService.set("selectedFamilyArrayReset",$scope.selectedFamilyArray),localStorageService.set("diseaseListReset",$scope.diseaseList),localStorageService.set("hospitalisationLimitValReset",$scope.hospitalisationLimit),localStorageService.get("PROF_QUOTE_ID")&&($scope.quote.PROF_QUOTE_ID=localStorageService.get("PROF_QUOTE_ID"));var quoteUserInfo=localStorageService.get("quoteUserInfo");quoteUserInfo&&($scope.quote.mobileNumber=quoteUserInfo.mobileNumber),campaignSource.utm_source&&($scope.quote.utm_source=campaignSource.utm_source),campaignSource.utm_medium&&($scope.quote.utm_medium=campaignSource.utm_medium),RestAPI.invoke($scope.p365Labels.getRequest.quoteHealth,$scope.quote).then(function(healthQuoteResult){$rootScope.healthQuoteRequest=[],healthQuoteResult.responseCode==$scope.p365Labels.responseCode.success?($scope.responseCodeList=[],$scope.requestId=healthQuoteResult.QUOTE_ID,localStorageService.set("HEALTH_UNIQUE_QUOTE_ID",$scope.requestId),$scope.UNIQUE_QUOTE_ID_ENCRYPTED=healthQuoteResult.encryptedQuoteId,localStorageService.set("HEALTH_UNIQUE_QUOTE_ID_ENCRYPTED",$scope.UNIQUE_QUOTE_ID_ENCRYPTED),console.log("$scope.UNIQUE_QUOTE_ID_ENCRYPTED",$scope.UNIQUE_QUOTE_ID_ENCRYPTED),$rootScope.healthQuoteRequest=healthQuoteResult.data,"undefined"!=String($rootScope.healthQuoteResult)&&$rootScope.healthQuoteResult.length>0&&($rootScope.healthQuoteResult.length=0),$rootScope.healthQuoteResult=[],angular.forEach($rootScope.healthQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=$scope.p365Labels.transactionName.healthQuoteResult,header.deviceId=deviceIdOrigin,campaignSource.utm_source&&(obj.utm_source=campaignSource.utm_source),campaignSource.utm_medium&&(obj.utm_medium=campaignSource.utm_medium),request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var healthQuoteResponse=JSON.parse(callback);if($rootScope.quoteResultCount+=1,healthQuoteResponse.QUOTE_ID==$scope.requestId)if($scope.responseCodeList.push(healthQuoteResponse.responseCode),healthQuoteResponse.responseCode==$scope.p365Labels.responseCode.success){for(var i=0;i<$rootScope.healthQuoteRequest.length;i++)$rootScope.healthQuoteRequest[i].messageId==healthQuoteResponse.messageId&&($rootScope.healthQuoteResult.push(healthQuoteResponse.data.quotes[0]),$rootScope.healthQuoteRequest[i].status=1);$scope.processResult()}else for(i=0;i<$rootScope.healthQuoteRequest.length;i++)$rootScope.healthQuoteRequest[i].messageId==healthQuoteResponse.messageId&&($rootScope.healthQuoteRequest[i].status=2,$rootScope.healthQuoteRequest[i].message=$sce.trustAsHtml($scope.p365Labels.validationMessages.generalisedMedicalErrMsg))}).error(function(data,status){$scope.responseCodeList.push($scope.p365Labels.responseCode.systemError)})}),$scope.$watch("responseCodeList",function(newValue,oldValue,scope){if(p365Includes($scope.responseCodeList,$scope.p365Labels.responseCode.success)&&($rootScope.loading=!1),$scope.responseCodeList.length==$rootScope.healthQuoteRequest.length){$rootScope.loading=!1;for(var i=0;i<$rootScope.healthQuoteRequest.length;i++)0==$rootScope.healthQuoteRequest[i].status&&($rootScope.healthQuoteRequest[i].status=2,$rootScope.healthQuoteRequest[i].message=$sce.trustAsHtml($scope.p365Labels.validationMessages.generalisedMedicalErrMsg));p365Includes($scope.responseCodeList,$scope.p365Labels.responseCode.success)||(p365Includes($scope.responseCodeList,$scope.p365Labels.responseCode.quoteNotAvailable)?$scope.errorMessage($scope.p365Labels.validationMessages.productNotFoundMsg):$scope.errorMessage($sce.trustAsHtml($scope.p365Labels.validationMessages.generalisedMedicalErrMsg)))}},!0)):($scope.responseCodeList=[],$rootScope.loading=!1,"undefined"!=String($rootScope.healthQuoteResult)&&$rootScope.healthQuoteResult.length>0&&($rootScope.healthQuoteResult.length=0),$rootScope.healthQuoteResult=[],$scope.errorMessage(healthQuoteResult.message))})},100)},$scope.$on("callSingleClickHealthQuote",function(){$scope.singleClickHealthQuote()}),$scope.fetchDefaultInputParamaters=function(defaultInputParamCallback){$scope.isDiseased=!1,$scope.quoteParam=defaultHealthQuoteParam.quoteParam,$scope.ratingParam=defaultHealthQuoteParam.ratingParam,$scope.personalInfo=defaultHealthQuoteParam.personalInfo;for(var i=0;i<$scope.hospitalizationLimitArray.length;i++)if($scope.hospitalizationLimitArray[i].minHosLimit<=$scope.personalInfo.hospitalisationLimit&&$scope.hospitalizationLimitArray[i].maxHosLimit>$scope.personalInfo.hospitalisationLimit){$scope.hospitalisationLimit=$scope.hospitalizationLimitArray[i];break}if($scope.personalInfo.preDiseaseStatus="No",$scope.personalInfo.pincode=localStorageService.get("cityDataFromIP")&&1==localStorageService.get("cityDataFromIP").cityStatus?localStorageService.get("cityDataFromIP").pincode:$scope.personalInfo.pincode,console.log("$rootScope.insuredGender::",$rootScope.insuredGender),$rootScope.insuredGender){var selectedGender=$rootScope.insuredGender;console.log("selectedGender is:",selectedGender),$scope.quoteParam.selfGender="Male"==selectedGender?"M":"F"}$rootScope.wordPressEnabled&&($scope.quote.quoteParam=$scope.quoteParam,$scope.quote.ratingParam=$scope.ratingParam,$scope.quote.personalInfo=$scope.personalInfo,$scope.quote.requestType=$scope.p365Labels.request.healthRequestType,localStorageService.set("healthQuoteInputParamaters",$scope.quote)),$scope.calcDefaultAreaDetails($scope.personalInfo.pincode)},null!=healthQuoteCookie&&"undefined"!==String(healthQuoteCookie)){if($scope.quote=healthQuoteCookie,$scope.quoteParam=healthQuoteCookie.quoteParam,$scope.personalInfo=healthQuoteCookie.personalInfo,$scope.ratingParam=healthQuoteCookie.ratingParam,$scope.familyList=localStorageService.get("selectedFamilyForHealth"),$scope.isDiseased=localStorageService.get("isDiseasedForHealth"),$scope.selectedArea=localStorageService.get("selectedArea"),localStorageService.get("selectedDisease")&&($scope.selectedDisease=localStorageService.get("selectedDisease")),$scope.selectedFamilyArray=localStorageService.get("selectedFamilyArray"),$scope.diseaseList=localStorageService.get("diseaseList"),$rootScope.wordPressEnabled)$scope.displayPincodeInfo=$scope.personalInfo.pincode+" - "+$scope.personalInfo.displayArea;else{var item=localStorageService.get("commAddressDetails");$scope.modalPIN=!1,$scope.selectedArea=item.area,$scope.personalInfo.pincode=item.pincode,$scope.personalInfo.displayArea=item.area+", "+item.city,$scope.personalInfo.city=item.city,$scope.displayPincodeInfo=item.pincode+" - "+$scope.personalInfo.displayArea}for(var i=0;i<$scope.hospitalizationLimitArray.length;i++)if($scope.hospitalizationLimitArray[i].minHosLimit<=$scope.personalInfo.hospitalisationLimit&&$scope.hospitalizationLimitArray[i].maxHosLimit>$scope.personalInfo.hospitalisationLimit){localStorageService.get("hospitalisationLimitVal")?$scope.hospitalisationLimit=localStorageService.get("hospitalisationLimitVal"):$scope.hospitalisationLimit=$scope.hospitalizationLimitArray[i];break}setTimeout(function(){$rootScope.wordPressEnabled||$scope.singleClickHealthQuote()},100)}else $scope.fetchDefaultInputParamaters(function(){});if(localStorageService.get("healthQuoteInputParamaters")&&($scope.quote=localStorageService.get("healthQuoteInputParamaters"),$scope.quoteParam=$scope.quote.quoteParam,$scope.personalInfo=localStorageService.get("healthQuoteInputParamaters").personalInfo),console.log("$rootScope.insuredGender::",$rootScope.insuredGender),$rootScope.insuredGender){var selectedGender=$rootScope.insuredGender;console.log("selectedGender is:",selectedGender),$scope.quoteParam.selfGender="Male"==selectedGender?"M":"F"}console.log("$scope.quoteParam.selfGender :",$scope.quoteParam.selfGender)})},localStorageService.get("ridersHealthStatus")?$scope.healthInstantQuoteCalculation(localStorageService.get("addOnCoverForHealth")):getRiderList(RestAPI,$scope.p365Labels.documentType.riderList,$scope.p365Labels.documentType.health,$scope.p365Labels.request.findAppConfig,function(addOnCoverForHealth){localStorageService.set("addOnCoverForHealth",addOnCoverForHealth),localStorageService.set("ridersHealthStatus",!0),getListFromDB(RestAPI,"","Disease",$scope.p365Labels.request.findAppConfig,function(callback){if(callback.responseCode==$scope.p365Labels.responseCode.success){for(var diseaseData=callback.data,i=0;i<diseaseData.length;i++)diseaseData[i].familyList=[];localStorageService.set("diseaseList",diseaseData),getListFromDB(RestAPI,"",$scope.p365Labels.documentType.hospitalizationLimit,$scope.p365Labels.request.findAppConfig,function(hospitalizationLimitList){if(hospitalizationLimitList.responseCode==$scope.p365Labels.responseCode.success&&(localStorageService.set("hospitalizationLimitList",hospitalizationLimitList.data),localStorageService.set("hospitalizationLimitListReset",hospitalizationLimitList.data)),localStorageService.get("selectedBusinessLineId"))var selectedBusinessLineId=localStorageService.get("selectedBusinessLineId");else selectedBusinessLineId=4;$scope.p365Labels.documentType.instantQuoteScreen;$scope.healthInstantQuoteCalculation(addOnCoverForHealth)})}else $rootScope.P365Alert("Policies365",$scope.p365Labels.validationMessages.generalisedErrMsg,"Ok")})}),setTimeout(function(){$(".hiddenAge").each(function(){var hiddenVal=$(this).val();$(this).closest("span").find(".ageDropdown").val(hiddenVal)})},2e3)}]);var jsonEncodeCarrierList=[];angular.module("healthResult",["CoreComponentApp","LocalStorageModule","ngMessages","checklist-model"]).controller("healthResultController",["$scope","$rootScope","$filter","$location","$http","RestAPI","localStorageService","$interval","$timeout","$sce","$anchorScroll",function($scope,$rootScope,$filter,$location,$http,RestAPI,localStorageService,$interval,$timeout,$sce,$anchorScroll){var setFlag=!1;$anchorScroll("home"),$rootScope.landingFlag=!1;var applicationLabels=localStorageService.get("applicationLabels");if($scope.globalLabel=applicationLabels.globalLabels,$scope.p365Labels=insHealthQuoteLabels,$rootScope.loaderContent={businessLine:"4",header:"Health Insurance",desc:$sce.trustAsHtml($scope.p365Labels.common.proverbResult)},$rootScope.title=$scope.p365Labels.policies365Title.medicalResultQuote,$scope.filterBenefitModal=!1,$rootScope.isBackButtonPressed=!1,$rootScope.disableLandingLeadBtn=!1,$scope.resultCnfrmBuyFlag=!1,$scope.buyConfrmFlag=!1,$scope.isRiderFormDirty=!1,$rootScope.wordPressEnabled?$scope.rippleColor="":$scope.rippleColor="#f8a201",$scope.EmailChoices=[{username:"",addNew:!0,paramMap:{docId:"",LOB:localStorageService.get("selectedBusinessLineId").toString(),userId:"",selectedPolicyType:""}}],$rootScope.isHealthLanding&&($scope.healthAffilatedLeadId=$sce.trustAsResourceUrl("https://tracking.icubeswire.co/aff_a?offer_id=1954&adv_sub1= "+messageIDVar+"&adv_sub2="+localStorageService.get("quoteUserInfo").mobileNumber),console.log("inside health landing $scope.healthAffilatedLeadId is: ",$scope.healthAffilatedLeadId)),$scope.healthFeaturesTemplate=wp_path+"buy/common/html/featureBenefitsHealth.html",$scope.healthPremiumTemplate=wp_path+"buy/common/html/healthPremiumTemplate.html",$scope.healthInputSectionHTML=wp_path+"buy/health/html/HealthInputSection.html",$scope.healthAddOnSectionHTML=wp_path+"buy/health/html/HealthAddOnSection.html",$scope.healthShareEmailSectionHTML=wp_path+"buy/health/html/HealthShareEmailSection.html","/PBHealthResult"==$location.path()&&($scope.PBHealthInputSection=wp_path+"buy/common/html/PBHTML/PBHealthInputSection.html",$scope.PBHealthRidersSection=wp_path+"buy/common/html/PBHTML/PBHealthRiderSection.html",$scope.PBHealthBestResultSection=wp_path+"buy/common/html/PBHTML/PBHealthBestResultSection.html",$scope.inputSectionEnabled=!0,$scope.ridersSectionEnabled=!1,$scope.resultSectionEnabled=!1,$scope.quoteRequest=localStorageService.get("professionalQuoteParams"),$scope.quoteRequest.commonInfo&&($scope.commonInfo=$scope.quoteRequest.commonInfo),$scope.quoteRequest.healthInfo&&($scope.healthInfo=$scope.quoteRequest.healthInfo),$scope.PBHealthRiderForm={},$scope.healthInputForm={}),localStorageService.get("userLoginInfo")&&($rootScope.userLoginStatus=localStorageService.get("userLoginInfo").status,$rootScope.username=localStorageService.get("userLoginInfo").username),localStorageService.get("PROF_QUOTE_ID_ENCRYPTED")&&($scope.UNIQUE_PROF_QUOTE_ID_ENCRYPTED=localStorageService.get("PROF_QUOTE_ID_ENCRYPTED")),$scope.healthInputSection=!1,$scope.riderInputSection=!1,$rootScope.loading=!0,$scope.quoteUserInfo={},$scope.quoteUserInfo.messageId="",$scope.quoteUserInfo.termsCondition=!0,$rootScope.agencyPortalEnabled){const quoteUserInfo=JSON.parse(localStorage.getItem("quoteUserInfo"));console.log("quoteUserInfo in agency car result is::",quoteUserInfo),quoteUserInfo&&($scope.quoteUserInfo=quoteUserInfo,localStorageService.set("quoteUserInfo",$scope.quoteUserInfo)),1==imauticAutomation&&imatHealthLeadQuoteInfo(localStorageService,$scope,"LeadSubmitted")}if($scope.UNIQUE_QUOTE_ID_ENCRYPTED=localStorageService.get("HEALTH_UNIQUE_QUOTE_ID_ENCRYPTED"),$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled){if($location.search().messageId&&(messageIDVar=$location.search().messageId),"undefined"!=String($location.search().leaddetails)){var leaddetails=JSON.parse($location.search().leaddetails);leaddetails.messageId||(leaddetails.messageId=$location.search().messageId),localStorageService.set("quoteUserInfo",leaddetails)}$scope.healthInputSection=!0,$scope.riderInputSection=!0}$scope.showPolicyDetails=function(){$scope.healthInputSection=!$scope.healthInputSection},$scope.showRiderDetails=function(){$scope.riderInputSection=!$scope.riderInputSection},$scope.backToResultScreen=function(){$rootScope.wordPressEnabled&&($rootScope.isBackButtonPressed=!0),$rootScope.isProfessionalJourneySelected?$location.path("/professionalJourneyResult"):$location.path("/PBQuote")},$scope.backToQuotes=function(){$location.path("/professionalJourneyResult")};$scope.p365Labels.documentType.quoteResultScreen,localStorageService.get("selectedBusinessLineId");$scope.declaration=function(){$rootScope.loading=!1,$scope.insuranceCompanyList={},$scope.insuranceCompanyList.selectedInsuranceCompany=[],$scope.quoteFinalResult={},$scope.quote={},$scope.ratingParam={},$scope.selectedDisease={},$scope.toDisplay={},$scope.mainFeature={},$scope.hospitalisationLimit={},$scope.medicalInstant={},$scope.hospitalList={},$scope.parent={},$scope.selectedFamilyArray=[],$scope.selectedDisease.diseaseList=[],$scope.selectedCarrierName={},$scope.selectedCarrierName.CompanyName=[],$scope.NoCoPayFeatures={name:"No Co-Pay",featureId:36,description:"Insurance companies deduct certain specified % of amount called Co-pay before settling the final claim amount and it is generally applicable beyond certain age.",riders:{riderId:38,riderName:"No Copay"},category:"Copay"},$scope.quote=localStorageService.get("healthQuoteInputParamaters"),$scope.quoteParam=localStorageService.get("healthQuoteInputParamaters").quoteParam,$scope.personalInfo=localStorageService.get("healthQuoteInputParamaters").personalInfo,$scope.selectedArea=localStorageService.get("selectedArea"),$scope.isDiseased=localStorageService.get("isDiseasedForHealth"),$scope.familyList=localStorageService.get("selectedFamilyForHealth"),$scope.selectedDisease=localStorageService.get("selectedDisease"),console.log("$scope.selectedDisease is: ",$scope.selectedDisease),$scope.selectedFamilyArray=localStorageService.get("selectedFamilyArray"),$scope.diseaseList=localStorageService.get("diseaseList"),console.log("$scope.diseaseList is: ",$scope.diseaseList),$scope.userGeoDetails=localStorageService.get("commAddressDetails"),$scope.hospitalList=localStorageService.get("hospitalList"),$scope.hospitalizationLimitArray=localStorageService.get("hospitalizationLimitList"),$scope.hospitalisationLimit=localStorageService.get("hospitalisationLimitVal"),$scope.quoteReset=localStorageService.get("healthQuoteInputParamatersReset"),$scope.quoteParamReset=localStorageService.get("healthQuoteInputParamatersReset").quoteParam,$scope.personalInfoReset=localStorageService.get("healthQuoteInputParamatersReset").personalInfo,$scope.selectedAreaReset=localStorageService.get("selectedAreaReset"),$scope.isDiseasedReset=localStorageService.get("isDiseasedForHealthReset"),$scope.familyListReset=localStorageService.get("selectedFamilyForHealthReset"),$scope.selectedDiseaseReset=localStorageService.get("selectedDiseaseReset"),$scope.selectedFamilyArrayReset=localStorageService.get("selectedFamilyArrayReset"),$scope.diseaseListReset=localStorageService.get("diseaseListReset"),$scope.hospitalListReset=localStorageService.get("hospitalListReset"),$scope.hospitalizationLimitArrayReset=localStorageService.get("hospitalizationLimitListReset"),$scope.hospitalisationLimitReset=localStorageService.get("hospitalisationLimitValReset"),$scope.quoteRequest=localStorageService.get("professionalQuoteParams"),$scope.quoteRequest&&($scope.commonInfo=$scope.quoteRequest.commonInfo,$scope.healthInfo=$scope.quoteRequest.healthInfo),localStorageService.get("healthRecommendedRiders")?$scope.recommendedHealthRiders=localStorageService.get("healthRecommendedRiders"):$scope.recommendedHealthRiders=[],localStorageService.get("selectedFeatures")?($rootScope.selectedFeatures=localStorageService.get("selectedFeatures"),console.log("$rootScope.selectedFeatures length is:",$rootScope.selectedFeatures)):$rootScope.selectedFeatures=[],localStorageService.get("addressDetails")&&($scope.addressDetails=localStorageService.get("addressDetails")),$scope.sortTypes=sortTypesHealthGeneric,$scope.planBenefits=planBenefitsGeneric,$scope.roomTypesArray=roomRentBenefitList,$scope.preExistingCoverages=preExistingCoveragesGeneric,$scope.genderType=genderTypeGeneric,$scope.preDiseaseStatus=preDiseaseStatusGeneric,$scope.selectedSortOption=$scope.sortTypes[0],$scope.parent.coverageAfter=[],$scope.activeSort=$scope.sortTypes[0].key,$scope.toDisplay.categoryFeature="Y",$scope.mainFeature.resultFeature="Y",setFlag=!1;$scope.expose=!1,$scope.disabledRiderCheckGroup=!0,$scope.medicalInstant.collapseFamilyList=!1,$scope.errorSectionButtonStatus=!0,$scope.parent.roomRentFeature=!1,$scope.parent.preExistingCoverageFeature=!1,$rootScope.modalShown=!1},$rootScope.healthQuoteRequest&&$rootScope.healthQuoteRequest.length==$rootScope.quoteResultCount&&$scope.quotesToShow&&0==$scope.quotesToShow.length&&($scope.noQuoteResultFound=!0,$rootScope.healthQuoteRequest=[],$rootScope.healthQuoteRequest.push({status:2,message:$sce.trustAsHtml($scope.p365Labels.validationMessages.generalisedErrMsg)})),$scope.init=function(){if($scope.quotesToShow=$rootScope.healthQuoteResult,$scope.quotesToShowCopy=angular.copy($scope.quotesToShow),angular.forEach($rootScope.healthQuoteResult,function(obj,i){$scope.selectedCarrierName.CompanyName.push(obj.insuranceCompany)}),console.log("$scope.quotesToShow::",$scope.quotesToShow),console.log("is professional journey::",$rootScope.professionalJourney),$scope.recommendedHealthRiders.length>0){for(var i=0;i<$scope.planBenefits.length;i++)for(var j=0;j<$scope.recommendedHealthRiders.length;j++)$scope.planBenefits[i].riders.riderId==$scope.recommendedHealthRiders[j].riderId&&($scope.planBenefits[i].isRecommended=!0);for(i=0;i<$scope.roomTypesArray.length;i++)for(j=0;j<$scope.recommendedHealthRiders.length;j++)$scope.roomTypesArray[i].riderId==$scope.recommendedHealthRiders[j].riderId&&($scope.roomTypesArray[i].isRecommended=!0)}$rootScope.consolidatedHospitalizationRelatedList=[],$rootScope.consolidatedPreventiveOutPatientRelatedList=[],$rootScope.consolidatedEnhancedCoverageList=[],$rootScope.consolidatedPreExistingDiseasesList=[];for(i=0;i<$scope.quotesToShow.length;i++)getAllProductFeatures($scope.quotesToShow[i],!0);$scope.validateAge=function(data,dob){var dateArr=dob.split("/"),newDOB=dateArr[1]+"/"+dateArr[0]+"/"+dateArr[2];data.age=calculateAgeByDOB(newDOB)},$scope.resetHealthInputDetails=function(){$scope.quoteParamCopy=angular.copy($scope.quoteParam),$scope.personalInfoCopy=angular.copy($scope.personalInfo),$scope.hospitalisationLimitCopy=angular.copy($scope.hospitalisationLimit),$scope.familyListCopy=angular.copy($scope.familyList),$scope.selectedDiseaseCopy=angular.copy($scope.selectedDisease),$scope.diseaseListCopy=angular.copy($scope.diseaseList),$rootScope.selectedFeatures.length>0&&($rootScope.selectedFeaturesCopy=angular.copy($rootScope.selectedFeatures)),$scope.quoteParam.riders&&$scope.quoteParam.riders.length>0&&($scope.riderCopy=angular.copy($scope.quoteParam.riders))},$scope.resetOnCancel=function(){angular.copy($scope.quoteParamCopy,$scope.quoteParam),angular.copy($scope.personalInfoCopy,$scope.personalInfo),angular.copy($scope.familyListCopy,$scope.familyList),angular.copy($scope.diseaseListCopy,$scope.diseaseList),angular.copy($scope.selectedDiseaseCopy,$scope.selectedDisease),angular.copy($scope.hospitalisationLimitCopy,$scope.hospitalisationLimit),$scope.selectedDisease.diseaseList.length>0?$scope.isDiseased=!0:$scope.isDiseased=!1,$scope.quoteHealthInputForm.healthInputForm.$setPristine(),$scope.quoteHealthInputForm.$setUntouched()},$scope.showEditInputSection=function(){$scope.inputSectionEnabled=!0,$scope.resultSectionEnabled=!1,$scope.ridersSectionEnabled=!1},$scope.backToRiderSection=function(){$scope.inputSectionEnabled=!1,$scope.resultSectionEnabled=!1,$scope.ridersSectionEnabled=!0},$scope.getProfessionalBestQuotes=function(){localStorageService.get("healthProductToBeAddedInCart")&&($scope.productInCart=localStorageService.get("healthProductToBeAddedInCart")),console.log("$scope.productInCart for health is:",$scope.productInCart),$scope.resultSectionEnabled=!0,$scope.inputSectionEnabled=!1,$scope.ridersSectionEnabled=!1,$rootScope.healthQuoteResult.length>0&&($scope.isGotHealthQuotes=!0),$scope.quoteHealthInputForm.$dirty||$scope.isRiderFormDirty?$scope.singleClickHealthQuote():$rootScope.healthQuote=$scope.productInCart},$scope.confirmInput=function(){$scope.parent.roomType=$scope.roomTypesArray[0],$scope.parent.coverageAfter=$scope.preExistingCoverages[0],$scope.inputSectionEnabled=!1,$scope.resultSectionEnabled=!1,$scope.ridersSectionEnabled=!0},$scope.getAgeArray=function(minAge,maxAge){for(var ageArray=[],i=0,j=minAge;j<=maxAge;i++,j++)ageArray[i]=j;return ageArray},$scope.noCoPayClick=function(isNoCoPayApplicable){if(isNoCoPayApplicable)$rootScope.selectedFeatures.push($scope.NoCoPayFeatures);else for(var i=0;i<$rootScope.selectedFeatures.length;i++)if($rootScope.selectedFeatures[i].riders.riderId==$scope.NoCoPayFeatures.riders.riderId){$rootScope.selectedFeatures.splice(i,1);break}console.log("$scope.selectedFeatures is::",$rootScope.selectedFeatures)},$scope.resetFeatures=function(){$rootScope.selectedFeatures.length>0?($rootScope.selectedFeatures=[],$scope.parent.coverageAfter=[],$scope.parent.roomType=[],$scope.isNoCoPayApplicable=!1,$scope.quoteParam.riders.length>0&&($scope.quoteHealthInputForm.$dirty=!0,$scope.quoteHealthInputForm.$setDirty(),setTimeout(function(){$scope.singleClickHealthQuote()},100)),console.log("$scope.selectedFeatures length after reset: ",JSON.stringify($rootScope.selectedFeatures.length))):($rootScope.selectedFeatures=[],$scope.parent.coverageAfter=[],$scope.parent.roomType=[],$scope.isNoCoPayApplicable=!1)},$scope.wordPressEnabled&&$scope.resetHealthInputDetails(),$scope.filterForFeatures=function(){var i,indexes=[],quoteFeatures=new Array($rootScope.healthQuoteResult.length);for(i=0;i<quoteFeatures.length;i++){for(var length,j=0;j<$rootScope.healthQuoteResult.length;j++)length=0,length=$rootScope.healthQuoteResult[j].featuresList[0].HospitalizationRelated.length+$rootScope.healthQuoteResult[j].featuresList[1].PreventiveOutPatientRelated.length+$rootScope.healthQuoteResult[j].featuresList[2].EnhancedCoverage.length+$rootScope.healthQuoteResult[j].featuresList[3].PreExistingDiseases.length;quoteFeatures[i]=new Array(length);var arr2=$rootScope.healthQuoteResult[i].featuresList[0].HospitalizationRelated.concat($rootScope.healthQuoteResult[i].featuresList[1].PreventiveOutPatientRelated).concat($rootScope.healthQuoteResult[i].featuresList[2].EnhancedCoverage);quoteFeatures[i]=arr2.concat($rootScope.healthQuoteResult[i].featuresList[3].PreExistingDiseases)}for(var p=0;p<quoteFeatures.length;p++){for(var counter=0,q=0;q<quoteFeatures[p].length;q++)for(var n=0;n<$rootScope.selectedFeatures.length;n++){if(quoteFeatures[p][q].featureId==$rootScope.selectedFeatures[n].featureId&&"Yes"==quoteFeatures[p][q].isFeatureAvailable)1==$rootScope.selectedFeatures[n].featureId&&quoteFeatures[p][q].valueLimit==$scope.parent.roomType.id?counter++:1!=$rootScope.selectedFeatures[n].featureId||4!=quoteFeatures[p][q].valueLimit||1!=$scope.parent.roomType.id&&2!=$scope.parent.roomType.id?60==$rootScope.selectedFeatures[n].featureId&&quoteFeatures[p][q].valueLimit==parseInt($scope.parent.coverageAfter.value)?counter++:36==$rootScope.selectedFeatures[n].featureId&&0==quoteFeatures[p][q].valueLimit?counter++:57==$rootScope.selectedFeatures[n].featureId||22==$rootScope.selectedFeatures[n].featureId||52==$rootScope.selectedFeatures[n].featureId?counter++:counter=0:counter++;else if(quoteFeatures[p][q].featureId==$rootScope.selectedFeatures[n].featureId&&"No"==quoteFeatures[p][q].isFeatureAvailable){counter=0;break}if(0==counter)break}counter>0&&indexes.push(p)}if($scope.quotesToShow=[],$rootScope.selectedFeatures.length>0)for(i=0;i<indexes.length;i++)indexes[i]>-1&&$scope.quotesToShow.push($rootScope.healthQuoteResult[indexes[i]]);else $scope.quotesToShow=$rootScope.healthQuoteResult;$scope.quotesToShow.length<=0&&($scope.errorSectionButtonStatus=!1,$scope.quoteCalculationError="No product are available for selected plan benefits.")},$scope.selected=[],$scope.quoteParam.riders=void 0==$scope.quoteParam.riders?[]:$scope.quoteParam.riders,$scope.addPreExistingCoverageAsFeature=function(item){if($scope.parent.preExistingCoverageFeature){var preExistingCoverageExist=!1;for(i=0;i<$rootScope.selectedFeatures.length;i++)if(60==$rootScope.selectedFeatures[i].featureId){preExistingCoverageExist=!0;break}if(preExistingCoverageExist){for(var index=0;index<$rootScope.selectedFeatures.length;index++)if($rootScope.selectedFeatures[index].featureId==item.featureId){$rootScope.selectedFeatures[index].value=item.value,$rootScope.selectedFeatures[index].featureId=item.featureId,$rootScope.selectedFeatures[index].name=item.name,$rootScope.selectedFeatures[index].category=item.category,$rootScope.selectedFeatures[index].subCategory=item.subCategory,$rootScope.selectedFeatures[index].display=item.display;break}}else $rootScope.selectedFeatures.push($scope.parent.coverageAfter)}else for(i=0;i<$rootScope.selectedFeatures.length;i++)if(60==$rootScope.selectedFeatures[i].featureId){$rootScope.selectedFeatures.splice(i,1);break}},$scope.addRoomRentAsFeature=function(item){if(43==item.riders.riderId)if($scope.parent.roomRentFeature){var roomRentExist=!1;for(i=0;i<$rootScope.selectedFeatures.length;i++)if(1==$rootScope.selectedFeatures[i].featureId||2==$rootScope.selectedFeatures[i].featureId||3==$rootScope.selectedFeatures[i].featureId||4==$rootScope.selectedFeatures[i].featureId){roomRentExist=!0;break}if(roomRentExist){for(var index=0;index<$rootScope.selectedFeatures.length;index++)if($rootScope.selectedFeatures[index].riders&&$rootScope.selectedFeatures[index].riders.riderId==item.riders.riderId){$rootScope.selectedFeatures[index].riders.value=item.riders.value,$rootScope.selectedFeatures[index].featureId=item.featureId,$rootScope.selectedFeatures[index].id=item.id,$rootScope.selectedFeatures[index].description=item.description;break}}else $rootScope.selectedFeatures.push($scope.parent.roomType)}else for(i=0;i<$rootScope.selectedFeatures.length;i++)if(1==$rootScope.selectedFeatures[i].featureId||2==$rootScope.selectedFeatures[i].featureId||3==$rootScope.selectedFeatures[i].featureId||4==$rootScope.selectedFeatures[i].featureId){$rootScope.selectedFeatures.splice(i,1);break}},$scope.featuresSelected=function(item,list,status){if($scope.quoteHealthInputForm.$dirty=!0,$scope.quoteHealthInputForm.$setDirty(),console.log("selected features is:",$rootScope.selectedFeatures),status){var i,idx=list.indexOf(item);if(console.log("index is:",idx),idx>-1)list.splice(idx,1),$scope.quoteParam.riders.splice(idx,1),console.log("list is:",list);else if($scope.quoteParam.riders.length>0){var roomRentExist=!1;console.log("$scope.quoteParam.riders  in step 1 is::",$scope.quoteParam.riders);for(var index=0;index<$scope.quoteParam.riders.length;index++)if($scope.quoteParam.riders[index].riderId==item.riders.riderId){$scope.quoteParam.riders[index].value=item.riders.value,console.log("inside if $scope.quoteParam.riders  in step 2 is::",$scope.quoteParam.riders),roomRentExist=!0;break}roomRentExist||($scope.quoteParam.riders.push(item.riders),list.push(item))}else $scope.quoteParam.riders.push(item.riders),console.log("$scope.quoteParam.riders in step 2 after push is::",$scope.quoteParam.riders),list.push(item);if(console.log("$scope.parent.roomRentFeature",$scope.parent.roomRentFeature),console.log("roomRentExist",roomRentExist),43==item.riders.riderId)if($scope.parent.roomRentFeature){roomRentExist=!1;for(i=0;i<$rootScope.selectedFeatures.length;i++)if(1==$rootScope.selectedFeatures[i].featureId||2==$rootScope.selectedFeatures[i].featureId||3==$rootScope.selectedFeatures[i].featureId||4==$rootScope.selectedFeatures[i].featureId){roomRentExist=!0;break}if(roomRentExist){for(index=0;index<$rootScope.selectedFeatures.length;index++)if($rootScope.selectedFeatures[index].riders&&$rootScope.selectedFeatures[index].riders.riderId==item.riders.riderId){$rootScope.selectedFeatures[index].riders.value=item.riders.value,$rootScope.selectedFeatures[index].featureId=item.featureId,$rootScope.selectedFeatures[index].id=item.id,$rootScope.selectedFeatures[index].category=item.category,$rootScope.selectedFeatures[index].subCategory=item.subCategory,$rootScope.selectedFeatures[index].description=item.description;break}}else $rootScope.selectedFeatures.push($scope.parent.roomType)}else for(i=0;i<$rootScope.selectedFeatures.length;i++)if(1==$rootScope.selectedFeatures[i].featureId||2==$rootScope.selectedFeatures[i].featureId||3==$rootScope.selectedFeatures[i].featureId||4==$rootScope.selectedFeatures[i].featureId){$rootScope.selectedFeatures.splice(i,1);break}console.log("$scope.selectedFeatures  length before filter is::",$rootScope.selectedFeatures.length),console.log("$scope.selectedFeatures before filter is::",$rootScope.selectedFeatures)}else if($scope.parent.preExistingCoverageFeature){var preExistingCoverageExist=!1;for(i=0;i<$rootScope.selectedFeatures.length;i++)if(60==$rootScope.selectedFeatures[i].featureId){preExistingCoverageExist=!0;break}if(preExistingCoverageExist){for(index=0;index<$rootScope.selectedFeatures.length;index++)if($rootScope.selectedFeatures[index].featureId==item.featureId){$rootScope.selectedFeatures[index].value=item.value,$rootScope.selectedFeatures[index].featureId=item.featureId,$rootScope.selectedFeatures[index].name=item.name,$rootScope.selectedFeatures[index].category=item.category,$rootScope.selectedFeatures[index].subCategory=item.subCategory,$rootScope.selectedFeatures[index].display=item.display;break}}else $rootScope.selectedFeatures.push($rootScope.parent.coverageAfter)}else for(i=0;i<$rootScope.selectedFeatures.length;i++)if(60==$rootScope.selectedFeatures[i].featureId){$rootScope.selectedFeatures.splice(i,1);break}},$scope.exists=function(item,list){return list.indexOf(item)>-1},$scope.checkFilterDropdowns=function(name){"roomType"==name&&1==$scope.planBenefits[4].val?$scope.filterForFeatures():"coverageAfter"==name&&1==$scope.planBenefits[5].val&&$scope.filterForFeatures()};var DOBOption={changeMonth:!0,changeYear:!0};DOBOption.dateFormat=DATE_FORMAT,$scope.DOBOptions=setP365DatePickerProperties(DOBOption);var member,dateRange={};$scope.$watch(function(scope){return scope.familyList},function(){$scope.selectedFamilyArray=[];for(var i=0;i<$scope.familyList.length;i++)"S"!=$scope.familyList[i].relationship&&"SP"!=$scope.familyList[i].relationship&&"A"!=$scope.familyList[i].relationship||(dateRange.minimumYearLimit="-99Y",dateRange.maximumYearLimit="-18Y",dateRange.changeMonth=!0,dateRange.changeYear=!0,dateRange.dateFormat=DATE_FORMAT),"CH"==$scope.familyList[i].relationship&&(dateRange.minimumYearLimit="-25Y - 1D",dateRange.maximumYearLimit="00Y",dateRange.changeMonth=!0,dateRange.changeYear=!0,dateRange.dateFormat=DATE_FORMAT),1==$scope.familyList[i].val&&((member={}).id=$scope.familyList[i].id,member.display=$scope.familyList[i].member,member.age=$scope.familyList[i].age,member.dob=$scope.familyList[i].dob,member.relation=$scope.familyList[i].relationship,$scope["DOBOptions"+i]=setP365DatePickerProperties(dateRange),member.existSince="",member.existSinceError=!1,member.status=!1,"Son"==member.relation||"Daughter"==member.relation?member.label=$scope.familyList[i].member.concat(" aged ").concat($scope.familyList[i].age):member.label=$scope.familyList[i].member,0,$scope.selectedFamilyArray.push(member))},!0),$scope.getPinCodeAreaList=function(areaName){var docType;return docType=isNaN(areaName)?"Area":"Pincode",$http.get(getServiceLink+docType+"&q="+areaName).then(function(response){return JSON.parse(response.data).data})},$scope.calcDefaultAreaDetails=function(areaCode){$http.get(getServiceLink+"Pincode&q="+areaCode).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.p365Labels.responseCode.success&&$scope.onSelectPinOrArea(areaDetails.data[0],!0)})},$scope.getHospitalList=function(){for(var splitStr=$scope.personalInfo.city.toLowerCase().split(" "),i=0;i<splitStr.length;i++)splitStr[i]=splitStr[i].charAt(0).toUpperCase()+splitStr[i].substring(1);var cityFormatted=splitStr.join(" ");getListFromDB(RestAPI,cityFormatted,"cashlessHospital",$scope.p365Labels.request.findAppConfig,function(hospitalList){hospitalList.responseCode==$scope.p365Labels.responseCode.success&&($scope.hospitalList=hospitalList.data,console.log("$scope.hospitalList",$scope.hospitalList),localStorageService.set("hospitalList",hospitalList.data))})},$scope.onSelectPinOrArea=function(item,dirtyStatus){item.area?$scope.displayArea=item.area+", "+item.district:$scope.displayArea=item.displayArea,$scope.modalPIN=!1,$scope.selectedArea=item.area,$scope.personalInfo.pincode=item.pincode,$scope.personalInfo.displayArea=$scope.displayArea,$scope.personalInfo.city=item.district,$scope.personalInfo.state=item.state,item.city=item.district,$scope.getHospitalList(),localStorageService.set("commAddressDetails",item),dirtyStatus&&($scope.quoteHealthInputForm.$dirty=!0,$scope.quoteHealthInputForm.healthInputForm.$setDirty())},$scope.openHospitalList=function(selCarrierId){$scope.hospitalModal=!$scope.hospitalModal,$rootScope.selCarrierId=selCarrierId},$scope.closeModalHospital=function(){$scope.hospitalModal=!1};$scope.addNewSon=function(index){for(var i=0;i<$scope.familyList.length;i++)"Son"==$scope.familyList[i].member&&1;$scope.familyList[index].iconFlag=!1,$scope.calculatedDOB=calcDOBFromAge(5),$scope.familyList.push({member:"Son",relation:"SON",visible:!0,age:5,gender:"M",relationship:"CH",occupationClass:2,val:!0,other:!1,mandatory:!1,minAge:1,maxAge:82,iconFlag:!0,dob:$scope.calculatedDOB})},$scope.addNewDaughter=function(index){for(var i=0;i<$scope.familyList.length;i++)"Daughter"==$scope.familyList[i].member&&1;$scope.familyList[index].iconFlag=!1,$scope.calculatedDOB=calcDOBFromAge(5),$scope.familyList.push({member:"Daughter",relation:"DAUGHTER",visible:!0,age:5,gender:"F",relationship:"CH",occupationClass:2,val:!0,other:!1,mandatory:!1,minAge:1,maxAge:25,iconFlag:!0,dob:$scope.calculatedDOB})},$scope.cardView=!0,$scope.compareView=!1,$scope.showCompareBtn=!0,$scope.showCardBtn=!0,$scope.disableSort=!1,$scope.compareViewClick=function(){$scope.dataLoaded=!0,$scope.slickLoaded=!0,$scope.cardView=!0,$scope.compareView=!1,$scope.showCompareBtn=!0,$scope.showCardBtn=!0,$scope.disableSort=!1},$scope.cardViewClick=function(){$scope.dataLoaded=!0,$scope.slickLoaded=!0,$scope.cardView=!1,$scope.compareView=!0,$scope.showCompareBtn=!0,$scope.showCardBtn=!0,$scope.disableSort=!0},$scope.findDisplayLimit=function(displayLimitValue){var returnvalue="NOT AVAILABLE";return null!=displayLimitValue&&(returnvalue=displayLimitValue),returnvalue},$scope.hospitalFeatures=function(hospitalizationRelated,selData){for(var returnHospitalFeatures="NA",i=0;i<selData.length;i++)selData[i].CompareName==hospitalizationRelated&&(selData[i].compareDisplayLimit||(selData[i].compareDisplayLimit="NA"),returnHospitalFeatures=selData[i].compareDisplayLimit);return returnHospitalFeatures},$scope.preventiveFeature=function(preventiveOutPatient,selData){for(var returnPreventiveFeatures="NA",i=0;i<selData.length;i++)selData[i].CompareName==preventiveOutPatient&&(selData[i].compareDisplayLimit||(selData[i].compareDisplayLimit="NA"),returnPreventiveFeatures=selData[i].compareDisplayLimit);return returnPreventiveFeatures},$scope.enhancedFeature=function(enhancedCoverage,selData){for(var returnEnhancedFeatures="NA",i=0;i<selData.length;i++)selData[i].CompareName==enhancedCoverage&&(selData[i].compareDisplayLimit||(selData[i].compareDisplayLimit="NA"),returnEnhancedFeatures=selData[i].compareDisplayLimit);return returnEnhancedFeatures},$scope.preExFeature=function(preExistingDisease,selData){for(var returnPreDiseaseFeatures="NA",i=0;i<selData.length;i++)selData[i].CompareName==preExistingDisease&&(selData[i].compareDisplayLimit||(selData[i].compareDisplayLimit="NA"),returnPreDiseaseFeatures=selData[i].compareDisplayLimit);return returnPreDiseaseFeatures},$scope.updateDiseaseList=function(){var i;for(i=0;i<$scope.diseaseList.length;i++)for(var j=0;j<$scope.diseaseList[i].familyList.length;j++)p365Includes($scope.selectedDisease.diseaseList,$scope.diseaseList[j].diseaseId)?0==p365Includes($scope.personalInfo.selFamilyMember,$scope.diseaseList[i].familyList[j].id)&&($scope.diseaseList[i].familyList.splice(j,1),j=0):$scope.diseaseList[i].familyList=[];var deleteList=[];for(i=0;i<$scope.diseaseList.length;i++)1==p365Includes($scope.selectedDisease.diseaseList,$scope.diseaseList[i].diseaseId)&&0==$scope.diseaseList[i].familyList.length&&deleteList.push($scope.diseaseList[i].diseaseId);$scope.selectedDisease.diseaseList=$scope.selectedDisease.diseaseList.filter(function(obj){return-1===deleteList.indexOf(obj)}),0==$scope.selectedDisease.diseaseList.length&&($scope.personalInfo.preDiseaseStatus="No",$scope.isDiseased=!1)},$scope.submitFamily=function(){var i,submitFamilyForm;submitFamilyForm=$scope.validateFamilyForm();var familyCounter=0,familyMemberExistStatus=!1;for(i=0;i<$scope.familyList.length;i++)1==$scope.familyList[i].val&&(familyMemberExistStatus=!0,familyCounter+=1);$scope.quoteParam.planType=familyCounter>1?"F":"I",familyMemberExistStatus?1==submitFamilyForm&&($scope.modalFamily=!1,$scope.quoteHealthInputForm.$setDirty(),$scope.quoteHealthInputForm.healthInputForm.$setDirty()):$scope.familyErrors.push("Please select atleast one member.")},$scope.validateFamilyForm=function(){$scope.familyErrors=[];var i,ageOfSelf,ageOfSpouse,ageOfFather,lesserAge,submitFamilyForm=!0;for(i=0;i<$scope.familyList.length;i++)"Self"==$scope.familyList[i].member?$scope.familyList[i].val?($scope.ratingParam.isSelf="Y",ageOfSelf=Number($scope.familyList[i].age)):$scope.ratingParam.isSelf="N":"Spouse"==$scope.familyList[i].member?$scope.familyList[i].val?($scope.ratingParam.isSpouse="Y",ageOfSpouse=Number($scope.familyList[i].age)):$scope.ratingParam.isSpouse="N":"Father"==$scope.familyList[i].member&&$scope.familyList[i].val&&(ageOfFather=Number($scope.familyList[i].age)),lesserAge="undefined"==ageOfSelf||""==ageOfSelf||null==ageOfSelf?ageOfSpouse:ageOfSpouse<ageOfSelf?ageOfSpouse:ageOfSelf,1==$scope.familyList[i].val&&("CH"==$scope.familyList[i].relationship&&$scope.familyList[i].age>lesserAge-1&&0==p365Includes($scope.familyErrors,"Please correct,Child age is same as or greater than the Parent's age")&&($scope.familyErrors.push("Please correct,Child age is same as or greater than the Parent's age"),submitFamilyForm=!1),("Father"==$scope.familyList[i].member||"Mother"==$scope.familyList[i].member)&&$scope.familyList[i].age<ageOfSelf+1&&0==p365Includes($scope.familyErrors,"Please correct,Your age is same as or greater than your Parent's age")&&($scope.familyErrors.push("Please correct,Your age is same as or greater than your Parent's age"),submitFamilyForm=!1),("Father-in-Law"==$scope.familyList[i].member||"Mother-in-Law"==$scope.familyList[i].member)&&$scope.familyList[i].age<ageOfSpouse+1&&0==p365Includes($scope.familyErrors,"Please correct, your Spouse's age is same as or greater than your In-Laws' age")&&($scope.familyErrors.push("Please correct, your Spouse's age is same as or greater than your In-Laws' age"),submitFamilyForm=!1),("Grand Father"==$scope.familyList[i].member||"Grand Mother"==$scope.familyList[i].member)&&$scope.familyList[i].age<ageOfFather+1&&$scope.familyList[i].age<ageOfSelf+2&&0==p365Includes($scope.familyErrors,"Please correct,your Father's age is same as or greater than your Grand Parents' age")&&($scope.familyErrors.push("Please correct,your Father's age is same as or greater than your Grand Parents' age"),submitFamilyForm=!1));return submitFamilyForm},$scope.closeFamilyMemberModal=function(){$scope.familyList=$scope.oldFamilyList,$scope.modalFamily=!1},$scope.closePreExistingDiseaseModal=function(){for(var deleteList=[],i=0;i<$scope.diseaseList.length;i++)1==p365Includes($scope.selectedDisease.diseaseList,$scope.diseaseList[i].diseaseId)&&0==$scope.diseaseList[i].familyList.length?deleteList.push($scope.diseaseList[i].diseaseId):0==p365Includes($scope.oldSelectedDiseaseList,$scope.diseaseList[i].diseaseId)&&deleteList.push($scope.diseaseList[i].diseaseId);$scope.selectedDisease.diseaseList=$scope.selectedDisease.diseaseList.filter(function(obj){return-1===deleteList.indexOf(obj)}),0==$scope.selectedDisease.diseaseList.length&&($scope.personalInfo.preDiseaseStatus="No",$scope.isDiseased=!1),$scope.modalHealth=!1},$scope.submitPreDiseaseList=function(){var i,submitDiseaseForm=!0;for($scope.ratingParam.criticalIllness="N",$scope.ratingParam.organDonar="N",i=0;i<$scope.diseaseList.length;i++)1==p365Includes($scope.selectedDisease.diseaseList,$scope.diseaseList[i].diseaseId)&&("OrganDonar"==$scope.diseaseList[i].diseaseType&&($scope.ratingParam.organDonar="Y"),"Critical"==$scope.diseaseList[i].diseaseType&&($scope.ratingParam.criticalIllness="Y"),0==$scope.diseaseList[i].familyList.length&&($scope.diseaseError="Please select family members against each selected disease",submitDiseaseForm=!1));if(submitDiseaseForm){for($scope.modalHealth=!1,$scope.diseaseError="",0==$scope.selectedDisease.diseaseList.length&&($scope.personalInfo.preDiseaseStatus="No",$scope.isDiseased=!1),i=0;i<$scope.diseaseList.length;i++)if($scope.diseaseList[i].familyList)for(var j=0;j<$scope.diseaseList[i].familyList.length;j++)for(var k=0;k<$scope.selectedFamilyArray.length;k++)$scope.diseaseList[i].familyList[j].id==$scope.selectedFamilyArray[k].id&&($scope.diseaseList[i].familyList[j].status=!0);$scope.quoteHealthInputForm.$setDirty()}},$scope.getDisease=function(){return $scope.selectedDisease.diseaseList},$scope.removeFamilyMember=function(data){data.val=!1},$scope.removePreDisease=function(data){var i;for(i=0;i<$scope.selectedDisease.diseaseList.length;i++)if($scope.selectedDisease.diseaseList[i]==data.diseaseId){$scope.selectedDisease.diseaseList.splice(i,1);break}for($rootScope.wordPressEnabled&&$scope.quoteHealthInputForm.healthInputForm.$setDirty(),i=0;i<$scope.diseaseList.length;i++)if($scope.diseaseList[i].diseaseId==data.diseaseId){$scope.diseaseList[i].familyList=[];break}0==$scope.selectedDisease.diseaseList.length&&($scope.personalInfo.preDiseaseStatus="No",$scope.isDiseased=!1),$scope.submitPreDiseaseList()},$scope.checkDisease=function(value,checked){var idx=$scope.selectedDisease.diseaseList.indexOf(value);idx>=0&&!checked&&$scope.selectedDisease.diseaseList.splice(idx,1),idx<0&&checked&&$scope.selectedDisease.diseaseList.push(value),console.log("$scope.selectedDisease.diseaseList in check disease: ",$scope.selectedDisease.diseaseList)},$scope.openMenu=function($mdOpenMenu,ev){$mdOpenMenu(ev),setTimeout(function(){$(".md-click-catcher").click(function(){$scope.activeMenu=""})},100)},$scope.clickForActive=function(item){$scope.activeMenu=item},$scope.clickForViewActive=function(item){$scope.activeViewMenu=item},$scope.clickForViewActive("Compare"),$scope.clicktoDisable=function(){setTimeout(function(){$(".md-click-catcher").css("pointer-events","none")},100)},$scope.rateit={readonly_enables:!0},$scope.diseaseClick=function(){if("Yes"==$scope.personalInfo.preDiseaseStatus)$scope.isDiseased=!0,$scope.toggleHealth();else{$scope.isDiseased=!1,$scope.selectedDisease.diseaseList.length=0,$scope.selectedDisease.diseaseList=[];for(var i=0;i<$scope.diseaseList.length;i++)$scope.diseaseList[i].familyList.length=0,$scope.diseaseList[i].familyList=[]}},$scope.modalHealth=!1,$scope.toggleHealth=function(){$scope.modalHealth=!$scope.modalHealth,$scope.oldSelectedDiseaseList=angular.copy($scope.selectedDisease.diseaseList)},$scope.modalFamily=!1,$scope.toggleFamily=function(){$scope.modalFamily=!$scope.modalFamily,$scope.oldFamilyList=angular.copy($scope.familyList)},$scope.modalPIN=!1,$scope.togglePin=function(){$scope.modalPIN=!$scope.modalPIN,$scope.oldPincode=$scope.personalInfo.pincode,$scope.hideModal=function(){$scope.personalInfo.pincode=$scope.oldPincode,$scope.modalPIN=!1}},$rootScope.editForMobile=function(){$rootScope.showonEdit="inline !important",$rootScope.hideonEdit="none !important",$scope.flagforMobile=!0};$scope.toggleChange=function(clickEvent){$rootScope.loading=!0,setTimeout(function(){if($(".firstPane").addClass("opened"),$(".firstPaneContent").show(),1==$(".viewDiv").is(":visible"));else if(1==$(".modifyDiv").is(":visible")&&"cancel"==clickEvent){var i;for($scope.getHospitalList(),$scope.quote=$scope.quoteReset,$scope.quoteParam=$scope.quoteReset.quoteParam,$scope.personalInfo=$scope.quoteReset.personalInfo,$scope.selectedArea=$scope.selectedArea,$scope.isDiseased=$scope.isDiseasedReset,$scope.familyList=$scope.familyListReset,$scope.selectedDisease=$scope.selectedDiseaseReset,$scope.selectedFamilyArray=$scope.selectedFamilyArrayReset,$scope.diseaseList=$scope.diseaseListReset,$scope.userGeoDetails=$scope.userGeoDetailsReset,$scope.hospitalList=$scope.hospitalListReset,$scope.hospitalizationLimitArray=$scope.hospitalizationLimitArrayReset,i=1;i<$scope.familyList.length;i++)$scope.familyList[i].age<$scope.ratingParam.minInsuredAge&&($scope.ratingParam.minInsuredAge=Number($scope.familyList[i].age)),$scope.familyList[i].age>$scope.ratingParam.minInsuredAge&&($scope.ratingParam.maxInsuredAge=Number($scope.familyList[i].age));for(i=0;i<$scope.familyList.length;i++)1==$scope.familyList[i].val&&((member={}).relationShip=$scope.familyList[i].relationship,member.age=Number($scope.familyList[i].age),"F"==$scope.quoteParam.selfGender&&"S"==$scope.quoteParam.selfRelationShip&&"S"==member.relationShip?member.gender="F":"F"==$scope.quoteParam.selfGender&&"S"==$scope.quoteParam.selfRelationShip&&"SP"==member.relationShip?member.gender="M":member.gender=$scope.familyList[i].gender,member.occupationClass=$scope.familyList[i].occupationClass,$scope.quoteParam.dependent.push(member));for(i=0;i<$scope.familyList.length;i++)1==$scope.familyList[i].val&&((member={}).id=Number($scope.familyList[i].id),member.age=Number($scope.familyList[i].age),member.dob=$scope.familyList[i].dob,member.salutation="M"==$scope.familyList[i].gender?"Mr":"Ms",member.existSince="",member.existSinceError=!1,member.status=!1,member.relationship=$scope.familyList[i].relationship,"F"==$scope.quoteParam.selfGender&&"S"==$scope.quoteParam.selfRelationShip&&"S"==$scope.familyList[i].relationship?member.gender="Female":"F"==$scope.quoteParam.selfGender&&"S"==$scope.quoteParam.selfRelationShip&&"SP"==$scope.familyList[i].relationship?member.gender="Male":member.gender="M"==$scope.familyList[i].gender?"Male":"Female",member.relation=$scope.familyList[i].member,"Son"==member.relation||"Daughter"==member.relation?member.display=member.relation+" aged "+member.age:member.display=member.relation,$scope.personalInfo.selectedFamilyMembers.push(member));for(i=0;i<$scope.personalInfo.selectedFamilyMembers.length;i++){$scope.personalInfo.selectedFamilyMembers[i].dieaseDetails=[],$scope.dieaseDetails=[];for(var j=0;j<$scope.diseaseList.length;j++)if(1==p365Includes($scope.selectedDisease.diseaseList,$scope.diseaseList[j].diseaseId))for(var k=0;k<$scope.diseaseList[j].familyList.length;k++)if($scope.personalInfo.selectedFamilyMembers[i].id==$scope.diseaseList[j].familyList[k].id){$scope.diseaseList[j].familyList[k].status=!0;var dieaseDetails={};dieaseDetails.dieaseCode=$scope.diseaseList[j].diseaseId,dieaseDetails.dieaseName=$scope.diseaseList[j].disease,dieaseDetails.masterDieaseCode=$scope.diseaseList[j].diseaseCode,dieaseDetails.applicable=!0,$scope.dieaseDetails.push(dieaseDetails)}$scope.personalInfo.selectedFamilyMembers[i].dieaseDetails=$scope.dieaseDetails}$scope.userGeoDetails=$scope.userGeoDetailsReset,$scope.hospitalList=$scope.hospitalListReset,$scope.hospitalizationLimitArray=$scope.hospitalizationLimitArrayReset,$scope.hospitalisationLimit=$scope.hospitalisationLimitReset,$rootScope.loading=!1}},500)},$scope.setfromController=!0,setFlag=!0,$scope.submitReportBtn=!1,$scope.editReportBtn=!0,$scope.toggleReportChange=function(){$(".thirdPane").addClass("opened"),$(".thirdPaneContent").show(),1==$(".viewReportDiv").is(":visible")?($(".modifyReportDiv").show(),$(".viewReportDiv").hide(),$scope.editReportBtn=!1,$scope.submitReportBtn=!0,$scope.cancelReportBtn=!0,setFlag=!1):1==$(".modifyReportDiv").is(":visible")&&($(".viewReportDiv").slideDown(),$(".modifyReportDiv").slideUp(),$scope.editReportBtn=!0,$scope.submitReportBtn=!1,$scope.cancelReportBtn=!1,setFlag=!0)},$scope.checkDisable=function(){$scope.setfromController=0!=setFlag},$(".toggleResetChange").click(function(){$(".viewReportDiv").slideDown(),$(".modifyReportDiv").slideUp(),$(this).closest(".InsideWrapper").find(".changeReportText").text("Edit"),$(this).closest(".InsideWrapper").find(".substituteIcon").addClass("changeicon"),$(this).closest(".InsideWrapper").find(".substituteIcon").removeClass("submiticon")}),$scope.tabs=[{title:"Hospitalisation Coverage",url:"hospitalisation.tpl.html",className:"tabs"},{title:"Preventive & Out-Patient",url:"preventive.tpl.html",className:"tabs"},{title:"Bonus/Additional Coverage",url:"enhanced.tpl.html",className:"tabs"},{title:"Exclusions & Shared Costs",url:"disease.tpl.html",className:"tabs"}],$scope.currentTab="hospitalisation.tpl.html",$scope.onClickTab=function(tab){tab.disabled||($scope.currentTab=tab.url)},$scope.isActiveTab=function(tabUrl){return tabUrl==$scope.currentTab},$scope.healthmodalBeneFeature=!1,$scope.viewBeneFeature=function(selectedData){$scope.healthmodalBeneFeature=!0,$scope.beneFeatures=selectedData},$scope.closeBeneFeatureHealth=function(){$scope.healthmodalBeneFeature=!1},$scope.errorRespCounter=!0,$scope.errorMessage=function(errorMsg){!$scope.errorRespCounter||"undefined"!=String($rootScope.healthQuoteResult)&&0!=$rootScope.healthQuoteResult.length?$rootScope.healthQuoteResult.length>0&&($scope.errorSectionButtonStatus=!0,$scope.quoteCalculationError="",$rootScope.viewOptionDisabled=!1,$rootScope.tabSelectionStatus=!0,$rootScope.loading=!1):($scope.errorRespCounter=!1,$scope.errorSectionButtonStatus=!0,$scope.quoteCalculationError=errorMsg,$rootScope.viewOptionDisabled=!0,$rootScope.tabSelectionStatus=!0,$rootScope.loading=!1)},$scope.fetchDefaultInputParamaters=function(defaultInputParamCallback){$scope.personalInfo.preDiseaseStatus="No",$scope.isDiseased=!1,$scope.quoteParam=defaultHealthQuoteParam.quoteParam,$scope.ratingParam=defaultHealthQuoteParam.ratingParam,$scope.personalInfo=defaultHealthQuoteParam.personalInfo,$scope.personalInfo.pincode=localStorageService.get("cityDataFromIP")&&1==localStorageService.get("cityDataFromIP").cityStatus?localStorageService.get("cityDataFromIP").pincode:$scope.personalInfo.pincode,$scope.calcDefaultAreaDetails($scope.personalInfo.pincode),defaultInputParamCallback()},$scope.calculateDefaultQuote=function(errorFlag){localStorageService.remove("healthQuoteInputParamaters"),0==errorFlag?$location.path("/quote"):($scope.quoteHealthInputForm.$setDirty(),$scope.selectedFamilyArray=[],$scope.selectedDisease.diseaseList=[],$scope.parent.roomRentFeature=!1,$scope.parent.preExistingCoverageFeature=!1,$scope.familyList=healthFamilyListGeneric,$scope.fetchDefaultInputParamaters(function(){$scope.singleClickHealthQuote()}))},$scope.customFilterHealth=function(){$scope.netPremiumTotalHealth=0,$scope.netPremiumAverageHealth=0,$scope.netPremiumMaxHealth=0,$scope.proffesionalRatingHealth=0;for(var i=0;i<$scope.quotesToShow.length;i++)$scope.netPremiumTotalHealth+=$scope.quotesToShow[i].premiumRatio,$scope.netPremiumAverageHealth=Number(($scope.netPremiumTotalHealth/$scope.quotesToShow.length).toFixed(5));for(i=0;i<$scope.quotesToShow.length;i++)$scope.quotesToShow[i].netPremiumMax=Number(($scope.netPremiumAverageHealth/$scope.quotesToShow[i].premiumRatio).toFixed(5)),$scope.quotesToShow[i].netPremiumMax>$scope.netPremiumMaxHealth&&($scope.netPremiumMaxHealth=$scope.quotesToShow[i].netPremiumMax);for(i=0;i<$scope.quotesToShow.length;i++)$scope.quotesToShow[i].netPremiumMean=Number(($scope.quotesToShow[i].netPremiumMax/$scope.netPremiumMaxHealth*5).toFixed(1)),$scope.quotesToShow[i].proffesionalRating=.3*$scope.quotesToShow[i].netPremiumMean+.2*$scope.quotesToShow[i].hospitalIndex+.3*$scope.quotesToShow[i].benefitIndex+.2*$scope.quotesToShow[i].insurerIndex,$scope.quotesToShow[i].proffesionalRating=$scope.quotesToShow[i].proffesionalRating;return $scope.quotesToShow=$filter("orderBy")($scope.quotesToShow,"proffesionalRating"),$scope.quotesToShow=$scope.quotesToShow,$scope.sortReverse=!0,!0},$scope.customFilterHealthSelectedProduct=function(){$scope.netPremiumTotalHealth=0,$scope.netPremiumAverageHealth=0,$scope.netPremiumMaxHealth=0,$scope.proffesionalRatingHealth=0;for(var i=0;i<$scope.quotesToShow.length;i++)$scope.netPremiumTotalHealth+=$scope.quotesToShow[i].premiumRatio,$scope.netPremiumAverageHealth=Number(($scope.netPremiumTotalHealth/$scope.quotesToShow.length).toFixed(5));for(i=0;i<$scope.quotesToShow.length;i++)$scope.quotesToShow[i].netPremiumMax=Number(($scope.netPremiumAverageHealth/$scope.quotesToShow[i].premiumRatio).toFixed(5)),$scope.quotesToShow[i].netPremiumMax>$scope.netPremiumMaxHealth&&($scope.netPremiumMaxHealth=$scope.quotesToShow[i].netPremiumMax);for(i=0;i<$scope.quotesToShow.length;i++)$scope.quotesToShow[i].netPremiumMean=Number(($scope.quotesToShow[i].netPremiumMax/$scope.netPremiumMaxHealth*5).toFixed(1)),$scope.quotesToShow[i].proffesionalRating=.3*$scope.quotesToShow[i].netPremiumMean+.2*$scope.quotesToShow[i].hospitalIndex+.3*$scope.quotesToShow[i].benefitIndex+.2*$scope.quotesToShow[i].insurerIndex,$scope.quotesToShow[i].proffesionalRating=$scope.quotesToShow[i].proffesionalRating;console.log('localStorageService.get("healthProductToBeAddedInCart in step 1:',localStorageService.get("healthProductToBeAddedInCart"));var carrierAllReadyAdded=!1;if(localStorageService.get("healthProductToBeAddedInCart")){for(i=0;i<$scope.quotesToShow.length;i++)if(localStorageService.get("healthProductToBeAddedInCart").carrierId&&localStorageService.get("healthProductToBeAddedInCart").planId&&localStorageService.get("healthProductToBeAddedInCart").childPlanId){if(localStorageService.get("healthProductToBeAddedInCart").carrierId==$scope.quotesToShow[i].carrierId&&localStorageService.get("healthProductToBeAddedInCart").planId==$scope.quotesToShow[i].planId&&localStorageService.get("healthProductToBeAddedInCart").childPlanId==$scope.quotesToShow[i].childPlanId){console.log('localStorageService.get("healthProductToBeAddedInCart in step 2:',$scope.quotesToShow[i]),$scope.selectProduct($scope.quotesToShow[i],!1),$rootScope.healthQuote=$scope.quotesToShow[i];carrierAllReadyAdded=!0;break}}else if(localStorageService.get("healthProductToBeAddedInCart").carrierId&&localStorageService.get("healthProductToBeAddedInCart").planId&&localStorageService.get("healthProductToBeAddedInCart").carrierId==$scope.quotesToShow[i].carrierId&&localStorageService.get("healthProductToBeAddedInCart").planId==$scope.quotesToShow[i].planId){console.log('localStorageService.get("healthProductToBeAddedInCart in step 3:',$scope.quotesToShow[i]),$scope.selectProduct($scope.quotesToShow[i],!1),$rootScope.healthQuote=$scope.quotesToShow[i];carrierAllReadyAdded=!0;break}carrierAllReadyAdded?$scope.isGotHealthQuotes=!0:($scope.customFilterHealth(),$rootScope.healthQuote=$scope.quotesToShow[0],$scope.isGotHealthQuotes=!0)}},$scope.processResult=function(){$rootScope.viewOptionDisabled=!1,$rootScope.tabSelectionStatus=!0,$rootScope.modalShown=!1,$rootScope.loading=!1,console.log("inside health premium step 2"),$scope.quotesToShow=$rootScope.healthQuoteResult,$scope.quotesToShowCopy=angular.copy($scope.quotesToShow),console.log("inside health premium step 2",$scope.quotesToShowCopy.length),$scope.selectedCarrierName.CompanyName=[],angular.forEach($scope.quotesToShowCopy,function(obj,i){$scope.selectedCarrierName.CompanyName.push(obj.insuranceCompany)})},$scope.isMinPremium=function(annualPremiumValue,carrierIDValue){if("undefined"!=String($rootScope.healthQuoteResult[0])){for(var min=$rootScope.healthQuoteResult[0].annualPremium,i=0;i<=$rootScope.healthQuoteResult.length-1;i++){var carrierIdMin=$rootScope.healthQuoteResult[i].carrierId;Number($rootScope.healthQuoteResult[i].annualPremium)<min&&(min=$rootScope.healthQuoteResult[i].annualPremium,carrierIDValue=carrierIdMin)}return min===annualPremiumValue&&($scope.selMinCarrierId=carrierIDValue,!0)}},$scope.singleClickHealthQuote=function(){console.log("$scope.quoteHealthInputForm.$dirty : ",$scope.quoteHealthInputForm.$dirty),$scope.quoteHealthInputForm.$dirty||$scope.isRiderFormDirty?setTimeout(function(){for($scope.flagforMobile&&($rootScope.showonEdit="none !important",$rootScope.hideonEdit="inline !important",$scope.flagforMobile=!1),$scope.dataLoaded=!1,$rootScope.modalShown=!0,$scope.errorRespCounter=!0,$scope.filterBenefitModal=!1,$scope.isRiderFormDirty=!1,$rootScope.loading=!0,$scope.noQuoteResultFound=!1,$scope.isGotHealthQuotes=!1,$scope.quoteParam.dependent=[],$scope.quoteParam.preExistingDisease=[],$scope.quoteParam.riders=[],$scope.personalInfo.selectedFamilyMembers=[],$scope.buyConfrmFlag?($scope.resultCnfrmBuyFlag=!0,$scope.buyConfrmFlag=!1):$scope.resultCnfrmBuyFlag=!1,$scope.personalInfo.minHospitalisationLimit=$scope.hospitalisationLimit.minHosLimit,$scope.personalInfo.maxHospitalisationLimit=$scope.hospitalisationLimit.maxHosLimit,$scope.personalInfo.hospitalisationLimitDisplayValue=$scope.hospitalisationLimit.displayValue,$scope.quoteParam.childCount=0,$scope.quoteParam.adultCount=0,$scope.quoteParam.totalCount=0,localStorageService.get("quoteUserInfo")&&localStorageService.get("quoteUserInfo").mobileNumber&&($scope.quote.mobileNumber=localStorageService.get("quoteUserInfo").mobileNumber),$scope.validateFamilyForm(),1==$scope.isDiseased&&($scope.quoteParam.preExistingDisease=$scope.selectedDisease.diseaseList),i=0;i<$scope.familyList.length;i++)"Self"==$scope.familyList[i].member&&($scope.quoteParam.selfAge=Number($scope.familyList[i].age));for(i=0;i<$scope.familyList.length;i++)"Spouse"==$scope.familyList[i].member&&($scope.ratingParam.spouseAge=Number($scope.familyList[i].age));for($scope.ratingParam.minInsuredAge=Number($scope.familyList[0].age),$scope.ratingParam.maxInsuredAge=Number($scope.familyList[0].age),i=1;i<$scope.familyList.length;i++)$scope.familyList[i].age<$scope.ratingParam.minInsuredAge&&($scope.ratingParam.minInsuredAge=Number($scope.familyList[i].age)),$scope.familyList[i].age>$scope.ratingParam.minInsuredAge&&($scope.ratingParam.maxInsuredAge=Number($scope.familyList[i].age));for(i=0;i<$scope.familyList.length;i++)1==$scope.familyList[i].val&&((member={}).relationShip=$scope.familyList[i].relationship,member.age=Number($scope.familyList[i].age),"F"==$scope.quoteParam.selfGender&&"S"==$scope.quoteParam.selfRelationShip&&"S"==member.relationShip?member.gender="F":"F"==$scope.quoteParam.selfGender&&"S"==$scope.quoteParam.selfRelationShip&&"SP"==member.relationShip?member.gender="M":member.gender=$scope.familyList[i].gender,member.occupationClass=$scope.familyList[i].occupationClass,$scope.quoteParam.dependent.push(member));for(i=0;i<$scope.familyList.length;i++)1==$scope.familyList[i].val&&((member={}).id=Number($scope.familyList[i].id),member.age=Number($scope.familyList[i].age),member.dob=$scope.familyList[i].dob,member.salutation="M"==$scope.familyList[i].gender?"Mr":"Ms",member.existSince="",member.existSinceError=!1,member.status=!1,member.relationship=$scope.familyList[i].relationship,"F"==$scope.quoteParam.selfGender&&"S"==$scope.quoteParam.selfRelationShip&&"S"==$scope.familyList[i].relationship?member.gender="Female":"F"==$scope.quoteParam.selfGender&&"S"==$scope.quoteParam.selfRelationShip&&"SP"==$scope.familyList[i].relationship?member.gender="Male":member.gender="M"==$scope.familyList[i].gender?"Male":"Female",member.relation=$scope.familyList[i].member,"Son"==member.relation||"Daughter"==member.relation?member.display=member.relation+" aged "+member.age:member.display=member.relation,$scope.personalInfo.selectedFamilyMembers.push(member));for(i=0;i<$scope.personalInfo.selectedFamilyMembers.length;i++){$scope.personalInfo.selectedFamilyMembers[i].dieaseDetails=[],$scope.dieaseDetails=[];for(var j=0;j<$scope.diseaseList.length;j++)if(1==p365Includes($scope.selectedDisease.diseaseList,$scope.diseaseList[j].diseaseId))for(var k=0;k<$scope.diseaseList[j].familyList.length;k++)if($scope.personalInfo.selectedFamilyMembers[i].id==$scope.diseaseList[j].familyList[k].id){$scope.diseaseList[j].familyList[k].status=!0;var dieaseDetails={};dieaseDetails.dieaseCode=$scope.diseaseList[j].diseaseId,dieaseDetails.dieaseName=$scope.diseaseList[j].disease,dieaseDetails.masterDieaseCode=$scope.diseaseList[j].diseaseCode,dieaseDetails.applicable=!0,$scope.dieaseDetails.push(dieaseDetails)}$scope.personalInfo.selectedFamilyMembers[i].dieaseDetails=$scope.dieaseDetails}$scope.ratingParam.maxAllowedChildAge=$scope.quote.ratingParam.maxAllowedChildAge;for(var i=0;i<$scope.quoteParam.dependent.length;i++)"CH"==$scope.quoteParam.dependent[i].relationShip&&$scope.quoteParam.dependent[i].age<=$scope.ratingParam.maxAllowedChildAge?$scope.quoteParam.childCount++:$scope.quoteParam.adultCount++;var familyCounter=0;for(i=0;i<$scope.familyList.length;i++)1==$scope.familyList[i].val&&(familyCounter+=1);$scope.quoteParam.planType=familyCounter>1?"F":"I";for(i=0;i<$rootScope.selectedFeatures.length;i++)60!=$rootScope.selectedFeatures[i].featureId&&$scope.quoteParam.riders.push($rootScope.selectedFeatures[i].riders);$scope.quoteParam.totalCount=$scope.quoteParam.adultCount+$scope.quoteParam.childCount,$scope.quoteParam.documentType=$scope.p365Labels.documentType.quoteRequest,$scope.quoteParam.quoteType=localStorageService.get("selectedBusinessLineId"),$scope.quote.quoteParam=$scope.quoteParam,$scope.quote.ratingParam=$scope.ratingParam,$scope.quote.personalInfo=$scope.personalInfo,$scope.quote.requestType=$scope.p365Labels.request.healthRequestType,localStorageService.set("healthQuoteInputParamaters",$scope.quote),localStorageService.set("selectedArea",$scope.selectedArea),localStorageService.set("isDiseasedForHealth",$scope.isDiseased),localStorageService.set("selectedFamilyForHealth",$scope.familyList),localStorageService.set("selectedDisease",$scope.selectedDisease),console.log("$scope.selectedDisease in single click : "+JSON.stringify($scope.selectedDisease)),localStorageService.set("selectedFamilyArray",$scope.selectedFamilyArray),localStorageService.set("diseaseList",$scope.diseaseList),localStorageService.set("hospitalisationLimitVal",$scope.hospitalisationLimit),localStorageService.set("selectedFeatures",$rootScope.selectedFeatures),localStorageService.get("PROF_QUOTE_ID")&&($scope.quote.PROF_QUOTE_ID=localStorageService.get("PROF_QUOTE_ID")),$rootScope.wordPressEnabled&&$scope.resetHealthInputDetails(),campaignSource.utm_source&&($scope.quote.utm_source=campaignSource.utm_source),campaignSource.utm_medium&&($scope.quote.utm_medium=campaignSource.utm_medium),$scope.quoteHealthInputForm.$setPristine(),$scope.quoteHealthInputForm.$setUntouched(),$rootScope.consolidatedHospitalizationRelatedList=[],$rootScope.consolidatedPreventiveOutPatientRelatedList=[],$rootScope.consolidatedEnhancedCoverageList=[],$rootScope.consolidatedPreExistingDiseasesList=[],$rootScope.healthQuoteResult=[],RestAPI.invoke($scope.p365Labels.getRequest.quoteHealth,$scope.quote).then(function(healthQuoteResult){if($scope.quotesToShow=[],$rootScope.healthQuoteRequest=[],healthQuoteResult.responseCode==$scope.p365Labels.responseCode.success){$scope.responseCodeList=[],$scope.dataLoaded=!0,$scope.requestId=healthQuoteResult.QUOTE_ID,localStorageService.set("HEALTH_UNIQUE_QUOTE_ID",$scope.requestId),$scope.UNIQUE_QUOTE_ID_ENCRYPTED=healthQuoteResult.encryptedQuoteId,localStorageService.set("HEALTH_UNIQUE_QUOTE_ID_ENCRYPTED",$scope.UNIQUE_QUOTE_ID_ENCRYPTED),console.log("$scope.UNIQUE_QUOTE_ID_ENCRYPTED",$scope.UNIQUE_QUOTE_ID_ENCRYPTED),$rootScope.healthQuoteRequest=healthQuoteResult.data,"undefined"!=String($rootScope.healthQuoteResult)&&$rootScope.healthQuoteResult.length>0&&($rootScope.healthQuoteResult.length=0),$scope.quoteUserInfo=localStorageService.get("quoteUserInfo"),localStorageService.get("professionalQuoteParams")&&($scope.professionalParam=localStorageService.get("professionalQuoteParams")),1==imauticAutomation&&imatHealthLeadQuoteInfo(localStorageService,$scope,"ViewQuote");var quoteResultCount=0;angular.forEach($rootScope.healthQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=$scope.p365Labels.transactionName.healthQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,campaignSource.utm_source&&(obj.utm_campaign=campaignSource.utm_source),campaignSource.utm_medium&&(obj.utm_medium=campaignSource.utm_medium),request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var healthQuoteResponse=JSON.parse(callback);if(quoteResultCount+=1,healthQuoteResponse.QUOTE_ID==$scope.requestId)if($scope.responseCodeList.push(healthQuoteResponse.responseCode),healthQuoteResponse.responseCode==$scope.p365Labels.responseCode.success){for(var i=0;i<$rootScope.healthQuoteRequest.length;i++)$rootScope.healthQuoteRequest[i].messageId==healthQuoteResponse.messageId&&(Number(healthQuoteResponse.data.quotes[0].annualPremium>0)&&(console.log("inside health premium step 1"),$rootScope.loading=!1,$rootScope.healthQuoteResult.push(healthQuoteResponse.data.quotes[0])),getAllProductFeatures(healthQuoteResponse.data.quotes[0],!0),$rootScope.healthQuoteRequest[i].status=1);$scope.processResult()}else{$rootScope.healthQuoteRequest.length==quoteResultCount&&($scope.loading=!1,0==$rootScope.healthQuoteResult.length&&($scope.noQuoteResultFound=!0,console.log("noQuoteResultFound flag is::",$scope.noQuoteResultFound)));for(i=0;i<$rootScope.healthQuoteRequest.length;i++)$rootScope.healthQuoteRequest[i].messageId==healthQuoteResponse.messageId&&($rootScope.healthQuoteRequest[i].status=2,$rootScope.healthQuoteRequest[i].message=$sce.trustAsHtml($scope.p365Labels.validationMessages.generalisedMedicalErrMsg))}}).error(function(data,status){$scope.responseCodeList.push($scope.p365Labels.responseCode.systemError)})}),$scope.$watch("responseCodeList",function(newValue,oldValue,scope){if(p365Includes($scope.responseCodeList,$scope.p365Labels.responseCode.success)&&$scope.responseCodeList.length==$rootScope.healthQuoteRequest.length){for(var i=0;i<$rootScope.healthQuoteRequest.length;i++)0==$rootScope.healthQuoteRequest[i].status&&($rootScope.healthQuoteRequest[i].status=2,$rootScope.healthQuoteRequest[i].message=$sce.trustAsHtml($scope.p365Labels.validationMessages.generalisedMedicalErrMsg));p365Includes($scope.responseCodeList,$scope.p365Labels.responseCode.success)||(p365Includes($scope.responseCodeList,$scope.p365Labels.responseCode.quoteNotAvailable)?$scope.errorMessage($scope.p365Labels.validationMessages.productNotFoundMsg):$scope.errorMessage($scope.p365Labels.validationMessages.generalisedErrMsg))}},!0)}else $rootScope.loading=!1,$scope.responseCodeList=[],$rootScope.healthQuoteRequest.push({status:2,message:$sce.trustAsHtml($scope.p365Labels.validationMessages.generalisedErrMsg)}),$scope.noQuoteResultFound=!0,console.log("noQuoteResultFound flag  in step 2 is::",$scope.noQuoteResultFound),"undefined"!=String($rootScope.healthQuoteResult)&&$rootScope.healthQuoteResult.length>0&&($rootScope.healthQuoteResult.length=0),$rootScope.healthQuoteResult=[],$scope.errorMessage(healthQuoteResult.message)})},100):$scope.filterBenefitModal=!1},$scope.calculateQuoteOnSubmit=function(){$scope.quoteHealthInputForm.$dirty=!0,$scope.quoteHealthInputForm.$setDirty()},$scope.changeHospitalLimit=function(hospitalisationLimit){setTimeout(function(){$scope.hospitalisationLimit=hospitalisationLimit},100)},window.screen.width<768?($scope.mobileFit=!0,$scope.webFit=!1):($scope.mobileFit=!1,$scope.webFit=!0),$scope.state=!1,$scope.toggleState=function(){$scope.state=!$scope.state},$scope.toggleBasicExpanded=function(){$scope.basicExpanded=!$scope.basicExpanded},$scope.applyPreExistingCoverageFilter=function(data){if(!($scope.parent.coverageAfter.length>0))return data;if(console.log("$scope.parent.coverageAfter is present ..falatupana"),data.featuresList){for(var preExistingCoverageApplicable=!1,j=0;j<data.featuresList.length;j++)if(data.featuresList[j].PreExistingDiseases)for(var k=0;k<data.featuresList[j].PreExistingDiseases.length;k++)60==data.featuresList[j].PreExistingDiseases[k].featureId&&data.featuresList[j].PreExistingDiseases[k].valueLimit<=$scope.parent.coverageAfter.value&&data.featuresList[j].PreExistingDiseases[k].valueLimit>0&&(preExistingCoverageApplicable=!0);return preExistingCoverageApplicable?data:""}},$scope.applyFilter=function(){setTimeout(function(){$scope.singleClickHealthQuote()},100)},($rootScope.flag||$rootScope.isOlarked)&&(void 0!=$rootScope.selectedFeatures&&($rootScope.selectedFeatures=$rootScope.selectedFeatures,$rootScope.roomRentFeature&&($scope.parent.roomRentFeature=$rootScope.roomRentFeature)),$scope.customFilterHealth(),$rootScope.flag&&($rootScope.flag=!1,$rootScope.isOlarked=!1),console.log("$scope.EmailChoices",$scope.EmailChoices),localStorageService.get("quoteUserInfo")&&(console.log(localStorageService.get("quoteUserInfo")),$scope.EmailChoices[0].username=localStorageService.get("quoteUserInfo").emailId),$rootScope.loading=!1)},$scope.declaration(),$scope.$watch(function(){return $rootScope.healthQuoteResult},function(){$rootScope.healthQuoteResult=$rootScope.healthQuoteResult,$rootScope.healthQuoteResult&&$rootScope.healthQuoteResult.length>0&&$scope.init()},!0),$scope.hideResultCnfrmBuyModal=function(){$scope.familyList=$scope.oldFamilyList,$scope.modalResultCnfrmBuy=!1,$rootScope.loading=!1},$scope.submitResultCnfrmBuy=function(){if($scope.resultCnfrmBuy.$dirty){var i,submitFamilyForm;submitFamilyForm=$scope.validateFamilyForm();var familyCounter=0,familyMemberExistStatus=!1;for(i=0;i<$scope.familyList.length;i++)1==$scope.familyList[i].val&&(familyMemberExistStatus=!0,familyCounter+=1);$scope.quoteParam.planType=familyCounter>1?"F":"I",familyMemberExistStatus?1==submitFamilyForm&&($scope.modalResultCnfrmBuy=!1,$scope.resultCnfrmBuy.$setPristine(),$scope.resultCnfrmBuyFlag=!0,$scope.buyConfrmFlag=!0,$scope.quoteHealthInputForm.$setDirty(),$scope.singleClickHealthQuote()):$scope.familyErrors.push("Please select atleast one member.")}else $rootScope.loading=!0,$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled?$location.path("/buyHealth").search({quoteId:localStorageService.get("HEALTH_UNIQUE_QUOTE_ID"),carrierId:localStorageService.get("healthSelectedProduct").carrierId,productId:localStorageService.get("healthSelectedProduct").planId,lob:localStorageService.get("selectedBusinessLineId")}):($scope.quoteUserInfo=localStorageService.get("quoteUserInfo"),console.log("redirecting to health buy product::"),$location.path("/buyHealth"))},$scope.buyProduct=function(selectedProduct){if(localStorageService.get("renewPolicyDetails")){var renewPolicyDetails=localStorageService.get("renewPolicyDetails");console.log("HEALTH_UNIQUE_QUOTE_ID",localStorageService.get("HEALTH_UNIQUE_QUOTE_ID")),console.log("renewPolicyDetails",renewPolicyDetails),localStorageService.get("HEALTH_UNIQUE_QUOTE_ID")==renewPolicyDetails.QUOTE_ID&&$location.path("/proposalresdata").search({proposalId:renewPolicyDetails.encryptedQuoteId,LOB:1})}if($scope.selectedProduct=selectedProduct,$rootScope.title=$scope.p365Labels.policies365Title.confirmPopup,localStorageService.set("healthSelectedProduct",selectedProduct),1==imauticAutomation&&imatBuyClicked(localStorageService,$scope,"BuyClicked"),$scope.quote.quoteParam.riders){for(var i=0;i<$scope.quote.quoteParam.riders.length;i++)1==$scope.quote.quoteParam.riders[i].riderFlag&&($scope.quote.quoteParam.riders.splice(i,1),i-=1);$scope.quoteParam.riders=$scope.quote.quoteParam.riders}if(selectedProduct.riderList&&selectedProduct.riderList.length>0){var riderFromSel;for(i=0;i<selectedProduct.riderList.length;i++)(riderFromSel={}).riderId=selectedProduct.riderList[i].riderId,riderFromSel.riderName=selectedProduct.riderList[i].riderName,riderFromSel.riderFlag=!0,selectedProduct.riderList[i].riderPremiumAmount&&(riderFromSel.riderPremiumAmount=selectedProduct.riderList[i].riderPremiumAmount),$scope.quoteParam.riders.push(riderFromSel)}$scope.quote.quoteParam.riders=$scope.quoteParam.riders,localStorageService.set("healthQuoteInputParamaters",$scope.quote);var buyScreenParam={documentType:"proposalScreenConfig"};buyScreenParam.businessLineId=localStorageService.get("selectedBusinessLineId"),buyScreenParam.carrierId=selectedProduct.carrierId,buyScreenParam.productId=selectedProduct.planId,buyScreenParam.QUOTE_ID=localStorageService.get("HEALTH_UNIQUE_QUOTE_ID"),getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.productDataReader,buyScreenParam,function(buyScreen){if(buyScreen.responseCode==$scope.p365Labels.responseCode.success){localStorageService.set("buyScreen",buyScreen.data),$scope.resultCnfrmBuyFlag||($scope.oldFamilyList=angular.copy($scope.familyList),$scope.modalResultCnfrmBuy=!0);var occupationDocId=$scope.p365Labels.documentType.healthOccupation+"-"+selectedProduct.carrierId+"-"+selectedProduct.planId;getDocUsingId(RestAPI,occupationDocId,function(occupationList){localStorageService.set("healthBuyOccupationList",occupationList.Occupation),getListFromDB(RestAPI,"",$scope.p365Labels.documentType.healthCarrier,$scope.p365Labels.request.findAppConfig,function(carrierList){if(carrierList.responseCode==$scope.p365Labels.responseCode.success){localStorageService.set("carrierList",carrierList.data);var docId=$scope.p365Labels.documentType.buyScreen+"-"+localStorageService.get("selectedBusinessLineId");getDocUsingId(RestAPI,docId,function(buyScreenTooltip){localStorageService.set("buyScreenTooltip",buyScreenTooltip.toolTips),$scope.resultCnfrmBuyFlag&&($rootScope.loading=!0,$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled?$location.path("/buyHealth").search({quoteId:localStorageService.get("HEALTH_UNIQUE_QUOTE_ID"),carrierId:selectedProduct.carrierId,productId:selectedProduct.planId,lob:localStorageService.get("selectedBusinessLineId")}):($scope.quoteUserInfo=localStorageService.get("quoteUserInfo"),console.log("redirecting to health buy product::"),$location.path("/buyHealth")))})}else $rootScope.P365Alert("Policies365",$scope.p365Labels.validationMessages.generalisedErrMsg,"Ok")})})}else $rootScope.P365Alert("Policies365",$scope.p365Labels.validationMessages.generalisedErrMsg,"Ok")})},$scope.selectProduct=function(selectedProduct,_redirectTOResult){if(_redirectTOResult=0!=_redirectTOResult||_redirectTOResult){$rootScope.loading=!0;var QUOTE_ID=localStorageService.get("HEALTH_UNIQUE_QUOTE_ID");console.log("selectedProduct in medical result is",selectedProduct),updateHealthSelectedProduct(RestAPI,QUOTE_ID,selectedProduct,function(updatedProductCallback){if(console.log("_updatedProduct : ",updatedProductCallback),updatedProductCallback.data){var updatedProduct=updatedProductCallback.data;updatedProduct.selectedCarrier&&updatedProduct.selectedProduct&&($rootScope.selectedCarrierIdForHealth=updatedProduct.selectedCarrier,$rootScope.selectedProductIdForHealth=updatedProduct.selectedProduct,updatedProduct.childPlanId&&($rootScope.selectedChildPlanIdForHealth=updatedProduct.selectedChildPlanId)),$location.path("/professionalJourneyResult")}})}},$rootScope.signout=function(){$rootScope.userLoginStatus=!1;var userLoginInfo={username:""};userLoginInfo.status=$rootScope.userLoginStatus,localStorageService.set("userLoginInfo",userLoginInfo),$location.path("/quote")},$scope.missionCompled=function(){$rootScope.loading=!1};function getAllProductFeatures(selectedProduct,productFetchStatus){if(selectedProduct.featuresList[0].HospitalizationRelated)for(var i=0;i<selectedProduct.featuresList[0].HospitalizationRelated.length;i++)"Y"==selectedProduct.featuresList[0].HospitalizationRelated[i].compareView&&-1===$rootScope.consolidatedHospitalizationRelatedList.indexOf(selectedProduct.featuresList[0].HospitalizationRelated[i].CompareName)&&$rootScope.consolidatedHospitalizationRelatedList.push(selectedProduct.featuresList[0].HospitalizationRelated[i].CompareName);if(selectedProduct.featuresList[1].PreventiveOutPatientRelated)for(i=0;i<selectedProduct.featuresList[1].PreventiveOutPatientRelated.length;i++)"Y"==selectedProduct.featuresList[1].PreventiveOutPatientRelated[i].compareView&&-1===$rootScope.consolidatedPreventiveOutPatientRelatedList.indexOf(selectedProduct.featuresList[1].PreventiveOutPatientRelated[i].CompareName)&&$rootScope.consolidatedPreventiveOutPatientRelatedList.push(selectedProduct.featuresList[1].PreventiveOutPatientRelated[i].CompareName);if(selectedProduct.featuresList[2].EnhancedCoverage)for(i=0;i<selectedProduct.featuresList[2].EnhancedCoverage.length;i++)"Y"==selectedProduct.featuresList[2].EnhancedCoverage[i].compareView&&-1===$rootScope.consolidatedEnhancedCoverageList.indexOf(selectedProduct.featuresList[2].EnhancedCoverage[i].CompareName)&&$rootScope.consolidatedEnhancedCoverageList.push(selectedProduct.featuresList[2].EnhancedCoverage[i].CompareName);if(selectedProduct.featuresList[3].PreExistingDiseases)for(i=0;i<selectedProduct.featuresList[3].PreExistingDiseases.length;i++)"Y"==selectedProduct.featuresList[3].PreExistingDiseases[i].compareView&&-1===$rootScope.consolidatedPreExistingDiseasesList.indexOf(selectedProduct.featuresList[3].PreExistingDiseases[i].CompareName)&&$rootScope.consolidatedPreExistingDiseasesList.push(selectedProduct.featuresList[3].PreExistingDiseases[i].CompareName)}$scope.modalEmailView=!1,$scope.emailPopUpDisabled=!1,localStorageService.get("quoteUserInfo")&&($scope.EmailChoices[0].username=localStorageService.get("quoteUserInfo").emailId),$scope.addNewChoice=function(){var newItemNo=$scope.EmailChoices.length+1;newItemNo<=3&&($scope.EmailChoices.push({username:""}),$scope.EmailChoices[0].addNew=!1,$scope.EmailChoices[1].addNew=!0,$scope.emailPopUpDisabled=!1),3==newItemNo&&($scope.EmailChoices[2].addNew=!1,$scope.emailPopUpDisabled=!0)},$scope.removeChoice=function(){var lastItem=$scope.EmailChoices.length-1;$scope.EmailChoices.splice(lastItem)},$scope.showForShare=function(data){if(!$rootScope.parseCarrierList)return!0;for(var j=0;j<$rootScope.parseCarrierList.length;j++)if(data.carrierId==$rootScope.parseCarrierList[j])return!0},$scope.sendEmail=function(){$scope.flagArray=[];for(var index=-1,i=0;i<$scope.EmailChoices.length;i++){if(""!=$scope.EmailChoices[i].username&&void 0!=$scope.EmailChoices[i].username){var encodeQuote=localStorageService.get("HEALTH_UNIQUE_QUOTE_ID_ENCRYPTED"),encodeLOB=String(localStorageService.get("selectedBusinessLineId")),encodeEmailId=$scope.EmailChoices[i].username,encodeCarrierList=[];if($scope.insuranceCompanyList.selectedInsuranceCompany.length>0){encodeCarrierList=$scope.insuranceCompanyList.selectedInsuranceCompany;var jsonEncodeCarrierList=JSON.stringify(encodeCarrierList)}else encodeCarrierList.push("ALL");$rootScope.encryptedQuote_Id=encodeQuote,$rootScope.encryptedLOB=encodeLOB,$rootScope.encryptedEmail=encodeEmailId,$rootScope.encryptedCarriers=jsonEncodeCarrierList,$scope.EmailChoices[i].funcType="SHAREHEALTHQUOTE",$scope.EmailChoices[i].isBCCRequired="Y",$scope.EmailChoices[i].paramMap={},$scope.EmailChoices[i].paramMap.docId=String($rootScope.encryptedQuote_Id),$scope.EmailChoices[i].paramMap.LOB=String($rootScope.encryptedLOB),$scope.EmailChoices[i].paramMap.userId=String($rootScope.encryptedEmail),$scope.EmailChoices[i].paramMap.carriers=String($rootScope.encryptedCarriers),$scope.EmailChoices[i].paramMap.selectedPolicyType="HEALTH";var body={};body.longURL=shareQuoteLink+$scope.EmailChoices[i].paramMap.docId+"&LOB="+$scope.EmailChoices[i].paramMap.LOB+"&userId="+$scope.EmailChoices[i].paramMap.userId+"&carriers="+$scope.EmailChoices[i].paramMap.carriers,$http({method:"POST",url:getShortURLLink,data:body}).success(function(shortURLResponse){var request={},header={},arr=$scope.EmailChoices;header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=sendEmail,header.deviceId=deviceIdOrigin,request.header=header,shortURLResponse.responseCode==$scope.p365Labels.responseCode.success?(index++,request.body=arr[index],request.body.paramMap.url=shortURLResponse.data.shortURL,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback){var emailResponse=JSON.parse(callback),receipientNum=$scope.EmailChoices.length;i==receipientNum&&(emailResponse.responseCode==$scope.p365Labels.responseCode.success?($scope.shareEmailModal=!1,$scope.modalEmailView=!0):localStorageService.set("emailDetails",void 0))})):console.log(shortURLResponse.message)})}}},$scope.showShareEmailModal=function(){localStorageService.get("quoteUserInfo")&&localStorageService.get("quoteUserInfo").emailId&&($scope.crmEmailSend||$rootScope.wordPressEnabled)?(1==imauticAutomation?(imatShareQuote(localStorageService,$scope,"ShareQuote"),$scope.shareEmailModal=!1,$scope.modalEmailView=!0,$scope.crmEmailSend=!1):$scope.sendEmail(),$scope.shareEmailModal=!1,$scope.modalEmailView=!0):$scope.shareEmailModal=!0},$scope.sendQuotesByEmail=function(){var quoteUserInfo={};if($scope.EmailChoices.length>0)if(localStorageService.get("quoteUserInfo")){(quoteUserInfo=localStorageService.get("quoteUserInfo"))&&(quoteUserInfo.emailId=$scope.EmailChoices[0].username,localStorageService.set("quoteUserInfo",quoteUserInfo),$scope.crmEmailSend=!0,$scope.showShareEmailModal())}else{quoteUserInfo={};localStorageService.set("quoteUserInfo",quoteUserInfo),$scope.sendQuotesByEmail()}},$scope.deleteReceipient=function(index){$scope.EmailChoices.splice(index,1),$scope.EmailChoices.length<3&&($scope.emailPopUpDisabled=!1,1==$scope.EmailChoices.length?($scope.EmailChoices[0].addNew=!0,$scope.EmailChoices[1].addNew=!1):($scope.EmailChoices[0].addNew=!1,$scope.EmailChoices[1].addNew=!0))},$scope.hideEmailModal=function(){$scope.shareEmailModal=!1,$scope.modalEmailView=!1},$scope.leadCreationUserInfo=function(){var userInfoWithQuoteParam={};if($scope.selectedBusinessLineId=localStorageService.get("selectedBusinessLineId"),localStorageService.set("quoteUserInfo",$scope.quoteUserInfo),userInfoWithQuoteParam.quoteParam=localStorageService.get("healthQuoteInputParamaters").quoteParam,userInfoWithQuoteParam.contactInfo=$scope.quoteUserInfo,$rootScope.agencyPortalEnabled){const localdata=JSON.parse(localStorage.getItem("finalLocalStorage"));userInfoWithQuoteParam.contactInfo.createLeadStatus=!1,userInfoWithQuoteParam.requestSource=sourceOrigin,$location.search("createLead","false"),localdata&&(userInfoWithQuoteParam.userName=localdata.username,userInfoWithQuoteParam.agencyId=localdata.agencyId)}else $scope.quoteUserInfo.emailId=$rootScope.decryptedEmailId,userInfoWithQuoteParam.requestSource="web";null!=$scope.quoteUserInfo&&(""==$scope.quoteUserInfo.messageId||$scope.quoteUserInfoForm.$dirty?RestAPI.invoke($scope.p365Labels.transactionName.createLead,userInfoWithQuoteParam).then(function(callback){callback.responseCode==$scope.p365Labels.responseCode.success&&(messageIDVar=callback.data.messageId,$scope.quoteUserInfo.messageId=messageIDVar,localStorageService.set("quoteUserInfo",$scope.quoteUserInfo),$scope.modalView=!1)}):messageIDVar=$scope.quoteUserInfo.messageId)},$scope.showFilterBenefitModal=function(){$scope.filterBenefitModal=!$scope.filterBenefitModal},$scope.hideFilterBenefitModal=function(){$scope.filterBenefitModal=!1},$scope.redirectToResult=function(){$scope.leadCreationUserInfo()},$scope.redirectToAPResult=function(){$scope.leadCreationUserInfo()},$scope.validatePremium=function(data){if(data)return Number(data.basicPremium)>0},$scope.openHealthPopup=function(selectedTab,_data){$scope.filterPincode=$scope.personalInfo.pincode,$scope.filterCity=$scope.personalInfo.city,$scope.healthProductToBeAddedInCart=_data,$rootScope.selectedTabHealth=selectedTab,$scope.premiumModalHealth=!$scope.premiumModalHealth},$scope.hidePremiumModalHealth=function(){$scope.premiumModalHealth=!1},$scope.openMapHospital=function(hos){$scope.searchKeyHospital=googleMapURL+""+hos.hospitalName+","+hos.pincode,window.open($scope.searchKeyHospital,"_blank")},$scope.selectAllInsurer=function(){$scope.selectedCarrierName.CompanyName=[],$scope.quotesToShow=[],angular.forEach($scope.quotesToShowCopy,function(obj,i){$scope.selectedCarrierName.CompanyName.push(obj.insuranceCompany)}),$scope.quotesToShow=$scope.quotesToShowCopy,console.log("$scope.selectedCarrierName.CompanyName on all select::",$scope.selectedCarrierName.CompanyName),console.log("$scope.quotesToShowCopy length is::",$scope.quotesToShowCopy)},$scope.DeselectAllInsurer=function(){$scope.selectedCarrierName.CompanyName=[],$scope.quotesToShow=[],console.log("$scope.selectedCarrierName.CompanyName on all select::",$scope.selectedCarrierName.CompanyName),console.log("$scope.quotesToShow length is::",$scope.quotesToShow)},$scope.filterResult=function(){if($scope.quotesForBrand=[],$scope.quotesToShow=[],console.log("$scope.selectedCarrierName in fiter result::",$scope.selectedCarrierName),$scope.selectedCarrierName.CompanyName.length>0){for(var i=0;i<$scope.quotesToShowCopy.length;i++)for(var j=0;j<$scope.selectedCarrierName.CompanyName.length;j++)$scope.quotesToShowCopy[i].insuranceCompany==$scope.selectedCarrierName.CompanyName[j]&&$scope.quotesForBrand.push($scope.quotesToShowCopy[i]);$scope.quotesToShow=$scope.quotesForBrand}console.log("$scope.selectedCarrierName.CompanyName on all select::",$scope.selectedCarrierName.CompanyName),console.log("$scope.quotesToShow length is::",$scope.quotesToShow)},$(".activateFooter").hide(),$(".activateHeader").hide()}]);