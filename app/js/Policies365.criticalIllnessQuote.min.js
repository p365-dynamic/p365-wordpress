"use strict";angular.module("criticalIllnessInstantQuote",["CoreComponentApp","LocalStorageModule"]).controller("criticalIllnessInstantQuoteController",["$scope","$rootScope","$window","$location","$filter","RestAPI","localStorageService","$timeout","$interval","$http","$sce",function($scope,$rootScope,$window,$location,$filter,RestAPI,localStorageService,$timeout,$interval,$http,$sce){var applicationLabels=localStorageService.get("applicationLabels");$scope.globalLabel=applicationLabels.globalLabels,$rootScope.loaderContent={businessLine:"6",header:"CI Insurance",desc:$sce.trustAsHtml($scope.globalLabel.applicationLabels.criticalIllness.proverbInstantQuote)},"/criticalIllness"==$location.path()?$rootScope.title=$scope.globalLabel.policies365Title.criticalIllnessInstantQuoteLanding:$rootScope.title=$scope.globalLabel.policies365Title.criticalIllnessInstantQuote,$rootScope.carrierDetails={},$rootScope.GSTTag=!1,$rootScope.instantQuoteSummaryStatus=!0,$rootScope.disableLandingLeadBtn=!1,$scope.instantQuoteCalculation=function(){var ciQuoteCookie=localStorageService.get("criticalIllnessQuoteInputParamaters"),personalDetailsCookie=localStorageService.get("criticalIllnessPersonalDetails"),premiumFrequencyListCookie=localStorageService.get("premiumFrequencyList");$scope.quote={},$scope.quoteParam={},$scope.personalDetails={},$scope.relationType=relationLifeQuoteGeneric,$scope.healthConditionType=healthConditionGeneric,$scope.annualIncomesRange=annualIncomesGeneric,$scope.genderType=genderTypeGeneric,$scope.tobaccoAddictionStatus=tobaccoAddictionStatusGeneric,$scope.payoutOptions=lifePayoutOptionsGeneric,$scope.healthTypeCondition=healthTypeConditionGeneric,$scope.sumamount=20,$rootScope.viewOptionDisabled=!0,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteCriticalIllnessForm=!0,$scope.healthError=!1,$rootScope.openRegPopup=function(){$rootScope.Regpopup=!0},$scope.closePop=function(){$rootScope.Regpopup=!1},$scope.updateAnnualPremiumRange=function(minPremiumValue,maxPremiumValue){minPremiumValue>maxPremiumValue?($rootScope.minAnnualPremium=maxPremiumValue,$rootScope.maxAnnualPremium=minPremiumValue):($rootScope.minAnnualPremium=minPremiumValue,$rootScope.maxAnnualPremium=maxPremiumValue)},$scope.calculateSumAssured=function(){listSumAssuredAmt($scope.personalDetails.annualIncomeObject.annualIncome,function(sumInsuredArray,selectedSumAssured){$scope.quoteParam.sumInsured=selectedSumAssured.amount,$scope.personalDetails.sumInsuredObject=selectedSumAssured;var urlPattern=$location.path();$rootScope.wordPressEnabled&&"/criticalIllness"!=urlPattern||$scope.singleClickCriticalIllnessQuote()})},$scope.errorMessage=function(errorMsg){"undefined"==String($rootScope.ciQuoteResult)||0==$rootScope.ciQuoteResult.length?($scope.updateAnnualPremiumRange(1e3,5e3),$rootScope.instantQuoteSummaryStatus=!1,$rootScope.instantQuoteSummaryError=errorMsg,$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!0,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteCriticalIllnessForm=!1):$rootScope.ciQuoteResult.length>0&&($rootScope.instantQuoteSummaryStatus=!0,$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!1,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteCriticalIllnessForm=!1),$rootScope.loading=!1},$scope.tooltipPrepare=function(ciResult){for(var resultCarrierId=[],testCarrierId=[],i=0;i<ciResult.length;i++){var carrierInfo={};carrierInfo.id=ciResult[i].carrierId,carrierInfo.name=ciResult[i].insuranceCompany,carrierInfo.annualPremium=ciResult[i].annualPremium,carrierInfo.isMonthlyPremium=!1,carrierInfo.claimsRating=ciResult[i].insurerIndex,$rootScope.wordPressEnabled&&(carrierInfo.sumInsured=ciResult[i].sumInsured,carrierInfo.businessLineId="6"),0==p365Includes(testCarrierId,ciResult[i].carrierId)&&(resultCarrierId.push(carrierInfo),testCarrierId.push(ciResult[i].carrierId))}$rootScope.resultCarrierId=resultCarrierId,$rootScope.quoteResultInsurerList="\n<ul style='text-align: left;' class='tickpoints'>";for(i=0;i<resultCarrierId.length;i++)$rootScope.quoteResultInsurerList+="<li>"+resultCarrierId[i].name+"</li>";$rootScope.quoteResultInsurerList+="</ul>",$rootScope.calculatedQuotesLength=2==String(ciResult.length).length?String(ciResult.length):"0"+String(ciResult.length),setTimeout(function(){scrollv=new scrollable({wrapperid:"scrollable-v",moveby:4,mousedrag:!0})},2e3)},$scope.processResult=function(){$rootScope.enabledProgressLoader=!1,$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!1,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteCriticalIllnessForm=!1,$rootScope.loading=!1,$rootScope.campaignFlag=!0,$rootScope.ciQuoteResult=$filter("orderBy")($rootScope.ciQuoteResult,"dailyPremium");for(var minDailyPremiumValue=$rootScope.ciQuoteResult[0].dailyPremium,dailyPremiumSliderArray=[],j=0;j<$rootScope.ciQuoteResult.length;j++){var calculatedDiscAmt=0,discountAmtList=$rootScope.ciQuoteResult[j].discountList;if("undefined"!=String(discountAmtList)){for(var i=0;i<discountAmtList.length;i++)calculatedDiscAmt+=discountAmtList[i].discountAmount;calculatedDiscAmt+=$rootScope.ciQuoteResult[j].dailyPremium,dailyPremiumSliderArray.push(calculatedDiscAmt)}else dailyPremiumSliderArray.push($rootScope.ciQuoteResult[j].dailyPremium)}dailyPremiumSliderArray=$filter("orderBy")(dailyPremiumSliderArray),$scope.updateAnnualPremiumRange(minDailyPremiumValue,dailyPremiumSliderArray[dailyPremiumSliderArray.length-1]),6==localStorageService.get("selectedBusinessLineId")&&$scope.tooltipPrepare($rootScope.ciQuoteResult)},$scope.singleClickCriticalIllnessQuote=function(){setTimeout(function(){if($rootScope.instantQuoteSummaryStatus=!0,$rootScope.progressBarStatus=!0,$rootScope.viewOptionDisabled=!0,$rootScope.tabSelectionStatus=!1,$scope.instantQuoteCriticalIllnessForm=!0,$rootScope.loading=!0,localStorageService.set("selectedBusinessLineId",6),$scope.quoteParam.documentType=$scope.globalLabel.documentType.quoteRequest,$scope.quoteParam.quoteType=localStorageService.get("selectedBusinessLineId"),$scope.quoteParam.personType=relationLifeQuoteGeneric[0],$scope.quoteParam.payoutId=$scope.payoutOptions[0].id,$scope.quoteParam.annualIncome=$scope.personalDetails.annualIncomeObject.annualIncome,$scope.quoteParam.annualIncomeInterval=$scope.personalDetails.annualIncomeObject.annualIncomeInterval,$scope.quoteParam.sumInsured=1e4*Math.round(parseInt($scope.personalDetails.sumInsuredAmount)/1e4),$scope.quoteParam.age>35)var policyTerm=20;else policyTerm=20;policyTerm<$scope.personalDetails.minPolicyTermLimit?$scope.quoteParam.policyTerm=$scope.personalDetails.minPolicyTermLimit:$scope.quoteParam.policyTerm=policyTerm,$scope.personalDetails.minMaturityAge=$scope.quoteParam.age+5,$scope.personalDetails.dateOfBirth=calcDOBFromAge($scope.quoteParam.age),$scope.quote.quoteParam=$scope.quoteParam,$scope.quote.personalDetails=$scope.personalDetails,$scope.quote.requestType=$scope.globalLabel.request.criticalIllnessRequestType,localStorageService.set("criticalIllnessQuoteInputParamaters",$scope.quote),localStorageService.set("criticalIllnessPersonalDetails",$scope.personalDetails),$scope.requestId=null;var quoteUserInfo=localStorageService.get("quoteUserInfo");quoteUserInfo&&($scope.quote.mobileNumber=quoteUserInfo.mobileNumber),RestAPI.invoke($scope.globalLabel.getRequest.quoteCriticalIllness,$scope.quote).then(function(callback){$rootScope.ciQuoteRequest=[],callback.responseCode==$scope.globalLabel.responseCode.success?($scope.responseCodeList=[],$scope.requestId=callback.QUOTE_ID,localStorageService.set("CRITICAL_ILLNESS_UNIQUE_QUOTE_ID",$scope.requestId),$scope.UNIQUE_QUOTE_ID_ENCRYPTED=callback.encryptedQuoteId,localStorageService.set("CRITICAL_ILLNESS_UNIQUE_QUOTE_ID_ENCRYPTED",$scope.UNIQUE_QUOTE_ID_ENCRYPTED),$rootScope.ciQuoteRequest=callback.data,"undefined"!=String($scope.quoteResult)&&$scope.quoteResult.length>0&&($scope.quoteResult.length=0),"undefined"!=String($rootScope.ciQuoteResult)&&$rootScope.ciQuoteResult.length>0&&($rootScope.ciQuoteResult.length=0),$rootScope.ciQuoteResult=[],angular.forEach($rootScope.ciQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.deviceId=deviceIdOrigin,header.browser=browser.name+" V - "+browser.version,header.transactionName=$scope.globalLabel.transactionName.criticalIllnessQuoteResult,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var ciQuoteResponse=JSON.parse(callback);if(ciQuoteResponse.QUOTE_ID==$scope.requestId&&($scope.responseCodeList.push(ciQuoteResponse.responseCode),ciQuoteResponse.responseCode==$scope.globalLabel.responseCode.success)){for(var i=0;i<$rootScope.ciQuoteRequest.length;i++)$rootScope.ciQuoteRequest[i].messageId==ciQuoteResponse.messageId&&(ciQuoteResponse.data.quotes[0].dailyPremium=Math.round(ciQuoteResponse.data.quotes[0].annualPremium/365),ciQuoteResponse.data.quotes[0].insuranceCompany=ciQuoteResponse.data.quotes[0].insuranceCompany,$rootScope.ciQuoteResult.push(ciQuoteResponse.data.quotes[0]),$rootScope.ciQuoteRequest[i].status=1);$scope.processResult()}}).error(function(data,status){$scope.responseCodeList.push($scope.globalLabel.responseCode.systemError)})}),$scope.$watch("responseCodeList",function(newValue,oldValue,scope){p365Includes($scope.responseCodeList,$scope.globalLabel.responseCode.success)&&($rootScope.loading=!1),$scope.responseCodeList.length==$rootScope.ciQuoteRequest.length&&($rootScope.loading=!1,p365Includes($scope.responseCodeList,$scope.globalLabel.responseCode.success)||(p365Includes($scope.responseCodeList,$scope.globalLabel.responseCode.quoteNotAvailable)?$scope.errorMessage($scope.globalLabel.validationMessages.productNotFoundMsg):$scope.errorMessage($sce.trustAsHtml($scope.globalLabel.validationMessages.generalisedLifeErrMsg))))},!0)):($scope.responseCodeList=[],"undefined"!=String($scope.quoteResult)&&$scope.quoteResult.length>0&&($scope.quoteResult.length=0),"undefined"!=String($rootScope.ciQuoteResult)&&$rootScope.ciQuoteResult.length>0&&($rootScope.ciQuoteResult.length=0),$rootScope.ciQuoteResult=[],$scope.errorMessage(callback.message))})},100)},$scope.$on("callSingleClickCriticalIllnessQuote",function(){$scope.singleClickCriticalIllnessQuote()}),$scope.calculateCriticalIllnessPremium=function(healthCondition){$rootScope.wordPressEnabled||$scope.singleClickCriticalIllnessQuote()},$scope.prePopulateFields=function(){for(var i=0;i<annualIncomesGeneric.length;i++)if($scope.quoteParam.annualIncome==annualIncomesGeneric[i].annualIncome){$scope.personalDetails.annualIncomeObject=annualIncomesGeneric[i];break}listSumAssuredAmt($scope.personalDetails.annualIncomeObject.annualIncome,function(sumInsuredArray,selectedSumAssured){$scope.quoteParam.sumInsured=selectedSumAssured.amount,$scope.personalDetails.sumInsuredObject=selectedSumAssured}),setTimeout(function(){var urlPattern=$location.path();$rootScope.wordPressEnabled&&"/life"!=urlPattern&&"/childrmz"!=urlPattern&&"/pensionrmz"!=urlPattern&&"/mobilife"!=urlPattern&&"/childeid"!=urlPattern&&"/pensioneid"!=urlPattern&&"/childmonsoon"!=urlPattern&&"/pensionmonsoon"!=urlPattern&&"/lifemonsoon"!=urlPattern&&"/childindependence"!=urlPattern&&"/pensionindependence"!=urlPattern&&"/lifeindependence"!=urlPattern&&"/child-insurance"!=urlPattern&&"/pension-insurance"!=urlPattern&&"/life-insurance"!=urlPattern?$scope.instantQuoteCriticalIllnessForm=!1:$scope.singleClickCriticalIllnessQuote()},100)},$scope.fetchDefaultInputParamaters=function(defaultQuoteStatus,defaultInputParamCallback){defaultQuoteStatus?($scope.quoteParam=defaultCriticalIllnessQuoteParam.quoteParam,$scope.personalDetails=defaultCriticalIllnessQuoteParam.personalDetails,$scope.PremiumFrequencyList=defaultCriticalIllnessQuoteParam.premiumFrequencyList,$rootScope.wordPressEnabled&&($scope.quote={},$scope.quote.personalDetails=$scope.personalDetails,$scope.quote.quoteParam=$scope.quoteParam,localStorageService.set("selectedBusinessLineId",6),localStorageService.set("criticalIllnessQuoteInputParamaters",$scope.quote),localStorageService.set("criticalIllnessPersonalDetails",$scope.personalDetails),localStorageService.set("premiumFrequencyList",$scope.PremiumFrequencyList))):($scope.quoteParam=ciQuoteCookie.quoteParam,$scope.personalDetails=personalDetailsCookie,$scope.PremiumFrequencyList=premiumFrequencyListCookie,$scope.quoteParam.riders=makeObjectEmpty($scope.quoteParam.riders,"array"),$scope.personalDetails.selectedAddOnCovers=makeObjectEmpty($scope.quoteParam.riders,"array")),$scope.ageList=getAgeList($scope.personalDetails.minInsuredAge,$scope.personalDetails.maxInsuredAge),$scope.prePopulateFields(),$rootScope.loading=!1,defaultInputParamCallback()},null!=ciQuoteCookie&&"undefined"!==String(ciQuoteCookie)?$scope.fetchDefaultInputParamaters(!1,function(){}):$scope.fetchDefaultInputParamaters(!0,function(){})},$scope.showAmount=function(amount){return amount>1e5?Math.round(amount/1e5):0},$scope.checkSum=function(amount){(amount<5e5||void 0==amount||void 0==typeof amount)&&($rootScope.disableNextScreen=!0,$scope.message="Please enter the amount Greater Than 5 Lac "),amount>25e6&&($rootScope.disableNextScreen=!0,$scope.message="Please enter the amount Less than 2.5 Crore "),amount>5e5&&amount<=2e7&&($rootScope.disableNextScreen=!1,$scope.message="")},$rootScope.tooltipContent=localStorageService.get("criticalIllnessInstantQuoteTooltipContent"),$scope.instantQuoteCalculation()}]),angular.module("criticalIllnessResult",["CoreComponentApp","LocalStorageModule","ngMessages","checklist-model"]).controller("criticalIllnessResultController",["$scope","$rootScope","$filter","$location","$http","$window","RestAPI","localStorageService","$timeout","$interval","$sce",function($scope,$rootScope,$filter,$location,$http,$window,RestAPI,localStorageService,$timeout,$interval,$sce){var applicationLabels=localStorageService.get("applicationLabels");($scope.globalLabel=applicationLabels.globalLabels,$rootScope.loaderContent={businessLine:"6",header:"CI Insurance",desc:$sce.trustAsHtml($scope.globalLabel.applicationLabels.criticalIllness.proverbResult)},$rootScope.title=$scope.globalLabel.policies365Title.criticalIllnessResultQuote,localStorageService.get("premiumFrequencyList")&&($scope.PremiumFrequencyList=localStorageService.get("premiumFrequencyList")),$scope.quote={},$scope.quoteUserInfo={},$rootScope.wordPressEnabled?$scope.rippleColor="":$scope.rippleColor="#f8a201",$scope.UNIQUE_QUOTE_ID_ENCRYPTED=localStorageService.get("CRITICAL_ILLNESS_UNIQUE_QUOTE_ID_ENCRYPTED"),localStorageService.get("PROF_QUOTE_ID_ENCRYPTED")&&($scope.UNIQUE_PROF_QUOTE_ID_ENCRYPTED=localStorageService.get("PROF_QUOTE_ID_ENCRYPTED")),$scope.modalView=!1,$rootScope.agencyPortalEnabled)&&(localStorageService.get("quoteUserInfo")||($scope.modalView=!0));$scope.criticalIllnessInputSectionHTML=wp_path+"buy/criticalIllness/html/CriticalIllnessInputSection.html",$scope.criticalIllnessShareEmailSectionHTML=wp_path+"buy/criticalIllness/html/CriticalIllnessShareEmailSection.html",$scope.criticalIllnessPremiumTemplate=wp_path+"buy/common/html/criticalIllnessPremiumTemplate.html",olarkCustomParam(localStorageService.get("CRITICAL_ILLNESS_UNIQUE_QUOTE_ID"),localStorageService.get("selectedBusinessLineId"),localStorageService.get("quoteUserInfo"),!1),localStorageService.get("userLoginInfo")&&($rootScope.userLoginStatus=localStorageService.get("userLoginInfo").status,$rootScope.username=localStorageService.get("userLoginInfo").username),$rootScope.loading=!0,$rootScope.isBackButtonPressed=!1,$rootScope.disableLandingLeadBtn=!1,$scope.isMonthlyPremium=!1,$scope.isAnnualPremium=!0,$scope.isQuarterlyPremium=!1,$scope.isHalfAnnualPremium=!1,$scope.premiumChoice=!0,$scope.criticalIllnessInputSection=!1,$scope.frequencyDetailsModal=!1,$scope.showPremiumFrequencyModal=function(){$scope.frequencyDetailsModal=!$scope.frequencyDetailsModal},$scope.hidePremiumFrequencyModal=function(){$scope.frequencyDetailsModal=!1},$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled&&(messageIDVar=$location.search().messageId,$scope.quoteUserInfo.messageId=$location.search().messageId,$scope.criticalIllnessInputSection=!0),$scope.showPersonalDetails=function(){$scope.criticalIllnessInputSection=!$scope.criticalIllnessInputSection},$scope.updatePremiumFrequecy=function(selectedFreq){console.log("selectedFreq : "+selectedFreq),"M"==selectedFreq?($scope.isMonthlyPremium=!0,$scope.isQuarterlyPremium=$scope.isHalfAnnualPremium=$scope.isAnnualPremium=!1):"Q"==selectedFreq?($scope.isQuarterlyPremium=!0,$scope.isMonthlyPremium=$scope.isHalfAnnualPremium=$scope.isAnnualPremium=!1):"HY"==selectedFreq?($scope.isHalfAnnualPremium=!0,$scope.isMonthlyPremium=$scope.isQuarterlyPremium=$scope.isAnnualPremium=!1):($scope.isAnnualPremium=!0,$scope.isMonthlyPremium=$scope.isQuarterlyPremium=$scope.isHalfAnnualPremium=!1)},$scope.backToResultScreen=function(){$rootScope.wordPressEnabled&&($rootScope.isBackButtonPressed=!0),$rootScope.isProfessionalJourneySelected?$location.path("/professionalJourneyResult"):$location.path("/PBQuote")};var docId=$scope.globalLabel.documentType.quoteResultScreen+"-"+localStorageService.get("selectedBusinessLineId");getDocUsingId(RestAPI,docId,function(tooltipContent){$scope.tooltipContent=tooltipContent.toolTips,$scope.selectedAddOnCovers=[],$scope.sortByElement=[],$scope.selectedCarrier=[],$scope.riderFeatureLength=0,$scope.expose=!1,$scope.tempStatus=!0;$scope.quoteParam=localStorageService.get("criticalIllnessQuoteInputParamaters").quoteParam,$scope.personalDetails=localStorageService.get("criticalIllnessPersonalDetails"),$scope.insuranceCompanyList={},$scope.insuranceCompanyList.selectedInsuranceCompany=[],$scope.disableSubmit=!1,$scope.sortType=sortTypesCriticalIllnessGeneric[0],$scope.sortTypes=sortTypesCriticalIllnessGeneric,$scope.relationType=relationLifeQuoteGeneric,$scope.healthConditionType=healthConditionGeneric,$scope.annualIncomesRange=annualIncomesGeneric,$scope.healthTypeCondition=healthTypeConditionGeneric,$scope.riskLevels=riskLevelsGeneric,$scope.annualIncomesRange=annualIncomesGeneric,$scope.genderType=genderTypeGeneric,$scope.tobaccoAddictionStatus=tobaccoAddictionStatusGeneric,$scope.maturityAgeList=getAgeList($scope.personalDetails.minMaturityAge,$scope.personalDetails.maxMaturityAge),$scope.ageList=getAgeList($scope.personalDetails.minInsuredAge,$scope.personalDetails.maxInsuredAge),$scope.comparePoliciesDisplayList=comparePoliciesDisplayValues,$scope.compareLifePoliciesDisplayList=compareLifePoliciesDisplayValues,$scope.selectedSortOption=$scope.sortTypes[0],$scope.personalDetails.maturityAge=ciMaturityAgeConstant,$scope.personalDetails.dateOfBirth=calcDOBFromAge($scope.quoteParam.age),$scope.personAge=$scope.quoteParam.age,$scope.quoteParamCopy=angular.copy($scope.quoteParam),$scope.personalDetailsCopy=angular.copy($scope.personalDetails),$scope.openMenu=function($mdOpenMenu,ev){$mdOpenMenu(ev),setTimeout(function(){$(".md-click-catcher").click(function(){$scope.activeMenu=""})},100)},$scope.clickForActive=function(item){$scope.activeMenu=item},$scope.clickForViewActive=function(item){$scope.activeViewMenu=item},$scope.clickForViewActive("Compare"),$scope.clicktoDisable=function(){setTimeout(function(){$(".md-click-catcher").css("pointer-events","none")},100)},$scope.EmailChoices=[{username:"",addNew:!0,paramMap:{docId:"",LOB:localStorageService.get("selectedBusinessLineId").toString(),userId:"",selectedPolicyType:""}}],$scope.quoteUserInfo.messageId="",$scope.quoteUserInfo.termsCondition=!0;$scope.modalEmailView=!1,$scope.emailPopUpDisabled=!1,localStorageService.get("quoteUserInfo")&&($scope.EmailChoices[0].username=localStorageService.get("quoteUserInfo").emailId),$scope.addNewChoice=function(){var newItemNo=$scope.EmailChoices.length+1;newItemNo<=3&&($scope.EmailChoices.push({username:""}),$scope.EmailChoices[0].addNew=!1,$scope.EmailChoices[1].addNew=!0,$scope.emailPopUpDisabled=!1),3==newItemNo&&($scope.EmailChoices[2].addNew=!1,$scope.emailPopUpDisabled=!0)},$scope.removeChoice=function(){var lastItem=$scope.EmailChoices.length-1;$scope.EmailChoices.splice(lastItem)},$scope.showForShare=function(data){if(!$rootScope.parseCarrierList)return!0;for(var j=0;j<$rootScope.parseCarrierList.length;j++)if(data.carrierId==$rootScope.parseCarrierList[j])return!0},$scope.sendEmail=function(){for(var index=-1,i=0;i<$scope.EmailChoices.length;i++)if(""!=$scope.EmailChoices[i].username&&void 0!=$scope.EmailChoices[i].username){var encodeQuote=localStorageService.get("CRITICAL_ILLNESS_UNIQUE_QUOTE_ID_ENCRYPTED"),encodeLOB=String(localStorageService.get("selectedBusinessLineId")),encodeEmailId=$scope.EmailChoices[i].username,encodeMonthlyPremiumOption=String($scope.isMonthlyPremium),encodeCarrierList=[];$scope.insuranceCompanyList.selectedInsuranceCompany.length>0?(encodeCarrierList=$scope.insuranceCompanyList.selectedInsuranceCompany,jsonEncodeCarrierList=JSON.stringify(encodeCarrierList)):encodeCarrierList.push("ALL"),$rootScope.encryptedQuote_Id=encodeQuote,$rootScope.encryptedLOB=encodeLOB,$rootScope.encryptedEmail=encodeEmailId,$rootScope.encryptedMonthlyPremium=encodeMonthlyPremiumOption,$rootScope.encryptedCarriers=jsonEncodeCarrierList,$scope.EmailChoices[i].funcType="SHARECRITICALILLNESSQUOTE",$scope.EmailChoices[i].isBCCRequired="Y",$scope.EmailChoices[i].paramMap={},$scope.EmailChoices[i].paramMap.docId=String($rootScope.encryptedQuote_Id),$scope.EmailChoices[i].paramMap.LOB=String($rootScope.encryptedLOB),$scope.EmailChoices[i].paramMap.userId=String($rootScope.encryptedEmail),$scope.EmailChoices[i].paramMap.carriers=String($rootScope.encryptedCarriers),$scope.EmailChoices[i].paramMap.monthlyPremiumOption=String($rootScope.encryptedMonthlyPremium),$scope.EmailChoices[i].paramMap.selectedPolicyType="Critical Illness";var body={};body.longURL=shareQuoteLink+$scope.EmailChoices[i].paramMap.docId+"&LOB="+$scope.EmailChoices[i].paramMap.LOB+"&userId="+$scope.EmailChoices[i].paramMap.userId+"&carriers="+$scope.EmailChoices[i].paramMap.carriers,$http({method:"POST",url:getShortURLLink,data:body}).success(function(shortURLResponse){var request={},header={},arr=$scope.EmailChoices;header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=sendEmail,header.deviceId=deviceIdOrigin,request.header=header,1e3==shortURLResponse.responseCode?(index++,request.body=arr[index],request.body.paramMap.url=shortURLResponse.data.shortURL,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback){var emailResponse=JSON.parse(callback),receipientNum=$scope.EmailChoices.length;i==receipientNum&&(1e3==emailResponse.responseCode?($scope.shareEmailModal=!1,$scope.modalEmailView=!0):localStorageService.set("emailDetails",void 0))})):console.log(shortURLResponse.message)})}},$scope.showShareEmailModal=function(){localStorageService.get("quoteUserInfo")&&localStorageService.get("quoteUserInfo").emailId&&($scope.crmEmailSend||$rootScope.wordPressEnabled)?(1==imauticAutomation?(imatShareQuote(localStorageService,$scope,"ShareQuote"),$scope.shareEmailModal=!1,$scope.modalEmailView=!0,$scope.crmEmailSend=!1):$scope.sendEmail(),$scope.shareEmailModal=!1,$scope.modalEmailView=!0):$scope.shareEmailModal=!0},$scope.sendQuotesByEmail=function(){var quoteUserInfo={};if($scope.EmailChoices.length>0)if(localStorageService.get("quoteUserInfo")){(quoteUserInfo=localStorageService.get("quoteUserInfo"))&&(quoteUserInfo.emailId=$scope.EmailChoices[0].username,localStorageService.set("quoteUserInfo",quoteUserInfo),$scope.crmEmailSend=!0,$scope.showShareEmailModal())}else{quoteUserInfo={};localStorageService.set("quoteUserInfo",quoteUserInfo),$scope.sendQuotesByEmail()}},$scope.deleteReceipient=function(index){$scope.EmailChoices.splice(index,1),$scope.EmailChoices.length<3&&($scope.emailPopUpDisabled=!1,1==$scope.EmailChoices.length?($scope.EmailChoices[0].addNew=!0,$scope.EmailChoices[1].addNew=!1):($scope.EmailChoices[0].addNew=!1,$scope.EmailChoices[1].addNew=!0))},$scope.hideEmailModal=function(){$scope.modalEmailView=!1,$scope.shareEmailModal=!1},$scope.premiumFrequencyTypeName=function(premiumType){return"Y"==premiumType?$scope.globalLabel.applicationLabels.criticalIllness.annualPremium:"HY"==premiumType?$scope.globalLabel.applicationLabels.criticalIllness.halfYearlyPremium:"Q"==premiumType?$scope.globalLabel.applicationLabels.criticalIllness.quaterlyPremium:"M"==premiumType?$scope.globalLabel.applicationLabels.criticalIllness.monthlyPremium:void 0},$scope.leadCreationUserInfo=function(){},$scope.redirectToResult=function(){$scope.leadCreationUserInfo()},$scope.redirectToAPResult=function(){$scope.leadCreationUserInfo()},($rootScope.flag||$rootScope.isOlarked)&&($scope.isMonthlyPremium=$rootScope.decryptedMonthlyPremiumOption,"true"==$scope.isMonthlyPremium?$scope.isMonthlyPremium=!0:($scope.isMonthlyPremium=!1,$scope.isQuarterlyPremium=!1,$scope.isHalfAnnualPremium=!1,$scope.isAnnualPremium=!0,$scope.premiumChoice=!1),void 0!=$rootScope.selectedAddOnCovers&&($scope.personalDetails.selectedAddOnCovers=$rootScope.selectedAddOnCovers),angular.copy($scope.personalDetails.selectedAddOnCovers,$scope.selectedAddOnCoversCopy),$rootScope.flag&&($scope.redirectToResult(),$rootScope.flag=!1),localStorageService.get("quoteUserInfo")&&($scope.EmailChoices[0].username=localStorageService.get("quoteUserInfo").emailId),$rootScope.loading=!1),$scope.calculateSumAssured=function(){listSumAssuredAmt($scope.personalDetails.annualIncomeObject.annualIncome,function(sumInsuredArray,selectedSumAssured){$scope.quoteParam.sumInsured=selectedSumAssured.amount,$scope.personalDetails.sumInsuredObject=selectedSumAssured,$scope.personalDetails.sumInsuredList=sumInsuredArray})},$rootScope.editForMobile=function(){$rootScope.showonEdit="inline !important",$rootScope.hideonEdit="none !important",$scope.flagforMobile=!0},$scope.submitBtn=!1,$scope.editBtn=!0;$scope.toggleChange=function(clickEvent){$(".firstPane").addClass("opened"),$(".firstPaneContent").show(),1==$(".viewDiv").is(":visible")?($scope.editBtn=!1,$scope.submitBtn=!0,$scope.cancelBtn=!0):1==$(".modifyDiv").is(":visible")&&"submit"==clickEvent?($scope.editBtn=!0,$scope.cancelBtn=!1,$scope.submitBtn=!1,$scope.singleClickCriticalIllnessQuote()):(angular.copy($scope.quoteParamCopy,$scope.quoteParam),angular.copy($scope.personalDetailsCopy,$scope.personalDetails),$scope.quoteCriticalIllnessInputForm.criticalIllnessInputForm.$setPristine(),$scope.criticalIllnessInputForm=!1,$scope.editBtn=!0,$scope.cancelBtn=!1,$scope.submitBtn=!1)},$scope.showAmount=function(amount){return amount>1e5?Math.round(amount/1e5):0},$scope.checkSum=function(amount){(amount<5e5||void 0==amount||void 0==typeof amount)&&($scope.disableSubmit=!0,$scope.message="Please enter the amount Greater Than 5 Lac "),amount>25e6&&($scope.disableSubmit=!0,$scope.message="Please enter the amount Less than 2.5 Crore "),amount>5e5&&amount<=2e7&&($scope.message="",$scope.disableSubmit=!1)},$scope.setfromController=!0;$scope.submitReportBtn=!1,$scope.editReportBtn=!0,$scope.toggleReportChange=function(){$(".thirdPane").addClass("opened"),$(".thirdPaneContent").show(),1==$(".viewReportDiv").is(":visible")?($(".modifyReportDiv").show(),$(".viewReportDiv").hide(),$scope.editReportBtn=!1,$scope.submitReportBtn=!0,$scope.cancelReportBtn=!0,!1):1==$(".modifyReportDiv").is(":visible")&&($(".viewReportDiv").slideDown(),$(".modifyReportDiv").slideUp(),$scope.editReportBtn=!0,$scope.submitReportBtn=!1,$scope.cancelReportBtn=!1,!0)},$scope.checkForSbi=function(data){return 43!=data.carrierId||!("Y"==data.premiumFrequency&&data.basicPremium<600)&&(!("M"==data.premiumFrequency&&data.basicPremium<50)&&(!("Q"==data.premiumFrequency&&data.basicPremium<150)&&!("HY"==data.premiumFrequency&&data.basicPremium<300)))},$scope.updateSort=function(sortOption){$scope.activeSort=sortOption.key,$scope.selectedSortOption=sortOption,1==sortOption.key?($scope.sortKey="annualPremium",$scope.sortReverse=!1):2==sortOption.key?($scope.sortKey="sumInsured",$scope.sortReverse=!0):3==sortOption.key?($scope.sortKey="insurerIndex",$scope.sortReverse=!0):4==sortOption.key?($scope.sortKey="ratingsList['8']["+$scope.benefitFeatureRiskType.id+"]",$scope.sortReverse=!0):5==sortOption.key?($scope.sortKey="ratingsList['9']["+$scope.flexibleFeatureRiskType.id+"]",$scope.sortReverse=!0):6==sortOption.key?($scope.sortKey="ratingsList['11']["+$scope.savingFeatureRiskType.id+"]",$scope.sortReverse=!0):7==sortOption.key&&($scope.sortKey="ratingsList['10']["+$scope.eligibilityFeatureRiskType.id+"]",$scope.sortReverse=!0),$scope.toggleState()},$scope.updateSortOrder=function(){1==$scope.selectedSortOption.key?$scope.sortKey="annualPremium":2==$scope.selectedSortOption.key?$scope.sortKey="sumInsured":3==$scope.selectedSortOption.key?$scope.sortKey="insurerIndex":4==$scope.selectedSortOption.key?$scope.sortKey="ratingsList['8']["+$scope.benefitFeatureRiskType.id+"]":5==$scope.selectedSortOption.key?$scope.sortKey="ratingsList['9']["+$scope.flexibleFeatureRiskType.id+"]":6==$scope.selectedSortOption.key?$scope.sortKey="ratingsList['11']["+$scope.savingFeatureRiskType.id+"]":7==$scope.selectedSortOption.key&&($scope.sortKey="ratingsList['10']["+$scope.eligibilityFeatureRiskType.id+"]"),$scope.sortReverse=!$scope.sortReverse},$scope.getRiskLabel=function(riskType){for(var i=0;i<$scope.riskLevels.length;i++)if($scope.riskLevels[i].id==riskType)return $scope.riskLevels[i]},$rootScope.ciQuoteResult.length>0&&($scope.benefitFeatureRiskType=$scope.getRiskLabel($rootScope.ciQuoteResult[0].risks[8]),$scope.flexibleFeatureRiskType=$scope.getRiskLabel($rootScope.ciQuoteResult[0].risks[9]),$scope.eligibilityFeatureRiskType=$scope.getRiskLabel($rootScope.ciQuoteResult[0].risks[10]),$scope.savingFeatureRiskType=$scope.getRiskLabel($rootScope.ciQuoteResult[0].risks[11])),$scope.fetchDefaultInputParamaters=function(defaultInputParamCallback){getDocUsingId(RestAPI,$scope.globalLabel.documentType.defaultCriticalIllnessQuoteParam,function(callback){$scope.quoteParam=callback.quoteParam,$scope.personalDetails=callback.personalDetails,listSumAssuredAmt($scope.quoteParam.annualIncome,function(sumInsuredArray,selectedSumAssured){$scope.personAge=$scope.quoteParam.age,$scope.personalDetails.dateOfBirth=calcDOBFromAge($scope.quoteParam.age),$scope.personalDetails.sumInsuredObject=selectedSumAssured,$scope.personalDetails.sumInsuredList=sumInsuredArray;for(var i=0;i<annualIncomesGeneric.length;i++)if($scope.quoteParam.annualIncome==annualIncomesGeneric[i].annualIncome){$scope.personalDetails.annualIncomeObject=annualIncomesGeneric[i];break}defaultInputParamCallback()})})},$scope.calculateMaturityAgeGap=function(){$scope.quoteParam.age>=45?$scope.personalDetails.maturityAge=ciMaturityAgeConstant:$scope.personalDetails.maturityAge=$scope.quoteParam.age+30},$scope.calculateMaturityAgeGap(),$scope.updateMaturityAgeList=function(){$scope.calculateMaturityAgeGap();var minMaturityAge=$scope.quoteParam.age+1;$scope.personalDetails.maturityAge<minMaturityAge&&($scope.personalDetails.maturityAge=minMaturityAge),$scope.maturityAgeList=getAgeList(minMaturityAge,$scope.personalDetails.maturityAge)},$scope.errorRespCounter=!0,$scope.errorMessage=function(errorMsg){!$scope.errorRespCounter||"undefined"!=String($rootScope.ciQuoteResult)&&0!=$rootScope.ciQuoteResult.length?$rootScope.ciQuoteResult.length>0&&($rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!1,$rootScope.tabSelectionStatus=!0,$rootScope.loading=!1):($scope.errorRespCounter=!1,$scope.errorRespMsg=errorMsg,$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!0,$rootScope.tabSelectionStatus=!0,$rootScope.loading=!1)},$scope.customFilterCriticalIllness=function(){$scope.netPremiumTotalCI=0,$scope.netPremiumAverageCI=0,$scope.netPremiumMaxCI=0,$scope.proffesionalRatingCI=0;for(var i=0;i<$rootScope.ciQuoteResult.length;i++)$scope.netPremiumTotalCI+=$rootScope.ciQuoteResult[i].premiumRatio,$scope.netPremiumAverageCI=Number(($scope.netPremiumTotalCI/$rootScope.ciQuoteResult.length).toFixed(5));for(i=0;i<$rootScope.ciQuoteResult.length;i++)$rootScope.ciQuoteResult[i].netPremiumMax=Number(($scope.netPremiumAverageCI/$rootScope.ciQuoteResult[i].premiumRatio).toFixed(5)),$rootScope.ciQuoteResult[i].netPremiumMax>$scope.netPremiumMaxCI&&($scope.netPremiumMaxCI=$rootScope.ciQuoteResult[i].netPremiumMax);for(i=0;i<$rootScope.ciQuoteResult.length;i++)$rootScope.ciQuoteResult[i].netPremiumMean=Number(($rootScope.ciQuoteResult[i].netPremiumMax/$scope.netPremiumMaxCI*5).toFixed(1)),$rootScope.ciQuoteResult[i].proffesionalRating=.4*$rootScope.ciQuoteResult[i].netPremiumMean+.3*$rootScope.ciQuoteResult[i].claimIndex+.3*$rootScope.ciQuoteResult[i].insurerIndex;return $rootScope.ciQuoteResult=$filter("orderBy")($rootScope.ciQuoteResult,"proffesionalRating"),$rootScope.ciQuoteResult=$rootScope.ciQuoteResult,$scope.sortReverse=!0,!0},$scope.processResult=function(){$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!1,$rootScope.tabSelectionStatus=!0,$rootScope.loading=!1,$rootScope.ciQuoteResult=$filter("orderBy")($rootScope.ciQuoteResult,"dailyPremium")},$scope.displayRibbon=function(){$scope.isMinPremium=function(annualPremiumValue,carrierIDValue){for(var min=$rootScope.ciQuoteResult[0].annualPremium,i=0;i<=$rootScope.ciQuoteResult.length-1;i++){var carrierIdMin=$rootScope.ciQuoteResult[i].carrierId;Number($rootScope.ciQuoteResult[i].annualPremium)<min&&(min=$rootScope.ciQuoteResult[i].annualPremium,carrierIDValue=carrierIdMin)}return min===annualPremiumValue&&($scope.selMinCarrierId=carrierIDValue,!0)},$scope.isMaxIndex=function(insurerIndex,sumInsured,annualPremium,carrierSelID){for(var maxSel=annualPremium/(insurerIndex*sumInsured)*1e3,insurerIndex0=$rootScope.ciQuoteResult[0].insurerIndex,sumInsured0=$rootScope.ciQuoteResult[0].sumInsured,max=$rootScope.ciQuoteResult[0].annualPremium/(sumInsured0*insurerIndex0)*1e3,i=0;i<=$rootScope.ciQuoteResult.length-1;i++){var insurerIndexI=$rootScope.ciQuoteResult[i].insurerIndex,sumInsuredI=$rootScope.ciQuoteResult[i].sumInsured,annualPremiumI=$rootScope.ciQuoteResult[i].annualPremium,carrierIdI=$rootScope.ciQuoteResult[i].carrierId,maxI=annualPremiumI/(sumInsuredI*insurerIndexI)*1e3;Number(maxI)<max&&(max=maxI,carrierSelID=carrierIdI)}return max===maxSel&&($scope.selCarrierId=carrierSelID,!0)}},$scope.displayRibbon(),$scope.validatePremium=function(data){return Number(data.annualPremium)>0},$scope.singleClickCriticalIllnessQuote=function(){$scope.quoteCriticalIllnessInputForm.$dirty||$scope.quoteCriticalIllnessInputForm.criticalIllnessInputForm.$dirty?setTimeout(function(){$scope.flagforMobile&&($rootScope.showonEdit="none !important",$rootScope.hideonEdit="inline !important",$scope.flagforMobile=!1),$scope.quoteCriticalIllnessInputForm.$setPristine(),$scope.errorRespCounter=!0,$rootScope.loading=!0,$scope.dataLoaded=!1,$scope.riderDetailsModal=!1,$scope.quoteParam.documentType=$scope.globalLabel.documentType.quoteRequest,$scope.quoteParam.quoteType=localStorageService.get("selectedBusinessLineId"),$scope.quoteParam.sumInsured=1e4*Math.round(parseInt($scope.personalDetails.sumInsuredAmount)/1e4),$scope.quoteParam.annualIncome=$scope.personalDetails.annualIncomeObject.annualIncome,$scope.quoteParam.annualIncomeInterval=$scope.personalDetails.annualIncomeObject.annualIncomeInterval;var policyTerm=$scope.personalDetails.maturityAge-$scope.quoteParam.age;policyTerm<$scope.personalDetails.minPolicyTermLimit?$scope.quoteParam.policyTerm=$scope.personalDetails.minPolicyTermLimit:$scope.quoteParam.policyTerm=policyTerm,$scope.personalDetails.dateOfBirth=calcDOBFromAge($scope.quoteParam.age),$scope.quote.quoteParam=$scope.quoteParam,$scope.quote.personalDetails=$scope.personalDetails,$scope.quote.requestType=$scope.globalLabel.request.criticalIllnessRequestType,localStorageService.set("ciInputParamaters",$scope.quote),localStorageService.set("ciPersonalDetails",$scope.personalDetails),$scope.quoteParamCopy=angular.copy($scope.quoteParam),$scope.personalDetailsCopy=angular.copy($scope.personalDetails),$scope.requestId=null,$rootScope.ciQuoteResult=[],RestAPI.invoke($scope.globalLabel.getRequest.quoteCriticalIllness,$scope.quote).then(function(callback){$rootScope.ciQuoteRequest=[],callback.responseCode==$scope.globalLabel.responseCode.success?($rootScope.loading=!1,$scope.dataLoaded=!0,$scope.responseCodeList=[],$scope.requestId=callback.QUOTE_ID,localStorageService.set("CRITICAL_ILLNESS_UNIQUE_QUOTE_ID",$scope.requestId),$rootScope.ciQuoteRequest=callback.data,"undefined"!=String($rootScope.ciQuoteResult)&&$rootScope.ciQuoteResult.length>0&&($rootScope.ciQuoteResult.length=0),1==imauticAutomation&&imatCriticalIllnessLeadQuoteInfo(localStorageService,$scope,"ViewQuote"),olarkCustomParam(localStorageService.get("CRITICAL_ILLNESS_UNIQUE_QUOTE_ID"),localStorageService.get("selectedBusinessLineId"),localStorageService.get("quoteUserInfo"),!1),angular.forEach($rootScope.ciQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=$scope.globalLabel.transactionName.criticalIllnessQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var ciQuoteResponse=JSON.parse(callback);if(ciQuoteResponse.QUOTE_ID==$scope.requestId)if($scope.responseCodeList.push(ciQuoteResponse.responseCode),ciQuoteResponse.responseCode==$scope.globalLabel.responseCode.success){for(var i=0;i<$rootScope.ciQuoteRequest.length;i++)$rootScope.ciQuoteRequest[i].messageId==ciQuoteResponse.messageId&&(ciQuoteResponse.data.quotes[0].dailyPremium=Math.round(ciQuoteResponse.data.quotes[0].annualPremium/365),ciQuoteResponse.data.quotes[0].insuranceCompany=ciQuoteResponse.data.quotes[0].insuranceCompany,$rootScope.ciQuoteResult.push(ciQuoteResponse.data.quotes[0]),$rootScope.ciQuoteRequest[i].status=1);$scope.processResult()}else for(i=0;i<$rootScope.ciQuoteRequest.length;i++)$rootScope.ciQuoteRequest[i].messageId==ciQuoteResponse.messageId&&($rootScope.ciQuoteRequest[i].status=2,$rootScope.ciQuoteRequest[i].message=$sce.trustAsHtml($scope.globalLabel.validationMessages.generalisedLifeErrMsg))}).error(function(data,status){$scope.responseCodeList.push($scope.globalLabel.responseCode.systemError)})}),$scope.$watch("responseCodeList",function(newValue,oldValue,scope){if(p365Includes($scope.responseCodeList,$scope.globalLabel.responseCode.success)&&$scope.responseCodeList.length==$scope.ciQuoteRequest.length){for(var i=0;i<$rootScope.ciQuoteRequest.length;i++)0==$rootScope.ciQuoteRequest[i].status&&($rootScope.ciQuoteRequest[i].status=2,$rootScope.ciQuoteRequest[i].message=$sce.trustAsHtml($scope.globalLabel.validationMessages.generalisedLifeErrMsg));p365Includes($scope.responseCodeList,$scope.globalLabel.responseCode.success)||(p365Includes($scope.responseCodeList,$scope.globalLabel.responseCode.quoteNotAvailable)?$scope.errorMessage($scope.globalLabel.validationMessages.productNotFoundMsg):$scope.errorMessage($scope.globalLabel.validationMessages.generalisedErrMsg))}},!0)):($scope.responseCodeList=[],"undefined"!=String($rootScope.ciQuoteResult)&&$rootScope.ciQuoteResult.length>0&&($rootScope.ciQuoteResult.length=0),$rootScope.ciQuoteResult=[],$scope.errorMessage($sce.trustAsHtml($scope.globalLabel.validationMessages.generalisedLifeErrMsg)))}),$scope.displayRibbon()},100):$scope.riderDetailsModal=!1},$scope.state=!1,$scope.toggleState=function(){$scope.state=!$scope.state},$scope.PremiumFrequencyClick=function(premiumFrequency){$scope.frequencyDetailsModal=!1,$scope.singleClickCriticalIllnessQuote()}}),$scope.modelBeneFeature=!1,$scope.closeBeneFeatureModel=function(){$scope.modelBeneFeature=!1},$scope.buyProductProxy=function(selectedProduct){var postMethodDynamicFormArray=[],tempParentJson={};$scope.postMethodFormContent=[],postMethodDynamicFormArray.length=0;var buyProductDetails={frequency:{}};buyProductDetails.quoteParam=$scope.quoteParam,buyProductDetails.personalDetails=$scope.personalDetails,buyProductDetails.quoteResponse=angular.copy(selectedProduct),$scope.isMonthlyPremium?(buyProductDetails.quoteResponse.annualPremium=selectedProduct.monthlyFinalPremium,buyProductDetails.quoteResponse.frequency="3"):$scope.isQuarterlyPremium?(buyProductDetails.quoteResponse.annualPremium=selectedProduct.annualPremium,buyProductDetails.quoteResponse.frequency="0"):$scope.isHalfAnnualPremium?(buyProductDetails.quoteResponse.annualPremium=selectedProduct.annualPremium,buyProductDetails.quoteResponse.frequency="0"):$scope.isAnnualPremium&&(buyProductDetails.quoteResponse.annualPremium=selectedProduct.annualPremium,buyProductDetails.quoteResponse.frequency="0"),buyProductDetails.areaDetails=localStorageService.get("cityDataFromIP"),buyProductDetails.contactInfo=localStorageService.get("quoteUserInfo"),buyProductDetails.frequency.type=String($scope.isMonthlyPremium),buyProductDetails.contactInfo.lastName||(buyProductDetails.contactInfo.lastName=""),buyProductDetails.contactInfo.fullName=buyProductDetails.contactInfo.firstName+" "+buyProductDetails.contactInfo.lastName;var buyQuoteURL=$scope.criticalIllnessProductBuyConfigDetails.quoteurl,buyQuoteMethod=$scope.criticalIllnessProductBuyConfigDetails.method,buyQuoteURLParamList=$scope.criticalIllnessProductBuyConfigDetails.paramList,buyQuoteURLParams="?",buyProductPlan=$scope.criticalIllnessProductBuyConfigDetails.planName;if("GET"==buyQuoteMethod){for(var i=0;i<buyQuoteURLParamList.length;i++)if(i<buyQuoteURLParamList.length-1){if(buyQuoteURLParamList[i].defaultStatus)buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+buyQuoteURLParamList[i].value+"&";else if(null!=buyProductDetails[buyQuoteURLParamList[i].parentNode])if("date"==buyQuoteURLParamList[i].definedValueStatus){var pdate=buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname],dateformat=buyQuoteURLParamList[i].definedValue.format;buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+dateFormater(pdate,dateformat)+"&"}else buyQuoteURLParamList[i].definedValueStatus?buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+buyQuoteURLParamList[i].definedValue[buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]]+"&":buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]+"&"}else if(buyQuoteURLParamList[i].defaultStatus)buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+buyQuoteURLParamList[i].value;else if(null!=buyProductDetails[buyQuoteURLParamList[i].parentNode])if("date"==buyQuoteURLParamList[i].definedValueStatus){pdate=buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname],dateformat=buyQuoteURLParamList[i].definedValue.format;buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+dateFormater(pdate,dateformat)+"&"}else buyQuoteURLParamList[i].definedValueStatus?buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+buyQuoteURLParamList[i].definedValue[buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]]+"&":buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname];$window.open(buyQuoteURL+buyQuoteURLParams,"_blank")}else if("POST"==buyQuoteMethod){for(i=0;i<buyQuoteURLParamList.length;i++)if(buyQuoteURLParamList[i].isChild){if(buyQuoteURLParamList[i].isChild&&(tempParentJson.hasOwnProperty(buyQuoteURLParamList[i].parentElement)||(tempParentJson[buyQuoteURLParamList[i].parentElement]=""),buyQuoteURLParamList[i].defaultStatus&&("string"===buyQuoteURLParamList[i].definedValueStatus&&(tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : "'+buyQuoteURLParamList[i].value+'", '),"integer"===buyQuoteURLParamList[i].definedValueStatus&&(tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : '+buyQuoteURLParamList[i].value+", ")),!buyQuoteURLParamList[i].defaultStatus)){if("string"===buyQuoteURLParamList[i].definedValueStatus&&(null!=buyQuoteURLParamList[i].definedValue&&(tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : "'+buyQuoteURLParamList[i].definedValue[buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]]+'", '),tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : "'+buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]+'", '),"date"===buyQuoteURLParamList[i].definedValueStatus){pdate=buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname],dateformat=buyQuoteURLParamList[i].definedValue.format;var newFormattedDate=dateFormater(pdate,dateformat);console.log("new formatted date: "+newFormattedDate),tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : "'+newFormattedDate+'", '}"integer"===buyQuoteURLParamList[i].definedValueStatus&&(tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : '+buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]+", ")}}else if(buyQuoteURLParamList[i].defaultStatus)postMethodDynamicFormArray.push({name:buyQuoteURLParamList[i].cname,value:buyQuoteURLParamList[i].value});else if(null!=buyProductDetails[buyQuoteURLParamList[i].parentNode])if("date"==buyQuoteURLParamList[i].definedValueStatus){var pdate=buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname],dateformat=buyQuoteURLParamList[i].definedValue.format;postMethodDynamicFormArray.push({name:buyQuoteURLParamList[i].cname,value:dateFormater(pdate,dateformat)})}else buyQuoteURLParamList[i].definedValueStatus?postMethodDynamicFormArray.push({name:buyQuoteURLParamList[i].cname,value:buyQuoteURLParamList[i].definedValue[buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]]}):"Fullname"==buyQuoteURLParamList[i].cname?postMethodDynamicFormArray.push({name:buyQuoteURLParamList[i].cname,value:buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]+"+"+buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname1]}):postMethodDynamicFormArray.push({name:buyQuoteURLParamList[i].cname,value:buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]});$scope.paymentForm.setAction(buyQuoteURL);var parentKeysArray=Object.keys(tempParentJson),parentKeysLength=parentKeysArray.length-1;buyProductPlan?0==parentKeysArray.length?($scope.postMethodFormContent.length=0,$scope.postMethodFormContent=postMethodDynamicFormArray,$scope.$apply(),$scope.paymentForm.commit()):parentKeysArray.forEach(function(keyObj,keyIndex){postMethodDynamicFormArray.push({name:keyObj,value:'[{ "MyLifePlusModel" : {'+tempParentJson[keyObj]+"} }]"}),keyIndex==parentKeysLength&&($scope.postMethodFormContent.length=0,$scope.postMethodFormContent=postMethodDynamicFormArray,$scope.$apply(),$scope.paymentForm.commit())}):parentKeysArray.forEach(function(keyObj,keyIndex){postMethodDynamicFormArray.push({name:keyObj,value:'[{ "TotalSecurePlusModel" : {'+String(tempParentJson[keyObj])+"} }]"}),keyIndex==parentKeysLength&&($scope.postMethodFormContent.length=0,$scope.postMethodFormContent=postMethodDynamicFormArray,$scope.$apply(),$scope.paymentForm.commit())})}},$scope.buyScreenTemplate=function(selectedProduct){$scope.isMonthlyPremium&&(selectedProduct.premiumTypeMonthOrAnnual="Monthly Premium",selectedProduct.monthlyFinalPremium=selectedProduct.monthlyFinalPremium),$scope.isQuarterlyPremium&&(selectedProduct.premiumTypeMonthOrAnnual="Annual Premium",selectedProduct.annualPremium=selectedProduct.annualPremium),$scope.isHalfAnnualPremium&&(selectedProduct.premiumTypeMonthOrAnnual="Half Annual Premium",selectedProduct.annualPremium=selectedProduct.annualPremium),$scope.isAnnualPremium&&(selectedProduct.premiumTypeMonthOrAnnual="Annual Premium",selectedProduct.annualPremium=selectedProduct.annualPremium),localStorageService.set("criticalIllnessSelectedProduct",selectedProduct),$scope.selectedProduct=selectedProduct,$scope.modalCompare&&($scope.modalCompare=!1);var buyScreenParam={};buyScreenParam.documentType=proposalScreenConfig,buyScreenParam.businessLineId=localStorageService.get("selectedBusinessLineId"),buyScreenParam.carrierId=selectedProduct.carrierId,buyScreenParam.productId=selectedProduct.productId,buyScreenParam.QUOTE_ID=localStorageService.get("CRITICAL_ILLNESS_UNIQUE_QUOTE_ID"),$rootScope.voluntaryDeductable=0,$rootScope.antiTheftDeviceAmount=0;for(var i=0;i<selectedProduct.discountList.length;i++)"Voluntary Deductible Discount"==selectedProduct.discountList[i].type&&selectedProduct.discountList[i].discountAmount>0&&($rootScope.voluntaryDeductable=selectedProduct.discountList[i].discountAmount),"Anti-Theft Discount"==selectedProduct.discountList[i].type&&selectedProduct.discountList[i].discountAmount>0&&($rootScope.antiTheftDeviceAmount=selectedProduct.discountList[i].discountAmount);getDocUsingParam(RestAPI,productDataReader,buyScreenParam,function(buyScreen){buyScreen.responseCode==$scope.globalLabel.responseCode.success?(localStorageService.set("buyScreen",buyScreen.data),$scope.productValidation=buyScreen.data.validation,$scope.resultCnfrmBuyFlag||("renew"==$scope.quoteParam.policyType&&$scope.setRangePrevPolicyStartDate(),$scope.modalResultCnfrmBuy=!0),$rootScope.loading=!0,$location.path("/buyAssurance"),getListFromDB(RestAPI,"",criticalIllnessCarrier,findAppConfig,function(criticalIllnessCarrierList){if(criticalIllnessCarrierList.responseCode==$scope.globalLabel.responseCode.success){localStorageService.set("criticalIllnessCarrierList",criticalIllnessCarrierList.data);$scope.globalLabel.documentType.buyScreen,localStorageService.get("selectedBusinessLineId")}else $location.path("/quote"),$rootScope.P365Alert("Policies365",$scope.globalLabel.validationMessages.generalisedErrMsg,"Ok")})):$rootScope.P365Alert("Policies365",$scope.globalLabel.validationMessages.generalisedErrMsg,"Ok")})},$scope.buyProduct=function(selectedProduct){$scope.quoteUserInfo=localStorageService.get("quoteUserInfo");var redirectionURLDocId=$scope.globalLabel.documentType.criticalIllnessProductBuyConfig+"-"+selectedProduct.carrierId+"-"+selectedProduct.productId;getDocUsingId(RestAPI,redirectionURLDocId,function(criticalIllnessProductBuyConfigDetails){criticalIllnessProductBuyConfigDetails&&($scope.criticalIllnessProductBuyConfigDetails=criticalIllnessProductBuyConfigDetails)}),$timeout(function(){$scope.buyProductProxy(selectedProduct)},500)},$rootScope.signout=function(){$rootScope.userLoginStatus=!1;var userLoginInfo={username:""};userLoginInfo.status=$rootScope.userLoginStatus,localStorageService.set("userLoginInfo",userLoginInfo),$location.path("/quote")},$scope.missionCompled=function(){$rootScope.loading=!1},$scope.data={},$scope.data.group1=1,$scope.modalCompare=!1,$scope.consolatedRiderList=[],$scope.consolatedDiscountList=[],$scope.toggleCompare=function(){var riderJson={};angular.forEach($scope.selectedCarrier,function(quote){angular.forEach(quote.riders,function(rider){null==riderJson[rider.riderId]&&($scope.consolatedRiderList.push(rider),riderJson[rider.riderId]=rider.riderName)})});var discountJson={};angular.forEach($scope.selectedCarrier,function(quote){angular.forEach(quote.discountList,function(discount){null==discountJson[discount.type]&&null!=discount.discountAmount&&0!=discount.discountAmount&&($scope.consolatedDiscountList.push(discount),discountJson[discount.type]=discount.type)})}),$scope.modalCompare=!0,$scope.hideModal=function(){$scope.modalCompare=!1}},$scope.cardView=!0,$scope.compareView=!1,$scope.showCompareBtn=!0,$scope.showCardBtn=!0,$scope.disableSort=!1,$scope.compareViewClick=function(){var riderJson={};$scope.consolatedRiderList=[],$scope.consolatedDiscountList=[],angular.forEach($rootScope.ciQuoteResult,function(quote){angular.forEach(quote.riders,function(rider){null==riderJson[rider.riderId]&&($scope.consolatedRiderList.push(rider),riderJson[rider.riderId]=rider.riderName)})});var discountJson={};angular.forEach($rootScope.ciQuoteResult,function(quote){angular.forEach(quote.discountList,function(discount){null==discountJson[discount.type]&&null!=discount.discountAmount&&($scope.consolatedDiscountList.push(discount),discountJson[discount.type]=discount.type)})}),$scope.disableSort=!1,$scope.dataLoaded=!0,$scope.slickLoaded=!0,$scope.cardView=!0,$scope.compareView=!1,$scope.showCompareBtn=!0,$scope.showCardBtn=!0},$scope.cardViewClick=function(){$scope.dataLoaded=!0,$scope.slickLoaded=!0,$scope.cardView=!1,$scope.compareView=!0,$scope.showCompareBtn=!0,$scope.showCardBtn=!0,$scope.disableSort=!0},$scope.premiumChoice=!0,$scope.findRider=function(riderId,riders){var returnvalue="Not Available";if(void 0==riders)return returnvalue="-";for(var count=0;count<riders.length;count++){if(riderId==riders[count].riderId&&0!=riders[count].riderPremiumAmount&&null!=riders[count].riderPremiumAmount){returnvalue=riders[count].riderPremiumAmount;break}if(riderId==riders[count].riderId&&"Included"==riders[count].riderType&&0==riders[count].riderPremiumAmount||void 0==riders[count].riderPremiumAmount){returnvalue=riders[count].riderType;break}if(riderId==riders[count].riderId&&"Not Available"==riders[count].riderType&&0==riders[count].riderPremiumAmount){returnvalue="0";break}}return"-1"==returnvalue&&(returnvalue="-"),returnvalue},$scope.findDiscount=function(type,discounts){for(var returnvalue="NA",count=0;count<discounts.length;count++)if(type==discounts[count].type&&0!=discounts[count].discountAmount&&null!=discounts[count].discountAmount){returnvalue=discounts[count].discountAmount;break}return returnvalue},$scope.showRiderModal=function(){$scope.riderDetailsModal=!$scope.riderDetailsModal},$scope.openCriticalIllnessPopup=function(selectedTab,_data){$scope.criticalIllnessProductToBeAddedInCart=_data,$rootScope.selectedTabCriticalIllness=selectedTab,$scope.premiumModalCriticalIllness=!$scope.premiumModalCriticalIllness},$scope.hidePremiumModalCriticalIllness=function(){$scope.premiumModalCriticalIllness=!1},$scope.hideRiderDetailsModal=function(){$scope.resetRiderDetails(),$scope.riderDetailsModal=!1},$(".activateFooter").hide(),$(".activateHeader").hide()}]);