"use strict";angular.module("lifeInstantQuote",["CoreComponentApp","LocalStorageModule"]).controller("lifeInstantQuoteController",["$scope","$rootScope","$window","$location","$filter","RestAPI","localStorageService","$timeout","$interval","$http","$sce","$anchorScroll",function($scope,$rootScope,$window,$location,$filter,RestAPI,localStorageService,$timeout,$interval,$http,$sce,$anchorScroll){function getAllProductFeatures(selectedProduct,productFetchStatus){var variableReplaceArray=[],productFeatureJSON={};$rootScope.consolidatedBenefitsList=[],$rootScope.consolidatedSavingsList=[],$rootScope.consolidatedFlexibilityList=[],productFeatureJSON.documentType=$scope.p365Labels.documentType.lifeProduct,productFeatureJSON.carrierId=selectedProduct.carrierId,productFeatureJSON.productId=selectedProduct.productId,productFeatureJSON.businessLineId=1;for(var selectedCarrierId=selectedProduct.carrierId,selectedProductId=selectedProduct.productId,i=0;i<$rootScope.carrierDetails.brochureList.length;i++)selectedProduct.carrierId==$rootScope.carrierDetails.brochureList[i].carrierId&&($scope.brochureUrl=$rootScope.carrierDetails.brochureList[i].brochureUrl);variableReplaceArray.push({id:"{{sumInsured}}",value:Math.round(selectedProduct.sumInsured)}),variableReplaceArray.push({id:"{{monthlyPayout}}",value:selectedProduct.monthlyPayout}),variableReplaceArray.push({id:"{{policyTerm}}",value:selectedProduct.policyTerm}),productFetchStatus&&RestAPI.invoke($scope.p365Labels.transactionName.getProductFeatures,productFeatureJSON).then(function(callback){var scopeVariableName="productFeaturesList_"+selectedCarrierId+"_"+selectedProductId,productFeatureJSONName="productFeaturesJSON_"+selectedCarrierId+"_"+selectedProductId;$rootScope[productFeatureJSONName]={},$scope[scopeVariableName]=callback.data[0].Features;for(var i=0;i<variableReplaceArray.length;i++)p365Includes($scope[scopeVariableName][1].details,variableReplaceArray[i].id)&&($scope[scopeVariableName][1].details=$scope[scopeVariableName][1].details.replace(variableReplaceArray[i].id,variableReplaceArray[i].value));for(i=0;i<$scope[scopeVariableName].length;i++)$rootScope[productFeatureJSONName][callback.data[0].Features[i].titleForCompareView]=callback.data[0].Features[i].detailsForCompareView;selectedProduct.features=$rootScope[productFeatureJSONName];for(i=0;i<$scope[scopeVariableName].length;i++)"Benefits"==$scope[scopeVariableName][i].featureCategory&&"Y"==$scope[scopeVariableName][i].compareView&&-1===$rootScope.consolidatedBenefitsList.indexOf($scope[scopeVariableName][i].titleForCompareView)&&$rootScope.consolidatedBenefitsList.push($scope[scopeVariableName][i].titleForCompareView),"Savings"==$scope[scopeVariableName][i].featureCategory&&"Y"==$scope[scopeVariableName][i].compareView&&-1===$rootScope.consolidatedSavingsList.indexOf($scope[scopeVariableName][i].titleForCompareView)&&$rootScope.consolidatedSavingsList.push($scope[scopeVariableName][i].titleForCompareView),"Flexibility"==$scope[scopeVariableName][i].featureCategory&&"Y"==$scope[scopeVariableName][i].compareView&&-1===$rootScope.consolidatedFlexibilityList.indexOf($scope[scopeVariableName][i].titleForCompareView)&&$rootScope.consolidatedFlexibilityList.push($scope[scopeVariableName][i].titleForCompareView)})}$scope.p365Labels=insLifeQuoteLabels,$rootScope.loaderContent={businessLine:"1",header:"Life Insurance",desc:$sce.trustAsHtml($scope.p365Labels.common.proverbInstantQuote)},"/life"==$location.path()?$rootScope.title=$scope.p365Labels.policies365Title.lifeInstantQuoteLanding:$rootScope.title=$scope.p365Labels.policies365Title.lifeInstantQuote,$anchorScroll("home"),$scope.payoutDetails={},$scope.relationType=relationLifeQuoteGeneric,$scope.healthConditionType=healthConditionGeneric,$scope.annualIncomesRange=annualIncomesGeneric,$scope.genderType=genderTypeGeneric,$scope.tobaccoAddictionStatus=tobaccoAddictionStatusGeneric,$scope.payoutOptions=lifePayoutOptionsGeneric,$rootScope.carrierDetails={},$rootScope.GSTTag=!1,$rootScope.loading=!0,$rootScope.instantQuoteSummaryStatus=!0,$rootScope.disableLandingLeadBtn=!1,$scope.quoteParam=defaultLifeQuoteParam.quoteParam,$scope.personalDetails=defaultLifeQuoteParam.personalDetails,getDocUsingId(RestAPI,$scope.p365Labels.common.ridersDocInDB,function(carrierDetails){$rootScope.carrierDetails=carrierDetails,$scope.instantQuoteCalculation=function(addOnCoverForLife){addRidersToDefaultQuote(addOnCoverForLife,localStorageService.get("selectedBusinessLineId"),function(defaultRiderList,defaultRiderArrayObject){var lifeQuoteCookie=localStorageService.get("lifeQuoteInputParamaters"),personalDetailsCookie=localStorageService.get("lifePersonalDetails");console.log("inside instant quote calculation"),$scope.quote={},$scope.quoteParam={},$scope.personalDetails={},$rootScope.viewOptionDisabled=!0,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteLifeForm=!0,$rootScope.openRegPopup=function(){$rootScope.Regpopup=!0},$scope.closePop=function(){$rootScope.Regpopup=!1},$scope.updateAnnualPremiumRange=function(minPremiumValue,maxPremiumValue){minPremiumValue>maxPremiumValue?($rootScope.minAnnualPremium=maxPremiumValue,$rootScope.maxAnnualPremium=minPremiumValue):($rootScope.minAnnualPremium=minPremiumValue,$rootScope.maxAnnualPremium=maxPremiumValue)},$scope.calculateSumAssured=function(){listSumAssuredAmt($scope.personalDetails.annualIncomeObject.annualIncome,function(sumInsuredArray,selectedSumAssured){$scope.quoteParam.sumInsured=selectedSumAssured.amount,$scope.personalDetails.sumInsuredObject=selectedSumAssured,$scope.personalDetails.sumInsuredList=sumInsuredArray;var urlPattern=$location.path();$rootScope.wordPressEnabled&&"/lifeproduct"!=urlPattern&&"/lifequote"!=urlPattern||$scope.singleClickLifeQuote()})},$scope.errorMessage=function(errorMsg){"undefined"==String($rootScope.lifeQuoteResult)||0==$rootScope.lifeQuoteResult.length?($scope.updateAnnualPremiumRange(1e3,5e3),$rootScope.instantQuoteSummaryStatus=!1,$rootScope.instantQuoteSummaryError=errorMsg,$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!0,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteLifeForm=!1):$rootScope.lifeQuoteResult.length>0&&($rootScope.instantQuoteSummaryStatus=!0,$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!1,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteLifeForm=!1),$rootScope.loading=!1},$scope.tooltipPrepare=function(lifeResult){$rootScope.riderOptionList="<ul style='text-align: left;' class='tickpoints'>";for(var i=0;i<addOnCoverForLife.length;i++)$rootScope.riderOptionList+="<li>"+addOnCoverForLife[i].riderName+"</li>";$rootScope.riderOptionList+="</ul>";var resultCarrierId=[],testCarrierId=[];for(i=0;i<lifeResult.length;i++)if(Number(lifeResult[i].annualPremium)>0){var carrierInfo={};carrierInfo.id=lifeResult[i].carrierId,carrierInfo.name=lifeResult[i].insuranceCompany,carrierInfo.annualPremium=lifeResult[i].annualPremium,carrierInfo.isMonthlyPremium=!1,carrierInfo.claimsRating=lifeResult[i].insurerIndex,$rootScope.wordPressEnabled&&(carrierInfo.sumInsured=lifeResult[i].sumInsured,carrierInfo.businessLineId="1"),0==p365Includes(testCarrierId,lifeResult[i].carrierId)&&(resultCarrierId.push(carrierInfo),testCarrierId.push(lifeResult[i].carrierId))}$rootScope.resultCarrierId=resultCarrierId;for(i=0;i<resultCarrierId.length;i++)$rootScope.quoteResultInsurerList+="<li>"+resultCarrierId[i].name+"</li>";$rootScope.quoteResultInsurerList+="</ul>",$rootScope.calculatedQuotesLength=2==String(lifeResult.length).length?String(lifeResult.length):"0"+String(lifeResult.length),$rootScope.calculatedRidersLength=2==String(addOnCoverForLife.length).length?String(addOnCoverForLife.length):"0"+String(addOnCoverForLife.length),setTimeout(function(){scrollv=new scrollable({wrapperid:"scrollable-v",moveby:4,mousedrag:!0})},2e3)},$scope.processResult=function(){$rootScope.enabledProgressLoader=!1,$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!1,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteLifeForm=!1,$rootScope.loading=!1,$rootScope.campaignFlag=!0,$rootScope.lifeQuoteResult=$filter("orderBy")($rootScope.lifeQuoteResult,"dailyPremium");for(var minDailyPremiumValue=$rootScope.lifeQuoteResult[0].dailyPremium,dailyPremiumSliderArray=[],j=0;j<$rootScope.lifeQuoteResult.length;j++){var calculatedDiscAmt=0,discountAmtList=$rootScope.lifeQuoteResult[j].discountList;if("undefined"!=String(discountAmtList)){for(var i=0;i<discountAmtList.length;i++)calculatedDiscAmt+=discountAmtList[i].discountAmount;calculatedDiscAmt+=$rootScope.lifeQuoteResult[j].dailyPremium,dailyPremiumSliderArray.push(calculatedDiscAmt)}else dailyPremiumSliderArray.push($rootScope.lifeQuoteResult[j].dailyPremium)}dailyPremiumSliderArray=$filter("orderBy")(dailyPremiumSliderArray),$scope.updateAnnualPremiumRange(minDailyPremiumValue,dailyPremiumSliderArray[dailyPremiumSliderArray.length-1]),1==localStorageService.get("selectedBusinessLineId")&&$scope.tooltipPrepare($rootScope.lifeQuoteResult)},$scope.singleClickLifeQuote=function(){if($rootScope.instantQuoteSummaryStatus=!0,$rootScope.progressBarStatus=!0,$rootScope.viewOptionDisabled=!0,$rootScope.tabSelectionStatus=!1,$scope.instantQuoteLifeForm=!0,$rootScope.loading=!0,localStorageService.set("selectedBusinessLineId",1),$scope.quoteParam.documentType=$scope.p365Labels.documentType.quoteRequest,$scope.quoteParam.quoteType=localStorageService.get("selectedBusinessLineId"),$scope.quoteParam.personType=relationLifeQuoteGeneric[0],$scope.quoteParam.payoutId=$scope.payoutOptions[0].id,$scope.quoteParam.annualIncome=$scope.personalDetails.annualIncomeObject.annualIncome,$scope.quoteParam.annualIncomeInterval=$scope.personalDetails.annualIncomeObject.annualIncomeInterval,$scope.quoteParam.sumInsured=$scope.personalDetails.sumInsuredObject.amount,$scope.quoteParam.frequency="Annual",$scope.quoteParam.age>=35)var policyTerm=lifematurityAgeConstant-$scope.quoteParam.age;else policyTerm=40;policyTerm<$scope.personalDetails.minPolicyTermLimit?$scope.quoteParam.policyTerm=$scope.personalDetails.minPolicyTermLimit:$scope.quoteParam.policyTerm=policyTerm,$scope.personalDetails.minMaturityAge=$scope.quoteParam.age+5,$scope.personalDetails.dateOfBirth=calcDOBFromAge($scope.quoteParam.age),$scope.quote.quoteParam=$scope.quoteParam,$scope.quote.personalDetails=$scope.personalDetails,$scope.quote.requestType=$scope.p365Labels.request.requestType,localStorageService.set("lifeQuoteInputParamaters",$scope.quote),localStorageService.set("lifePersonalDetails",$scope.personalDetails),$scope.requestId=null,localStorageService.get("PROF_QUOTE_ID")&&($scope.quote.PROF_QUOTE_ID=localStorageService.get("PROF_QUOTE_ID")),campaignSource.utm_source&&($scope.quote.utm_source=campaignSource.utm_source),campaignSource.utm_medium&&($scope.quote.utm_medium=campaignSource.utm_medium),RestAPI.invoke($scope.p365Labels.getRequest.quoteLife,$scope.quote).then(function(callback){$rootScope.lifeQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success?($scope.responseCodeList=[],$scope.requestId=callback.QUOTE_ID,$scope.UNIQUE_QUOTE_ID_ENCRYPTED=callback.encryptedQuoteId,localStorageService.set("LIFE_UNIQUE_QUOTE_ID",$scope.requestId),localStorageService.set("LIFE_UNIQUE_QUOTE_ID_ENCRYPTED",$scope.UNIQUE_QUOTE_ID_ENCRYPTED),$rootScope.lifeQuoteRequest=callback.data,"undefined"!=String($scope.quoteResult)&&$scope.quoteResult.length>0&&($scope.quoteResult.length=0),"undefined"!=String($rootScope.lifeQuoteResult)&&$rootScope.lifeQuoteResult.length>0&&($rootScope.lifeQuoteResult.length=0),$rootScope.lifeQuoteResult=[],angular.forEach($rootScope.lifeQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.deviceId=deviceIdOrigin,header.transactionName=$scope.p365Labels.transactionName.lifeQuoteResult,request.header=header,campaignSource.utm_source&&(obj.utm_source=campaignSource.utm_source),campaignSource.utm_medium&&(obj.utm_medium=campaignSource.utm_medium),request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var lifeQuoteResponse=JSON.parse(callback);if(lifeQuoteResponse.QUOTE_ID==$scope.requestId&&($scope.responseCodeList.push(lifeQuoteResponse.responseCode),lifeQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)){for(var j=0;j<$rootScope.carrierDetails.riderList.length;j++)$rootScope.carrierDetails.riderList[j].carrierId==lifeQuoteResponse.data.quotes[0].carrierId&&$rootScope.carrierDetails.riderList[j].productId==lifeQuoteResponse.data.quotes[0].productId&&(lifeQuoteResponse.data.quotes[0].riders=$rootScope.carrierDetails.riderList[j].riders);for(var k=0;k<lifeQuoteResponse.data.quotes[0].riderList.length;k++)for(var l=0;l<lifeQuoteResponse.data.quotes[0].riders.length;l++)lifeQuoteResponse.data.quotes[0].riderList[k].riderId==lifeQuoteResponse.data.quotes[0].riders[l].id&&(lifeQuoteResponse.data.quotes[0].riders[l].value=lifeQuoteResponse.data.quotes[0].riderList[k].riderPremiumAmount);if(lifeQuoteResponse.data.quotes[0].riders)for(var m=0;m<lifeQuoteResponse.data.quotes[0].riders.length;m++)"At Additional Cost"==lifeQuoteResponse.data.quotes[0].riders[m].riderType?(lifeQuoteResponse.data.quotes[0].riders[m].riderImgPath="additionalCost",lifeQuoteResponse.data.quotes[0].riders[m].riderTooltipName="Additional Cost"):"Not Available"==lifeQuoteResponse.data.quotes[0].riders[m].riderType?(lifeQuoteResponse.data.quotes[0].riders[m].riderImgPath="notAvailable",lifeQuoteResponse.data.quotes[0].riders[m].riderTooltipName="Not Available"):"Included"==lifeQuoteResponse.data.quotes[0].riders[m].riderType&&(lifeQuoteResponse.data.quotes[0].riders[m].riderImgPath="included",lifeQuoteResponse.data.quotes[0].riders[m].riderTooltipName="Included");for(var i=0;i<$rootScope.lifeQuoteRequest.length;i++)$rootScope.lifeQuoteRequest[i].messageId==lifeQuoteResponse.messageId&&(lifeQuoteResponse.data.quotes[0].dailyPremium=Math.round(lifeQuoteResponse.data.quotes[0].annualPremium/365),lifeQuoteResponse.data.quotes[0].insuranceCompany=JSON.parse(lifeQuoteResponse.data.quotes[0].insuranceCompany),$rootScope.lifeQuoteResult.push(lifeQuoteResponse.data.quotes[0]),getAllProductFeatures(lifeQuoteResponse.data.quotes[0],!0),$rootScope.lifeQuoteRequest[i].status=1);$scope.processResult()}}).error(function(data,status){$scope.responseCodeList.push($scope.p365Labels.responseCode.systemError)})}),$scope.$watch("responseCodeList",function(newValue,oldValue,scope){p365Includes($scope.responseCodeList,$scope.p365Labels.responseCode.success)&&($rootScope.loading=!1),$scope.responseCodeList.length==$rootScope.lifeQuoteRequest.length&&($rootScope.loading=!1,p365Includes($scope.responseCodeList,$scope.p365Labels.responseCode.success)||(p365Includes($scope.responseCodeList,$scope.p365Labels.responseCode.quoteNotAvailable)?$scope.errorMessage($scope.p365Labels.validationMessages.productNotFoundMsg):$scope.errorMessage($sce.trustAsHtml($scope.p365Labels.validationMessages.generalisedLifeErrMsg))))},!0)):($scope.responseCodeList=[],"undefined"!=String($scope.quoteResult)&&$scope.quoteResult.length>0&&($scope.quoteResult.length=0),"undefined"!=String($rootScope.lifeQuoteResult)&&$rootScope.lifeQuoteResult.length>0&&($rootScope.lifeQuoteResult.length=0),$rootScope.lifeQuoteResult=[],$scope.errorMessage(callback.message))})},$scope.$on("callSingleClickLifeQuote",function(){$scope.singleClickLifeQuote()}),$scope.calculateLifePremium=function(){$rootScope.wordPressEnabled||$scope.singleClickLifeQuote()},$scope.prePopulateFields=function(){for(var i=0;i<annualIncomesGeneric.length;i++)if($scope.quoteParam.annualIncome==annualIncomesGeneric[i].annualIncome){$scope.personalDetails.annualIncomeObject=annualIncomesGeneric[i];break}listSumAssuredAmt($scope.personalDetails.annualIncomeObject.annualIncome,function(sumInsuredArray,selectedSumAssured){$scope.quoteParam.sumInsured=selectedSumAssured.amount,$scope.personalDetails.sumInsuredObject=selectedSumAssured,$scope.personalDetails.sumInsuredList=sumInsuredArray}),setTimeout(function(){var urlPattern=$location.path();$rootScope.wordPressEnabled&&"/lifeproduct"!=urlPattern&&"/lifequote"!=urlPattern&&"/lifeLanding"!=urlPattern?$scope.instantQuoteLifeForm=!1:("/lifeLanding"==urlPattern&&(sourceOrigin="landing",console.log("soure origin for life landing is: ",sourceOrigin)),$scope.singleClickLifeQuote())},100)},$scope.fetchDefaultInputParamaters=function(defaultQuoteStatus,defaultInputParamCallback){if(defaultQuoteStatus){if($scope.quoteParam=defaultLifeQuoteParam.quoteParam,$scope.personalDetails=defaultLifeQuoteParam.personalDetails,$rootScope.wordPressEnabled){if($scope.quote={},$scope.quoteParam.age>=35?$scope.personalDetails.maturityAge=lifematurityAgeConstant:$scope.personalDetails.maturityAge=$scope.quoteParam.age+30,$rootScope.insuredGender){var selectedGender=$rootScope.insuredGender;$scope.quoteParam.gender="Male"==selectedGender?"M":"F"}$scope.quote.personalDetails=$scope.personalDetails,$scope.quote.quoteParam=$scope.quoteParam,localStorageService.set("selectedBusinessLineId",1),localStorageService.set("lifeQuoteInputParamaters",$scope.quote),localStorageService.set("lifePersonalDetails",$scope.personalDetails)}}else $scope.quoteParam=lifeQuoteCookie.quoteParam,$scope.personalDetails=personalDetailsCookie,$scope.personalDetails.maturityAge||($scope.quoteParam.age>=35?$scope.personalDetails.maturityAge=lifematurityAgeConstant:$scope.personalDetails.maturityAge=$scope.quoteParam.age+30);if($rootScope.insuredGender){selectedGender=$rootScope.insuredGender;$scope.quoteParam.gender="Male"==selectedGender?"M":"F"}console.log("$rootScope.insuredGender: ",$rootScope.insuredGender),$scope.ageList=getAgeList($scope.personalDetails.minInsuredAge,$scope.personalDetails.maxInsuredAge),$scope.prePopulateFields(),$rootScope.loading=!1,defaultInputParamCallback()},console.log("lifeQuoteCookie in instant screen is",lifeQuoteCookie),null!=lifeQuoteCookie&&"undefined"!==String(lifeQuoteCookie)?$scope.fetchDefaultInputParamaters(!1,function(){}):$scope.fetchDefaultInputParamaters(!0,function(){})})},localStorageService.get("ridersLifeStatus")?$scope.instantQuoteCalculation(localStorageService.get("addOnCoverForLife")):getRiderList(RestAPI,$scope.p365Labels.documentType.riderList,$scope.p365Labels.documentType.life,$scope.p365Labels.request.findAppConfig,function(addOnCoverForLife){localStorageService.set("addOnCoverForLife",addOnCoverForLife),localStorageService.set("ridersLifeStatus",!0);$scope.p365Labels.documentType.instantQuoteScreen,localStorageService.get("selectedBusinessLineId");$scope.instantQuoteCalculation(addOnCoverForLife)})})}]);var jsonEncodeCarrierList=[];angular.module("lifeResult",["CoreComponentApp","LocalStorageModule","ngMessages","checklist-model"]).controller("lifeResultController",["$scope","$rootScope","$filter","$location","$http","$window","RestAPI","localStorageService","$timeout","$interval","$sce",function($scope,$rootScope,$filter,$location,$http,$window,RestAPI,localStorageService,$timeout,$interval,$sce){var applicationLabels=localStorageService.get("applicationLabels");if($scope.globalLabel=applicationLabels.globalLabels,$scope.p365Labels=insLifeQuoteLabels,$rootScope.loaderContent={businessLine:"1",header:"Life Insurance",desc:$sce.trustAsHtml($scope.p365Labels.common.proverbResult)},$rootScope.title=$scope.p365Labels.policies365Title.lifeResultQuote,$scope.quote={},$scope.payoutDetails={},$rootScope.wordPressEnabled?$scope.rippleColor="":$scope.rippleColor="#f8a201",$scope.lifeInputSectionHTML=wp_path+"buy/life/html/LifeInputSection.html",$scope.lifeRiderSectionHTML=wp_path+"buy/life/html/LifeRiderSection.html",$scope.lifePayoutSectionHTML=wp_path+"buy/life/html/LifePayoutSection.html",$scope.lifeShareEmailSectionHTML=wp_path+"buy/life/html/LifeShareEmailSection.html",$scope.lifeFeaturesTemplate=wp_path+"buy/common/html/featureBenefitsLife.html",$scope.lifePremiumTemplate=wp_path+"buy/common/html/lifePremiumTemplate.html",localStorageService.get("userLoginInfo")&&($rootScope.userLoginStatus=localStorageService.get("userLoginInfo").status,$rootScope.username=localStorageService.get("userLoginInfo").username),$rootScope.loading=!0,$rootScope.isBackButtonPressed=!1,$rootScope.disableLandingLeadBtn=!1,$scope.isMonthlyPremium=!1,$scope.isAnnualPremium=!0,$scope.payoutOptionModal=!1,$scope.riderDetailsModal=!1,$rootScope.isAnnualPremium=$scope.isAnnualPremium,$scope.lifeInputSection=!1,$scope.payoutInputSection=!1,$scope.riderInputSection=!1,$scope.quoteUserInfo={},$scope.quoteUserInfo.messageId="",$scope.quoteUserInfo.termsCondition=!0,$rootScope.isLifeLanding&&($scope.lifeAffilatedLeadId=$sce.trustAsResourceUrl("https://tracking.icubeswire.co/aff_a?offer_id=1951&adv_sub1= "+messageIDVar+"&adv_sub2="+localStorageService.get("quoteUserInfo").mobileNumber),console.log("inside health landing $scope.healthAffilatedLeadId is: ",$scope.healthAffilatedLeadId)),$scope.modalView=!1,"/PBLifeResult"==$location.path()&&($scope.PBLifeInputSection=wp_path+"buy/common/html/PBHTML/PBLifeInputSection.html",$scope.PBLifeRidersSection=wp_path+"buy/common/html/PBHTML/PBLifeRiderSection.html",$scope.PBLifeBestResultSection=wp_path+"buy/common/html/PBHTML/PBLifeBestResultSection.html",$scope.inputSectionEnabled=!0,$scope.ridersSectionEnabled=!1,$scope.resultSectionEnabled=!1,$scope.commonInfo=localStorageService.get("professionalQuoteParams").commonInfo),$rootScope.agencyPortalEnabled){const quoteUserInfo=JSON.parse(localStorage.getItem("quoteUserInfo"));console.log("quoteUserInfo in agency life result is::",quoteUserInfo),quoteUserInfo&&($scope.quoteUserInfo=quoteUserInfo,localStorageService.set("quoteUserInfo",$scope.quoteUserInfo)),1==imauticAutomation&&imatLifeLeadQuoteInfo(localStorageService,$scope,"LeadSubmitted")}if($rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled){if($location.search().messageId&&(messageIDVar=$location.search().messageId),console.log("quote user info in life result step 1 is::",localStorageService.get("quoteUserInfo")),"undefined"!=String($location.search().leaddetails)){var leaddetails=JSON.parse($location.search().leaddetails);leaddetails.messageId||(leaddetails.messageId=$location.search().messageId),console.log("leaddetails in life result is::",leaddetails),localStorageService.set("quoteUserInfo",leaddetails)}$scope.lifeInputSection=!0,$scope.payoutInputSection=!0,$scope.riderInputSection=!0}$scope.UNIQUE_QUOTE_ID_ENCRYPTED=localStorageService.get("LIFE_UNIQUE_QUOTE_ID_ENCRYPTED"),localStorageService.get("PROF_QUOTE_ID_ENCRYPTED")&&($scope.UNIQUE_PROF_QUOTE_ID_ENCRYPTED=localStorageService.get("PROF_QUOTE_ID_ENCRYPTED")),$scope.showPersonalDetails=function(){$scope.lifeInputSection=!$scope.lifeInputSection},$scope.showRiderDetails=function(){$scope.riderInputSection=!$scope.riderInputSection},$scope.showPayoutDetails=function(){$scope.payoutInputSection=!$scope.payoutInputSection},$scope.backToResultScreen=function(){$rootScope.wordPressEnabled&&($rootScope.isBackButtonPressed=!0),$rootScope.isProfessionalJourneySelected?$location.path("/professionalJourneyResult"):$location.path("/PBQuote")};var carrierRiderList=angular.copy($rootScope.carrierDetails);function getAllProductFeatures(selectedProduct,productFetchStatus){var variableReplaceArray=[],productFeatureJSON={};$rootScope.consolidatedBenefitsList=[],$rootScope.consolidatedSavingsList=[],$rootScope.consolidatedFlexibilityList=[],productFeatureJSON.documentType=$scope.p365Labels.documentType.lifeProduct,productFeatureJSON.carrierId=selectedProduct.carrierId,productFeatureJSON.productId=selectedProduct.productId,productFeatureJSON.businessLineId=1;for(var selectedCarrierId=selectedProduct.carrierId,selectedProductId=selectedProduct.productId,i=0;i<$rootScope.carrierDetails.brochureList.length;i++)selectedProduct.carrierId==$rootScope.carrierDetails.brochureList[i].carrierId&&($rootScope.carrierDetails.brochureList[i].productId?selectedProduct.productId==$rootScope.carrierDetails.brochureList[i].productId&&($scope.brochureUrl=wp_path+$rootScope.carrierDetails.brochureList[i].brochureUrl):$scope.brochureUrl=wp_path+$rootScope.carrierDetails.brochureList[i].brochureUrl);variableReplaceArray.push({id:"{{sumInsured}}",value:Math.round(selectedProduct.sumInsured)}),variableReplaceArray.push({id:"{{monthlyPayout}}",value:selectedProduct.monthlyPayout}),variableReplaceArray.push({id:"{{policyTerm}}",value:selectedProduct.policyTerm}),productFetchStatus&&RestAPI.invoke($scope.p365Labels.transactionName.getProductFeatures,productFeatureJSON).then(function(callback){var scopeVariableName="productFeaturesList_"+selectedCarrierId+"_"+selectedProductId,productFeatureJSONName="productFeaturesJSON_"+selectedCarrierId+"_"+selectedProductId;$rootScope[productFeatureJSONName]={},$scope[scopeVariableName]=callback.data[0].Features;for(var i=0;i<variableReplaceArray.length;i++)p365Includes($scope[scopeVariableName][1].details,variableReplaceArray[i].id)&&($scope[scopeVariableName][1].details=$scope[scopeVariableName][1].details.replace(variableReplaceArray[i].id,variableReplaceArray[i].value));for(i=0;i<$scope[scopeVariableName].length;i++)$rootScope[productFeatureJSONName][callback.data[0].Features[i].titleForCompareView]=callback.data[0].Features[i].detailsForCompareView;selectedProduct.features=$rootScope[productFeatureJSONName];for(i=0;i<$scope[scopeVariableName].length;i++)"Benefits"==$scope[scopeVariableName][i].featureCategory&&"Y"==$scope[scopeVariableName][i].compareView&&-1===$rootScope.consolidatedBenefitsList.indexOf($scope[scopeVariableName][i].titleForCompareView)&&$rootScope.consolidatedBenefitsList.push($scope[scopeVariableName][i].titleForCompareView),"Savings"==$scope[scopeVariableName][i].featureCategory&&"Y"==$scope[scopeVariableName][i].compareView&&-1===$rootScope.consolidatedSavingsList.indexOf($scope[scopeVariableName][i].titleForCompareView)&&$rootScope.consolidatedSavingsList.push($scope[scopeVariableName][i].titleForCompareView),"Flexibility"==$scope[scopeVariableName][i].featureCategory&&"Y"==$scope[scopeVariableName][i].compareView&&-1===$rootScope.consolidatedFlexibilityList.indexOf($scope[scopeVariableName][i].titleForCompareView)&&$rootScope.consolidatedFlexibilityList.push($scope[scopeVariableName][i].titleForCompareView)})}$scope.declaration=function(){$rootScope.loading=!1,$scope.selectedAddOnCovers=[],$scope.sortByElement=[],$scope.selectedCarrier=[],$scope.riderFeatureLength=0,$scope.expose=!1,$scope.tempStatus=!0;if($scope.quoteParam=localStorageService.get("lifeQuoteInputParamaters").quoteParam,$scope.personalDetails=localStorageService.get("lifePersonalDetails"),$scope.insuranceCompanyList={},$scope.insuranceCompanyList.selectedInsuranceCompany=[],$scope.addOnCovers=localStorageService.get("addOnCoverForLife"),$scope.personalDetails.selectedAddOnCovers=void 0==$scope.personalDetails.selectedAddOnCovers?[]:$scope.personalDetails.selectedAddOnCovers,$scope.selectedAddOnCoversCopy=angular.copy($scope.personalDetails.selectedAddOnCovers),$scope.sortType=sortTypesLifeGeneric[0],$scope.sortTypes=sortTypesLifeGeneric,$scope.relationType=relationLifeQuoteGeneric,$scope.healthConditionType=healthConditionGeneric,$scope.annualIncomesRange=annualIncomesGeneric,$scope.riskLevels=riskLevelsGeneric,$scope.annualIncomesRange=annualIncomesGeneric,$scope.genderType=genderTypeGeneric,$scope.tobaccoAddictionStatus=tobaccoAddictionStatusGeneric,$scope.maturityAgeList=getAgeList($scope.personalDetails.minMaturityAge,$scope.personalDetails.maxMaturityAge),$scope.ageList=getAgeList($scope.personalDetails.minInsuredAge,$scope.personalDetails.maxInsuredAge),$scope.comparePoliciesDisplayList=comparePoliciesDisplayValues,$scope.compareLifePoliciesDisplayList=compareLifePoliciesDisplayValues,$scope.payoutOptions=lifePayoutOptionsGeneric,$scope.payoutDetails.payoutOption=$scope.payoutOptions[0],$scope.payoutName=$scope.payoutOptions[0].name,$scope.selectedSortOption=$scope.sortTypes[0],$scope.quoteParam){for(var i=0;i<$scope.payoutOptions.length;i++)if($scope.payoutOptions[i].id==$scope.quoteParam.payoutId){$scope.payoutDetails.payoutOption=$scope.payoutOptions[i];break}}else $scope.payoutId=$scope.payoutOptions[0].id;$scope.personalDetails.dateOfBirth=calcDOBFromAge($scope.quoteParam.age),$scope.personAge=$scope.quoteParam.age,$scope.quoteParamCopy=angular.copy($scope.quoteParam),$scope.personalDetailsCopy=angular.copy($scope.personalDetails),$rootScope.wordPressEnabled&&($scope.selectedPayoutOptionCopy=angular.copy($scope.payoutDetails.payoutOption))},$scope.init=function(){$scope.togglePayoutChange=function(selectedPayout){$scope.payoutId=selectedPayout.id,$scope.payoutName=selectedPayout.name,$scope.singleClickLifeQuote()},$scope.openMenu=function($mdOpenMenu,ev){$mdOpenMenu(ev),setTimeout(function(){$(".md-click-catcher").click(function(){$scope.activeMenu=""})},100)},$scope.clickForActive=function(item){$scope.activeMenu=item},$scope.clickForViewActive=function(item){$scope.activeViewMenu=item},$scope.clickForViewActive("Compare"),$scope.clicktoDisable=function(){setTimeout(function(){$(".md-click-catcher").css("pointer-events","none")},100)},$scope.EmailChoices=[{username:"",addNew:!0,paramMap:{docId:"",LOB:localStorageService.get("selectedBusinessLineId").toString(),userId:"",selectedPolicyType:""}}];if($scope.modalEmailView=!1,$scope.emailPopUpDisabled=!1,localStorageService.get("quoteUserInfo")&&($scope.EmailChoices[0].username=localStorageService.get("quoteUserInfo").emailId),$scope.addNewChoice=function(){var newItemNo=$scope.EmailChoices.length+1;newItemNo<=3&&($scope.EmailChoices.push({username:""}),$scope.EmailChoices[0].addNew=!1,$scope.EmailChoices[1].addNew=!0,$scope.emailPopUpDisabled=!1),3==newItemNo&&($scope.EmailChoices[2].addNew=!1,$scope.emailPopUpDisabled=!0)},$scope.removeChoice=function(){var lastItem=$scope.EmailChoices.length-1;$scope.EmailChoices.splice(lastItem)},$scope.showForShare=function(data){if(!$rootScope.parseCarrierList)return!0;for(var j=0;j<$rootScope.parseCarrierList.length;j++)if(data.carrierId==$rootScope.parseCarrierList[j])return!0},$scope.sendEmail=function(){for(var index=-1,i=0;i<$scope.EmailChoices.length;i++)if(""!=$scope.EmailChoices[i].username&&void 0!=$scope.EmailChoices[i].username){var encodeQuote=localStorageService.get("LIFE_UNIQUE_QUOTE_ID_ENCRYPTED"),encodeLOB=String(localStorageService.get("selectedBusinessLineId")),encodeEmailId=$scope.EmailChoices[i].username,encodeMonthlyPremiumOption=String($scope.isMonthlyPremium),encodeCarrierList=[];$scope.insuranceCompanyList.selectedInsuranceCompany.length>0?(encodeCarrierList=$scope.insuranceCompanyList.selectedInsuranceCompany,jsonEncodeCarrierList=JSON.stringify(encodeCarrierList)):encodeCarrierList.push("ALL"),$rootScope.encryptedQuote_Id=encodeQuote,$rootScope.encryptedLOB=encodeLOB,$rootScope.encryptedEmail=encodeEmailId,$rootScope.encryptedMonthlyPremium=encodeMonthlyPremiumOption,$rootScope.encryptedCarriers=jsonEncodeCarrierList,$scope.EmailChoices[i].funcType="SHARELIFEQUOTE",$scope.EmailChoices[i].isBCCRequired="Y",$scope.EmailChoices[i].paramMap={},$scope.EmailChoices[i].paramMap.docId=String($rootScope.encryptedQuote_Id),$scope.EmailChoices[i].paramMap.LOB=String($rootScope.encryptedLOB),$scope.EmailChoices[i].paramMap.userId=String($rootScope.encryptedEmail),$scope.EmailChoices[i].paramMap.carriers=String($rootScope.encryptedCarriers),$scope.EmailChoices[i].paramMap.monthlyPremiumOption=String($rootScope.encryptedMonthlyPremium),$scope.EmailChoices[i].paramMap.selectedPolicyType="LIFE";var body={};body.longURL=shareQuoteLink+$scope.EmailChoices[i].paramMap.docId+"&LOB="+$scope.EmailChoices[i].paramMap.LOB+"&userId="+$scope.EmailChoices[i].paramMap.userId+"&carriers="+$scope.EmailChoices[i].paramMap.carriers,$http({method:"POST",url:getShortURLLink,data:body}).success(function(shortURLResponse){var request={},header={},arr=$scope.EmailChoices;header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=sendEmail,header.deviceId=deviceIdOrigin,request.header=header,shortURLResponse.responseCode==$scope.p365Labels.responseCode.success?(index++,request.body=arr[index],request.body.paramMap.url=shortURLResponse.data.shortURL,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback){var emailResponse=JSON.parse(callback),receipientNum=$scope.EmailChoices.length;i==receipientNum&&(emailResponse.responseCode==$scope.p365Labels.responseCode.success?($scope.shareEmailModal=!1,$scope.modalEmailView=!0):localStorageService.set("emailDetails",void 0))})):console.log(shortURLResponse.message)})}},$scope.showShareEmailModal=function(){localStorageService.get("quoteUserInfo")&&localStorageService.get("quoteUserInfo").emailId&&($scope.crmEmailSend||$rootScope.wordPressEnabled)?(1==imauticAutomation?(imatShareQuote(localStorageService,$scope,"ShareQuote"),$scope.shareEmailModal=!1,$scope.modalEmailView=!0,$scope.crmEmailSend=!1):$scope.sendEmail(),$scope.shareEmailModal=!1,$scope.modalEmailView=!0):$scope.shareEmailModal=!0},$scope.sendQuotesByEmail=function(){var quoteUserInfo={};if($scope.EmailChoices.length>0)if(localStorageService.get("quoteUserInfo")){(quoteUserInfo=localStorageService.get("quoteUserInfo"))&&(quoteUserInfo.emailId=$scope.EmailChoices[0].username,localStorageService.set("quoteUserInfo",quoteUserInfo),$scope.crmEmailSend=!0,$scope.showShareEmailModal())}else{quoteUserInfo={};localStorageService.set("quoteUserInfo",quoteUserInfo),$scope.sendQuotesByEmail()}},$scope.deleteReceipient=function(index){$scope.EmailChoices.splice(index,1),$scope.EmailChoices.length<3&&($scope.emailPopUpDisabled=!1,1==$scope.EmailChoices.length?($scope.EmailChoices[0].addNew=!0,$scope.EmailChoices[1].addNew=!1):($scope.EmailChoices[0].addNew=!1,$scope.EmailChoices[1].addNew=!0))},$scope.hideEmailModal=function(){$scope.modalEmailView=!1,$scope.shareEmailModal=!1},$scope.leadCreationUserInfo=function(){var userInfoWithQuoteParam={};if($scope.selectedBusinessLineId=localStorageService.get("selectedBusinessLineId"),localStorageService.set("quoteUserInfo",$scope.quoteUserInfo),userInfoWithQuoteParam.quoteParam=localStorageService.get("lifeQuoteInputParamaters"),userInfoWithQuoteParam.contactInfo=$scope.quoteUserInfo,$rootScope.agencyPortalEnabled){const localdata=JSON.parse(localStorage.getItem("finalLocalStorage"));userInfoWithQuoteParam.contactInfo.createLeadStatus=!1,userInfoWithQuoteParam.requestSource=sourceOrigin,$location.search("createLead","false"),localdata&&(userInfoWithQuoteParam.userName=localdata.username,userInfoWithQuoteParam.agencyId=localdata.agencyId)}else $scope.quoteUserInfo.emailId=$rootScope.decryptedEmailId,userInfoWithQuoteParam.requestSource=sourceOrigin;null!=$scope.quoteUserInfo&&(""==$scope.quoteUserInfo.messageId||$scope.quoteUserInfoForm.$dirty?RestAPI.invoke($scope.p365Labels.transactionName.createLead,userInfoWithQuoteParam).then(function(callback){callback.responseCode==$scope.p365Labels.responseCode.success&&(messageIDVar=callback.data.messageId,$scope.quoteUserInfo.messageId=messageIDVar,localStorageService.set("quoteUserInfo",$scope.quoteUserInfo),$scope.modalView=!1)}):messageIDVar=$scope.quoteUserInfo.messageId)},$scope.redirectToResult=function(){$scope.leadCreationUserInfo()},$scope.redirectToAPResult=function(){$scope.leadCreationUserInfo()},$rootScope.flag||$rootScope.isOlarked){$scope.isMonthlyPremium=$rootScope.decryptedMonthlyPremiumOption,"true"==$scope.isMonthlyPremium?$scope.isMonthlyPremium=!0:($scope.isMonthlyPremium=!1,$scope.isAnnualPremium=!0,$scope.premiumChoice=!1),void 0!=$rootScope.selectedAddOnCovers&&($scope.personalDetails.selectedAddOnCovers=$rootScope.selectedAddOnCovers),angular.copy($scope.personalDetails.selectedAddOnCovers,$scope.selectedAddOnCoversCopy);for(var i=0;i<$scope.payoutOptions.length;i++)if($scope.payoutOptions[i].id==$scope.quoteParam.payoutId){$scope.payoutDetails.payoutOption=$scope.payoutOptions[i];break}$rootScope.flag&&($scope.redirectToResult(),$rootScope.flag=!1),localStorageService.get("quoteUserInfo")&&($scope.EmailChoices[0].username=localStorageService.get("quoteUserInfo").emailId),$rootScope.loading=!1}$scope.calculateSumAssured=function(){listSumAssuredAmt($scope.personalDetails.annualIncomeObject.annualIncome,function(sumInsuredArray,selectedSumAssured){$scope.quoteParam.sumInsured=selectedSumAssured.amount,$scope.personalDetails.sumInsuredObject=selectedSumAssured,$scope.personalDetails.sumInsuredList=sumInsuredArray})},$scope.updateRiders=function(rider){for(var selectedRidersWithRequest=$scope.personalDetails.selectedAddOnCovers,flag=-1,i=0;i<selectedRidersWithRequest.length;i++)selectedRidersWithRequest[i].riderId==rider.riderId&&(flag=i);flag>-1?selectedRidersWithRequest.splice(flag,1):selectedRidersWithRequest.push(rider),$scope.personalDetails.selectedAddOnCovers=selectedRidersWithRequest},$rootScope.editForMobile=function(){$rootScope.showonEdit="inline !important",$rootScope.hideonEdit="none !important",$scope.flagforMobile=!0},$scope.submitBtn=!1,$scope.editBtn=!0;$scope.toggleChange=function(clickEvent){$(".firstPane").addClass("opened"),$(".firstPaneContent").show(),1==$(".viewDiv").is(":visible")?($scope.editBtn=!1,$scope.submitBtn=!0,$scope.cancelBtn=!0):1==$(".modifyDiv").is(":visible")&&"submit"==clickEvent?($scope.editBtn=!0,$scope.cancelBtn=!1,$scope.submitBtn=!1,$scope.singleClickLifeQuote()):(angular.copy($scope.quoteParamCopy,$scope.quoteParam),angular.copy($scope.personalDetailsCopy,$scope.personalDetails),$scope.quoteLifeInputForm.lifeInputForm.$setPristine(),$scope.lifeInputForm=!1,$scope.editBtn=!0,$scope.cancelBtn=!1,$scope.submitBtn=!1)},$scope.getRiskLabel=function(riskType){for(var i=0;i<$scope.riskLevels.length;i++)if($scope.riskLevels[i].id==riskType)return $scope.riskLevels[i]},$scope.fetchDefaultInputParamaters=function(defaultInputParamCallback){$scope.quoteParam=defaultLifeQuoteParam.quoteParam,$scope.personalDetails=defaultLifeQuoteParam.personalDetails,listSumAssuredAmt($scope.quoteParam.annualIncome,function(sumInsuredArray,selectedSumAssured){$scope.personAge=$scope.quoteParam.age,$scope.personalDetails.dateOfBirth=calcDOBFromAge($scope.quoteParam.age),$scope.personalDetails.sumInsuredObject=selectedSumAssured,$scope.personalDetails.sumInsuredList=sumInsuredArray;for(var i=0;i<annualIncomesGeneric.length;i++)if($scope.quoteParam.annualIncome==annualIncomesGeneric[i].annualIncome){$scope.personalDetails.annualIncomeObject=annualIncomesGeneric[i];break}defaultInputParamCallback()})},$scope.calculateMaturityAgeGap=function(){$scope.quoteParam.age>=35?$scope.personalDetails.maturityAge=lifematurityAgeConstant:$scope.personalDetails.maturityAge=$scope.quoteParam.age+30},$scope.updateMaturityAgeList=function(){$scope.calculateMaturityAgeGap();var minMaturityAge=$scope.quoteParam.age+5;$scope.personalDetails.maturityAge<minMaturityAge&&($scope.personalDetails.maturityAge=minMaturityAge),$scope.maturityAgeList=getAgeList(minMaturityAge,$scope.personalDetails.maxMaturityAge)},$scope.errorRespCounter=!0,$scope.errorMessage=function(errorMsg){!$scope.errorRespCounter||"undefined"!=String($rootScope.lifeQuoteResult)&&0!=$rootScope.lifeQuoteResult.length?$rootScope.lifeQuoteResult.length>0&&($rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!1,$rootScope.tabSelectionStatus=!0,$rootScope.loading=!1):($scope.errorRespCounter=!1,$scope.errorRespMsg=errorMsg,$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!0,$rootScope.tabSelectionStatus=!0,$rootScope.loading=!1)},$scope.customFilterLife=function(){$scope.netPremiumTotalLife=0,$scope.netPremiumAverageLife=0,$scope.netPremiumMaxLife=0,$scope.proffesionalRatingLife=0;for(var i=0;i<$rootScope.lifeQuoteResult.length;i++)$scope.netPremiumTotalLife+=$rootScope.lifeQuoteResult[i].premiumRatio,$scope.netPremiumAverageLife=Number(($scope.netPremiumTotalLife/$rootScope.lifeQuoteResult.length).toFixed(5));for(i=0;i<$rootScope.lifeQuoteResult.length;i++)$rootScope.lifeQuoteResult[i].netPremiumMax=Number(($scope.netPremiumAverageLife/$rootScope.lifeQuoteResult[i].premiumRatio).toFixed(5)),$rootScope.lifeQuoteResult[i].netPremiumMax>$scope.netPremiumMaxLife&&($scope.netPremiumMaxLife=$rootScope.lifeQuoteResult[i].netPremiumMax);for(i=0;i<$rootScope.lifeQuoteResult.length;i++)$rootScope.lifeQuoteResult[i].netPremiumMean=Number(($rootScope.lifeQuoteResult[i].netPremiumMax/$scope.netPremiumMaxLife*5).toFixed(1)),$rootScope.lifeQuoteResult[i].proffesionalRating=.4*$rootScope.lifeQuoteResult[i].netPremiumMean+.2*$rootScope.lifeQuoteResult[i].claimIndex+.2*$rootScope.lifeQuoteResult[i].benefitIndex+.2*$rootScope.lifeQuoteResult[i].insurerIndex;return $rootScope.lifeQuoteResult=$filter("orderBy")($rootScope.lifeQuoteResult,"proffesionalRating"),$rootScope.lifeQuoteResult=$rootScope.lifeQuoteResult,$scope.sortReverse=!0,!0},$scope.customFilterLifeSelectedProduct=function(){$scope.netPremiumTotalLife=0,$scope.netPremiumAverageLife=0,$scope.netPremiumMaxLife=0,$scope.proffesionalRatingLife=0;for(var i=0;i<$rootScope.lifeQuoteResult.length;i++)$scope.netPremiumTotalLife+=$rootScope.lifeQuoteResult[i].premiumRatio,$scope.netPremiumAverageLife=Number(($scope.netPremiumTotalLife/$rootScope.lifeQuoteResult.length).toFixed(5));for(i=0;i<$rootScope.lifeQuoteResult.length;i++)$rootScope.lifeQuoteResult[i].netPremiumMax=Number(($scope.netPremiumAverageLife/$rootScope.lifeQuoteResult[i].premiumRatio).toFixed(5)),$rootScope.lifeQuoteResult[i].netPremiumMax>$scope.netPremiumMaxLife&&($scope.netPremiumMaxLife=$rootScope.lifeQuoteResult[i].netPremiumMax);for(i=0;i<$rootScope.lifeQuoteResult.length;i++)$rootScope.lifeQuoteResult[i].netPremiumMean=Number(($rootScope.lifeQuoteResult[i].netPremiumMax/$scope.netPremiumMaxLife*5).toFixed(1)),$rootScope.lifeQuoteResult[i].proffesionalRating=.4*$rootScope.lifeQuoteResult[i].netPremiumMean+.2*$rootScope.lifeQuoteResult[i].claimIndex+.2*$rootScope.lifeQuoteResult[i].benefitIndex+.2*$rootScope.lifeQuoteResult[i].insurerIndex;var carrierAllReadyAdded=!1;for(i=0;i<$rootScope.lifeQuoteResult.length;i++)if(localStorageService.get("lifeProductToBeAddedInCart").carrierId==$rootScope.lifeQuoteResult[i].carrierId&&localStorageService.get("lifeProductToBeAddedInCart").productId==$rootScope.lifeQuoteResult[i].productId){console.log('localStorageService.get("lifeProductToBeAddedInCart in step 3:',$rootScope.lifeQuoteResult[i]),$scope.selectProduct($rootScope.lifeQuoteResult[i],!1),$rootScope.lifeQuoteResult[0]=$rootScope.lifeQuoteResult[i];carrierAllReadyAdded=!0;$scope.isGotLifeQuotes=!0;break}carrierAllReadyAdded||(console.log("inside life custom filter"),$scope.customFilterLife(),$scope.isGotLifeQuotes=!0)},$scope.processResult=function(){$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!1,$rootScope.tabSelectionStatus=!0,$rootScope.loading=!1},$scope.displaySelecteRidersModal=!1,$scope.showSelectedRiders=function(){$scope.displaySelecteRidersModal=!0},$scope.hideSelectedRiders=function(){$scope.displaySelecteRidersModal=!1},$scope.isMinPremium=function(annualPremiumValue,carrierIDValue){for(var min=$rootScope.lifeQuoteResult[0].annualPremium,i=0;i<=$rootScope.lifeQuoteResult.length-1;i++){var carrierIdMin=$rootScope.lifeQuoteResult[i].carrierId;Number($rootScope.lifeQuoteResult[i].annualPremium)<min&&(min=$rootScope.lifeQuoteResult[i].annualPremium,carrierIDValue=carrierIdMin)}return min===annualPremiumValue&&($scope.selMinCarrierId=carrierIDValue,!0)},$scope.resetPayoutDetails=function(){if($scope.selectedPayoutOptionCopy){$scope.payoutDetails.payoutOption=$scope.selectedPayoutOptionCopy;for(var i=0;i<$scope.payoutOptions.length;i++)if($scope.payoutDetails.payoutOption.id==$scope.payoutOptions[i].id){$scope.payoutDetails.payoutOption=$scope.payoutOptions[i];break}}else $scope.payoutDetails.payoutOption=[];$scope.payoutOptionModal=!1},$scope.resetRiderDetails=function(){$scope.selectedAddOnCoversCopy?angular.copy($scope.selectedAddOnCoversCopy,$scope.personalDetails.selectedAddOnCovers):$scope.personalDetails.selectedAddOnCovers=[],$scope.riderDetailsModal=!1},$scope.validatePremium=function(data){return $scope.isMonthlyPremium?Number(data.monthlyFinalPremium)>0:$scope.isAnnualPremium?Number(data.annualPremium)>0:void 0},$scope.singleClickLifeQuote=function(){$scope.quoteLifeInputForm.$dirty||$scope.quoteLifeInputForm.lifeInputForm.$dirty?setTimeout(function(){$scope.flagforMobile&&($rootScope.showonEdit="none !important",$rootScope.hideonEdit="inline !important",$scope.flagforMobile=!1),$scope.quoteLifeInputForm.$setPristine(),$scope.quoteParam.riders=[],selectedRiderListForLife($scope.addOnCovers,$scope.personalDetails.selectedAddOnCovers,$scope.quoteParam.riders,function(){$scope.errorRespCounter=!0,$rootScope.loading=!0,$scope.dataLoaded=!1,$scope.payoutOptionModal=!1,$scope.riderDetailsModal=!1,$scope.isGotLifeQuotes=!1,$scope.quoteParam.documentType=$scope.p365Labels.documentType.quoteRequest,$scope.quoteParam.quoteType=localStorageService.get("selectedBusinessLineId"),$scope.quoteParam.payoutId=$scope.payoutDetails.payoutOption.id,$scope.quoteParam.sumInsured=$scope.personalDetails.sumInsuredObject.amount,$scope.quoteParam.annualIncome=$scope.personalDetails.annualIncomeObject.annualIncome,$scope.quoteParam.annualIncomeInterval=$scope.personalDetails.annualIncomeObject.annualIncomeInterval,$scope.quoteParam.healthCondition="Good",$scope.isAnnualPremium?$scope.quoteParam.frequency="Annual":$scope.quoteParam.frequency="Monthly",$scope.personalDetails.selectedAddOnCovers.length>0&&($scope.selectedAddOnCoversCopy=angular.copy($scope.personalDetails.selectedAddOnCovers)),$scope.selectedPayoutOptionCopy=angular.copy($scope.payoutDetails.payoutOption);var policyTerm=$scope.personalDetails.maturityAge-$scope.quoteParam.age;policyTerm<$scope.personalDetails.minPolicyTermLimit?$scope.quoteParam.policyTerm=$scope.personalDetails.minPolicyTermLimit:$scope.quoteParam.policyTerm=policyTerm,$scope.personalDetails.dateOfBirth=calcDOBFromAge($scope.quoteParam.age),0==$scope.quoteParam.riders.length&&($scope.quoteParam.riders=makeObjectEmpty($scope.quoteParam.riders,"array")),$scope.personalDetails.selectedAddOnCovers.length<=2?$scope.riderFeatureLength=0:3==$scope.personalDetails.selectedAddOnCovers.length?$scope.riderFeatureLength=1:$scope.riderFeatureLength=2,$scope.quote.quoteParam=$scope.quoteParam,$scope.quote.personalDetails=$scope.personalDetails,$scope.quote.requestType=$scope.p365Labels.request.requestType,localStorageService.set("lifeQuoteInputParamaters",$scope.quote),localStorageService.set("lifePersonalDetails",$scope.personalDetails),$scope.quoteParamCopy=angular.copy($scope.quoteParam),$scope.personalDetailsCopy=angular.copy($scope.personalDetails),localStorageService.get("PROF_QUOTE_ID")&&($scope.quote.PROF_QUOTE_ID=localStorageService.get("PROF_QUOTE_ID")),campaignSource.utm_source&&($scope.quote.utm_source=campaignSource.utm_source),campaignSource.utm_medium&&($scope.quote.utm_medium=campaignSource.utm_medium),$scope.requestId=null,$rootScope.lifeQuoteResult=[],RestAPI.invoke($scope.p365Labels.getRequest.quoteLife,$scope.quote).then(function(callback){$rootScope.lifeQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success?($rootScope.loading=!1,$scope.dataLoaded=!0,$scope.responseCodeList=[],$scope.requestId=callback.QUOTE_ID,localStorageService.set("LIFE_UNIQUE_QUOTE_ID",$scope.requestId),$rootScope.lifeQuoteRequest=callback.data,$scope.UNIQUE_QUOTE_ID_ENCRYPTED=callback.encryptedQuoteId,localStorageService.set("LIFE_UNIQUE_QUOTE_ID_ENCRYPTED",$scope.UNIQUE_QUOTE_ID_ENCRYPTED),$scope.quoteUserInfo=localStorageService.get("quoteUserInfo"),$scope.professionalParam=localStorageService.get("professionalQuoteParams"),console.log("newly added varibale",$scope.professionalParam),1==imauticAutomation&&imatLifeLeadQuoteInfo(localStorageService,$scope,"ViewQuote"),"undefined"!=String($rootScope.lifeQuoteResult)&&$rootScope.lifeQuoteResult.length>0&&($rootScope.lifeQuoteResult.length=0),angular.forEach($rootScope.lifeQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.deviceId=deviceIdOrigin,header.transactionName=$scope.p365Labels.transactionName.lifeQuoteResult,request.header=header,campaignSource.utm_source&&(obj.utm_source=campaignSource.utm_source),campaignSource.utm_medium&&(obj.utm_medium=campaignSource.utm_medium),request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var lifeQuoteResponse=JSON.parse(callback);if(lifeQuoteResponse.QUOTE_ID==$scope.requestId)if($scope.responseCodeList.push(lifeQuoteResponse.responseCode),lifeQuoteResponse.responseCode==$scope.p365Labels.responseCode.success){lifeQuoteResponse.data.quotes[0].dailyPremium=Math.round(lifeQuoteResponse.data.quotes[0].annualPremium/365),lifeQuoteResponse.data.quotes[0].insuranceCompany=JSON.parse(lifeQuoteResponse.data.quotes[0].insuranceCompany),$rootScope.carrierDetails=angular.copy(carrierRiderList);for(var j=0;j<$rootScope.carrierDetails.riderList.length;j++)$rootScope.carrierDetails.riderList[j].carrierId==lifeQuoteResponse.data.quotes[0].carrierId&&$rootScope.carrierDetails.riderList[j].productId==lifeQuoteResponse.data.quotes[0].productId&&(lifeQuoteResponse.data.quotes[0].riders=$rootScope.carrierDetails.riderList[j].riders);for(var k=0;k<lifeQuoteResponse.data.quotes[0].riderList.length;k++)for(var l=0;l<lifeQuoteResponse.data.quotes[0].riders.length;l++)if(lifeQuoteResponse.data.quotes[0].riderList[k].riderId==lifeQuoteResponse.data.quotes[0].riders[l].riderId){lifeQuoteResponse.data.quotes[0].riders[l]=lifeQuoteResponse.data.quotes[0].riderList[k];break}for(var m=0;m<lifeQuoteResponse.data.quotes[0].riders.length;m++)"At Additional Cost"==lifeQuoteResponse.data.quotes[0].riders[m].riderType?(lifeQuoteResponse.data.quotes[0].riders[m].riderImgPath="additionalCost",lifeQuoteResponse.data.quotes[0].riders[m].riderTooltipName="Additional Cost"):"Not Available"==lifeQuoteResponse.data.quotes[0].riders[m].riderType?(lifeQuoteResponse.data.quotes[0].riders[m].riderImgPath="notAvailable",lifeQuoteResponse.data.quotes[0].riders[m].riderTooltipName="Not Available"):"Included"==lifeQuoteResponse.data.quotes[0].riders[m].riderType&&(lifeQuoteResponse.data.quotes[0].riders[m].riderImgPath="included",lifeQuoteResponse.data.quotes[0].riders[m].riderTooltipName="Included");for(var i=0;i<$rootScope.lifeQuoteRequest.length;i++)$rootScope.lifeQuoteRequest[i].messageId==lifeQuoteResponse.messageId&&($rootScope.lifeQuoteResult.push(lifeQuoteResponse.data.quotes[0]),getAllProductFeatures(lifeQuoteResponse.data.quotes[0],!0),$rootScope.lifeQuoteRequest[i].status=1);$scope.processResult()}else for(i=0;i<$rootScope.lifeQuoteRequest.length;i++)$rootScope.lifeQuoteRequest[i].messageId==lifeQuoteResponse.messageId&&($rootScope.lifeQuoteRequest[i].status=2,$rootScope.lifeQuoteRequest[i].message=$sce.trustAsHtml($scope.p365Labels.validationMessages.generalisedLifeErrMsg))}).error(function(data,status){$scope.responseCodeList.push($scope.p365Labels.responseCode.systemError)})}),$scope.$watch("responseCodeList",function(newValue,oldValue,scope){if(p365Includes($scope.responseCodeList,$scope.p365Labels.responseCode.success)&&$scope.responseCodeList.length==$scope.lifeQuoteRequest.length){for(var i=0;i<$rootScope.lifeQuoteRequest.length;i++)0==$rootScope.lifeQuoteRequest[i].status&&($rootScope.lifeQuoteRequest[i].status=2,$rootScope.lifeQuoteRequest[i].message=$sce.trustAsHtml($scope.p365Labels.validationMessages.generalisedLifeErrMsg));p365Includes($scope.responseCodeList,$scope.p365Labels.responseCode.success)||(p365Includes($scope.responseCodeList,$scope.p365Labels.responseCode.quoteNotAvailable)?$scope.errorMessage($scope.p365Labels.validationMessages.productNotFoundMsg):$scope.errorMessage($scope.p365Labels.validationMessages.generalisedErrMsg))}},!0)):($scope.responseCodeList=[],"undefined"!=String($rootScope.lifeQuoteResult)&&$rootScope.lifeQuoteResult.length>0&&($rootScope.lifeQuoteResult.length=0),$rootScope.lifeQuoteResult=[],$scope.errorMessage($sce.trustAsHtml($scope.p365Labels.validationMessages.generalisedLifeErrMsg)))})})},100):($scope.payoutOptionModal=!1,$scope.riderDetailsModal=!1)},$scope.state=!1,$scope.toggleState=function(){$scope.state=!$scope.state}},$scope.declaration(),$scope.$watch(function(){return $rootScope.lifeQuoteResult},function(){$rootScope.lifeQuoteResult=$rootScope.lifeQuoteResult,$rootScope.lifeQuoteResult&&$rootScope.lifeQuoteResult.length>0&&$scope.init()},!0),$scope.confirmInput=function(){$scope.inputSectionEnabled=!1,$scope.resultSectionEnabled=!1,$scope.ridersSectionEnabled=!0},$scope.showEditInputSection=function(){$scope.inputSectionEnabled=!0,$scope.resultSectionEnabled=!1,$scope.ridersSectionEnabled=!1},$scope.backToRiderSection=function(){$scope.inputSectionEnabled=!1,$scope.resultSectionEnabled=!1,$scope.ridersSectionEnabled=!0},$scope.getProfessionalBestQuotes=function(){localStorageService.get("lifeProductToBeAddedInCart")&&($scope.productInCart=localStorageService.get("lifeProductToBeAddedInCart")),console.log("$scope.productInCart for life is:",$scope.productInCart),$scope.resultSectionEnabled=!0,$scope.inputSectionEnabled=!1,$scope.ridersSectionEnabled=!1,$scope.quoteLifeInputForm.$dirty=!0,$scope.singleClickLifeQuote()},$scope.backToQuotes=function(){$location.path("/professionalJourneyResult")},$scope.getProductFeatures=function(selectedProduct,productFetchStatus){var variableReplaceArray=[],productFeatureJSON={};productFeatureJSON.documentType=$scope.p365Labels.documentType.lifeProduct,productFeatureJSON.carrierId=selectedProduct.carrierId,productFeatureJSON.productId=selectedProduct.productId,productFeatureJSON.businessLineId=1;for(var i=0;i<$rootScope.carrierDetails.brochureList.length;i++)selectedProduct.carrierId==$rootScope.carrierDetails.brochureList[i].carrierId&&($scope.brochureUrl=wp_path+$rootScope.carrierDetails.brochureList[i].brochureUrl);variableReplaceArray.push({id:"{{sumInsured}}",value:Math.round(selectedProduct.sumInsured)}),variableReplaceArray.push({id:"{{monthlyPayout}}",value:selectedProduct.monthlyPayout}),variableReplaceArray.push({id:"{{policyTerm}}",value:$scope.quoteParam.policyTerm}),productFetchStatus&&RestAPI.invoke($scope.p365Labels.transactionName.getProductFeatures,productFeatureJSON).then(function(callback){$scope.productFeaturesList=callback.data[0].Features;for(var j=0;j<$scope.productFeaturesList.length;j++)for(var i=0;i<variableReplaceArray.length;i++)p365Includes($scope.productFeaturesList[j].details,variableReplaceArray[i].id)&&($scope.productFeaturesList[j].details=$scope.productFeaturesList[j].details.replace(variableReplaceArray[i].id,variableReplaceArray[i].value))}),$scope.modelBeneFeatureLife=!0},$scope.modelBeneFeatureLife=!1,$scope.closeBeneFeatureLife=function(){$scope.modelBeneFeatureLife=!1},$scope.buyProductProxy=function(selectedProduct){var postMethodDynamicFormArray=[],tempParentJson={},selectedRidersJson={};$scope.postMethodFormContent=[],selectedProduct.riderList.forEach(function(riderObj){selectedRidersJson[riderObj.riderName]=riderObj}),postMethodDynamicFormArray.length=0;var buyProductDetails={frequency:{}};buyProductDetails.quoteParam=$scope.quoteParam,buyProductDetails.personalDetails=$scope.personalDetails,buyProductDetails.quoteResponse=angular.copy(selectedProduct),$scope.isMonthlyPremium&&(buyProductDetails.quoteResponse.annualPremium=selectedProduct.monthlyFinalPremium,buyProductDetails.quoteResponse.frequency="3"),$scope.isAnnualPremium&&(buyProductDetails.quoteResponse.annualPremium=selectedProduct.annualPremium,buyProductDetails.quoteResponse.frequency="0"),buyProductDetails.areaDetails=localStorageService.get("cityDataFromIP"),buyProductDetails.contactInfo=localStorageService.get("quoteUserInfo"),buyProductDetails.frequency.type=String($scope.isMonthlyPremium),buyProductDetails.contactInfo.lastName||(buyProductDetails.contactInfo.lastName=""),buyProductDetails.contactInfo.fullName=buyProductDetails.contactInfo.firstName+" "+buyProductDetails.contactInfo.lastName;var buyQuoteURL=$scope.lifeProductBuyConfigDetails.quoteurl,buyQuoteMethod=$scope.lifeProductBuyConfigDetails.method,buyQuoteURLParamList=$scope.lifeProductBuyConfigDetails.paramList,buyQuoteURLParams="?",buyProductPlan=$scope.lifeProductBuyConfigDetails.planName;if("GET"==buyQuoteMethod){for(var i=0;i<buyQuoteURLParamList.length;i++)if(i<buyQuoteURLParamList.length-1){if(buyQuoteURLParamList[i].defaultStatus)buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+buyQuoteURLParamList[i].value+"&";else if(null!=buyProductDetails[buyQuoteURLParamList[i].parentNode])if("date"==buyQuoteURLParamList[i].definedValueStatus){var pdate=buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname],dateformat=buyQuoteURLParamList[i].definedValue.format;buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+dateFormater(pdate,dateformat)+"&"}else"integer"==buyQuoteURLParamList[i].definedValueStatus?buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]+"&":buyQuoteURLParamList[i].definedValueStatus?buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+buyQuoteURLParamList[i].definedValue[buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]]+"&":buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]+"&"}else if(buyQuoteURLParamList[i].defaultStatus)buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+buyQuoteURLParamList[i].value;else if(null!=buyProductDetails[buyQuoteURLParamList[i].parentNode])if("date"==buyQuoteURLParamList[i].definedValueStatus){pdate=buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname],dateformat=buyQuoteURLParamList[i].definedValue.format;buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+dateFormater(pdate,dateformat)+"&"}else buyQuoteURLParamList[i].definedValueStatus?buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+buyQuoteURLParamList[i].definedValue[buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]]+"&":buyQuoteURLParams+=buyQuoteURLParamList[i].cname+"="+buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname];$window.open(buyQuoteURL+buyQuoteURLParams,"_blank")}else if("POST"==buyQuoteMethod){for(i=0;i<buyQuoteURLParamList.length;i++)if(buyQuoteURLParamList[i].isChild){if(buyQuoteURLParamList[i].isChild&&(tempParentJson.hasOwnProperty(buyQuoteURLParamList[i].parentElement)||(tempParentJson[buyQuoteURLParamList[i].parentElement]=""),buyQuoteURLParamList[i].defaultStatus&&("string"===buyQuoteURLParamList[i].definedValueStatus&&(tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : "'+buyQuoteURLParamList[i].value+'", '),"integer"===buyQuoteURLParamList[i].definedValueStatus&&(tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : '+buyQuoteURLParamList[i].value+", ")),!buyQuoteURLParamList[i].defaultStatus)){if("string"===buyQuoteURLParamList[i].definedValueStatus&&(null!=buyQuoteURLParamList[i].definedValue?buyQuoteURLParamList[i].isPayout?tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : "'+buyQuoteURLParamList[i].definedValue[String($scope.payoutOptions[selectedProduct.payoutId].id)]+'", ':tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : "'+buyQuoteURLParamList[i].definedValue[buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]]+'", ':selectedRidersJson.hasOwnProperty(buyQuoteURLParamList[i].pname)&&buyQuoteURLParamList[i].isRider?tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : "'+selectedRidersJson[buyQuoteURLParamList[i].pname].riderSumAssured+'", ':!selectedRidersJson.hasOwnProperty(buyQuoteURLParamList[i].pname)&&buyQuoteURLParamList[i].isRider?tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : "0", ':selectedRidersJson.hasOwnProperty(buyQuoteURLParamList[i].pname)&&buyQuoteURLParamList[i].isRiderStatus?tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : "true", ':!selectedRidersJson.hasOwnProperty(buyQuoteURLParamList[i].pname)&&buyQuoteURLParamList[i].isRiderStatus?tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : "false", ':tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : "'+buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]+'", '),"date"===buyQuoteURLParamList[i].definedValueStatus){pdate=buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname],dateformat=buyQuoteURLParamList[i].definedValue.format;var newFormattedDate=dateFormater(pdate,dateformat);tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : "'+newFormattedDate+'", '}"integer"===buyQuoteURLParamList[i].definedValueStatus&&(selectedRidersJson.hasOwnProperty(buyQuoteURLParamList[i].pname)&&buyQuoteURLParamList[i].isRider?tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : '+selectedRidersJson[buyQuoteURLParamList[i].pname].riderSumAssured+", ":!selectedRidersJson.hasOwnProperty(buyQuoteURLParamList[i].pname)&&buyQuoteURLParamList[i].isRider?tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : 0, ':tempParentJson[buyQuoteURLParamList[i].parentElement]+='"'+buyQuoteURLParamList[i].cname+'" : '+buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]+", ")}}else if(buyQuoteURLParamList[i].defaultStatus)postMethodDynamicFormArray.push({name:buyQuoteURLParamList[i].cname,value:buyQuoteURLParamList[i].value});else if(null!=buyProductDetails[buyQuoteURLParamList[i].parentNode])if("date"==buyQuoteURLParamList[i].definedValueStatus){var pdate=buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname],dateformat=buyQuoteURLParamList[i].definedValue.format;postMethodDynamicFormArray.push({name:buyQuoteURLParamList[i].cname,value:dateFormater(pdate,dateformat)})}else buyQuoteURLParamList[i].definedValueStatus?postMethodDynamicFormArray.push({name:buyQuoteURLParamList[i].cname,value:buyQuoteURLParamList[i].definedValue[buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]]}):postMethodDynamicFormArray.push({name:buyQuoteURLParamList[i].cname,value:buyProductDetails[buyQuoteURLParamList[i].parentNode][buyQuoteURLParamList[i].pname]});$scope.paymentForm.setAction(buyQuoteURL);var parentKeysArray=Object.keys(tempParentJson),parentKeysLength=parentKeysArray.length-1;buyProductPlan?0==parentKeysArray.length?($scope.postMethodFormContent.length=0,$scope.postMethodFormContent=postMethodDynamicFormArray,$scope.$apply(),$scope.paymentForm.commit()):parentKeysArray.forEach(function(keyObj,keyIndex){postMethodDynamicFormArray.push({name:keyObj,value:'[{ "MyLifePlusModel" : {'+tempParentJson[keyObj]+"} }]"}),keyIndex==parentKeysLength&&($scope.postMethodFormContent.length=0,$scope.postMethodFormContent=postMethodDynamicFormArray,$scope.$apply(),$scope.paymentForm.commit())}):parentKeysArray.forEach(function(keyObj,keyIndex){postMethodDynamicFormArray.push({name:keyObj,value:'[{ "TotalSecurePlusModel" : {'+String(tempParentJson[keyObj])+"} }]"}),keyIndex==parentKeysLength&&($scope.postMethodFormContent.length=0,$scope.postMethodFormContent=postMethodDynamicFormArray,$scope.$apply(),$scope.paymentForm.commit())})}},$scope.buyScreenTemplate=function(selectedProduct){$scope.isMonthlyPremium&&(selectedProduct.premiumTypeMonthOrAnnual="Monthly Premium",selectedProduct.monthlyFinalPremium=selectedProduct.monthlyFinalPremium),$scope.isAnnualPremium&&(selectedProduct.premiumTypeMonthOrAnnual="Annual Premium",selectedProduct.annualPremium=selectedProduct.annualPremium),localStorageService.set("lifeSelectedProduct",selectedProduct),$scope.selectedProduct=selectedProduct,$scope.modalCompare&&($scope.modalCompare=!1);var buyScreenParam={};buyScreenParam.documentType=proposalScreenConfig,buyScreenParam.businessLineId=localStorageService.get("selectedBusinessLineId"),buyScreenParam.carrierId=selectedProduct.carrierId,buyScreenParam.productId=selectedProduct.productId,buyScreenParam.QUOTE_ID=localStorageService.get("LIFE_UNIQUE_QUOTE_ID"),$rootScope.voluntaryDeductable=0,$rootScope.antiTheftDeviceAmount=0;for(var i=0;i<selectedProduct.discountList.length;i++)"Voluntary Deductible Discount"==selectedProduct.discountList[i].type&&selectedProduct.discountList[i].discountAmount>0&&($rootScope.voluntaryDeductable=selectedProduct.discountList[i].discountAmount),"Anti-Theft Discount"==selectedProduct.discountList[i].type&&selectedProduct.discountList[i].discountAmount>0&&($rootScope.antiTheftDeviceAmount=selectedProduct.discountList[i].discountAmount);getDocUsingParam(RestAPI,productDataReader,buyScreenParam,function(buyScreen){buyScreen.responseCode==$scope.p365Labels.responseCode.success?(localStorageService.set("buyScreen",buyScreen.data),$scope.productValidation=buyScreen.data.validation,$scope.resultCnfrmBuyFlag||("renew"==$scope.quoteParam.policyType&&$scope.setRangePrevPolicyStartDate(),$scope.modalResultCnfrmBuy=!0),$rootScope.loading=!0,$location.path("/buyAssurance"),getListFromDB(RestAPI,"",lifeCarrier,findAppConfig,function(lifeCarrierList){if(lifeCarrierList.responseCode==$scope.p365Labels.responseCode.success){localStorageService.set("lifeCarrierList",lifeCarrierList.data);$scope.p365Labels.documentType.buyScreen,localStorageService.get("selectedBusinessLineId")}else $location.path("/quote"),$rootScope.P365Alert("Policies365",$scope.p365Labels.validationMessages.generalisedErrMsg,"Ok")})):$rootScope.P365Alert("Policies365",$scope.p365Labels.validationMessages.generalisedErrMsg,"Ok")})},$scope.buyProduct=function(selectedProduct){if(localStorageService.get("renewPolicyDetails")){var renewPolicyDetails=localStorageService.get("renewPolicyDetails");localStorageService.get("LIFE_UNIQUE_QUOTE_ID")==renewPolicyDetails.QUOTE_ID&&$location.path("/proposalresdata").search({proposalId:renewPolicyDetails.encryptedQuoteId,LOB:1})}if($scope.quoteUserInfo=localStorageService.get("quoteUserInfo"),9==selectedProduct.carrierId)$scope.buyScreenTemplate(selectedProduct);else{var redirectionURLDocId=$scope.p365Labels.documentType.lifeProductBuyConfig+"-"+selectedProduct.carrierId+"-"+selectedProduct.productId;getDocUsingId(RestAPI,redirectionURLDocId,function(lifeProductBuyConfigDetails){setTimeout(function(){lifeProductBuyConfigDetails?($scope.lifeProductBuyConfigDetails=lifeProductBuyConfigDetails,$scope.$$phase||$scope.buyProductProxy(selectedProduct)):$rootScope.P365Alert("Policies365",$scope.p365Labels.validationMessages.generalisedErrMsg,"Ok")},100)})}1==imauticAutomation&&imatBuyClicked(localStorageService,$scope,"BuyClicked")},$scope.selectProduct=function(selectedProduct,_redirectTOResult){if(_redirectTOResult=0!=_redirectTOResult||_redirectTOResult){var QUOTE_ID=localStorageService.get("LIFE_UNIQUE_QUOTE_ID");console.log("QUOTE_ID",QUOTE_ID),console.log('localStorageService.get("LIFE_UNIQUE_QUOTE_ID")',selectedProduct),updateSelectedProduct(RestAPI,QUOTE_ID,selectedProduct,function(updatedProductCallback){if(console.log("_updatedProduct : ",updatedProductCallback),updatedProductCallback.data){var updatedProduct=updatedProductCallback.data;updatedProduct.selectedCarrier&&updatedProduct.selectedProduct&&($rootScope.selectedCarrierIdForLife=updatedProduct.selectedCarrier,$rootScope.selectedProductIdForLife=updatedProduct.selectedProduct),$location.path("/professionalJourneyResult")}})}},$rootScope.signout=function(){$rootScope.userLoginStatus=!1;var userLoginInfo={username:""};userLoginInfo.status=$rootScope.userLoginStatus,localStorageService.set("userLoginInfo",userLoginInfo),$location.path("/quote")},$scope.missionCompled=function(){$rootScope.loading=!1},$scope.data={},$scope.data.group1=1,$scope.modalCompare=!1,$scope.consolatedRiderList=[],$scope.consolatedDiscountList=[],$scope.toggleCompare=function(){var riderJson={};angular.forEach($scope.selectedCarrier,function(quote){angular.forEach(quote.riders,function(rider){null==riderJson[rider.riderId]&&($scope.consolatedRiderList.push(rider),riderJson[rider.riderId]=rider.riderName)})});var discountJson={};angular.forEach($scope.selectedCarrier,function(quote){angular.forEach(quote.discountList,function(discount){null==discountJson[discount.type]&&null!=discount.discountAmount&&0!=discount.discountAmount&&($scope.consolatedDiscountList.push(discount),discountJson[discount.type]=discount.type)})}),$scope.modalCompare=!0,$scope.hideModal=function(){$scope.modalCompare=!1}},$scope.cardView=!0,$scope.compareView=!1,$scope.showCompareBtn=!0,$scope.showCardBtn=!0,$scope.disableSort=!1,$scope.compareViewClick=function(){var riderJson={};$scope.consolatedRiderList=[],$scope.consolatedDiscountList=[],angular.forEach($rootScope.lifeQuoteResult,function(quote){angular.forEach(quote.riders,function(rider){null==riderJson[rider.riderId]&&($scope.consolatedRiderList.push(rider),riderJson[rider.riderId]=rider.riderName)})});var discountJson={};angular.forEach($rootScope.lifeQuoteResult,function(quote){angular.forEach(quote.discountList,function(discount){null==discountJson[discount.type]&&null!=discount.discountAmount&&($scope.consolatedDiscountList.push(discount),discountJson[discount.type]=discount.type)})}),$scope.disableSort=!1,$scope.dataLoaded=!0,$scope.slickLoaded=!0,$scope.cardView=!0,$scope.compareView=!1,$scope.showCompareBtn=!0,$scope.showCardBtn=!0},$scope.cardViewClick=function(){$scope.dataLoaded=!0,$scope.slickLoaded=!0,$scope.cardView=!1,$scope.compareView=!0,$scope.showCompareBtn=!0,$scope.showCardBtn=!0,$scope.disableSort=!0},$scope.premiumChoice=!0,$scope.annualPremiumClick=function(){console.log("inside annualPremiumClick function");for(var i=0;i<$rootScope.lifeQuoteResult.length;i++)if(9==$rootScope.lifeQuoteResult[i].carrierId){$scope.singleClickLifeQuote();break}$scope.isMonthlyPremium=!$scope.isMonthlyPremium,$scope.isAnnualPremium=!$scope.isAnnualPremium,$rootScope.isAnnualPremium=$scope.isAnnualPremium},$scope.findRider=function(riderId,riders){var returnvalue="Not Available";if(void 0==riders)return returnvalue="-";for(var count=0;count<riders.length;count++){if(riderId==riders[count].riderId&&0!=riders[count].riderPremiumAmount&&null!=riders[count].riderPremiumAmount){returnvalue=riders[count].riderPremiumAmount;break}if(riderId==riders[count].riderId&&"Included"==riders[count].riderType&&0==riders[count].riderPremiumAmount||void 0==riders[count].riderPremiumAmount){returnvalue=riders[count].riderType;break}if(riderId==riders[count].riderId&&"Not Available"==riders[count].riderType&&0==riders[count].riderPremiumAmount){returnvalue="0";break}}return"-1"==returnvalue&&(returnvalue="-"),returnvalue},$scope.findDiscount=function(type,discounts){for(var returnvalue="NA",count=0;count<discounts.length;count++)if(type==discounts[count].type&&0!=discounts[count].discountAmount&&null!=discounts[count].discountAmount){returnvalue=discounts[count].discountAmount;break}return returnvalue},$scope.showRiderModal=function(){$scope.riderDetailsModal=!$scope.riderDetailsModal},$scope.showPayoutOptionModal=function(){$scope.payoutOptionModal=!$scope.payoutOptionModal},$scope.hidePayoutOptionModal=function(){$scope.resetPayoutDetails(),$scope.payoutOptionModal=!1},$scope.hideRiderDetailsModal=function(){$scope.resetRiderDetails(),$scope.riderDetailsModal=!1},$scope.openLifePopup=function(selectedTab,_data){$scope.lifeProductToBeAddedInCart=_data,$rootScope.selectedTabLife=selectedTab,$scope.premiumModalLife=!$scope.premiumModalLife},$scope.hidePremiumModalLife=function(){$scope.premiumModalLife=!1},$(".activateFooter").hide(),$(".activateHeader").hide()}]);