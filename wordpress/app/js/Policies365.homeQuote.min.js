"use strict";angular.module("homeInstantQuote",["CoreComponentApp","LocalStorageModule"]).controller("homeInstantQuoteController",["$scope","$rootScope","$window","$location","$filter","RestAPI","localStorageService","$timeout","$interval","$http","$sce",function($scope,$rootScope,$window,$location,$filter,RestAPI,localStorageService,$timeout,$interval,$http,$sce){var applicationLabels=localStorageService.get("applicationLabels");$scope.globalLabel=applicationLabels.globalLabels,$rootScope.loaderContent={businessLine:"7",header:"Home Insurance",desc:$sce.trustAsHtml($scope.globalLabel.applicationLabels.home.proverbInstantQuote)},"/home"==$location.path()||($rootScope.title=$scope.globalLabel.policies365Title.homeInstantQuote),$rootScope.carrierDetails={},$rootScope.wordPressEnabled?$scope.instantQuoteHomeForm=!1:$scope.instantQuoteHomeForm=!0,$scope.getPinCodeAreaList=function(areaName){var docType;return docType=isNaN(areaName)?"Area":"Pincode",$http.get(getServiceLink+docType+"&q="+areaName).then(function(response){return JSON.parse(response.data).data})},$scope.calcDefaultAreaDetails=function(areaCode){$http.get(getServiceLink+"Pincode&q="+areaCode).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.globalLabel.responseCode.success&&$scope.onSelectPinOrArea(areaDetails.data[0])})},$scope.onSelectPinOrArea=function(item){$scope.modalPIN=!1,$scope.selectedArea=item.area,$scope.personalDetails.pincode=item.pincode,$scope.personalDetails.displayArea=item.area+", "+item.district,$scope.personalDetails.city=item.district,$scope.displayPincodeInfo=item.pincode+" - "+$scope.personalDetails.displayArea,$scope.personalDetails.state=item.state,localStorageService.set("userGeoDetails",item),setTimeout(function(){$rootScope.wordPressEnabled||$scope.singleClickHomeQuote()},100)},$scope.modalPIN=!1,$scope.togglePin=function(){$scope.modalPIN=!$scope.modalPIN,$scope.oldPincode=$scope.personalDetails.pincode,$scope.hideModal=function(){$scope.personalDetails.pincode=$scope.oldPincode,$scope.modalPIN=!1}},$rootScope.instantQuoteSummaryStatus=!0,$rootScope.disableLandingLeadBtn=!1,$scope.instantQuoteCalculation=function(){var homeQuoteCookie=localStorageService.get("homeQuoteInputParamaters"),personalDetailsCookie=localStorageService.get("homePersonalDetails");if($scope.quote={},$scope.quoteParam={},$scope.personalDetails={},$scope.typeOfHome=homeTypeGeneric,$scope.sumamount=20,$rootScope.viewOptionDisabled=!0,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteHomeForm=!0,$rootScope.openRegPopup=function(){$rootScope.Regpopup=!0},$scope.closePop=function(){$rootScope.Regpopup=!1},$scope.updateAnnualPremiumRange=function(minPremiumValue,maxPremiumValue){minPremiumValue>maxPremiumValue?($rootScope.minAnnualPremium=maxPremiumValue,$rootScope.maxAnnualPremium=minPremiumValue):($rootScope.minAnnualPremium=minPremiumValue,$rootScope.maxAnnualPremium=maxPremiumValue)},$scope.calculatePropertyAge=function(){var urlPattern=$location.path();$rootScope.wordPressEnabled&&"/home"!=urlPattern||$scope.singleClickHomeQuote()},$scope.errorMessage=function(errorMsg){"undefined"==String($rootScope.homeQuoteResult)||0==$rootScope.homeQuoteResult.length?($scope.updateAnnualPremiumRange(1e3,5e3),$rootScope.instantQuoteSummaryStatus=!1,$rootScope.instantQuoteSummaryError=errorMsg,$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!0,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteHomeForm=!1):$rootScope.homeQuoteResult.length>0&&($rootScope.instantQuoteSummaryStatus=!0,$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!1,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteHomeForm=!1),$rootScope.loading=!1},$scope.tooltipPrepare=function(homeResult){for(var resultCarrierId=[],testCarrierId=[],i=0;i<homeResult.length;i++){var carrierInfo={};carrierInfo.id=homeResult[i].carrierId,carrierInfo.name=homeResult[i].insuranceCompany,carrierInfo.annualPremium=homeResult[i].grossPremium,carrierInfo.claimsRating=homeResult[i].insurerIndex,$rootScope.wordPressEnabled&&(carrierInfo.sumInsured=homeResult[i].structureSumInsured,carrierInfo.businessLineId="7"),0==p365Includes(testCarrierId,homeResult[i].carrierId)&&(resultCarrierId.push(carrierInfo),testCarrierId.push(homeResult[i].carrierId))}$rootScope.resultCarrierId=resultCarrierId,$rootScope.quoteResultInsurerList="\n<ul style='text-align: left;' class='tickpoints'>";for(i=0;i<resultCarrierId.length;i++)$rootScope.quoteResultInsurerList+="<li>"+resultCarrierId[i].name+"</li>";$rootScope.quoteResultInsurerList+="</ul>",$rootScope.calculatedQuotesLength=2==String(homeResult.length).length?String(homeResult.length):"0"+String(homeResult.length),setTimeout(function(){scrollv=new scrollable({wrapperid:"scrollable-v",moveby:4,mousedrag:!0})},2e3)},$scope.processResult=function(){$rootScope.enabledProgressLoader=!1,$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!1,$rootScope.tabSelectionStatus=!0,$scope.instantQuoteHomeForm=!1,$rootScope.loading=!1,$rootScope.campaignFlag=!0,$rootScope.homeQuoteResult=$filter("orderBy")($rootScope.homeQuoteResult,"grossPremium");for(var minAnnualPremiumValue=$rootScope.homeQuoteResult[0].grossPremium,annualPremiumSliderArray=[],j=0;j<$rootScope.homeQuoteResult.length;j++){var calculatedDiscAmt=0,discountAmtList=$rootScope.homeQuoteResult[j].discountList;if("undefined"!=String(discountAmtList)){for(var i=0;i<discountAmtList.length;i++)calculatedDiscAmt+=discountAmtList[i].discountAmount;calculatedDiscAmt+=$rootScope.homeQuoteResult[j].grossPremium,annualPremiumSliderArray.push(calculatedDiscAmt)}else annualPremiumSliderArray.push($rootScope.homeQuoteResult[j].grossPremium)}annualPremiumSliderArray=$filter("orderBy")(annualPremiumSliderArray),$scope.updateAnnualPremiumRange(minAnnualPremiumValue,annualPremiumSliderArray[annualPremiumSliderArray.length-1]),7==localStorageService.get("selectedBusinessLineId")&&$scope.tooltipPrepare($rootScope.homeQuoteResult)},$scope.singleClickHomeQuote=function(){setTimeout(function(){$rootScope.instantQuoteSummaryStatus=!0,$rootScope.progressBarStatus=!0,$rootScope.viewOptionDisabled=!0,$rootScope.tabSelectionStatus=!1,$scope.instantQuoteHomeForm=!0,$rootScope.loading=!0,localStorageService.set("selectedBusinessLineId",7),$scope.quoteParam.documentType=$scope.globalLabel.documentType.quoteRequest,$scope.quoteParam.quoteType=localStorageService.get("selectedBusinessLineId"),$scope.quoteParam.personType=relationLifeQuoteGeneric[0],"Owned"===$scope.quoteParam.homeType?$scope.quoteParam.structureSumInsured=Number($scope.quoteParam.structureSumInsured):$scope.quoteParam.structureSumInsured=0,$scope.quoteParam.contentSumInsured=Number($scope.quoteParam.contentSumInsured),$scope.quote.quoteParam=$scope.quoteParam,$scope.quote.personalDetails=$scope.personalDetails,$scope.quote.requestType=$scope.globalLabel.request.homeRequestType,localStorageService.set("homeQuoteInputParamaters",$scope.quote),localStorageService.set("homePersonalDetails",$scope.personalDetails),$scope.requestId=null,RestAPI.invoke($scope.globalLabel.getRequest.quoteHome,$scope.quote).then(function(callback){console.log("in restapi home"),$rootScope.homeQuoteRequest=[],callback.responseCode==$scope.globalLabel.responseCode.success?($scope.responseCodeList=[],$scope.requestId=callback.QUOTE_ID,localStorageService.set("HOME_UNIQUE_QUOTE_ID",$scope.requestId),$rootScope.homeQuoteRequest=callback.data,"undefined"!=String($scope.homeQuoteResult)&&$scope.homeQuoteResult.length>0&&($scope.homeQuoteResult.length=0),$rootScope.homeQuoteResult=[],angular.forEach($rootScope.homeQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.deviceId=deviceIdOrigin,header.browser=browser.name+" V - "+browser.version,header.transactionName=$scope.globalLabel.transactionName.homeQuoteResult,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var homeQuoteResponse=JSON.parse(callback);if(homeQuoteResponse.QUOTE_ID==$scope.requestId&&($scope.responseCodeList.push(homeQuoteResponse.responseCode),homeQuoteResponse.responseCode==$scope.globalLabel.responseCode.success)){for(var i=0;i<$rootScope.homeQuoteRequest.length;i++)$rootScope.homeQuoteRequest[i].messageId==homeQuoteResponse.messageId&&(homeQuoteResponse.data.quotes[0].insuranceCompany=homeQuoteResponse.data.quotes[0].insuranceCompany,$rootScope.homeQuoteResult.push(homeQuoteResponse.data.quotes[0]),$rootScope.homeQuoteRequest[i].status=1);$scope.processResult()}}).error(function(data,status){$scope.responseCodeList.push($scope.globalLabel.responseCode.systemError)})}),$scope.$watch("responseCodeList",function(newValue,oldValue,scope){p365Includes($scope.responseCodeList,$scope.globalLabel.responseCode.success)&&($rootScope.loading=!1),$scope.responseCodeList.length==$rootScope.homeQuoteRequest.length&&($rootScope.loading=!1,p365Includes($scope.responseCodeList,$scope.globalLabel.responseCode.success)||(p365Includes($scope.responseCodeList,$scope.globalLabel.responseCode.quoteNotAvailable)?$scope.errorMessage($scope.globalLabel.validationMessages.productNotFoundMsg):$scope.errorMessage($sce.trustAsHtml($scope.globalLabel.validationMessages.generalisedLifeErrMsg))))},!0)):($scope.responseCodeList=[],"undefined"!=String($rootScope.homeQuoteResult)&&$rootScope.homeQuoteResult.length>0&&($rootScope.homeQuoteResult.length=0),$rootScope.homeQuoteResult=[],$scope.errorMessage(callback.message))})},100)},$scope.$on("callSingleClickHomeQuote",function(){$scope.singleClickHomeQuote()}),$scope.calculateHomePremium=function(){$rootScope.wordPressEnabled||$scope.singleClickHomeQuote()},$scope.prePopulateFields=function(){},$scope.fetchDefaultInputParamaters=function(defaultQuoteStatus,defaultInputParamCallback){getDocUsingId(RestAPI,$scope.globalLabel.documentType.defaultHomeQuoteParam,function(callback){defaultQuoteStatus?($scope.quoteParam=callback.quoteParam,$scope.personalDetails=callback.personalDetails,$rootScope.wordPressEnabled&&($scope.quote={},$scope.quote.personalDetails=$scope.personalDetails,$scope.quote.quoteParam=$scope.quoteParam,localStorageService.set("selectedBusinessLineId",7),localStorageService.set("homeQuoteInputParamaters",$scope.quote),localStorageService.set("homePersonalDetails",$scope.personalDetails))):($scope.quoteParam=homeQuoteCookie.quoteParam,$scope.personalDetails=personalDetailsCookie),$scope.personalDetails.pincode=localStorageService.get("cityDataFromIP")&&1==localStorageService.get("cityDataFromIP").cityStatus?localStorageService.get("cityDataFromIP").pincode:$scope.personalDetails.pincode,$scope.calcDefaultAreaDetails($scope.personalDetails.pincode),$scope.prePopulateFields(),$rootScope.loading=!1,defaultInputParamCallback()})},null!=homeQuoteCookie&&"undefined"!==String(homeQuoteCookie)){if($scope.quote=homeQuoteCookie,$scope.quoteParam=homeQuoteCookie.quoteParam,$scope.personalDetails=homeQuoteCookie.personalDetails,$rootScope.wordPressEnabled)$scope.displayPincodeInfo=$scope.personalDetails.pincode+" - "+$scope.personalDetails.displayArea;else{var item=localStorageService.get("userGeoDetails");$scope.modalPIN=!1,$scope.selectedArea=item.area,$scope.personalDetails.pincode=item.pincode,$scope.personalDetails.displayArea=item.area+", "+item.district,$scope.personalDetails.city=item.district,$scope.displayPincodeInfo=item.pincode+" - "+$scope.personalDetails.displayArea}$scope.fetchDefaultInputParamaters(!1,function(){})}else $scope.fetchDefaultInputParamaters(!0,function(){})},$scope.showAmount=function(amount){return amount>1e5?Math.round(amount/1e5):0},$scope.checkSum=function(amount){(amount<1e5||void 0==amount||void 0==typeof amount)&&($rootScope.disableNextScreen=!0,$scope.message="Please enter the amount Greater than or equal to 1 Lac "),amount>5e8&&($rootScope.disableNextScreen=!0,$scope.message="Please enter the amount Less than 5 Crore "),amount>1e5&&amount<=2e9&&($rootScope.disableNextScreen=!1,$scope.message="")},$scope.showContentAmount=function(amount){return amount>1e5?Math.round(amount/1e5):0},$scope.checkContentSum=function(amount){(amount<1e5||void 0==amount||void 0==typeof amount)&&($rootScope.disableNextScreen=!0,$scope.message="Please enter the amount Greater than or equal to 1 Lac "),amount>5e8&&($rootScope.disableNextScreen=!0,$scope.message="Please enter the amount Less than 5 Crore "),amount>1e5&&amount<=2e9&&($rootScope.disableNextScreen=!1,$scope.message="")},$scope.showPropertyAge=function(age){if(age>=1)return age},$scope.checkPropertyAge=function(age){(age<=1||void 0==age||void 0==typeof age)&&($rootScope.disableNextScreen=!0,$scope.message="Please enter the property age greater than or equal to 1 year"),age>40&&($rootScope.disableNextScreen=!0,$scope.message="Please enter the property age less than 40 years "),age>=1&&age<=40&&($rootScope.disableNextScreen=!1,$scope.message="")},$rootScope.tooltipContent=localStorageService.get("homeInstantQuoteTooltipContent"),$scope.instantQuoteCalculation()}]),angular.module("homeResult",["CoreComponentApp","LocalStorageModule","ngMessages","checklist-model"]).controller("homeResultController",["$scope","$rootScope","$filter","$location","$http","$window","RestAPI","localStorageService","$timeout","$interval","$sce",function($scope,$rootScope,$filter,$location,$http,$window,RestAPI,localStorageService,$timeout,$interval,$sce){var applicationLabels=localStorageService.get("applicationLabels");($scope.globalLabel=applicationLabels.globalLabels,$rootScope.loaderContent={businessLine:"7",header:"Home Insurance",desc:$sce.trustAsHtml($scope.globalLabel.applicationLabels.home.proverbResult)},$rootScope.title=$scope.globalLabel.policies365Title.homeResultQuote,$scope.quote={},$scope.quoteUserInfo={},$rootScope.instantQuoteSummaryStatus=!0,$rootScope.disableLandingLeadBtn=!1,$rootScope.wordPressEnabled?$scope.rippleColor="":$scope.rippleColor="#f8a201",$scope.modalView=!1,$rootScope.agencyPortalEnabled)&&(localStorageService.get("quoteUserInfo")||($scope.modalView=!0));$scope.homeInputSectionHTML=wp_path+"buy/home/html/HomeInputSection.html",$scope.homeShareEmailSectionHTML=wp_path+"buy/home/html/HomeShareEmailSection.html",localStorageService.get("userLoginInfo")&&($rootScope.userLoginStatus=localStorageService.get("userLoginInfo").status,$rootScope.username=localStorageService.get("userLoginInfo").username),$rootScope.loading=!0,$rootScope.isBackButtonPressed=!1,$rootScope.disableLandingLeadBtn=!1,$scope.homeInputSection=!1,$scope.typeOfHome=homeTypeGeneric,$scope.typeOfProperty=propertyTypeGeneric,$scope.policyTermArray=homePolicyTermList,$scope.getPinCodeAreaList=function(areaName){var docType;return docType=isNaN(areaName)?"Area":"Pincode",$http.get(getServiceLink+docType+"&q="+areaName).then(function(response){return JSON.parse(response.data).data})},$scope.calcDefaultAreaDetails=function(areaCode){$http.get(getServiceLink+"Pincode&q="+areaCode).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.globalLabel.responseCode.success&&$scope.onSelectPinOrArea(areaDetails.data[0])})},$scope.onSelectPinOrArea=function(item){$scope.modalPIN=!1,$scope.selectedArea=item.area,$scope.personalDetails.pincode=item.pincode,$scope.personalDetails.displayArea=item.area+", "+item.district,$scope.personalDetails.city=item.district,$scope.displayPincodeInfo=item.pincode+" - "+$scope.personalDetails.displayArea,$scope.personalDetails.state=item.state,localStorageService.set("userGeoDetails",item),setTimeout(function(){$rootScope.wordPressEnabled||$scope.singleClickHomeQuote()},100)},$scope.modalPIN=!1,$scope.togglePin=function(){$scope.quoteHomeInputForm.homeInputForm.$setDirty(),$scope.modalPIN=!$scope.modalPIN,$scope.oldPincode=$scope.personalDetails.pincode,$scope.hideModal=function(){$scope.personalDetails.pincode=$scope.oldPincode,$scope.modalPIN=!1}},$scope.quotesToShow=$rootScope.homeQuoteResult,$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled&&(messageIDVar=$location.search().messageId,$scope.quoteUserInfo.messageId=$location.search().messageId,$scope.homeInputSection=!0),$scope.showPersonalDetails=function(){$scope.hometInputSection=!$scope.homeInputSection},$scope.backToResultScreen=function(){$rootScope.wordPressEnabled&&($rootScope.isBackButtonPressed=!0),$location.path("/quote")};var docId=$scope.globalLabel.documentType.quoteResultScreen+"-"+localStorageService.get("selectedBusinessLineId");getDocUsingId(RestAPI,docId,function(tooltipContent){$scope.tooltipContent=tooltipContent.toolTips,$scope.selectedAddOnCovers=[],$scope.sortByElement=[],$scope.selectedCarrier=[],$scope.riderFeatureLength=0,$scope.expose=!1,$scope.tempStatus=!0;$scope.quoteParam=localStorageService.get("homeQuoteInputParamaters").quoteParam,$scope.personalDetails=localStorageService.get("homePersonalDetails"),$scope.insuranceCompanyList={},$scope.insuranceCompanyList.selectedInsuranceCompany=[],$scope.disableSubmit=!1,$scope.sortTypes=sortTypesHomeGeneric,$scope.relationType=relationLifeQuoteGeneric,$scope.healthConditionType=healthConditionGeneric,$scope.annualIncomesRange=annualIncomesGeneric,$scope.healthTypeCondition=healthTypeConditionGeneric,$scope.riskLevels=riskLevelsGeneric,$scope.selectedSortOption=$scope.sortTypes[0],$scope.activeSort=$scope.sortTypes[0].key,$scope.comparePoliciesDisplayList=comparePoliciesDisplayValues,$scope.compareLifePoliciesDisplayList=compareLifePoliciesDisplayValues,$scope.personAge=$scope.quoteParam.age,$scope.quoteParamCopy=angular.copy($scope.quoteParam),$scope.personalDetailsCopy=angular.copy($scope.personalDetails),$scope.openMenu=function($mdOpenMenu,ev){$mdOpenMenu(ev),setTimeout(function(){$(".md-click-catcher").click(function(){$scope.activeMenu=""})},100)},$scope.clickForActive=function(item){$scope.activeMenu=item},$scope.clickForViewActive=function(item){$scope.activeViewMenu=item},$scope.clickForViewActive("Compare"),$scope.clicktoDisable=function(){setTimeout(function(){$(".md-click-catcher").css("pointer-events","none")},100)},$scope.EmailChoices=[{username:"",addNew:!0,paramMap:{docId:"",LOB:localStorageService.get("selectedBusinessLineId").toString(),userId:"",selectedPolicyType:""}}],$scope.quoteUserInfo.messageId="",$scope.quoteUserInfo.termsCondition=!0;if($scope.modalEmailView=!1,$scope.emailPopUpDisabled=!1,localStorageService.get("quoteUserInfo")&&($scope.EmailChoices[0].username=localStorageService.get("quoteUserInfo").emailId),$scope.addNewChoice=function(){var newItemNo=$scope.EmailChoices.length+1;newItemNo<=3&&($scope.EmailChoices.push({username:""}),$scope.EmailChoices[0].addNew=!1,$scope.EmailChoices[1].addNew=!0,$scope.emailPopUpDisabled=!1),3==newItemNo&&($scope.EmailChoices[2].addNew=!1,$scope.emailPopUpDisabled=!0)},$scope.removeChoice=function(){var lastItem=$scope.EmailChoices.length-1;$scope.EmailChoices.splice(lastItem)},$scope.showForShare=function(data){if(!$rootScope.parseCarrierList)return!0;for(var j=0;j<$rootScope.parseCarrierList.length;j++)if(data.carrierId==$rootScope.parseCarrierList[j])return!0},$scope.sendQuotesByEmail=function(){for(var i=0;i<$scope.EmailChoices.length;i++)if(""!=$scope.EmailChoices[i].username&&void 0!=$scope.EmailChoices[i].username){var encodeQuote=localStorageService.get("HOME_UNIQUE_QUOTE_ID"),encodeLOB=String(localStorageService.get("selectedBusinessLineId")),encodeEmailId=$scope.EmailChoices[i].username,encodeMonthlyPremiumOption=String($scope.isMonthlyPremium),encodeCarrierList=[];if($scope.insuranceCompanyList.selectedInsuranceCompany.length>0){encodeCarrierList=$scope.insuranceCompanyList.selectedInsuranceCompany;var jsonEncodeCarrierList=JSON.stringify(encodeCarrierList)}else encodeCarrierList.push("ALL");var key=CryptoJS.enc.Hex.parse("000102030405060708090a0b0c0d0e0f"),iv=CryptoJS.enc.Hex.parse("101112131415161718191a1b1c1d1e1f"),encryptedQuote=CryptoJS.AES.encrypt(encodeQuote,key,{iv:iv});$rootScope.encryptedQuote_Id=encryptedQuote.ciphertext.toString();var encryptedNewLOB=CryptoJS.AES.encrypt(encodeLOB,key,{iv:iv});$rootScope.encryptedLOB=encryptedNewLOB.ciphertext.toString();var encryptedEmailId=CryptoJS.AES.encrypt(encodeEmailId,key,{iv:iv});$rootScope.encryptedEmail=encryptedEmailId.ciphertext.toString();var encryptedMonthlyPremiumOption=CryptoJS.AES.encrypt(encodeMonthlyPremiumOption,key,{iv:iv});$rootScope.encryptedMonthlyPremium=encryptedMonthlyPremiumOption.ciphertext.toString();var encryptedCarrierList=CryptoJS.AES.encrypt(jsonEncodeCarrierList,key,{iv:iv});$rootScope.encryptedCarriers=encryptedCarrierList.ciphertext.toString(),$scope.EmailChoices[i].funcType="SHARECIQUOTE",$scope.EmailChoices[i].paramMap={},$scope.EmailChoices[i].paramMap.docId=String($rootScope.encryptedQuote_Id),$scope.EmailChoices[i].paramMap.LOB=String($rootScope.encryptedLOB),$scope.EmailChoices[i].paramMap.userId=String($rootScope.encryptedEmail),$scope.EmailChoices[i].paramMap.carriers=String($rootScope.encryptedCarriers),$scope.EmailChoices[i].paramMap.monthlyPremiumOption=String($rootScope.encryptedMonthlyPremium),$scope.EmailChoices[i].paramMap.selectedPolicyType="HOME";var request={},header={};get_browser_info();header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=sendEmail,header.deviceId=deviceIdOrigin,request.header=header,request.body=$scope.EmailChoices[i],$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback){var emailResponse=JSON.parse(callback),receiptNum=$scope.EmailChoices.length;i==receiptNum&&(emailResponse.responseCode==$scope.globalLabel.responseCode.success?($scope.shareEmailModal=!1,$scope.modalEmailView=!0):(localStorageService.set("emailDetails",void 0),flagCheck.flag=!1))})}},$scope.deleteReceipient=function(index){$scope.EmailChoices.splice(index,1),$scope.EmailChoices.length<3&&($scope.emailPopUpDisabled=!1,1==$scope.EmailChoices.length?($scope.EmailChoices[0].addNew=!0,$scope.EmailChoices[1].addNew=!1):($scope.EmailChoices[0].addNew=!1,$scope.EmailChoices[1].addNew=!0))},$scope.hideEmailModal=function(){$scope.modalEmailView=!1,$scope.shareEmailModal=!1},$scope.leadCreationUserInfo=function(){},$scope.redirectToResult=function(){$scope.leadCreationUserInfo()},$scope.redirectToAPResult=function(){$scope.leadCreationUserInfo()},$rootScope.flag||$rootScope.isOlarked){$scope.isMonthlyPremium=$rootScope.decryptedMonthlyPremiumOption,"true"==$scope.isMonthlyPremium?$scope.isMonthlyPremium=!0:($scope.isMonthlyPremium=!1,$scope.isQuarterlyPremium=!1,$scope.isHalfAnnualPremium=!1,$scope.isAnnualPremium=!0,$scope.premiumChoice=!1),void 0!=$rootScope.selectedAddOnCovers&&($scope.personalDetails.selectedAddOnCovers=$rootScope.selectedAddOnCovers),angular.copy($scope.personalDetails.selectedAddOnCovers,$scope.selectedAddOnCoversCopy);for(var i=0;i<$scope.payoutOptions.length;i++)if($scope.payoutOptions[i].id==$scope.quoteParam.payoutId){$scope.payoutDetails.payoutOption=$scope.payoutOptions[i];break}$rootScope.flag&&($scope.redirectToResult(),$rootScope.flag=!1),localStorageService.get("quoteUserInfo")&&($scope.EmailChoices[0].username=localStorageService.get("quoteUserInfo").emailId),$rootScope.loading=!1}$scope.calculateSumAssured=function(){listSumAssuredAmt($scope.personalDetails.annualIncomeObject.annualIncome,function(sumInsuredArray,selectedSumAssured){$scope.quoteParam.structureSumInsured=selectedSumAssured.amount,$scope.personalDetails.sumInsuredObject=selectedSumAssured,$scope.personalDetails.sumInsuredList=sumInsuredArray})},$scope.submitBtn=!1,$scope.editBtn=!0;$scope.toggleChange=function(clickEvent){$(".firstPane").addClass("opened"),$(".firstPaneContent").show(),1==$(".viewDiv").is(":visible")?($scope.editBtn=!1,$scope.submitBtn=!0,$scope.cancelBtn=!0):1==$(".modifyDiv").is(":visible")&&"submit"==clickEvent?($scope.editBtn=!0,$scope.cancelBtn=!1,$scope.submitBtn=!1,$scope.singleClickHomeQuote()):(angular.copy($scope.quoteParamCopy,$scope.quoteParam),angular.copy($scope.personalDetailsCopy,$scope.personalDetails),$scope.quoteHomeInputForm.homeInputForm.$setPristine(),$scope.homeInputForm=!1,$scope.editBtn=!0,$scope.cancelBtn=!1,$scope.submitBtn=!1)},$scope.showAmount=function(amount){return amount>1e5?Math.round(amount/1e5):0},$scope.checkSum=function(amount){(amount<1e5||void 0==amount||void 0==typeof amount)&&($rootScope.disableNextScreen=!0,$scope.message="Please enter the amount Greater than or equal to 1 Lac "),amount>5e8&&($rootScope.disableNextScreen=!0,$scope.message="Please enter the amount Less than 5 Crore "),amount>1e5&&amount<=2e9&&($rootScope.disableNextScreen=!1,$scope.message="")},$scope.showPropertyAge=function(age){if(age=>1)return age},$scope.checkPropertyAge=function(age){(age<=1||void 0==age||void 0==typeof age)&&($rootScope.disableNextScreen=!0,$scope.message="Please enter the property age greater than or equal to 1 year"),age>40&&($rootScope.disableNextScreen=!0,$scope.message="Please enter the property age less than 40 years "),age>=1&&age<=40&&($rootScope.disableNextScreen=!1,$scope.message="")},$scope.setfromController=!0;$scope.submitReportBtn=!1,$scope.editReportBtn=!0,$scope.toggleReportChange=function(){$(".thirdPane").addClass("opened"),$(".thirdPaneContent").show(),1==$(".viewReportDiv").is(":visible")?($(".modifyReportDiv").show(),$(".viewReportDiv").hide(),$scope.editReportBtn=!1,$scope.submitReportBtn=!0,$scope.cancelReportBtn=!0,!1):1==$(".modifyReportDiv").is(":visible")&&($(".viewReportDiv").slideDown(),$(".modifyReportDiv").slideUp(),$scope.editReportBtn=!0,$scope.submitReportBtn=!1,$scope.cancelReportBtn=!1,!0)},$scope.updateSort=function(sortOption){$scope.activeSort=sortOption.key,$scope.selectedSortOption=sortOption,1==sortOption.key?($scope.sortKey="annualPremium",$scope.sortReverse=!1):2==sortOption.key?($scope.sortKey="structureSumInsured",$scope.sortReverse=!0):3==sortOption.key?($scope.sortKey="insurerIndex",$scope.sortReverse=!0):4==sortOption.key?($scope.sortKey="ratingsList['8']["+$scope.benefitFeatureRiskType.id+"]",$scope.sortReverse=!0):5==sortOption.key?($scope.sortKey="ratingsList['9']["+$scope.flexibleFeatureRiskType.id+"]",$scope.sortReverse=!0):6==sortOption.key?($scope.sortKey="ratingsList['11']["+$scope.savingFeatureRiskType.id+"]",$scope.sortReverse=!0):7==sortOption.key&&($scope.sortKey="ratingsList['10']["+$scope.eligibilityFeatureRiskType.id+"]",$scope.sortReverse=!0),$scope.toggleState()},$scope.updateSortOrder=function(){1==$scope.selectedSortOption.key?$scope.sortKey="annualPremium":2==$scope.selectedSortOption.key?$scope.sortKey="structureSumInsured":3==$scope.selectedSortOption.key?$scope.sortKey="insurerIndex":4==$scope.selectedSortOption.key?$scope.sortKey="ratingsList['8']["+$scope.benefitFeatureRiskType.id+"]":5==$scope.selectedSortOption.key?$scope.sortKey="ratingsList['9']["+$scope.flexibleFeatureRiskType.id+"]":6==$scope.selectedSortOption.key?$scope.sortKey="ratingsList['11']["+$scope.savingFeatureRiskType.id+"]":7==$scope.selectedSortOption.key&&($scope.sortKey="ratingsList['10']["+$scope.eligibilityFeatureRiskType.id+"]"),$scope.sortReverse=!$scope.sortReverse},$scope.fetchDefaultInputParamaters=function(defaultInputParamCallback){getDocUsingId(RestAPI,$scope.globalLabel.documentType.defaultHomeQuoteParam,function(callback){$scope.quoteParam=callback.quoteParam,$scope.personalDetails=callback.personalDetails,listSumAssuredAmt($scope.quoteParam.annualIncome,function(sumInsuredArray,selectedSumAssured){$scope.personAge=$scope.quoteParam.age,$scope.personalDetails.sumInsuredObject=selectedSumAssured,$scope.personalDetails.sumInsuredList=sumInsuredArray;for(var i=0;i<annualIncomesGeneric.length;i++)if($scope.quoteParam.annualIncome==annualIncomesGeneric[i].annualIncome){$scope.personalDetails.annualIncomeObject=annualIncomesGeneric[i];break}defaultInputParamCallback()})})},$scope.errorRespCounter=!0,$scope.errorMessage=function(errorMsg){!$scope.errorRespCounter||"undefined"!=String($rootScope.homeQuoteResult)&&0!=$rootScope.homeQuoteResult.length?$rootScope.homeQuoteResult.length>0&&($rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!1,$rootScope.tabSelectionStatus=!0,$rootScope.loading=!1):($scope.errorRespCounter=!1,$scope.errorRespMsg=errorMsg,$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!0,$rootScope.tabSelectionStatus=!0,$rootScope.loading=!1)},$scope.processResult=function(){$rootScope.progressBarStatus=!1,$rootScope.viewOptionDisabled=!1,$rootScope.tabSelectionStatus=!0,$rootScope.loading=!1,$rootScope.homeQuoteResult=$filter("orderBy")($rootScope.homeQuoteResult,"grossPremium"),$rootScope.homeQuoteResult=changeCurrencySymbol($rootScope.homeQuoteResult),localStorageService.set("homeQuoteResult",$rootScope.homeQuoteResult),$scope.updateSortOrder(),$scope.quotesToShow=$rootScope.homeQuoteResult},$scope.displayRibbon=function(){$scope.isMinPremium=function(annualPremiumValue,carrierIDValue){for(var min=$rootScope.homeQuoteResult[0].grossPremium,i=0;i<=$rootScope.homeQuoteResult.length-1;i++){var carrierIdMin=$rootScope.homeQuoteResult[i].carrierId;Number($rootScope.homeQuoteResult[i].grossPremium)<min&&(min=$rootScope.homeQuoteResult[i].grossPremium,carrierIDValue=carrierIdMin)}return min===annualPremiumValue&&($scope.selMinCarrierId=carrierIDValue,!0)},$scope.isMaxIndex=function(insurerIndex,structureSumInsured,grossPremium,carrierSelID){for(var maxSel=grossPremium/(insurerIndex*structureSumInsured)*1e3,insurerIndex0=$rootScope.homeQuoteResult[0].insurerIndex,sumInsured0=$rootScope.homeQuoteResult[0].structureSumInsured,max=$rootScope.homeQuoteResult[0].grossPremium/(sumInsured0*insurerIndex0)*1e3,i=0;i<=$rootScope.homeQuoteResult.length-1;i++){var insurerIndexI=$rootScope.homeQuoteResult[i].insurerIndex,sumInsuredI=$rootScope.homeQuoteResult[i].structureSumInsured,annualPremiumI=$rootScope.homeQuoteResult[i].annualPremium,carrierIdI=$rootScope.homeQuoteResult[i].carrierId,maxI=annualPremiumI/(sumInsuredI*insurerIndexI)*1e3;Number(maxI)<max&&(max=maxI,carrierSelID=carrierIdI)}return max===maxSel&&($scope.selCarrierId=carrierSelID,!0)}},$scope.displayRibbon(),$scope.singleClickHomeQuote=function(){setTimeout(function(){$scope.quoteHomeInputForm.$setPristine(),$scope.errorRespCounter=!0,$rootScope.loading=!0,$scope.dataLoaded=!1,$scope.quoteParam.documentType=$scope.globalLabel.documentType.quoteRequest,$scope.quoteParam.quoteType=localStorageService.get("selectedBusinessLineId"),$scope.quoteParam.structureSumInsured=Number($scope.quoteParam.structureSumInsured),$scope.quoteParam.contentSumInsured=Number($scope.quoteParam.contentSumInsured),$scope.quote.quoteParam=$scope.quoteParam,$scope.quote.personalDetails=$scope.personalDetails,$scope.quote.requestType=$scope.globalLabel.request.homeRequestType,localStorageService.set("hometQuoteInputParamaters",$scope.quote),localStorageService.set("homePersonalDetails",$scope.personalDetails),$rootScope.homeQuoteResult=[],$scope.quoteParamCopy=angular.copy($scope.quoteParam),$scope.personalDetailsCopy=angular.copy($scope.personalDetails),$scope.requestId=null,$rootScope.homeQuoteResult=[],RestAPI.invoke($scope.globalLabel.getRequest.quoteHome,$scope.quote).then(function(callback){$rootScope.homeQuoteRequest=[],callback.responseCode==$scope.globalLabel.responseCode.success?($rootScope.loading=!1,$scope.dataLoaded=!0,$scope.responseCodeList=[],$scope.requestId=callback.QUOTE_ID,localStorageService.set("HOME_UNIQUE_QUOTE_ID",$scope.requestId),$rootScope.homeQuoteRequest=callback.data,"undefined"!=String($rootScope.homeQuoteResult)&&$rootScope.homeQuoteResult.length>0&&($rootScope.homeQuoteResult.length=0),angular.forEach($rootScope.homeQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=$scope.globalLabel.transactionName.homeQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var homeQuoteResponse=JSON.parse(callback);if(homeQuoteResponse.QUOTE_ID==$scope.requestId)if($scope.responseCodeList.push(homeQuoteResponse.responseCode),homeQuoteResponse.responseCode==$scope.globalLabel.responseCode.success){for(var i=0;i<$rootScope.homeQuoteRequest.length;i++)$rootScope.homeQuoteRequest[i].messageId==homeQuoteResponse.messageId&&(homeQuoteResponse.data.quotes[0].insuranceCompany=homeQuoteResponse.data.quotes[0].insuranceCompany,$rootScope.homeQuoteResult.push(homeQuoteResponse.data.quotes[0]),$rootScope.homeQuoteRequest[i].status=1);$scope.processResult()}else for(i=0;i<$rootScope.homeQuoteRequest.length;i++)$rootScope.homeQuoteRequest[i].messageId==homeQuoteResponse.messageId&&($rootScope.homeQuoteRequest[i].status=2,$rootScope.homeQuoteRequest[i].message=$sce.trustAsHtml($scope.globalLabel.validationMessages.generalisedLifeErrMsg))}).error(function(data,status){$scope.responseCodeList.push($scope.globalLabel.responseCode.systemError)})}),$scope.$watch("responseCodeList",function(newValue,oldValue,scope){if(p365Includes($scope.responseCodeList,$scope.globalLabel.responseCode.success)&&$scope.responseCodeList.length==$scope.homeQuoteRequest.length){for(var i=0;i<$rootScope.homeQuoteRequest.length;i++)0==$rootScope.homeQuoteRequest[i].status&&($rootScope.homeQuoteRequest[i].status=2,$rootScope.homeQuoteRequest[i].message=$sce.trustAsHtml($scope.globalLabel.validationMessages.generalisedLifeErrMsg));p365Includes($scope.responseCodeList,$scope.globalLabel.responseCode.success)||(p365Includes($scope.responseCodeList,$scope.globalLabel.responseCode.quoteNotAvailable)?$scope.errorMessage($scope.globalLabel.validationMessages.productNotFoundMsg):$scope.errorMessage($scope.globalLabel.validationMessages.generalisedErrMsg))}},!0)):($scope.responseCodeList=[],"undefined"!=String($rootScope.homeQuoteResult)&&$rootScope.homeQuoteResult.length>0&&($rootScope.homeQuoteResult.length=0),$rootScope.homeQuoteResult=[],$scope.errorMessage($sce.trustAsHtml($scope.globalLabel.validationMessages.generalisedLifeErrMsg)))}),$scope.displayRibbon()},100)},$scope.callSingleClickQuote=function(){$rootScope.wordPressEnabled||$scope.singleClickHomeQuote()},$scope.calculateQuoteOnSubmit=function(){$scope.callSingleClickQuote()},$scope.validatePremium=function(data){return Number(data.grossPremium)>0},$scope.buyProduct=function(selectedProduct){$rootScope.title=$scope.globalLabel.policies365Title.confirmPopup,$scope.buyScreenTemplate(selectedProduct)},$scope.buyScreenTemplate=function(selectedProduct){localStorageService.set("homeSelectedProduct",selectedProduct),$scope.selectedProduct=selectedProduct,$scope.requestId&&localStorageService.set("HOME_UNIQUE_QUOTE_ID",$scope.requestId),$scope.modalCompare&&($scope.modalCompare=!1);var buyScreenParam={};buyScreenParam.documentType=proposalScreenConfig,buyScreenParam.businessLineId=localStorageService.get("selectedBusinessLineId"),buyScreenParam.carrierId=selectedProduct.carrierId,buyScreenParam.productId=selectedProduct.productId,buyScreenParam.QUOTE_ID=localStorageService.get("HOME_UNIQUE_QUOTE_ID"),getDocUsingParam(RestAPI,$scope.globalLabel.transactionName.productDataReader,buyScreenParam,function(buyScreen){if(buyScreen.responseCode==$scope.globalLabel.responseCode.success){localStorageService.set("buyScreen",buyScreen.data),$scope.productValidation=buyScreen.data.validation;var docId=$scope.globalLabel.documentType.buyScreen+"-"+localStorageService.get("selectedBusinessLineId");getDocUsingId(RestAPI,docId,function(buyScreenTooltip){if(localStorageService.set("buyScreenTooltip",buyScreenTooltip.toolTips),$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled){if(String($location.search().leaddetails)!=$scope.globalLabel.errorMessage.undefinedError){var leaddetails=JSON.parse($location.search().leaddetails);localStorageService.set("quoteUserInfo",leaddetails)}$location.path("/home").search({quoteId:localStorageService.get("HOME_UNIQUE_QUOTE_ID"),carrierId:selectedProduct.carrierId,productId:selectedProduct.productId,lob:localStorageService.get("selectedBusinessLineId")})}else $location.path("/home")})}else $rootScope.P365Alert("Policies365",$scope.globalLabel.validationMessages.generalisedErrMsg,"Ok")})},$scope.state=!1,$scope.toggleState=function(){$scope.state=!$scope.state}}),$rootScope.signout=function(){$rootScope.userLoginStatus=!1;var userLoginInfo={username:""};userLoginInfo.status=$rootScope.userLoginStatus,localStorageService.set("userLoginInfo",userLoginInfo),$location.path("/quote")},$scope.missionCompled=function(){$rootScope.loading=!1},$scope.data={},$scope.data.group1=1,$scope.modalCompare=!1,$scope.consolatedRiderList=[],$scope.consolatedDiscountList=[],$scope.toggleCompare=function(){var riderJson={};angular.forEach($scope.selectedCarrier,function(quote){angular.forEach(quote.riders,function(rider){null==riderJson[rider.riderId]&&($scope.consolatedRiderList.push(rider),riderJson[rider.riderId]=rider.riderName)})});var discountJson={};angular.forEach($scope.selectedCarrier,function(quote){angular.forEach(quote.discountList,function(discount){null==discountJson[discount.type]&&null!=discount.discountAmount&&0!=discount.discountAmount&&($scope.consolatedDiscountList.push(discount),discountJson[discount.type]=discount.type)})}),$scope.modalCompare=!0,$scope.hideModal=function(){$scope.modalCompare=!1}},$scope.cardView=!0,$scope.compareView=!1,$scope.showCompareBtn=!0,$scope.showCardBtn=!0,$scope.disableSort=!1,$scope.compareViewClick=function(){var riderJson={};$scope.consolatedRiderList=[],$scope.consolatedDiscountList=[],angular.forEach($rootScope.homeQuoteResult,function(quote){angular.forEach(quote.riders,function(rider){null==riderJson[rider.riderId]&&($scope.consolatedRiderList.push(rider),riderJson[rider.riderId]=rider.riderName)})});var discountJson={};angular.forEach($rootScope.homeQuoteResult,function(quote){angular.forEach(quote.discountList,function(discount){null==discountJson[discount.type]&&null!=discount.discountAmount&&($scope.consolatedDiscountList.push(discount),discountJson[discount.type]=discount.type)})}),$scope.disableSort=!1,$scope.dataLoaded=!0,$scope.slickLoaded=!0,$scope.cardView=!0,$scope.compareView=!1,$scope.showCompareBtn=!0,$scope.showCardBtn=!0},$scope.cardViewClick=function(){$scope.dataLoaded=!0,$scope.slickLoaded=!0,$scope.cardView=!1,$scope.compareView=!0,$scope.showCompareBtn=!0,$scope.showCardBtn=!0,$scope.disableSort=!0},$scope.premiumChoice=!0,$scope.showPayoutOptionModal=function(){$scope.payoutOptionModal=!$scope.payoutOptionModal},$scope.hidePayoutOptionModal=function(){$scope.resetPayoutDetails(),$scope.payoutOptionModal=!1},$scope.showShareEmailModal=function(){$scope.shareEmailModal=!0},$scope.hideRiderDetailsModal=function(){$scope.resetRiderDetails(),$scope.riderDetailsModal=!1},$(".activateFooter").hide(),$(".activateHeader").hide()}]);