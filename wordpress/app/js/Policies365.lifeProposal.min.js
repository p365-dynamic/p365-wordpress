"use strict";angular.module("buyAssurance",["CoreComponentApp","LocalStorageModule","checklist-model","ngMessages"]).controller("buyAssuranceController",["$scope","$rootScope","$timeout","RestAPI","localStorageService","$location","$window","$http","$filter","$interval","$sce",function($scope,$rootScope,$timeout,RestAPI,localStorageService,$location,$window,$http,$filter,$interval,$sce){$scope.lifeProposalSectionHTML=wp_path+"buy/life/html/LifeProposalSection.html",$scope.p365Labels=lifeProposalLabels,$rootScope.loaderContent={businessLine:"1",header:"Life Insurance",desc:$sce.trustAsHtml($scope.p365Labels.common.proverbBuyProduct)},$rootScope.title=$scope.p365Labels.policies365Title.lifeBuyQuote,$scope.numRecords=4,$scope.status=!1,$scope.page=1,$scope.genderMorF="",$scope.medicalInfo={},$scope.jobsInfo={},$scope.jobsInfo.tempJobDetails=[],$scope.medicalInfo.medicalQuestionarrier=[],$scope.medicalInfo.dieaseDetails=[],$scope.medicalQuestionarrie=[],$scope.nationalityList={},$scope.appointeeRelList={},$scope.nomineeRelList={},$scope.occupationList={},$scope.personalDetails={},$scope.proposerDetails={},$scope.assuranceInfo={},$scope.assuranceDetails={},$scope.addressDetails={},$scope.addressDetails.communicationAddress={},$scope.addressDetails.isAddressSameAsCommun=!0,$scope.permanentAddressDetails={},$scope.nominationDetails={},$scope.nominationDetails.nomineeAddressDetails={},$scope.nominationDetails.appointeeDetails={},$scope.nominationDetails.isNomineeAddressSameAsCommun=!0,$scope.previousPolicyDetails={},$scope.previousPolicyDetails.isPreviousPol="false",$scope.previousPolicyDetails.kotakPolicy="false",$scope.previousPolicyDetails.otherThanKotakPrevPol="false",$scope.previousPolicyDetails.PolicyDeclined="false",$scope.nominationInfo={},$scope.appointeeInfo={},$scope.insuranceInfo={},$scope.insuranceDetails={},$scope.lifeProposeFormCookieDetails={},$scope.authenticate={},$scope.selectedDiseaseList=[],$scope.selectedJobsList=[],$scope.jobsList=[],$scope.selectedJob={},$scope.jobsInfo.jobsDetails=[],$scope.showSublist="",$scope.regex=/^[\w'\-\,\#\/\"]+[\w'\-\,\s\.\#\/\"]*[\w'\-\,\.\#\/\"]+$/;$scope.screenOneStatus=!0,$scope.screenTwoStatus=!1,$scope.screenThreeStatus=!1,$scope.screenFourStatus=!1,$scope.screenFiverStatus=!1,$scope.previousPolicyStatus=!0,$scope.redirectForPayment=!1,$scope.frequencyListLife=[{label:"Occasionally"},{label:"Daily"},{label:"Per Week"}],$scope.durationListLife=[{label:" < 1 year"},{label:"1-3 years"},{label:"> 5 years"}];$scope.lifePersonalInformation=localStorageService.get("lifePersonalDetails"),$scope.marrital=maritalStatusListGeneric,$scope.proposerDetails.marrital=$scope.marrital[0].name,$scope.annualIncomeList=annualIncomesGeneric,$scope.gender=[{label:"Male",value:"M"},{label:"Female",value:"F"}],$scope.carrierStaff=yesNoStatusGeneric,$scope.qualificationList=kotakEducationList,localStorageService.get("professionalQuoteParams")&&localStorageService.get("professionalQuoteParams").commonInfo?$scope.commonInfo=localStorageService.get("professionalQuoteParams").commonInfo:localStorageService.get("quoteUserInfo")&&($scope.commonInfo=localStorageService.get("quoteUserInfo"),$scope.commonInfo.salutation="Female"==$scope.proposerDetails.gender?"Miss":"Mr");var quoteUserInfo=localStorageService.get("quoteUserInfo"),buyScreens=localStorageService.get("buyScreen");if($scope.selectedProduct=localStorageService.get("lifeSelectedProduct"),$scope.selectedProductInputParam=localStorageService.get("lifeQuoteInputParamaters"),$scope.addOnCovers=localStorageService.get("addOnCoverListForLife"),$scope.lifeInfo=localStorageService.get("lifePersonalDetails"),$scope.ownerDetailsTemplate=$sce.trustAsHtml(buyScreens.templates[0].template),$scope.prevPolicyDetailsTemplate=$sce.trustAsHtml(buyScreens.templates[2].template),$scope.productValidation=buyScreens.validation,$scope.redirectSuccessUrl=buyScreens.redirectSuccessUrl,$scope.redirectFailureUrl=buyScreens.redirectFailureUrl,$scope.requestFormat=buyScreens.requestFormat,$scope.transactionName=buyScreens.transaction.proposalService.name,$scope.paymentURL=buyScreens.paymentUrl,$scope.proposerDetails.dateOfBirth=$scope.selectedProductInputParam.personalDetails.dateOfBirth,"M"==$scope.selectedProductInputParam.quoteParam.gender?($scope.proposerDetails.gender="Male",$scope.proposerDetails.salutation="Mr",$scope.commonInfo&&($scope.commonInfo.salutation="Mr")):($scope.proposerDetails.gender="Female",$scope.proposerDetails.salutation="Mrs",$scope.commonInfo&&($scope.commonInfo.salutation="Miss")),$scope.showJobsDiscription=function(job){},$scope.prePopulateProposerDetails=function(){$scope.storedDOB=angular.copy($scope.selectedProductInputParam.personalDetails.dateOfBirth),$scope.genderDefault=angular.copy($scope.proposerDetails.gender),$scope.selectedProductInputParam.quoteParam.gender,$scope.storedGENDER=angular.copy($scope.proposerDetails.gender),$scope.medicalInfo.medicalQuestionarrier=$scope.medicalQuestionarrie,$scope.assuranceDetails.isPersonAddressSameAsCommun=!0},$scope.prePopulateProposerDetails(),quoteUserInfo&&($scope.proposerDetails.emailId="undefined"!==String(quoteUserInfo.emailId)?quoteUserInfo.emailId:"",$scope.proposerDetails.mobileNumber="undefined"!==String(quoteUserInfo.mobileNumber)?quoteUserInfo.mobileNumber:"",$scope.proposerDetails.lastName="undefined"!==String(quoteUserInfo.lastName)?quoteUserInfo.lastName:"",$scope.proposerDetails.firstName="undefined"!==String(quoteUserInfo.firstName)?quoteUserInfo.firstName:""),$scope.riderStatus=!1,null!=$scope.selectedProduct.ridersList&&"undefined"!=String($scope.selectedProduct.ridersList))for(var i=0;i<$scope.selectedProduct.ridersList.length;i++)null!=$scope.selectedProduct.ridersList[i].riderValue&&($scope.riderStatus=!0,delete $scope.selectedProduct.ridersList[i].$$hashKey);$scope.calcDefaultAreaDetails=function(areaCode){if(null!=areaCode&&String(areaCode)!=$scope.p365Labels.errorMessage.undefinedError&&String(areaCode).length>0){var docType=$scope.p365Labels.documentType.cityDetails,carrierId=$scope.selectedProduct.carrierId;$http.get(getSearchServiceLink+docType+"&q="+areaCode+"&id="+carrierId).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.p365Labels.responseCode.success&&$scope.onSelectPinOrAreaComm(areaDetails.data[0])})}},$scope.calcNomineeDefaultAreaDetails=function(areaCode){if(null!=areaCode&&String(areaCode)!=$scope.p365Labels.errorMessage.undefinedError&&String(areaCode).length>0){var docType=$scope.p365Labels.documentType.cityDetails,carrierId=$scope.selectedProduct.carrierId;$http.get(getSearchServiceLink+docType+"&q="+areaCode+"&id="+carrierId).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.p365Labels.responseCode.success&&$scope.onSelectPinOrAreaNomineeComm(areaDetails.data[0])})}},$scope.calcDefaultPermAreaDetails=function(areaCode){if(null!=areaCode&&String(areaCode)!=$scope.p365Labels.errorMessage.undefinedError&&String(areaCode).length>0){var docType=$scope.p365Labels.documentType.cityDetails,carrierId=$scope.selectedProduct.carrierId;$http.get(getSearchServiceLink+docType+"&q="+areaCode+"&id="+carrierId).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.p365Labels.responseCode.success&&$scope.onSelectPinOrAreaPerm(areaDetails.data[0])})}},$scope.calcDefaultAppointeeAreaDetails=function(areaCode){if(null!=areaCode&&String(areaCode)!=$scope.p365Labels.errorMessage.undefinedError&&String(areaCode).length>0){var docType=$scope.p365Labels.documentType.cityDetails,carrierId=$scope.selectedProduct.carrierId;$http.get(getSearchServiceLink+docType+"&q="+areaCode+"&id="+carrierId).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.p365Labels.responseCode.success&&$scope.onSelectPinOrAreaAppointeeComm(areaDetails.data[0])})}},localStorageService.get("commAddressDetails")&&($scope.addressDetails.communicationAddress=localStorageService.get("commAddressDetails"),$scope.calcDefaultAreaDetails($scope.addressDetails.communicationAddress.pincode)),localStorageService.get("parmAddressDetails")&&($scope.permanentAddressDetails=localStorageService.get("parmAddressDetails"),$scope.addressDetails.isAddressSameAsCommun=!1),$scope.hideModal=function(){$scope.modalOTP=!1,$scope.proceedPaymentStatus=!0,$scope.authenticate.enteredOTP=""},$scope.hideModalError=function(){$scope.modalOTPError=!1},$scope.resendOTP=function(){var validateAuthParam={paramMap:{}};validateAuthParam.mobileNumber=$scope.proposerDetails.mobileNumber,validateAuthParam.funcType=$scope.p365Labels.functionType.optAuth,validateAuthParam.paramMap.OTP=$scope.p365Labels.functionType.otpGenerate,sessionIDvar&&(validateAuthParam.sessionId=sessionIDvar),getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.sendSMS,validateAuthParam,function(createOTP){createOTP.responseCode==$scope.p365Labels.responseCode.success?$scope.invalidOTPError="":$scope.invalidOTPError=$scope.p365Labels.errorMessage.createOTP})};var proposerDOBOption={};proposerDOBOption.minimumYearLimit="-"+$scope.productValidation.proposerAgeMax.age+"Y",proposerDOBOption.maximumYearLimit="-"+$scope.productValidation.proposerAgeMin.age+"Y",proposerDOBOption.changeMonth=!0,proposerDOBOption.changeYear=!0,proposerDOBOption.dateFormat="dd/mm/yy",$scope.proposerDOBOptions=setP365DatePickerProperties(proposerDOBOption);var nomineeDOBOption={maximumYearLimit:"-1Y",changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy"};$scope.nomineeDOBOptions=setP365DatePickerProperties(nomineeDOBOption);var appointeeDOBOption={maximumYearLimit:"-18Y",changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy"};$scope.appointeeDOBOptions=setP365DatePickerProperties(appointeeDOBOption),$scope.onSelectVehiclePinOrArea=function(item){$scope.assuranceDetails.registrationAddress=item,$scope.displayArea=item.area+", "+item.city,$scope.assuranceDetails.area=item.area,$scope.assuranceDetails.pincode=item.pincode,$scope.assuranceDetails.city=item.city,$scope.assuranceDetails.state=item.state,$scope.loadPlaceholder(),localStorageService.set("regGeoDetails",item)},$scope.getPinCodeAreaList=function(searchValue){var docType=$scope.p365Labels.documentType.cityDetails,carrierId=$scope.selectedProduct.carrierId;return $http.get(getSearchServiceLink+docType+"&q="+searchValue+"&id="+carrierId).then(function(response){return JSON.parse(response.data).data})},$scope.loadPlaceholder=function(){setTimeout(function(){$(".buyform-control").on("focus blur",function(e){$(this).parents(".buyform-group").toggleClass("focusedInput","focus"===e.type||this.value.length>0)}).trigger("blur")},100)},$scope.onSelectPinOrAreaComm=function(item){$scope.addressDetails.communicationAddress.stateCode=item.stateCode,$scope.addressDetails.communicationAddress.state=item.state,$scope.addressDetails.communicationAddress.cityCode=item.cityCode,$scope.addressDetails.communicationAddress.city=item.city,$scope.addressDetails.communicationAddress.pincode=item.pincode,$scope.addressDetails.communicationAddress.address=item.displayField,$scope.loadPlaceholder(),$scope.addressDetails.communicationAddress.address&&(item.displayArea=$scope.addressDetails.communicationAddress.address),localStorageService.set("commAddressDetails",item)},$scope.onSelectPinOrAreaPerm=function(item){$scope.permanentAddressDetails.stateCode=item.stateCode,$scope.permanentAddressDetails.state=item.state,$scope.permanentAddressDetails.cityCode=item.cityCode,$scope.permanentAddressDetails.city=item.city,$scope.permanentAddressDetails.pincode=item.pincode,$scope.permanentAddressDetails.address=item.displayField,localStorageService.set("parmAddressDetails",item)},$scope.onSelectPinOrAreaNomineeComm=function(item){$scope.nominationDetails.nomineeAddressDetails.stateCode=item.stateCode,$scope.nominationDetails.nomineeAddressDetails.state=item.state,$scope.nominationDetails.nomineeAddressDetails.cityCode=item.cityCode,$scope.nominationDetails.nomineeAddressDetails.city=item.city,$scope.nominationDetails.nomineeAddressDetails.pincode=item.pincode,$scope.loadPlaceholder()},$scope.onSelectPinOrAreaAppointeeComm=function(item){$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.stateCode=item.stateCode,$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.state=item.state,$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.cityCode=item.cityCode,$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.city=item.city,$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.pincode=item.pincode},$scope.changeOccupation=function(){},$scope.changeIncome=function(){},$scope.calcHeight=function(){$scope.proposerDetails.heightInFeet=Number($scope.proposerDetails.heightInCM)/30.48},$scope.changeStaff=function(){"Yes"==$scope.proposerDetails.StaffStatus?$scope.staffFlag=!0:($scope.staffFlag=!1,$scope.proposerDetails.staffCode="")},$scope.changeGender=function(){"Male"==$scope.proposerDetails.gender||"Other"==$scope.proposerDetails.gender?($scope.proposerDetails.salutation="Mr",$scope.commonInfo&&($scope.commonInfo.salutation="Mr")):($scope.proposerDetails.salutation="Mrs",$scope.commonInfo&&($scope.commonInfo.salutation="Miss")),$scope.recalculateProposerGender()},$scope.changeNationality=function(){"Other"==$scope.proposerDetails.nationalityStatus?$scope.nationalityFlag=!0:($scope.nationalityFlag=!1,$scope.proposerDetails.otherNationality="")},$scope.changeNationalityOther=function(){},$scope.resetCommunicationAddress=function(){String($scope.addressDetails.communicationAddress.address)!=$scope.p365Labels.errorMessage.undefinedError&&0!=$scope.addressDetails.communicationAddress.address.length||($scope.addressDetails.communicationAddress.pincode=EMPTY,$scope.addressDetails.communicationAddress.state=EMPTY,$scope.addressDetails.communicationAddress.city=EMPTY)},$scope.resetNomineeCommunicationAddress=function(){String($scope.nominationDetails.nomineeAddressDetails.address)!=$scope.p365Labels.errorMessage.undefinedError&&0!=$scope.nominationDetails.nomineeAddressDetails.address.length||($scope.nominationDetails.nomineeAddressDetails.pincode=EMPTY,$scope.nominationDetails.nomineeAddressDetails.state=EMPTY,$scope.nominationDetails.nomineeAddressDetails.city=EMPTY)},$scope.resetAppointeeAddress=function(){String($scope.nominationDetails.appointeeDetails.appointeeAddressDetails.address)!=$scope.p365Labels.errorMessage.undefinedError&&0!=$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.address.length||($scope.nominationDetails.appointeeDetails.appointeeAddressDetails.pincode=EMPTY,$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.state=EMPTY,$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.city=EMPTY)},$scope.resetPermanentAddress=function(){String($scope.permanentAddressDetails.address)!=$scope.p365Labels.errorMessage.undefinedError&&0!=$scope.permanentAddressDetails.address.length||($scope.permanentAddressDetails.pincode=EMPTY,$scope.permanentAddressDetails.state=EMPTY,$scope.permanentAddressDetails.city=EMPTY)},$scope.changePermanentAddress=function(){$scope.addressDetails.isAddressSameAsCommun?($scope.permanentAddressDetails=$scope.addressDetails.communicationAddress,$scope.addressDetails.isAddressSameAsCommun=!0):($scope.permanentAddressDetails={},$scope.addressDetails.isAddressSameAsCommun=!1),$scope.addressDetails.permanentAddress=$scope.permanentAddressDetails},$scope.$watch("addressDetails.communicationAddress.doorNo",function(newValue){$scope.addressDetails.isAddressSameAsCommun&&$scope.changePermanentAddress()}),$scope.$watch("addressDetails.communicationAddress.address",function(newValue){$scope.addressDetails.isAddressSameAsCommun&&$scope.changePermanentAddress()}),$scope.changeNomineeAddress=function(isNomineeAddressSameAsCommun){isNomineeAddressSameAsCommun?($scope.nominationDetails.nomineeAddressDetails=$scope.addressDetails.communicationAddress,$scope.nominationDetails.isNomineeAddressSameAsCommun=!0):($scope.nominationDetails.nomineeAddressDetails={},$scope.nominationDetails.isNomineeAddressSameAsCommun=!1)},$scope.changeAppointeeAddress=function(isAppointeeAddressSameAsCommun){isAppointeeAddressSameAsCommun?($scope.nominationDetails.appointeeDetails.appointeeAddressDetails=$scope.addressDetails.communicationAddress,$scope.nominationDetails.appointeeDetails.isAppointeeAddressSameAsCommun=!0):($scope.nominationDetails.appointeeDetails.appointeeAddressDetails={},$scope.nominationDetails.appointeeDetails.isAppointeeAddressSameAsCommun=!1)},$scope.calculateProposerAge=function(){$scope.proposerDetails.personAge=getAgeFromDOB($scope.proposerDetails.dateOfBirth),$scope.selectedProductInputParam.personalDetails.dateOfBirth=$scope.proposerDetails.dateOfBirth,$scope.selectedProductInputParam.quoteParam.age=parseInt(getAgeFromDOB($scope.proposerDetails.dateOfBirth)),$scope.calculateMaturityAgeGap(),$scope.recalculateProposerAge()},$scope.calculateMaturityAgeGap=function(){$scope.selectedProductInputParam.quoteParam.age>35?$scope.selectedProductInputParam.personalDetails.maturityAge=lifematurityAgeConstant:$scope.selectedProductInputParam.personalDetails.maturityAge=$scope.selectedProductInputParam.quoteParam.age+40},$scope.backToResultScreen=function(){$location.path("/lifeResult")},$scope.validateQuestions=function(){$scope.showPreviouspolErrMsg=!1,"true"==$scope.previousPolicyDetails.isPreviousPol&&("false"==$scope.previousPolicyDetails.otherThanKotakPrevPol&&"false"==$scope.previousPolicyDetails.kotakPolicy?$scope.showPreviouspolErrMsg=!0:"false"==$scope.previousPolicyDetails.otherThanKotakPrevPol||"true"==$scope.previousPolicyDetails.kotakPolicy?$scope.showPreviouspolErrMsg=!1:"true"!=$scope.previousPolicyDetails.otherThanKotakPrevPol&&"false"!=$scope.previousPolicyDetails.kotakPolicy||($scope.showPreviouspolErrMsg=!1))},$scope.showAuthenticateForm=function(){var validateAuthParam={paramMap:{}};validateAuthParam.mobileNumber=$scope.proposerDetails.mobileNumber,validateAuthParam.funcType=$scope.p365Labels.functionType.optAuth,validateAuthParam.paramMap.OTP=$scope.p365Labels.functionType.otpGenerate,sessionIDvar&&(validateAuthParam.sessionId=sessionIDvar),getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.sendSMS,validateAuthParam,function(createOTP){createOTP.responseCode==$scope.p365Labels.responseCode.success?($scope.createOTPError="",$scope.modalOTP=!0):createOTP.responseCode==$scope.p365Labels.responseCode.blockedMobile?($scope.createOTPError=createOTP.message,$scope.modalOTPError=!0):($scope.createOTPError=$scope.p365Labels.errorMessage.createOTP,$scope.modalOTPError=!0)})},$scope.validateProposerDateOfBirth=function(){if("undefined"!==String($scope.proposerDetails.dateOfBirth)){var proposerAge=getAgeFromDOB($scope.proposerDetails.dateOfBirth);isNaN(proposerAge)?($scope.proposerDetails.dateOfBirth=void 0,$scope.proposerDateOfBirthError=$scope.productValidation.messages.dateOfBirthInvalid):proposerAge<$scope.productValidation.proposerDateOfBirthMinLimit?($scope.proposerDetails.dateOfBirth=void 0,$scope.proposerDateOfBirthError=$scope.productValidation.messages.proposerDateOfBirthErrorOne.replace("MIN_AGE_LIMIT",$scope.productValidation.proposerDateOfBirthMinLimit)):proposerAge>$scope.productValidation.proposerDateOfBirthMaxLimit?($scope.proposerDetails.dateOfBirth=void 0,$scope.proposerDateOfBirthError=$scope.productValidation.messages.proposerDateOfBirthErrorTwo.replace("MAX_AGE_LIMIT",$scope.productValidation.proposerDateOfBirthMaxLimit)):($scope.loadPlaceholder(),$scope.proposerAgeValue(proposorAge),$scope.proposerDateOfBirthError="")}else $scope.proposerDetails.dateOfBirth=void 0,$scope.proposerDateOfBirthError=$scope.productValidation.messages.dateOfBirthInvalid},$scope.changePurchasedLoan=function(){"No"==$scope.assuranceDetails.purchasedLoan&&($scope.assuranceDetails.financeInstitution=""),$scope.loadPlaceholder()},$scope.validateNomineeDateOfBirth=function(){$scope.nominationDetails.personAge=getAgeFromDOB($scope.nominationDetails.dateOfBirth),$scope.nominationDetails.personAge<18?($scope.nominationDetails.appointeeStatus=!0,$scope.nomineeRelationList=buyScreenMinorNomineeRealtion,$scope.loadPlaceholder(),$scope.appointeeRelationList=buyScreenAppointeeRelation,$scope.nominationDetails.appointeeDetails.isAppointeeAddressSameAsCommun=!0,$scope.nominationDetails.appointeeDetails.isAppointeeAddressSameAsCommun&&($scope.nominationDetails.appointeeDetails.appointeeAddressDetails=$scope.addressDetails.communicationAddress)):($scope.nominationDetails.appointeeStatus=!1,$scope.nomineeRelationList=buyScreenNotMinorNomineeRealtion,$scope.appointeeRelationList=buyScreenAppointeeRelation,$scope.nominationDetails.appointeeDetails={})},$scope.validateAppointeeDateOfBirth=function(){$scope.nominationDetails.appointeeDetails.personAge=getAgeFromDOB($scope.nominationDetails.appointeeDetails.dateOfBirth),$scope.nominationDetails.appointeeDetails.personAge<18?($scope.nominationDetails.appointeeDetails.dateOfBirth=void 0,$scope.appointeeDateOfBirthError=$scope.productValidation.messages.dateOfBirthInvalid):($scope.loadPlaceholder(),$scope.appointeeDateOfBirthError="")},$scope.validatePolicyStartDate=function(){if("undefined"!==String($scope.insuranceDetails.policyStartDate)){var todayDate=new Date,polStartDate=$scope.insuranceDetails.policyStartDate.split("/"),tempPolStartDate=polStartDate[1]+"/"+polStartDate[0]+"/"+polStartDate[2],regDate=$scope.selectedProductInputParam.assuranceInfo.dateOfRegistration.split("/"),tempRegDate=regDate[1]+"/"+regDate[0]+"/"+regDate[2],futureDate=new Date(tempRegDate.setDate(tempRegDate.getDate()+Number($scope.productValidation.policyStartDateLimit)));if(new Date(tempPolStartDate).setHours(0,0,0,0)<todayDate.setHours(0,0,0,0))$scope.insuranceDetails.policyStartDate=void 0,$scope.insuranceDetails.policyEndDate=void 0,$scope.policyStartDateError=$scope.productValidation.messages.policyStartDateInvalidOne;else if(new Date(tempPolStartDate).setHours(0,0,0,0)<new Date(tempRegDate).setHours(0,0,0,0)){$scope.insuranceDetails.policyStartDate=void 0,$scope.insuranceDetails.policyEndDate=void 0;var dispRegistrationDate=regDate[0]+"-"+monthListGeneric[Number(regDate[1])]+"-"+regDate[2];$scope.policyStartDateError=$scope.productValidation.messages.policyStartDateInvalidTwo.replace("DISP_REGISTRATION_DATE",dispRegistrationDate)}else if(new Date(tempPolStartDate).setHours(0,0,0,0)>futureDate.setHours(0,0,0,0)){$scope.insuranceDetails.policyStartDate=void 0,$scope.insuranceDetails.policyEndDate=void 0;var dispFutureDate=futureDate.getDate()+"-"+monthListGeneric[Number(futureDate.getMonth())]+"-"+futureDate.getFullYear();$scope.policyStartDateError=$scope.productValidation.messages.policyStartDateInvalidThree.replace("DISP_FUTURE_DATE",dispFutureDate)}else{var polEndDate=new Date(new Date(String(tempPolStartDate)).setFullYear(new Date(tempPolStartDate).getFullYear()+1)),tempPolEndDate=new Date(polEndDate.setDate(polEndDate.getDate()-1));$scope.insuranceDetails.policyEndDate=tempPolEndDate.getDate()+"/"+(Number(tempPolEndDate.getMonth())+1)+"/"+tempPolEndDate.getFullYear(),$scope.policyStartDateError="",$scope.loadPlaceholder()}}},$scope.accordion="1",$scope.editPesonalInfo=function(){$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!1,$scope.accordion="1"},$scope.editAddressInfo=function(){$scope.screenOneStatus=!1,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!1,$scope.accordion="2"},$scope.editMedicalInfo=function(){$scope.screenOneStatus=!1,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.accordion="3"},$scope.editNomineeInfo=function(){$scope.screenOneStatus=!1,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!0,$scope.accordion="4"},$scope.Section2Inactive=!0,$scope.Section3Inactive=!0,$scope.Section4Inactive=!0,$scope.Section5Inactive=!0,$scope.submitPersonalDetails=function(){$scope.screenTwoStatus=!0,$scope.Section2Inactive=!1,$scope.accordion="2",$scope.lifeProposeFormCookieDetails.proposerDetails=$scope.proposerDetails,1==imauticAutomation&&imatEvent("ProposalFilled")},$scope.submitAddressDetails=function(){$scope.screenThreeStatus=!0,$scope.Section3Inactive=!1,$scope.accordion="3",$scope.lifeProposeFormCookieDetails.proposerDetails=$scope.proposerDetails,$scope.nominationDetails.isNomineeAddressSameAsCommun&&($scope.nominationDetails.nomineeAddressDetails=$scope.addressDetails.communicationAddress,$scope.nominationDetails.isNomineeAddressSameAsCommun=!0)},$scope.submitNomineeDetails=function(){$scope.screenFiveStatus=!0,$scope.Section5Inactive=!1,$scope.accordion="5"},$scope.checkJob=function(){for(var flag=!0,i=0;i<$scope.jobsInfo.jobsDetails.length;i++)void 0!==$scope.jobsInfo.jobsDetails[i].applicable&&1==$scope.jobsInfo.jobsDetails[i].applicable&&(flag=!1);return flag},$scope.showDesc=!0,$scope.validateJobIfNotNone=function(){$scope.showDesc=!0;for(var i=0;i<$scope.jobsInfo.jobsDetails.length;i++)"NONE"==$scope.jobsInfo.jobsDetails[i].jobCode&&($scope.jobsInfo.jobsDetails[i].applicable=!1)},$scope.validateJobIfNone=function(){$scope.showDesc=!1;for(var i=0;i<$scope.jobsInfo.jobsDetails.length;i++)"NONE"!=$scope.jobsInfo.jobsDetails[i].jobCode&&($scope.jobsInfo.jobsDetails[i].applicable=!1)},$scope.checkDisease=function(questionCode){for(var flag=!0,i=0;i<$scope.medicalInfo.dieaseDetails.length;i++)$scope.medicalInfo.dieaseDetails[i]&&$scope.medicalInfo.dieaseDetails[i].questionCode==questionCode&&$scope.medicalInfo.dieaseDetails[i].applicable&&(flag=!1);return flag},$scope.displayIfNotNone=function(){angular.forEach($scope.medicalInfo.dieaseDetails,function(element){"FAMDISEASE"==element.questionCode&&"none_fam"==element.masterDiseaseCode&&(element.applicable=!1)})},$scope.displayIfNone=function(){angular.forEach($scope.medicalInfo.dieaseDetails,function(element){"FAMDISEASE"==element.questionCode&&"none_fam"!=element.masterDiseaseCode&&(element.applicable=!1)})},$scope.submitMedicalDetails=function(obj){$scope.screenFourStatus=!0,$scope.Section4Inactive=!1,$scope.accordion="4",$scope.proceedPaymentStatus=!0};var occupationDocId=$scope.p365Labels.documentType.lifeOccupation+"-"+$scope.selectedProduct.carrierId;getDocUsingId(RestAPI,occupationDocId,function(occupationList){$scope.occupationList=occupationList.Occupation;var nomineeRelationDocId=$scope.p365Labels.documentType.lifeNomineeRelation+"-"+$scope.selectedProduct.carrierId;getDocUsingId(RestAPI,nomineeRelationDocId,function(nomineeRelationList){$scope.nomineeRelList=nomineeRelationList.NomineeRelation;var appointeeRelationDocId=$scope.p365Labels.documentType.lifeAppointeeRelation+"-"+$scope.selectedProduct.carrierId;getDocUsingId(RestAPI,appointeeRelationDocId,function(appointeeRelationList){$scope.appointeeRelList=appointeeRelationList.AppointeeRelation;var nationalityDocId=$scope.p365Labels.documentType.lifeNationality+"-"+$scope.selectedProduct.carrierId;getDocUsingId(RestAPI,nationalityDocId,function(nationalityList){$scope.nationalityList=nationalityList.Nationality;var searchData={documentType:"LifeDiseaseQuestion"};searchData.carrierId=$scope.selectedProduct.carrierId,searchData.planId=$scope.selectedProduct.productId,searchData.riders=$scope.selectedProduct.ridersList,searchData.gender=$scope.proposerDetails.gender,getDocUsingParam(RestAPI,"getHealthQuestionList",searchData,function(callback){$scope.medicalQuestionarrie=callback.data;var searchDiseaseData={documentType:"LifeDiseaseMapping"};searchDiseaseData.carrierId=$scope.selectedProduct.carrierId,searchDiseaseData.planId=$scope.selectedProduct.productId,searchDiseaseData.riders=$scope.selectedProduct.ridersList,getDocUsingParam(RestAPI,"getHealthQuestionList",searchDiseaseData,function(callback){angular.forEach(callback.data,function(element){element.applicable=!1}),$scope.diseaseList=angular.copy(callback.data),$scope.diseaseListDisable=angular.copy($scope.diseaseList);for(var i=0;i<$scope.diseaseListDisable.length;i++)$scope.diseaseListDisable[i].subParentId=$scope.diseaseListDisable[i].parentId;var searchDiseaseData={documentType:"LifeJobMapping"};searchDiseaseData.carrierId=$scope.selectedProduct.carrierId,searchDiseaseData.planId=$scope.selectedProduct.productId,searchDiseaseData.riders=$scope.selectedProduct.ridersList,getDocUsingParam(RestAPI,"getHealthQuestionList",searchDiseaseData,function(callback){$scope.jobsList=angular.copy(callback.data),$scope.jobsListCopy=angular.copy($scope.jobsList),$rootScope.loading=!1})})})})})})}),$scope.changeMaritalStatus=function(){if("SINGLE"==$scope.proposerDetails.marritalStatus)for(var i=0;i<$scope.nomineeRelList.length;i++)"Husband"==$scope.nomineeRelList[i].relationNominee&&$scope.nomineeRelList.splice(i,1),"Wife"==$scope.nomineeRelList[i].relationNominee&&$scope.nomineeRelList.splice(i,1)},$scope.changeNomineeRelation=function(relationObj){$scope.nominationDetails.nominationRelation=relationObj.relationNominee,$scope.nominationDetails.gender=relationObj.gender,$scope.personalDetails=$scope.proposerDetails},$scope.changeAppointeeRelation=function(relation){$scope.nominationDetails.appointeeDetails.appointeeRelation=relation.relationAppointee,$scope.nominationDetails.appointeeDetails.gender=relation.gender,$scope.personalDetails=$scope.proposerDetails};var quesArr=[];$rootScope.lifeRegretPolicyFlag=!1,$scope.inputTypeCheck=function(sel,quesId,mquestion){if("true"==sel){if("MULTIPLECOUNTRY"==mquestion.questionCode||"IS_NRI"==mquestion.questionCode||"IS_GREENCARDHOLDER"==mquestion.questionCode){quesArr.push(quesId);var screenCnfrmError=$scope.p365Labels.errorMessage.lifeRegretPolicyMsg;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}else quesArr.length>0&&quesArr.splice(-1,quesId);quesArr.length>0?$rootScope.lifeRegretPolicyFlag=!0:$rootScope.lifeRegretPolicyFlag=!1},$scope.clickToShowDisease=function(index){$scope.diseaseShow=!0,$scope.showSublist=index},$scope.tobacoErrorMsg=!1,$rootScope.smokingFlag=!1,$scope.clickToShowDiseaseTobacco=function(index,applicable){$scope.tobacoErrorMsg=!1,$rootScope.smokingFlag=!1,$scope.tobacoAdictedTemp="Y"==$scope.proposerDetails.tobacoAdicted?"true":"false",applicable!=$scope.tobacoAdictedTemp&&($rootScope.smokingFlag=!0,$scope.tobacoErrorMsg=!0)},$scope.getnumberOfPages=function(array){array.length<=4?$scope.numberOfPages=1:array.length<=8?$scope.numberOfPages=2:$scope.numberOfPages=Math.floor(array.length/$scope.numRecords)},$scope.clickToHideDisease=function(){$scope.diseaseShow=!1},$scope.submitDieaseList=function(){$scope.diseaseShow=!1},$scope.next=function(){$scope.page<$scope.numberOfPages&&($scope.page=$scope.page+1)},$scope.back=function(){$scope.page>$scope.numberOfPages&&($scope.page=$scope.page-1)},$scope.getOptionsArr=function(strarr){},$scope.proposalInfo=function(){$scope.lifeProposeFormDetails={},$scope.proposerDetails.panNumber="undefined"!=String($scope.proposerDetails.panNumber)?$scope.proposerDetails.panNumber.toUpperCase():"",delete $scope.selectedProduct.features,delete $scope.selectedProduct.riders,$scope.lifeProposeFormDetails.premiumDetails=$scope.selectedProduct,$scope.lifeProposeFormDetails.proposerDetails=$scope.proposerDetails,$scope.lifeProposeFormDetails.nominationDetails=$scope.nominationDetails,$scope.lifeProposeFormDetails.previousPolicyDetails=$scope.previousPolicyDetails,$scope.addressDetails.isAddressSameAsCommun&&($scope.addressDetails.permanentAddress=$scope.addressDetails.communicationAddress),$scope.lifeProposeFormDetails.addressDetails=$scope.addressDetails,$scope.lifeProposeFormDetails.medicalQuestionarrier=angular.copy($scope.medicalInfo.medicalQuestionarrier),$scope.lifeProposeFormDetails.jobsDetails=angular.copy($scope.jobsInfo.jobsDetails),$scope.lifeProposeFormDetails.dieaseDetails=angular.copy($scope.medicalInfo.dieaseDetails);for(var i=0;i<$scope.lifeProposeFormDetails.dieaseDetails.length;i++)void 0==$scope.lifeProposeFormDetails.dieaseDetails[i]&&($scope.lifeProposeFormDetails.dieaseDetails.splice(i,1),i-=1);$scope.selectedProduct.carrierUniqueId&&($scope.lifeProposeFormDetails.premiumDetails.carrierUniqueId=$scope.selectedProduct.carrierUniqueId),(0==$scope.selectedProduct.totalDiscountAmount||$scope.selectedProduct.totalDiscountAmount)&&($scope.lifeProposeFormDetails.totalDiscountAmount=$scope.selectedProduct.totalDiscountAmount),(0==$scope.selectedProduct.totalRiderAmount||$scope.selectedProduct.totalRiderAmount)&&($scope.lifeProposeFormDetails.totalRiderAmount=$scope.selectedProduct.totalRiderAmount),(0==$scope.selectedProduct.basicCoverage||$scope.selectedProduct.basicCoverage)&&($scope.lifeProposeFormDetails.basicCoverage=$scope.selectedProduct.basicCoverage),$scope.lifeProposeFormDetails.premiumDetails.userIdv=localStorageService.get("lifeQuoteInputParamaters").quoteParam.userIdv,$scope.lifeProposeFormDetails.carrierId=$scope.selectedProduct.carrierId,$scope.lifeProposeFormDetails.productId=$scope.selectedProduct.productId,$scope.lifeProposeFormDetails.requestType=$scope.p365Labels.request.lifePropRequestType},$scope.getCarrierList=function(){getListFromDB(RestAPI,"",$scope.p365Labels.documentType.lifeCarrier,$scope.p365Labels.request.findAppConfig,function(lifeCarrierList){if(lifeCarrierList.responseCode==$scope.p365Labels.responseCode.success){$scope.carrierList=lifeCarrierList.data;var docId=$scope.p365Labels.documentType.buyScreen+"-"+$scope.selectedProductInputParam.quoteParam.quoteType;getDocUsingId(RestAPI,docId,function(buyScreenTooltip){$scope.buyTooltip=buyScreenTooltip.toolTips,$scope.getRelationshipList(),$rootScope.loading=!1})}else $rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.serverError,"Ok")})},$scope.recalculateProposerGender=function(){"undefined"==$scope.storedGENDER&&null==$scope.storedGENDER||("Male"==$scope.proposerDetails.gender||"Other"==$scope.proposerDetails.gender?($scope.genderMorF="M",$scope.selectedProductInputParam.quoteParam.gender=$scope.genderMorF):($scope.genderMorF="F",$scope.selectedProductInputParam.quoteParam.gender=$scope.genderMorF),$scope.storedGENDER!=$scope.proposerDetails.gender?$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.genderChangeMsg,"No","Yes",function(confirmStatus){confirmStatus?($scope.loading=!0,$scope.selectedProductInputParam.quoteParam.policyTerm=$scope.selectedProductInputParam.personalDetails.maturityAge-$scope.selectedProductInputParam.quoteParam.age,localStorageService.get("PROF_QUOTE_ID")&&($scope.selectedProductInputParam.PROF_QUOTE_ID=localStorageService.get("PROF_QUOTE_ID")),RestAPI.invoke($scope.p365Labels.getRequest.quoteLife,$scope.selectedProductInputParam).then(function(callback){if($scope.lifeRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success)$scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("LIFE_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.lifeRecalculateQuoteRequest=callback.data,$scope.lifeQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.lifeRecalculateQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=$scope.p365Labels.transactionName.lifeQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var lifeQuoteResponse=JSON.parse(callback);if(lifeQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=lifeQuoteResponse.data&&lifeQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&lifeQuoteResponse.data.quotes[0].productId==$scope.selectedProduct.productId&&($scope.selectedProduct.annualPremium=lifeQuoteResponse.data.quotes[0].annualPremium,$scope.selectedProduct.monthlyFinalPremium=lifeQuoteResponse.data.quotes[0].monthlyFinalPremium,$scope.selectedProduct.basicPremium=lifeQuoteResponse.data.quotes[0].basicPremium,$scope.selectedProduct.monthlyBasePremium=lifeQuoteResponse.data.quotes[0].monthlyBasePremium,$scope.selectedProduct.serviceTax=lifeQuoteResponse.data.quotes[0].sericeTax,$scope.selectedProduct.sumInsured=lifeQuoteResponse.data.quotes[0].sumInsured,$scope.selectedProduct.adjustedPremium=lifeQuoteResponse.data.quotes[0].adjustedPremium,$scope.loading=!1),lifeQuoteResponse.data.quotes[0].id=lifeQuoteResponse.messageId,$scope.quoteCalcResponse.push(lifeQuoteResponse.data.quotes[0]);else if(null!=lifeQuoteResponse.data&&lifeQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&lifeQuoteResponse.data.quotes[0].productId==$scope.selectedProduct.productId){$scope.loading=!1;var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsg;$rootScope.P365Alert($scope.p365Labels.common.p365prompt,screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})});else{$scope.loading=!1,$scope.proposerDetails.gender=$scope.storedGENDER;var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgDob;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}),$scope.storedGENDER=$scope.proposerDetails.gender,$scope.proposerDetails.gender=$scope.storedGENDER,$scope.commonInfo&&($scope.commonInfo.salutation="Female"==$scope.proposerDetails.gender?"Miss":"Mr")):($scope.loading=!1,$scope.proposerDetails.gender=$scope.storedGENDER,$scope.storedGENDER=$scope.proposerDetails.gender,$scope.commonInfo&&($scope.commonInfo.salutation="Female"==$scope.proposerDetails.gender?"Miss":"Mr"))}):($scope.loading=!1,$scope.proposerDetails.gender=$scope.storedGENDER,$scope.storedGENDER=$scope.proposerDetails.gender))},$scope.recalculateProposerAge=function(){"undefined"==String($scope.storedDOB)&&null==$scope.storedDOB||($scope.storedDOB!=$scope.proposerDetails.dateOfBirth?$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.DobChangeMsg,"No","Yes",function(confirmStatus){confirmStatus?($scope.loading=!0,$scope.selectedProductInputParam.quoteParam.policyTerm=$scope.selectedProductInputParam.personalDetails.maturityAge-$scope.selectedProductInputParam.quoteParam.age,localStorageService.get("PROF_QUOTE_ID")&&($scope.selectedProductInputParam.PROF_QUOTE_ID=localStorageService.get("PROF_QUOTE_ID")),RestAPI.invoke($scope.p365Labels.getRequest.quoteLife,$scope.selectedProductInputParam).then(function(callback){if($scope.lifeRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success)$scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("LIFE_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.lifeRecalculateQuoteRequest=callback.data,$scope.lifeQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.lifeRecalculateQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=$scope.p365Labels.transactionName.lifeQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var lifeQuoteResponse=JSON.parse(callback);if(lifeQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=lifeQuoteResponse.data&&lifeQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&lifeQuoteResponse.data.quotes[0].productId==$scope.selectedProduct.productId&&("Monthly Premium"==$scope.selectedProduct.premiumTypeMonthOrAnnual?($scope.selectedProduct.monthlyFinalPremium=lifeQuoteResponse.data.quotes[0].monthlyFinalPremium,$scope.selectedProduct.annualPremium=lifeQuoteResponse.data.quotes[0].annualPremium):($scope.selectedProduct.annualPremium=lifeQuoteResponse.data.quotes[0].annualPremium,$scope.selectedProduct.monthlyFinalPremium=lifeQuoteResponse.data.quotes[0].monthlyFinalPremium),$scope.selectedProduct.basicPremium=lifeQuoteResponse.data.quotes[0].basicPremium,$scope.selectedProduct.monthlyBasePremium=lifeQuoteResponse.data.quotes[0].monthlyBasePremium,$scope.selectedProduct.serviceTax=lifeQuoteResponse.data.quotes[0].sericeTax,$scope.selectedProduct.sumInsured=lifeQuoteResponse.data.quotes[0].sumInsured,$scope.selectedProduct.adjustedPremium=lifeQuoteResponse.data.quotes[0].adjustedPremium,$scope.loading=!1),lifeQuoteResponse.data.quotes[0].id=lifeQuoteResponse.messageId,$scope.quoteCalcResponse.push(lifeQuoteResponse.data.quotes[0]);else if(null!=lifeQuoteResponse.data&&lifeQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&lifeQuoteResponse.data.quotes[0].productId==$scope.selectedProduct.productId){$scope.loading=!1;var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsg;$rootScope.P365Alert($scope.p365Labels.common.p365prompt,screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})});else{$scope.loading=!1,$scope.proposerDetails.dateOfBirth="";var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgDob;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}),$scope.storedDOB=$scope.proposerDetails.dateOfBirth,$scope.proposerDetails.dateOfBirth=$scope.storedDOB):($scope.loading=!1,$scope.proposerDetails.dateOfBirth=$scope.storedDOB,$scope.storedDOB=$scope.proposerDetails.dateOfBirth)}):($scope.loading=!1,$scope.proposerDetails.dateOfBirth=$scope.storedDOB,$scope.storedDOB=$scope.proposerDetails.dateOfBirth))},$scope.submitProposalData=function(selectedPolicyDetails){if($scope.proposalInfo(),$scope.lifeProposeFormDetails.QUOTE_ID=localStorageService.get("LIFE_UNIQUE_QUOTE_ID"),$scope.lifeProposeFormDetails.businessLineId=$scope.p365Labels.businessLineType.life,$scope.lifeProposeFormDetails.carrierProposalStatus=!1,$scope.lifeProposeFormDetails.baseEnvStatus=baseEnvEnabled,$scope.loading=!0,$rootScope.agencyPortalEnabled){const localdata=JSON.parse(localStorage.getItem("finalLocalStorage"));$scope.lifeProposeFormDetails.requestSource=requestSource,$scope.lifeProposeFormDetails.userName=localdata.username,$scope.lifeProposeFormDetails.agencyId=localdata.agencyId}$scope.lifeProposeFormDetails.QUOTE_ID?RestAPI.invoke($scope.transactionName,$scope.lifeProposeFormDetails).then(function(proposeFormResponse){if(proposeFormResponse.responseCode==$scope.p365Labels.responseCode.success)if($scope.encryptedProposalId=proposeFormResponse.data.encryptedProposalId,localStorageService.set("proposalIdEncrypted",$scope.encryptedProposalId),$scope.proposalId=proposeFormResponse.proposalId,$scope.responseToken=proposeFormResponse.data,$scope.responseToken.paymentGateway=$scope.paymentURL,$scope.responseToken.businessLineId=$scope.p365Labels.businessLineType.life,localStorageService.set("lifeReponseToken",$scope.responseToken),$rootScope.encryptedProposalID=$scope.encryptedProposalId,$rootScope.encryptedLOB=$scope.p365Labels.businessLineType.life,1==imauticAutomation)imatLifeProposal(localStorageService,$scope,"MakePayment"),$scope.redirectForPayment=!1,$scope.loading=!1,$scope.modalIPOS=!0;else{var body={};body.longURL=sharePaymentLink+String($rootScope.encryptedProposalID)+"&lob="+String($rootScope.encryptedLOB),$http({method:"POST",url:getShortURLLink,data:body}).success(function(shortURLResponse){if(shortURLResponse.responseCode==$scope.p365Labels.responseCode.success){var proposalDetailsEmail={paramMap:{}};proposalDetailsEmail.funcType=$scope.p365Labels.functionType.proposalDetailsTemplate,proposalDetailsEmail.username=$scope.proposerDetails.emailId.trim(),proposalDetailsEmail.isBCCRequired="Y",proposalDetailsEmail.paramMap.customerName=$scope.proposerDetails.firstName.trim()+" "+$scope.proposerDetails.lastName.trim(),proposalDetailsEmail.paramMap.selectedPolicyType=$scope.p365Labels.insuranceType.life,proposalDetailsEmail.paramMap.quoteId=localStorageService.get("LIFE_UNIQUE_QUOTE_ID"),proposalDetailsEmail.paramMap.premiumAmount=String($scope.selectedProduct.grossPremium),proposalDetailsEmail.paramMap.docId=String($scope.responseToken.encryptedProposalId),proposalDetailsEmail.paramMap.LOB=String($scope.p365Labels.businessLineType.life),proposalDetailsEmail.paramMap.url=shortURLResponse.data.shortURL,RestAPI.invoke($scope.p365Labels.transactionName.sendEmail,proposalDetailsEmail).then(function(emailResponse){emailResponse.responseCode==$scope.p365Labels.responseCode.success?($scope.redirectForPayment=!1,$scope.loading=!1,$scope.modalIPOS=!0):$rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.emailSentFailed,"Ok")})}else $rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.emailSentFailed,"Ok"),$scope.loading=!1})}else 1==imauticAutomation&&imatEvent("ProposalFailed"),$scope.loading=!1,$rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.serverError,"Ok")}):($scope.loading=!1,$rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.generalisedErrMsg,"Ok"))},$scope.hideModalIPOS=function(){$scope.modalIPOS=!1,1==$scope.redirectForPayment&&$scope.redirectToPaymentGateway()},$scope.prepopulateFields=function(){$scope.authenticate.enteredOTP="",$scope.proposerDetails.tobacoAdicted=$scope.selectedProductInputParam.quoteParam.tobacoAdicted,$scope.istobacoAddicted="Y"==$scope.proposerDetails.tobacoAdicted?"true":"false"},$scope.prepopulateFields(),$scope.redirectToPaymentGateway=function(){$scope.paymentGatewayURL&&$window.open($scope.paymentGatewayURL,"_blank")},$scope.proceedForPayment=function(){$scope.proceedPaymentStatus=!1,$scope.proposalInfo(),$scope.lifeProposeFormDetails.QUOTE_ID=localStorageService.get("LIFE_UNIQUE_QUOTE_ID"),$scope.lifeProposeFormDetails.businessLineId=$scope.p365Labels.businessLineType.life,$rootScope.wordPressEnabled?$scope.lifeProposeFormDetails.source=sourceOrigin:($scope.lifeProposeFormDetails.baseEnvStatus=baseEnvEnabled,$scope.lifeProposeFormDetails.source=sourceOrigin),localStorageService.set("lifeProposeFormDetails",$scope.lifeProposeFormDetails),$scope.lifeProposeFormDetails.QUOTE_ID?($scope.loading=!0,RestAPI.invoke($scope.transactionName,$scope.lifeProposeFormDetails).then(function(proposeFormResponse){if($scope.modalOTP=!1,$scope.authenticate.enteredOTP="",$scope.modalOTPError=!1,$scope.proceedPaymentStatus=!0,proposeFormResponse.responseCode==$scope.p365Labels.responseCode.success)$scope.encryptedProposalId=proposeFormResponse.data.encryptedProposalId,localStorageService.set("proposalIdEncrypted",$scope.encryptedProposalId),$scope.proposalId=proposeFormResponse.proposalId,proposeFormResponse.data?(1==imauticAutomation&&imatLifeProposal(localStorageService,$scope,"SubmitProposal"),$scope.loading=!1,$scope.paymentGatewayURL=proposeFormResponse.data.redirectionUrl,$scope.redirectForPayment=!0,$scope.modalIPOS=!0):console.error("URL is not available for redirection.");else if(proposeFormResponse.responseCode==$scope.p365Labels.responseCode.error)$scope.loading=!1,$rootScope.P365Alert("Error",proposeFormResponse.data,"Ok");else{$scope.loading=!1;var buyScreenCnfrmError=proposeFormResponse.responseCode+" : "+$scope.p365Labels.validationMessages.buyScreenCnfrmError.replace("INSURER_NAME",$scope.selectedProduct.insuranceCompany);$rootScope.P365Alert($scope.p365Labels.common.p365prompt,buyScreenCnfrmError,"Ok")}})):($scope.loading=!1,$scope.proceedPaymentStatus=!0,$rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.generalisedErrMsg,"Ok"))},setTimeout(function(){$(".buyform-control").on("focus blur",function(e){$(this).parents(".buyform-group").toggleClass("focusedInput","focus"===e.type||this.value.length>0)}).trigger("blur")},4e3),setTimeout(function(){$(".buyform-control").on("focus blur",function(e){$(this).parents(".buyform-group").toggleClass("focusedInput","focus"===e.type||this.value.length>0)}).trigger("blur")},500),$rootScope.signout=function(){$rootScope.userLoginStatus=!1;var userLoginInfo={username:void 0};userLoginInfo.status=$rootScope.userLoginStatus,localStorageService.set("userLoginInfo",userLoginInfo),$location.path("/quote")},$scope.$on("setCommAddressByAPI",function(){setTimeout(function(){var googleAddressObject=angular.copy($scope.chosenCommPlaceDetails);getAddressFields(googleAddressObject,function(fomattedAddress,formattedCity,formattedState,formattedPincode){$scope.addressDetails.communicationAddress.address=fomattedAddress,"undefined"!=String(formattedPincode)&&""!=formattedPincode?$scope.calcDefaultAreaDetails(formattedPincode):($scope.addressDetails.communicationAddress.pincode="",$scope.addressDetails.communicationAddress.state="",$scope.addressDetails.communicationAddress.city=""),$scope.$apply()})},10)}),$scope.$on("setRegAddressByAPI",function(){setTimeout(function(){var googleAddressObject=angular.copy($rootScope.chosenRegPlaceDetails);getAddressFields(googleAddressObject,function(fomattedAddress,formattedCity,formattedState,formattedPincode){$scope.permanentAddressDetails.address=fomattedAddress,"undefined"!=String(formattedPincode)&&""!=formattedPincode?$scope.calcDefaultPermAreaDetails(formattedPincode):($scope.permanentAddressDetails.pincode="",$scope.permanentAddressDetails.state="",$scope.permanentAddressDetails.city=""),$scope.$apply()})},10)}),$scope.$on("setNomineeAddressByAPI",function(){setTimeout(function(){var googleAddressObject=angular.copy($rootScope.chosenNomineeCommPlaceDetails);getAddressFields(googleAddressObject,function(fomattedAddress,formattedCity,formattedState,formattedPincode){$scope.nominationDetails.nomineeAddressDetails.address=fomattedAddress,"undefined"!=String(formattedPincode)&&""!=formattedPincode?$scope.calcNomineeDefaultAreaDetails(formattedPincode):($scope.nominationDetails.nomineeAddressDetails.pincode="",$scope.nominationDetails.nomineeAddressDetails.state="",$scope.nominationDetails.nomineeAddressDetails.city=""),$scope.$apply()})},10)}),$scope.$on("setAppointeeAddressByAPI",function(){setTimeout(function(){var googleAddressObject=angular.copy($rootScope.chosenAppointeePlaceDetails);getAddressFields(googleAddressObject,function(fomattedAddress,formattedCity,formattedState,formattedPincode){$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.address=fomattedAddress,"undefined"!=String(formattedPincode)&&""!=formattedPincode?$scope.calcDefaultAppointeeAreaDetails(formattedPincode):($scope.nominationDetails.appointeeDetails.appointeeAddressDetails.pincode="",$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.state="",$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.city=""),$scope.$apply()})},10)}),$(".activateFooter").hide(),$(".activateHeader").hide()}]),angular.module("proposalresdatalife",["CoreComponentApp","LocalStorageModule","checklist-model","ngMessages"]).controller("proposalResponseDataLifeController",["$scope","$rootScope","$timeout","RestAPI","localStorageService","$location","$window","$http","$filter","$sce",function($scope,$rootScope,$timeout,RestAPI,localStorageService,$location,$window,$http,$filter,$sce){$scope.loading=!0,$scope.lifeProposalSectionHTML=wp_path+"buy/life/html/LifeProposalSection.html",$scope.p365Labels=lifeProposalLabels,$rootScope.loaderContent={businessLine:"1",header:"Life Insurance",desc:$sce.trustAsHtml($scope.p365Labels.common.proverbBuyProduct)},$rootScope.title=$scope.p365Labels.policies365Title.lifeBuyQuote,$scope.isFromLMS=!0,$scope.numRecords=4,$scope.status=!1,$scope.page=1,$scope.genderMorF="",$scope.medicalInfo={},$scope.jobsInfo={},$scope.jobsInfo.tempJobDetails=[],$scope.medicalInfo.medicalQuestionarrier=[],$scope.medicalInfo.dieaseDetails=[],$scope.medicalQuestionarrie=[],$scope.nationalityList={},$scope.appointeeRelList={},$scope.nomineeRelList={},$scope.occupationList={},$scope.personalDetails={},$scope.proposerDetails={},$scope.assuranceInfo={},$scope.assuranceDetails={},$scope.addressDetails={},$scope.lifeProposalApp={},$scope.addressDetails.communicationAddress={},$scope.addressDetails.isAddressSameAsCommun=!0,$scope.permanentAddressDetails={},$scope.nominationDetails={},$scope.selectedProductInputParam={},$scope.nominationDetails.nomineeAddressDetails={},$scope.nominationDetails.appointeeDetails={},$scope.quoteCalcResponse={},$scope.quoteCalcRequest={},$scope.nominationDetails.isNomineeAddressSameAsCommun=!0,$scope.previousPolicyDetails={},$scope.previousPolicyDetails.isPreviousPol="false",$scope.previousPolicyDetails.kotakPolicy="false",$scope.previousPolicyDetails.otherThanKotakPrevPol="false",$scope.previousPolicyDetails.PolicyDeclined="false",$scope.nominationInfo={},$scope.appointeeInfo={},$scope.insuranceInfo={},$scope.insuranceDetails={},$scope.lifeProposeFormCookieDetails={},$scope.authenticate={},$scope.selectedDiseaseList=[],$scope.selectedJobsList=[],$scope.jobsList=[],$scope.selectedJob={},$scope.jobsInfo.jobsDetails=[],$scope.showSublist="",$scope.regex=/^[\w'\-\,\#\/\"]+[\w'\-\,\s\.\#\/\"]*[\w'\-\,\.\#\/\"]+$/;$scope.screenOneStatus=!0,$scope.screenTwoStatus=!1,$scope.screenThreeStatus=!1,$scope.screenFourStatus=!1,$scope.screenFiverStatus=!1,$scope.previousPolicyStatus=!0,$scope.redirectForPayment=!1,$scope.p365Labels=lifeProposalLabels,$scope.frequencyListLife=[{label:"Occasionally"},{label:"Daily"},{label:"Per Week"}],$scope.durationListLife=[{label:" < 1 year"},{label:"1-3 years"},{label:"> 5 years"}];$scope.marrital=maritalStatusListGeneric,$scope.proposerDetails.marrital=$scope.marrital[0].name,$scope.annualIncomeList=annualIncomesGeneric,$scope.gender=[{label:"Male",value:"M"},{label:"Female",value:"F"}],$scope.carrierStaff=yesNoStatusGeneric,$scope.qualificationList=kotakEducationList,$scope.accordion="1",$scope.editPesonalInfo=function(){$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!1,$scope.accordion="1"},$scope.editAddressInfo=function(){$scope.screenOneStatus=!1,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!1,$scope.accordion="2"},$scope.editMedicalInfo=function(){$scope.screenOneStatus=!1,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.accordion="3"},$scope.editNomineeInfo=function(){$scope.screenOneStatus=!1,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!0,$scope.accordion="4"},$scope.Section2Inactive=!0,$scope.Section3Inactive=!0,$scope.Section4Inactive=!0,$scope.Section5Inactive=!0,$scope.proposalDocParam={},$scope.submitPersonalDetails=function(){$scope.screenTwoStatus=!0,$scope.Section2Inactive=!1,$scope.accordion="2",$scope.lifeProposeFormCookieDetails.proposerDetails=$scope.proposerDetails,1==imauticAutomation&&imatEvent("ProposalFilled")},$scope.submitNomineeDetails=function(){$scope.screenFiveStatus=!0,$scope.Section5Inactive=!1,$scope.accordion="5"},$scope.displayIfNotNone=function(){angular.forEach($scope.medicalInfo.dieaseDetails,function(element){"FAMDISEASE"==element.questionCode&&"none_fam"==element.masterDiseaseCode&&(element.applicable=!1)})},$scope.displayIfNone=function(){angular.forEach($scope.medicalInfo.dieaseDetails,function(element){"FAMDISEASE"==element.questionCode&&"none_fam"!=element.masterDiseaseCode&&(element.applicable=!1)})},$scope.submitMedicalDetails=function(obj){$scope.screenFourStatus=!0,$scope.Section4Inactive=!1,$scope.accordion="4",$scope.proceedPaymentStatus=!0},$scope.submitAddressDetails=function(){$scope.screenThreeStatus=!0,$scope.Section3Inactive=!1,$scope.accordion="3",$scope.lifeProposeFormCookieDetails.proposerDetails=$scope.proposerDetails,$scope.nominationDetails.isNomineeAddressSameAsCommun&&($scope.nominationDetails.nomineeAddressDetails=$scope.addressDetails.communicationAddress,$scope.nominationDetails.isNomineeAddressSameAsCommun=!0)},$scope.submitNomineeDetails=function(){$scope.screenFiveStatus=!0,$scope.Section5Inactive=!1,$scope.accordion="5"},$scope.showAuthenticateForm=function(){var validateAuthParam={paramMap:{}};validateAuthParam.mobileNumber=$scope.proposerDetails.mobileNumber,validateAuthParam.funcType=$scope.p365Labels.functionType.optAuth,validateAuthParam.paramMap.OTP=$scope.p365Labels.functionType.otpGenerate,sessionIDvar&&(validateAuthParam.sessionId=sessionIDvar),getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.sendSMS,validateAuthParam,function(createOTP){createOTP.responseCode==$scope.p365Labels.responseCode.success?($scope.createOTPError="",$scope.modalOTP=!0):createOTP.responseCode==$scope.p365Labels.responseCode.blockedMobile?($scope.createOTPError=createOTP.message,$scope.modalOTPError=!0):($scope.createOTPError=$scope.p365Labels.errorMessage.createOTP,$scope.modalOTPError=!0)})},$scope.calcDefaultAreaDetails=function(areaCode){if(null!=areaCode&&String(areaCode)!=$scope.p365Labels.errorMessage.undefinedError&&String(areaCode).length>0){var docType=$scope.p365Labels.documentType.cityDetails,carrierId=$scope.selectedProduct.carrierId;$http.get(getSearchServiceLink+docType+"&q="+areaCode+"&id="+carrierId).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.p365Labels.responseCode.success&&$scope.onSelectPinOrAreaComm(areaDetails.data[0])})}},$scope.calcNomineeDefaultAreaDetails=function(areaCode){if(null!=areaCode&&String(areaCode)!=$scope.p365Labels.errorMessage.undefinedError&&String(areaCode).length>0){var docType=$scope.p365Labels.documentType.cityDetails,carrierId=$scope.selectedProduct.carrierId;$http.get(getSearchServiceLink+docType+"&q="+areaCode+"&id="+carrierId).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.p365Labels.responseCode.success&&$scope.onSelectPinOrAreaNomineeComm(areaDetails.data[0])})}},$scope.calcDefaultPermAreaDetails=function(areaCode){if(null!=areaCode&&String(areaCode)!=$scope.p365Labels.errorMessage.undefinedError&&String(areaCode).length>0){var docType=$scope.p365Labels.documentType.cityDetails,carrierId=$scope.selectedProduct.carrierId;$http.get(getSearchServiceLink+docType+"&q="+areaCode+"&id="+carrierId).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.p365Labels.responseCode.success&&$scope.onSelectPinOrAreaPerm(areaDetails.data[0])})}},$scope.getPinCodeAreaList=function(searchValue){var docType=$scope.p365Labels.documentType.cityDetails,carrierId=$scope.selectedProduct.carrierId;return $http.get(getSearchServiceLink+docType+"&q="+searchValue+"&id="+carrierId).then(function(response){return JSON.parse(response.data).data})},$scope.loadPlaceholder=function(){setTimeout(function(){$(".buyform-control").on("focus blur",function(e){$(this).parents(".buyform-group").toggleClass("focusedInput","focus"===e.type||this.value.length>0)}).trigger("blur")},100)},$scope.backToResultScreen=function(){if($rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled){$scope.proposalApp.QUOTE_ID;$location.path("/sharefromAPI").search({docId:$scope.lifeProposalApp.UNIQUE_QUOTE_ID_ENCRYPTED,LOB:"4"})}},$scope.onSelectPinOrAreaComm=function(item){$scope.addressDetails.communicationAddress.stateCode=item.stateCode,$scope.addressDetails.communicationAddress.state=item.state,$scope.addressDetails.communicationAddress.cityCode=item.cityCode,$scope.addressDetails.communicationAddress.city=item.city,$scope.addressDetails.communicationAddress.pincode=item.pincode,$scope.addressDetails.communicationAddress.address=item.displayField,$scope.loadPlaceholder(),$scope.addressDetails.communicationAddress.address&&(item.displayArea=$scope.addressDetails.communicationAddress.address),localStorageService.set("commAddressDetails",item)},$scope.onSelectPinOrAreaPerm=function(item){$scope.permanentAddressDetails.stateCode=item.stateCode,$scope.permanentAddressDetails.state=item.state,$scope.permanentAddressDetails.cityCode=item.cityCode,$scope.permanentAddressDetails.city=item.city,$scope.permanentAddressDetails.pincode=item.pincode,$scope.permanentAddressDetails.address=item.displayField,localStorageService.set("parmAddressDetails",item)},$scope.onSelectPinOrAreaNomineeComm=function(item){$scope.nominationDetails.nomineeAddressDetails.stateCode=item.stateCode,$scope.nominationDetails.nomineeAddressDetails.state=item.state,$scope.nominationDetails.nomineeAddressDetails.cityCode=item.cityCode,$scope.nominationDetails.nomineeAddressDetails.city=item.city,$scope.nominationDetails.nomineeAddressDetails.pincode=item.pincode,$scope.loadPlaceholder()},$scope.onSelectPinOrAreaAppointeeComm=function(item){$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.stateCode=item.stateCode,$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.state=item.state,$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.cityCode=item.cityCode,$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.city=item.city,$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.pincode=item.pincode},$scope.hideModal=function(){$scope.modalOTP=!1,$scope.proceedPaymentStatus=!0,$scope.authenticate.enteredOTP=""},$scope.hideModalIPOS=function(){$scope.modalIPOS=!1,$scope.authenticate.enteredOTP="",1==$scope.redirectForPayment&&$scope.redirectToPaymentGateway()},$scope.hideModalError=function(){$scope.modalOTPError=!1},$scope.resendOTP=function(){var validateAuthParam={paramMap:{}};validateAuthParam.mobileNumber=$scope.proposerDetails.mobileNumber,validateAuthParam.funcType=$scope.p365Labels.functionType.optAuth,validateAuthParam.paramMap.OTP=$scope.p365Labels.functionType.otpGenerate,sessionIDvar&&(validateAuthParam.sessionId=sessionIDvar),getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.sendSMS,validateAuthParam,function(createOTP){createOTP.responseCode==$scope.p365Labels.responseCode.success?$scope.invalidOTPError="":$scope.invalidOTPError=$scope.p365Labels.errorMessage.createOTP})},$scope.calcHeight=function(){$scope.proposerDetails.heightInFeet=Number($scope.proposerDetails.heightInCM)/30.48},$scope.changeStaff=function(){"Yes"==$scope.proposerDetails.StaffStatus?$scope.staffFlag=!0:($scope.staffFlag=!1,$scope.proposerDetails.staffCode="")},$scope.changeGender=function(){"Male"==$scope.proposerDetails.gender||"Other"==$scope.proposerDetails.gender?($scope.proposerDetails.salutation="Mr",$scope.commonInfo&&($scope.commonInfo.salutation="Mr")):($scope.proposerDetails.salutation="Mrs",$scope.commonInfo&&($scope.commonInfo.salutation="Miss")),$scope.recalculateProposerGender()},$scope.resetCommunicationAddress=function(){String($scope.addressDetails.communicationAddress.address)!=$scope.p365Labels.errorMessage.undefinedError&&0!=$scope.addressDetails.communicationAddress.address.length||($scope.addressDetails.communicationAddress.pincode=EMPTY,$scope.addressDetails.communicationAddress.state=EMPTY,$scope.addressDetails.communicationAddress.city=EMPTY)},$scope.resetNomineeCommunicationAddress=function(){String($scope.nominationDetails.nomineeAddressDetails.address)!=$scope.p365Labels.errorMessage.undefinedError&&0!=$scope.nominationDetails.nomineeAddressDetails.address.length||($scope.nominationDetails.nomineeAddressDetails.pincode=EMPTY,$scope.nominationDetails.nomineeAddressDetails.state=EMPTY,$scope.nominationDetails.nomineeAddressDetails.city=EMPTY)},$scope.resetAppointeeAddress=function(){String($scope.nominationDetails.appointeeDetails.appointeeAddressDetails.address)!=$scope.p365Labels.errorMessage.undefinedError&&0!=$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.address.length||($scope.nominationDetails.appointeeDetails.appointeeAddressDetails.pincode=EMPTY,$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.state=EMPTY,$scope.nominationDetails.appointeeDetails.appointeeAddressDetails.city=EMPTY)},$scope.resetPermanentAddress=function(){String($scope.permanentAddressDetails.address)!=$scope.p365Labels.errorMessage.undefinedError&&0!=$scope.permanentAddressDetails.address.length||($scope.permanentAddressDetails.pincode=EMPTY,$scope.permanentAddressDetails.state=EMPTY,$scope.permanentAddressDetails.city=EMPTY)},$scope.changePermanentAddress=function(){$scope.addressDetails.isAddressSameAsCommun?($scope.permanentAddressDetails=$scope.addressDetails.communicationAddress,$scope.addressDetails.isAddressSameAsCommun=!0):($scope.permanentAddressDetails={},$scope.addressDetails.isAddressSameAsCommun=!1),$scope.addressDetails.permanentAddress=$scope.permanentAddressDetails},$scope.$watch("addressDetails.communicationAddress.doorNo",function(newValue){$scope.addressDetails.isAddressSameAsCommun&&$scope.changePermanentAddress()}),$scope.$watch("addressDetails.communicationAddress.address",function(newValue){$scope.addressDetails.isAddressSameAsCommun&&$scope.changePermanentAddress()}),$scope.changeNomineeAddress=function(isNomineeAddressSameAsCommun){isNomineeAddressSameAsCommun?($scope.nominationDetails.nomineeAddressDetails=$scope.addressDetails.communicationAddress,$scope.nominationDetails.isNomineeAddressSameAsCommun=!0):($scope.nominationDetails.nomineeAddressDetails={},$scope.nominationDetails.isNomineeAddressSameAsCommun=!1)},$scope.changeAppointeeAddress=function(isAppointeeAddressSameAsCommun){isAppointeeAddressSameAsCommun?($scope.nominationDetails.appointeeDetails.appointeeAddressDetails=$scope.addressDetails.communicationAddress,$scope.nominationDetails.appointeeDetails.isAppointeeAddressSameAsCommun=!0):($scope.nominationDetails.appointeeDetails.appointeeAddressDetails={},$scope.nominationDetails.appointeeDetails.isAppointeeAddressSameAsCommun=!1)},$scope.calculateProposerAge=function(){$scope.proposerDetails.personAge=getAgeFromDOB($scope.proposerDetails.dateOfBirth),$scope.selectedProductInputParam.personalDetails.dateOfBirth=$scope.proposerDetails.dateOfBirth,$scope.selectedProductInputParam.quoteParam.age=parseInt(getAgeFromDOB($scope.proposerDetails.dateOfBirth)),$scope.calculateMaturityAgeGap(),$scope.recalculateProposerAge()},$scope.calculateMaturityAgeGap=function(){$scope.selectedProductInputParam.quoteParam.age>35?$scope.selectedProductInputParam.personalDetails.maturityAge=lifematurityAgeConstant:$scope.selectedProductInputParam.personalDetails.maturityAge=$scope.selectedProductInputParam.quoteParam.age+40},$scope.validateQuestions=function(){$scope.showPreviouspolErrMsg=!1,"true"==$scope.previousPolicyDetails.isPreviousPol&&("false"==$scope.previousPolicyDetails.otherThanKotakPrevPol&&"false"==$scope.previousPolicyDetails.kotakPolicy?$scope.showPreviouspolErrMsg=!0:"false"==$scope.previousPolicyDetails.otherThanKotakPrevPol||"true"==$scope.previousPolicyDetails.kotakPolicy?$scope.showPreviouspolErrMsg=!1:"true"!=$scope.previousPolicyDetails.otherThanKotakPrevPol&&"false"!=$scope.previousPolicyDetails.kotakPolicy||($scope.showPreviouspolErrMsg=!1))},$scope.validateProposerDateOfBirth=function(){if("undefined"!==String($scope.proposerDetails.dateOfBirth)){var proposerAge=getAgeFromDOB($scope.proposerDetails.dateOfBirth);isNaN(proposerAge)?($scope.proposerDetails.dateOfBirth=void 0,$scope.proposerDateOfBirthError=$scope.productValidation.messages.dateOfBirthInvalid):proposerAge<$scope.productValidation.proposerDateOfBirthMinLimit?($scope.proposerDetails.dateOfBirth=void 0,$scope.proposerDateOfBirthError=$scope.productValidation.messages.proposerDateOfBirthErrorOne.replace("MIN_AGE_LIMIT",$scope.productValidation.proposerDateOfBirthMinLimit)):proposerAge>$scope.productValidation.proposerDateOfBirthMaxLimit?($scope.proposerDetails.dateOfBirth=void 0,$scope.proposerDateOfBirthError=$scope.productValidation.messages.proposerDateOfBirthErrorTwo.replace("MAX_AGE_LIMIT",$scope.productValidation.proposerDateOfBirthMaxLimit)):($scope.loadPlaceholder(),$scope.proposerAgeValue(proposorAge),$scope.proposerDateOfBirthError="")}else $scope.proposerDetails.dateOfBirth=void 0,$scope.proposerDateOfBirthError=$scope.productValidation.messages.dateOfBirthInvalid},$scope.validateNomineeDateOfBirth=function(){$scope.nominationDetails.personAge=getAgeFromDOB($scope.nominationDetails.dateOfBirth),$scope.nominationDetails.personAge<18?($scope.nominationDetails.appointeeStatus=!0,$scope.nomineeRelationList=buyScreenMinorNomineeRealtion,$scope.loadPlaceholder(),$scope.appointeeRelationList=buyScreenAppointeeRelation,$scope.nominationDetails.appointeeDetails.isAppointeeAddressSameAsCommun=!0,$scope.nominationDetails.appointeeDetails.isAppointeeAddressSameAsCommun&&($scope.nominationDetails.appointeeDetails.appointeeAddressDetails=$scope.addressDetails.communicationAddress)):($scope.nominationDetails.appointeeStatus=!1,$scope.nomineeRelationList=buyScreenNotMinorNomineeRealtion,$scope.appointeeRelationList=buyScreenAppointeeRelation,$scope.nominationDetails.appointeeDetails={})},$scope.validateAppointeeDateOfBirth=function(){$scope.nominationDetails.appointeeDetails.personAge=getAgeFromDOB($scope.nominationDetails.appointeeDetails.dateOfBirth),$scope.nominationDetails.appointeeDetails.personAge<18?($scope.nominationDetails.appointeeDetails.dateOfBirth=void 0,$scope.appointeeDateOfBirthError=$scope.productValidation.messages.dateOfBirthInvalid):($scope.loadPlaceholder(),$scope.appointeeDateOfBirthError="")},$scope.changeMaritalStatus=function(){if("SINGLE"==$scope.proposerDetails.marritalStatus)for(var i=0;i<$scope.nomineeRelList.length;i++)"Husband"==$scope.nomineeRelList[i].relationNominee&&$scope.nomineeRelList.splice(i,1),"Wife"==$scope.nomineeRelList[i].relationNominee&&$scope.nomineeRelList.splice(i,1)};var proposalId=$location.search().proposalId;$scope.proposalDocParam.proposalId=proposalId,$scope.proposalDocParam.businessLineId=$scope.p365Labels.businessLineType.life,$scope.iposRequest={},$scope.iposRequest.parent_id=String($rootScope.parent_id)!=$scope.p365Labels.errorMessage.undefinedError?$rootScope.parent_id:$location.search().recordId,$scope.iposRequest.parent_type=String($rootScope.parent_type)!=$scope.p365Labels.errorMessage.undefinedError?$rootScope.parent_type:$location.search().moduleName,$scope.iposRequest.requestType=$scope.p365Labels.request.createProposalRecord,$scope.quote={},RestAPI.invoke("proposalDataReader",$scope.proposalDocParam).then(function(proposalDataResponse){if(proposalDataResponse.responsecode==$scope.p365Labels.responseCode.success){$scope.responseProduct=proposalDataResponse.data.PolicyTransaction,$scope.lifeProposalApp.documentType="lifeProposalRequest",$scope.lifeProposalApp.productId=$scope.responseProduct.proposalRequest.insuranceDetails.productId,$scope.lifeProposalApp.planId=$scope.responseProduct.proposalRequest.insuranceDetails.planId,$scope.lifeProposalApp.QUOTE_ID=$scope.responseProduct.QUOTE_ID,$scope.lifeProposalApp.UNIQUE_QUOTE_ID_ENCRYPTED=$scope.responseProduct.encryptedQuoteId,$scope.lifeProposalApp.carrierId=$scope.responseProduct.proposalRequest.insuranceDetails.carrierId,localStorageService.set("QUOTE_ID",$scope.responseProduct.QUOTE_ID),localStorageService.set("LIFE_UNIQUE_QUOTE_ID",$scope.responseProduct.QUOTE_ID),$scope.lifeProposalApp.businessLineId=$scope.p365Labels.businessLineType.life,messageIDVar=$scope.responseProduct.leadMessageId,campaign_id=$scope.responseProduct.campaign_id,requestSource=$scope.responseProduct.requestSource,sourceOrigin=$scope.responseProduct.source,$scope.lifeProposalApp.username=$scope.responseProduct.username,$scope.lifeProposalApp.agencyId=$scope.responseProduct.agencyId;var buyScreenParam={};buyScreenParam.documentType=$scope.p365Labels.documentType.proposalScreenConfig,buyScreenParam.businessLineId=Number($scope.p365Labels.businessLineType.life),buyScreenParam.carrierId=$scope.lifeProposalApp.carrierId,buyScreenParam.productId=$scope.lifeProposalApp.productId,buyScreenParam.QUOTE_ID=$scope.lifeProposalApp.QUOTE_ID,getDocUsingParam(RestAPI,productDataReader,buyScreenParam,function(buyScreen){if(buyScreen.responseCode==$scope.p365Labels.responseCode.success){localStorageService.set("buyScreen",buyScreen.data);var buyScreens=buyScreen.data;$scope.ownerDetailsTemplate=$sce.trustAsHtml(buyScreens.templates[0].template),$scope.prevPolicyDetailsTemplate=$sce.trustAsHtml(buyScreens.templates[2].template),$scope.productValidation=buyScreens.validation,$scope.redirectSuccessUrl=buyScreens.redirectSuccessUrl,$scope.redirectFailureUrl=buyScreens.redirectFailureUrl,$scope.requestFormat=buyScreens.requestFormat,$scope.transactionName=buyScreens.transaction.proposalService.name,$scope.paymentURL=buyScreens.paymentUrl,getDocUsingIdQuoteDB(RestAPI,$scope.lifeProposalApp.QUOTE_ID,function(quoteCalcDetails){$scope.quoteCalcResponse=quoteCalcDetails.lifeQuoteResponse,$scope.quoteCalcRequest=quoteCalcDetails.lifeQuoteRequest,localStorageService.set("lifeQuoteInputParamaters",$scope.quoteCalcRequest),$scope.selectedProductInputParam=quoteCalcDetails.lifeQuoteRequest;for(var i=0;i<$scope.quoteCalcResponse.length;i++)if($scope.quoteCalcResponse[i].carrierId==$scope.responseProduct.proposalRequest.insuranceDetails.carrierId){$scope.selectedProduct=$scope.quoteCalcResponse[i],localStorageService.set("selectedProduct",$scope.selectedProduct);break}$scope.prePopulateForm=function(){$scope.proposerDetails=$scope.responseProduct.proposalRequest.proposerDetails,$scope.proposerDetails.dateOfBirth=$scope.selectedProductInputParam.personalDetails.dateOfBirth,$scope.storedDOB=angular.copy($scope.selectedProductInputParam.personalDetails.dateOfBirth),"M"==$scope.selectedProductInputParam.quoteParam.gender?($scope.proposerDetails.gender="Male",$scope.proposerDetails.salutation="Mr",$scope.commonInfo&&($scope.commonInfo.salutation="Mr")):($scope.proposerDetails.gender="Female",$scope.proposerDetails.salutation="Mrs",$scope.commonInfo&&($scope.commonInfo.salutation="Miss"));var proposerDOBOption={};proposerDOBOption.minimumYearLimit="-"+$scope.productValidation.proposerAgeMax.age+"Y",proposerDOBOption.maximumYearLimit="-"+$scope.productValidation.proposerAgeMin.age+"Y",proposerDOBOption.changeMonth=!0,proposerDOBOption.changeYear=!0,proposerDOBOption.dateFormat="dd/mm/yy",$scope.proposerDOBOptions=setP365DatePickerProperties(proposerDOBOption);var nomineeDOBOption={maximumYearLimit:"-1Y",changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy"};$scope.nomineeDOBOptions=setP365DatePickerProperties(nomineeDOBOption);var appointeeDOBOption={maximumYearLimit:"-18Y",changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy"};$scope.appointeeDOBOptions=setP365DatePickerProperties(appointeeDOBOption),$scope.addressDetails=$scope.responseProduct.proposalRequest.addressDetails,localStorageService.set("commAddressDetails",$scope.addressDetails.communicationAddress),$scope.addressDetails.isAddressSameAsCommun?$scope.permanentAddressDetails=$scope.responseProduct.proposalRequest.addressDetails.communicationAddress:$scope.permanentAddressDetails=$scope.responseProduct.proposalRequest.addressDetails.permanentAddress,$scope.medicalInfo.medicalQuestionarrier=$scope.responseProduct.proposalRequest.medicalQuestionarrier,$scope.medicalInfo.dieaseDetails=$scope.responseProduct.proposalRequest.dieaseDetails,$scope.jobsInfo.jobsDetails=$scope.responseProduct.proposalRequest.jobsInfo,$scope.tobacoAdictedTemp="Y"==$scope.responseProduct.proposalRequest.proposerDetails.tobacoAdicted?"true":"false",$scope.proposerDetails.tobacoAdicted=$scope.selectedProductInputParam.quoteParam.tobacoAdicted,$scope.istobacoAddicted="Y"==$scope.proposerDetails.tobacoAdicted?"true":"false",$scope.tobacoErrorMsg=!1,$rootScope.smokingFlag=!1,$scope.nominationDetails=$scope.responseProduct.proposalRequest.nominationDetails,angular.forEach($scope.nomineeRelList,function(value,key){$scope.nomineeRelList[key].relationNominee==$scope.nominationDetails.nominationRelation&&($scope.nominationRelation=$scope.nomineeRelList[key])}),angular.forEach($scope.appointeeRelList,function(value,key){$scope.appointeeRelList[key].relationAppointee==$scope.nominationDetails.appointeeDetails.appointeeRelation&&($scope.appointeeRelation=$scope.appointeeRelList[key])}),$scope.previousPolicyDetails=$scope.responseProduct.proposalRequest.previousPolicyDetails,$scope.undertakingStatus=!0,$scope.loading=!1},$scope.redirectToPaymentGateway=function(){$scope.paymentGatewayURL&&$window.open($scope.paymentGatewayURL,"_blank")},$scope.proceedForPayment=function(){$scope.proceedPaymentStatus=!1;var authenticateUserParam={};authenticateUserParam.mobileNumber=$scope.proposerDetails.mobileNumber,authenticateUserParam.OTP=Number($scope.authenticate.enteredOTP),getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.validateOTP,authenticateUserParam,function(createOTP){createOTP.responseCode==$scope.p365Labels.responseCode.success?($scope.modalOTP=!1,$scope.invalidOTPError="",$scope.proposalInfo(),$scope.lifeProposeFormDetails.QUOTE_ID=localStorageService.get("LIFE_UNIQUE_QUOTE_ID"),$scope.lifeProposeFormDetails.businessLineId=$scope.p365Labels.businessLineType.life,$rootScope.wordPressEnabled?$scope.lifeProposeFormDetails.source=sourceOrigin:($scope.lifeProposeFormDetails.baseEnvStatus=baseEnvEnabled,$scope.lifeProposeFormDetails.source=sourceOrigin),localStorageService.set("lifeProposeFormDetails",$scope.lifeProposeFormDetails),$scope.lifeProposeFormDetails.QUOTE_ID?($scope.loading=!0,RestAPI.invoke($scope.transactionName,$scope.lifeProposeFormDetails).then(function(proposeFormResponse){if($scope.modalOTP=!1,$scope.authenticate.enteredOTP="",$scope.modalOTPError=!1,$scope.proceedPaymentStatus=!0,proposeFormResponse.responseCode==$scope.p365Labels.responseCode.success)$scope.proposalId=proposeFormResponse.data.proposalId,$scope.encryptedProposalId=proposeFormResponse.data.encryptedProposalId,localStorageService.set("proposalIdEncrypted",$scope.encryptedProposalId),proposeFormResponse.data?(1==imauticAutomation&&imatLifeProposal(localStorageService,$scope,"MakePayment"),$scope.loading=!1,$scope.paymentGatewayURL=proposeFormResponse.data.redirectionUrl,$scope.redirectForPayment=!0,$scope.modalIPOS=!0):console.error("URL is not available for redirection.");else if(proposeFormResponse.responseCode==$scope.p365Labels.responseCode.error)$scope.loading=!1,$rootScope.P365Alert("Error",proposeFormResponse.data,"Ok");else{1==imauticAutomation&&imatEvent("ProposalFailed"),$scope.loading=!1;var buyScreenCnfrmError=proposeFormResponse.responseCode+" : "+$scope.p365Labels.validationMessages.buyScreenCnfrmError.replace("INSURER_NAME",$scope.selectedProduct.insuranceCompany);$rootScope.P365Alert($scope.p365Labels.common.p365prompt,buyScreenCnfrmError,"Ok")}})):($scope.loading=!1,$scope.proceedPaymentStatus=!0,$rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.generalisedErrMsg,"Ok"))):createOTP.responseCode==$scope.p365Labels.responseCode.noRecordsFound?$scope.invalidOTPError=$scope.p365Labels.validationMessages.invalidOTP:createOTP.responseCode==$scope.p365Labels.responseCode.expiredOTP?$scope.invalidOTPError=$scope.p365Labels.validationMessages.expiredOTP:createOTP.responseCode==$scope.p365Labels.responseCode.blockedMobile?$scope.invalidOTPError=createOTP.message:$scope.invalidOTPError=$scope.p365Labels.validationMessages.authOTP})},$scope.submitProposalData=function(selectedPolicyDetails){if($scope.proposalInfo(),$scope.lifeProposeFormDetails.QUOTE_ID=localStorageService.get("LIFE_UNIQUE_QUOTE_ID"),$scope.lifeProposeFormDetails.businessLineId=$scope.p365Labels.businessLineType.life,$scope.lifeProposeFormDetails.carrierProposalStatus=!1,$scope.lifeProposeFormDetails.baseEnvStatus=baseEnvEnabled,$scope.loading=!0,$rootScope.agencyPortalEnabled){const localdata=JSON.parse(localStorage.getItem("finalLocalStorage"));$scope.lifeProposeFormDetails.requestSource=requestSource,$scope.lifeProposeFormDetails.userName=localdata.username,$scope.lifeProposeFormDetails.agencyId=localdata.agencyId}$scope.lifeProposeFormDetails.QUOTE_ID?RestAPI.invoke($scope.transactionName,$scope.lifeProposeFormDetails).then(function(proposeFormResponse){if(proposeFormResponse.responseCode==$scope.p365Labels.responseCode.success)if($scope.responseToken=proposeFormResponse.data,$scope.responseToken.paymentGateway=$scope.paymentURL,$scope.responseToken.businessLineId=$scope.p365Labels.businessLineType.life,localStorageService.set("lifeReponseToken",$scope.responseToken),$scope.encryptedProposalId=proposeFormResponse.data.encryptedProposalId,localStorageService.set("proposalIdEncrypted",$scope.encryptedProposalId),1==imauticAutomation)imatLifeProposal(localStorageService,$scope,"MakePayment"),$scope.redirectForPayment=!1,$scope.loading=!1,$scope.modalIPOS=!0;else{var body={};body.longURL=sharePaymentLink+String($scope.responseToken.encryptedProposalId)+"&lob="+String($scope.p365Labels.businessLineType.life),$http({method:"POST",url:getShortURLLink,data:body}).success(function(shortURLResponse){if(shortURLResponse.responseCode==$scope.p365Labels.responseCode.success){var proposalDetailsEmail={paramMap:{}};proposalDetailsEmail.funcType=$scope.p365Labels.functionType.proposalDetailsTemplate,proposalDetailsEmail.username=$scope.proposerDetails.emailId.trim(),proposalDetailsEmail.isBCCRequired="Y",proposalDetailsEmail.paramMap.customerName=$scope.proposerDetails.firstName.trim()+" "+$scope.proposerDetails.lastName.trim(),proposalDetailsEmail.paramMap.selectedPolicyType=$scope.p365Labels.insuranceType.life,proposalDetailsEmail.paramMap.quoteId=localStorageService.get("LIFE_UNIQUE_QUOTE_ID"),proposalDetailsEmail.paramMap.premiumAmount=String($scope.selectedProduct.grossPremium),proposalDetailsEmail.paramMap.docId=String($scope.responseToken.proposalId),proposalDetailsEmail.paramMap.LOB=String($scope.p365Labels.businessLineType.life),proposalDetailsEmail.paramMap.url=shortURLResponse.data.shortURL,RestAPI.invoke($scope.p365Labels.transactionName.sendEmail,proposalDetailsEmail).then(function(emailResponse){emailResponse.responseCode==$scope.p365Labels.responseCode.success?($scope.redirectForPayment=!1,$scope.loading=!1,$scope.modalIPOS=!0):($rootScope.P365Alert("Policies365",emailResponse.data,"Ok"),$scope.loading=!1);var proposalDetailsSMS={paramMap:{},funcType:"SHAREPROPOSAL"};proposalDetailsSMS.paramMap.customerName=$scope.proposerDetails.firstName.trim()+" "+$scope.proposerDetails.lastName.trim(),proposalDetailsSMS.paramMap.premiumAmount=String($scope.selectedProduct.grossPremium),proposalDetailsSMS.paramMap.docId=String($scope.responseToken.proposalId),proposalDetailsSMS.paramMap.LOB=String($scope.p365Labels.businessLineType.life),proposalDetailsSMS.mobileNumber=$scope.proposerDetails.mobileNumber,proposalDetailsSMS.paramMap.url=shortURLResponse.data.shortURL,RestAPI.invoke($scope.p365Labels.transactionName.sendSMS,proposalDetailsSMS).then(function(smsResponse){smsResponse.responseCode==$scope.p365Labels.responseCode.success?$scope.smsResponseError="":smsResponse.responseCode==$scope.p365Labels.responseCode.blockedMobile?$scope.smsResponseError=smsResponse.message:$scope.smsResponseError=$scope.p365Labels.errorMessage.createOTP})})}else $rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.emailSentFailed,"Ok"),$scope.loading=!1})}else{if($scope.loading=!1,$scope.vehicleDetails.registrationNumber){var formatRegisCode=$scope.vehicleDetails.registrationNumber;$scope.assuranceInfo.registrationNumber=formatRegisCode.substring(4)}$rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.serverError,"Ok")}}):($scope.loading=!1,$rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.generalisedErrMsg,"Ok"))},$scope.recalculateProposerGender=function(){"undefined"==$scope.storedGENDER&&null==$scope.storedGENDER||("Male"==$scope.proposerDetails.gender||"Other"==$scope.proposerDetails.gender?($scope.genderMorF="M",$scope.selectedProductInputParam.quoteParam.gender=$scope.genderMorF):($scope.genderMorF="F",$scope.selectedProductInputParam.quoteParam.gender=$scope.genderMorF),$scope.storedGENDER!=$scope.proposerDetails.gender?$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.genderChangeMsg,"No","Yes",function(confirmStatus){confirmStatus?($scope.loading=!0,$scope.selectedProductInputParam.quoteParam.policyTerm=$scope.selectedProductInputParam.personalDetails.maturityAge-$scope.selectedProductInputParam.quoteParam.age,localStorageService.get("PROF_QUOTE_ID")&&($scope.selectedProductInputParam.PROF_QUOTE_ID=localStorageService.get("PROF_QUOTE_ID")),RestAPI.invoke($scope.p365Labels.getRequest.quoteLife,$scope.selectedProductInputParam).then(function(callback){if($scope.lifeRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success)$scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("LIFE_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.lifeRecalculateQuoteRequest=callback.data,$scope.lifeQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.lifeRecalculateQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=$scope.p365Labels.transactionName.lifeQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var lifeQuoteResponse=JSON.parse(callback);if(lifeQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=lifeQuoteResponse.data&&lifeQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&lifeQuoteResponse.data.quotes[0].productId==$scope.selectedProduct.productId&&($scope.selectedProduct.annualPremium=lifeQuoteResponse.data.quotes[0].annualPremium,$scope.selectedProduct.monthlyFinalPremium=lifeQuoteResponse.data.quotes[0].monthlyFinalPremium,$scope.selectedProduct.basicPremium=lifeQuoteResponse.data.quotes[0].basicPremium,$scope.selectedProduct.monthlyBasePremium=lifeQuoteResponse.data.quotes[0].monthlyBasePremium,$scope.selectedProduct.serviceTax=lifeQuoteResponse.data.quotes[0].sericeTax,$scope.selectedProduct.sumInsured=lifeQuoteResponse.data.quotes[0].sumInsured,$scope.selectedProduct.adjustedPremium=lifeQuoteResponse.data.quotes[0].adjustedPremium,$scope.loading=!1),lifeQuoteResponse.data.quotes[0].id=lifeQuoteResponse.messageId,$scope.quoteCalcResponse.push(lifeQuoteResponse.data.quotes[0]);else if(null!=lifeQuoteResponse.data&&lifeQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&lifeQuoteResponse.data.quotes[0].productId==$scope.selectedProduct.productId){$scope.loading=!1;var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsg;$rootScope.P365Alert($scope.p365Labels.common.p365prompt,screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})});else{$scope.loading=!1,$scope.proposerDetails.gender=$scope.storedGENDER;var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgDob;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}),$scope.storedGENDER=$scope.proposerDetails.gender,$scope.proposerDetails.gender=$scope.storedGENDER,$scope.commonInfo&&($scope.commonInfo.salutation="Female"==$scope.proposerDetails.gender?"Miss":"Mr")):($scope.loading=!1,$scope.proposerDetails.gender=$scope.storedGENDER,$scope.storedGENDER=$scope.proposerDetails.gender,$scope.commonInfo&&($scope.commonInfo.salutation="Female"==$scope.proposerDetails.gender?"Miss":"Mr"))}):($scope.loading=!1,$scope.proposerDetails.gender=$scope.storedGENDER,$scope.storedGENDER=$scope.proposerDetails.gender))},$scope.recalculateProposerAge=function(){"undefined"==String($scope.storedDOB)&&null==$scope.storedDOB||($scope.storedDOB!=$scope.proposerDetails.dateOfBirth?$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.DobChangeMsg,"No","Yes",function(confirmStatus){confirmStatus?($scope.loading=!0,$scope.selectedProductInputParam.quoteParam.policyTerm=$scope.selectedProductInputParam.personalDetails.maturityAge-$scope.selectedProductInputParam.quoteParam.age,localStorageService.get("PROF_QUOTE_ID")&&($scope.selectedProductInputParam.PROF_QUOTE_ID=localStorageService.get("PROF_QUOTE_ID")),RestAPI.invoke($scope.p365Labels.getRequest.quoteLife,$scope.selectedProductInputParam).then(function(callback){if($scope.lifeRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success)$scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("LIFE_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.lifeRecalculateQuoteRequest=callback.data,$scope.lifeQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.lifeRecalculateQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=$scope.p365Labels.transactionName.lifeQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var lifeQuoteResponse=JSON.parse(callback);if(lifeQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=lifeQuoteResponse.data&&lifeQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&lifeQuoteResponse.data.quotes[0].productId==$scope.selectedProduct.productId&&("Monthly Premium"==$scope.selectedProduct.premiumTypeMonthOrAnnual?($scope.selectedProduct.monthlyFinalPremium=lifeQuoteResponse.data.quotes[0].monthlyFinalPremium,$scope.selectedProduct.annualPremium=lifeQuoteResponse.data.quotes[0].annualPremium):($scope.selectedProduct.annualPremium=lifeQuoteResponse.data.quotes[0].annualPremium,$scope.selectedProduct.monthlyFinalPremium=lifeQuoteResponse.data.quotes[0].monthlyFinalPremium),$scope.selectedProduct.basicPremium=lifeQuoteResponse.data.quotes[0].basicPremium,$scope.selectedProduct.monthlyBasePremium=lifeQuoteResponse.data.quotes[0].monthlyBasePremium,$scope.selectedProduct.serviceTax=lifeQuoteResponse.data.quotes[0].sericeTax,$scope.selectedProduct.sumInsured=lifeQuoteResponse.data.quotes[0].sumInsured,$scope.selectedProduct.adjustedPremium=lifeQuoteResponse.data.quotes[0].adjustedPremium,$scope.loading=!1),lifeQuoteResponse.data.quotes[0].id=lifeQuoteResponse.messageId,$scope.quoteCalcResponse.push(lifeQuoteResponse.data.quotes[0]);else if(null!=lifeQuoteResponse.data&&lifeQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&lifeQuoteResponse.data.quotes[0].productId==$scope.selectedProduct.productId){$scope.loading=!1;var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsg;$rootScope.P365Alert($scope.p365Labels.common.p365prompt,screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})});else{$scope.loading=!1,$scope.proposerDetails.dateOfBirth="";var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgDob;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}),$scope.storedDOB=$scope.proposerDetails.dateOfBirth,$scope.proposerDetails.dateOfBirth=$scope.storedDOB):($scope.loading=!1,$scope.proposerDetails.dateOfBirth=$scope.storedDOB,$scope.storedDOB=$scope.proposerDetails.dateOfBirth)}):($scope.loading=!1,$scope.proposerDetails.dateOfBirth=$scope.storedDOB,$scope.storedDOB=$scope.proposerDetails.dateOfBirth))},setTimeout(function(){$(".buyform-control").on("focus blur",function(e){$(this).parents(".buyform-group").toggleClass("focusedInput","focus"===e.type||this.value.length>0)}).trigger("blur")},4e3),setTimeout(function(){$(".buyform-control").on("focus blur",function(e){$(this).parents(".buyform-group").toggleClass("focusedInput","focus"===e.type||this.value.length>0)}).trigger("blur")},500),$scope.scheduleVehicleInspection=function(){$location.path("/FourWheelerscheduleInspection")},$rootScope.signout=function(){$rootScope.userLoginStatus=!1;var userLoginInfo={username:void 0};userLoginInfo.status=$rootScope.userLoginStatus,localStorageService.set("userLoginInfo",userLoginInfo),$location.path("/quote")};var quesArr=[];$rootScope.lifeRegretPolicyFlag=!1,$scope.inputTypeCheck=function(sel,quesId,mquestion){if("true"==sel){if("MULTIPLECOUNTRY"==mquestion.questionCode||"IS_NRI"==mquestion.questionCode||"IS_GREENCARDHOLDER"==mquestion.questionCode){quesArr.push(quesId);var screenCnfrmError=$scope.p365Labels.errorMessage.lifeRegretPolicyMsg;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}else quesArr.length>0&&quesArr.splice(-1,quesId);quesArr.length>0?$rootScope.lifeRegretPolicyFlag=!0:$rootScope.lifeRegretPolicyFlag=!1},$scope.clickToShowDisease=function(index){$scope.diseaseShow=!0,$scope.showSublist=index},$scope.tobacoErrorMsg=!1,$rootScope.smokingFlag=!1,$scope.clickToShowDiseaseTobacco=function(index,applicable){$scope.tobacoErrorMsg=!1,$rootScope.smokingFlag=!1,$scope.tobacoAdictedTemp="Y"==$scope.proposerDetails.tobacoAdicted?"true":"false",applicable!=$scope.tobacoAdictedTemp&&($rootScope.smokingFlag=!0,$scope.tobacoErrorMsg=!0),$scope.showDesc=!0},$scope.checkJob=function(){for(var flag=!0,i=0;i<$scope.jobsInfo.jobsDetails.length;i++)void 0!==$scope.jobsInfo.jobsDetails[i].applicable&&1==$scope.jobsInfo.jobsDetails[i].applicable&&(flag=!1);return flag},$scope.checkDisease=function(questionCode){for(var flag=!0,i=0;i<$scope.medicalInfo.dieaseDetails.length;i++)$scope.medicalInfo.dieaseDetails[i]&&$scope.medicalInfo.dieaseDetails[i].questionCode==questionCode&&$scope.medicalInfo.dieaseDetails[i].applicable&&(flag=!1);return flag},$scope.getnumberOfPages=function(array){array.length<=4?$scope.numberOfPages=1:array.length<=8?$scope.numberOfPages=2:$scope.numberOfPages=Math.floor(array.length/$scope.numRecords)},$scope.clickToHideDisease=function(){$scope.diseaseShow=!1},$scope.submitDieaseList=function(){$scope.diseaseShow=!1},$scope.proposalInfo=function(){$scope.lifeProposeFormDetails={},$scope.proposerDetails.panNumber="undefined"!=String($scope.proposerDetails.panNumber)?$scope.proposerDetails.panNumber.toUpperCase():"",delete $scope.selectedProduct.features,delete $scope.selectedProduct.riders,$scope.lifeProposeFormDetails.premiumDetails=$scope.selectedProduct,$scope.lifeProposeFormDetails.proposerDetails=$scope.proposerDetails,$scope.lifeProposeFormDetails.nominationDetails=$scope.nominationDetails,$scope.lifeProposeFormDetails.previousPolicyDetails=$scope.previousPolicyDetails,$scope.addressDetails.isAddressSameAsCommun&&($scope.addressDetails.permanentAddress=$scope.addressDetails.communicationAddress),$scope.lifeProposeFormDetails.addressDetails=$scope.addressDetails,$scope.lifeProposeFormDetails.medicalQuestionarrier=angular.copy($scope.medicalInfo.medicalQuestionarrier),$scope.lifeProposeFormDetails.jobsDetails=angular.copy($scope.jobsInfo.jobsDetails),$scope.lifeProposeFormDetails.dieaseDetails=angular.copy($scope.medicalInfo.dieaseDetails);for(var i=0;i<$scope.lifeProposeFormDetails.dieaseDetails.length;i++)void 0==$scope.lifeProposeFormDetails.dieaseDetails[i]&&($scope.lifeProposeFormDetails.dieaseDetails.splice(i,1),i-=1);$scope.selectedProduct.carrierUniqueId&&($scope.lifeProposeFormDetails.premiumDetails.carrierUniqueId=$scope.selectedProduct.carrierUniqueId),(0==$scope.selectedProduct.totalDiscountAmount||$scope.selectedProduct.totalDiscountAmount)&&($scope.lifeProposeFormDetails.totalDiscountAmount=$scope.selectedProduct.totalDiscountAmount),(0==$scope.selectedProduct.totalRiderAmount||$scope.selectedProduct.totalRiderAmount)&&($scope.lifeProposeFormDetails.totalRiderAmount=$scope.selectedProduct.totalRiderAmount),(0==$scope.selectedProduct.basicCoverage||$scope.selectedProduct.basicCoverage)&&($scope.lifeProposeFormDetails.basicCoverage=$scope.selectedProduct.basicCoverage),$scope.lifeProposeFormDetails.premiumDetails.userIdv=localStorageService.get("lifeQuoteInputParamaters").quoteParam.userIdv,$scope.lifeProposeFormDetails.carrierId=$scope.selectedProduct.carrierId,$scope.lifeProposeFormDetails.productId=$scope.selectedProduct.productId,$scope.lifeProposeFormDetails.requestType=$scope.p365Labels.request.lifePropRequestType},$scope.changeNomineeRelation=function(relationObj){$scope.nominationDetails.nominationRelation=relationObj.relationNominee,$scope.nominationDetails.gender=relationObj.gender,$scope.personalDetails=$scope.proposerDetails},$scope.changeAppointeeRelation=function(relation){$scope.nominationDetails.appointeeDetails.appointeeRelation=relation.relationAppointee,$scope.nominationDetails.appointeeDetails.gender=relation.gender,$scope.personalDetails=$scope.proposerDetails},$scope.loadLists=function(){var occupationDocId=$scope.p365Labels.documentType.lifeOccupation+"-"+$scope.selectedProduct.carrierId;getDocUsingId(RestAPI,occupationDocId,function(occupationList){$scope.occupationList=occupationList.Occupation;var nomineeRelationDocId=$scope.p365Labels.documentType.lifeNomineeRelation+"-"+$scope.selectedProduct.carrierId;getDocUsingId(RestAPI,nomineeRelationDocId,function(nomineeRelationList){$scope.nomineeRelList=nomineeRelationList.NomineeRelation;var appointeeRelationDocId=$scope.p365Labels.documentType.lifeAppointeeRelation+"-"+$scope.selectedProduct.carrierId;getDocUsingId(RestAPI,appointeeRelationDocId,function(appointeeRelationList){$scope.appointeeRelList=appointeeRelationList.AppointeeRelation;var nationalityDocId=$scope.p365Labels.documentType.lifeNationality+"-"+$scope.selectedProduct.carrierId;getDocUsingId(RestAPI,nationalityDocId,function(nationalityList){$scope.nationalityList=nationalityList.Nationality;var searchData={documentType:"LifeDiseaseQuestion"};searchData.carrierId=$scope.selectedProduct.carrierId,searchData.planId=$scope.selectedProduct.productId,searchData.riders=$scope.selectedProduct.ridersList,searchData.gender=angular.copy($scope.responseProduct.gender),getDocUsingParam(RestAPI,"getHealthQuestionList",searchData,function(callback){$scope.medicalQuestionarrie=callback.data;var searchDiseaseData={documentType:"LifeDiseaseMapping"};searchDiseaseData.carrierId=$scope.selectedProduct.carrierId,searchDiseaseData.planId=$scope.selectedProduct.productId,searchDiseaseData.riders=$scope.selectedProduct.ridersList,searchData.gender=$scope.proposerDetails.gender,getDocUsingParam(RestAPI,"getHealthQuestionList",searchDiseaseData,function(callback){angular.forEach(callback.data,function(element){element.applicable=!1}),$scope.diseaseList=angular.copy(callback.data),$scope.diseaseListDisable=angular.copy($scope.diseaseList);for(var i=0;i<$scope.diseaseListDisable.length;i++)$scope.diseaseListDisable[i].subParentId=$scope.diseaseListDisable[i].parentId;var searchDiseaseData={documentType:"LifeJobMapping"};searchDiseaseData.carrierId=$scope.selectedProduct.carrierId,searchDiseaseData.planId=$scope.selectedProduct.productId,searchDiseaseData.riders=$scope.selectedProduct.ridersList,getDocUsingParam(RestAPI,"getHealthQuestionList",searchDiseaseData,function(callback){$scope.jobsList=angular.copy(callback.data),$scope.jobsListCopy=angular.copy($scope.jobsList),$rootScope.loading=!1,$scope.prePopulateForm()})})})})})})})},$scope.loadLists()})}else $rootScope.P365Alert("Error",buyScreen.data,"Ok")})}else{$scope.loading=!1;var buyScreenCnfrmError=$scope.p365Labels.validationMessages.buyScreenCnfrmError.replace("INSURER_NAME",$scope.selectedProduct.insuranceCompany);$rootScope.P365Alert("Policies365",buyScreenCnfrmError,"Ok")}})}]);