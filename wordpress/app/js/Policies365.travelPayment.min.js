"use strict";angular.module("paySuccessTravel",["CoreComponentApp","LocalStorageModule","ngMessages"]).controller("paySuccessTravelController",["RestAPI","$scope","$rootScope","$location","$http","localStorageService","$timeout","$sce",function(RestAPI,$scope,$rootScope,$location,$http,localStorageService,$timeout,$sce){agencyPortalEnabled&&($scope.agencyPortalEnabled=agencyPortalEnabled),$scope.redirectURL=function(){if(isAPICall){$scope.rampUniqueId="",$scope.rampRedirectURL="";var url="",request={};localStorageService.get("rampUniqueId")&&localStorageService.get("rampRedirectURL")?($scope.rampUniqueId=JSON.parse(localStorageService.get("rampUniqueId")),$scope.rampRedirectURL=JSON.parse(localStorageService.get("rampRedirectURL")),url="https://"+$scope.rampRedirectURL,request.rampUniqueId=$scope.rampUniqueId,request.message="success"):url=$rootScope.affilateRedirection,$http({method:"POST",url:url,data:request}).success(function(callback,status){var Response=JSON.parse(callback);$window.location.href=$rootScope.affilateURL,console.log("API Response : "+Response)}).error(function(data,status){$window.location.href=$rootScope.affilateURL}),$window.location.href=$rootScope.affilateURL}else $window.location.href=$rootScope.affilateURL},loadDatbase(function(){idepProdEnv&&($rootScope.modalSurvey=!0),$scope.p365Labels=travelPolicyLabels,$scope.policies365Details=policies365Details,$rootScope.wordPressEnabled=wordPressEnabled,$rootScope.loaderContent={businessLine:"5",header:"Travel Insurance",desc:$sce.trustAsHtml($scope.p365Labels.common.proverbBuyProduct)},$rootScope.title=$scope.p365Labels.policies365Title.travelPaySuccess,$scope.authenticate={},$scope.showSuccessScreen=!1,"undefined"!=String($location.search().proposalId)&&null!=$location.search().proposalId&&($scope.proposalId=$location.search().proposalId,$scope.proposalDocParam={},$scope.proposalDocParam.proposalId=$scope.proposalId,$scope.proposalDocParam.businessLineId=5,RestAPI.invoke("proposalDataReader",$scope.proposalDocParam).then(function(proposalDataResponse){1e3==proposalDataResponse.responsecode?($scope.proposalDataResponse=proposalDataResponse.data.PolicyTransaction,$scope.proposalRequest=angular.copy($scope.proposalDataResponse.proposalRequest),$scope.proposalDataResponse.bikePolicyResponse.policyNo?1==imauticAutomation&&imatEvent("PaymentGenerated"):1==imauticAutomation&&imatEvent("PaymentSuccess"),localStorageService.get("quoteUserInfo")&&($scope.quoteUserInfo=localStorageService.get("quoteUserInfo"),$scope.quoteUserInfo.createLeadStatus=!0,localStorageService.set("quoteUserInfo",$scope.quoteUserInfo),$scope.quoteUserInfo&&(messageIDVar=$scope.quoteUserInfo.messageId)),$scope.loading=!1,$scope.showSuccessScreen=!1):($scope.loading=!1,$rootScope.P365Alert("Policies365","Some error Occurred ","Ok"))})),$scope.viewPolicy=function(){$scope.modalOTP=!0,$scope.resendOTP()},$scope.closeAuthenticateForm=function(){$scope.modalOTP=!1},$scope.authenticateUser=function(){$scope.disableOTP=!1;var authenticateUserParam={};authenticateUserParam.mobileNumber=$scope.proposalRequest.proposerDetails.mobileNumber,authenticateUserParam.OTP=Number($scope.authenticate.enteredOTP),getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.validateOTP,authenticateUserParam,function(createOTP){if(createOTP.responseCode==$scope.p365Labels.responseCode.success){$scope.invalidOTPError="",$scope.modalOTP=!1;var userLoginInfo={};userLoginInfo.username=createOTP.data.firstName,userLoginInfo.mobileNumber=createOTP.data.mobile,userLoginInfo.status=!0,localStorageService.set("userLoginInfo",userLoginInfo),localStorageService.set("userProfileDetails",createOTP.data),$location.path("/dashboard")}else createOTP.responseCode==$scope.p365Labels.responseCode.noRecordsFound?$scope.invalidOTPError=$scope.p365Labels.validationMessages.invalidOTP:createOTP.responseCode==$scope.p365Labels.responseCode.expiredOTP?$scope.invalidOTPError=$scope.p365Labels.validationMessages.expiredOTP:$scope.invalidOTPError=$scope.p365Labels.validationMessages.authOTP})},$scope.resendOTP=function(){var validateLoginParam={paramMap:{}};validateLoginParam.mobileNumber=$scope.proposalRequest.proposerDetails.mobileNumber,validateLoginParam.funcType=$scope.p365Labels.functionType.optAuth,validateLoginParam.paramMap.OTP=$scope.p365Labels.functionType.otpGenerate,getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.sendSMS,validateLoginParam,function(createOTP){createOTP.responseCode==$scope.p365Labels.responseCode.success?$scope.invalidOTPError="":createOTP.responseCode==$scope.p365Labels.responseCode.blockedMobile?($scope.disableOTP=!0,$scope.invalidOTPError=createOTP.message):$scope.invalidOTPError=$scope.p365Labels.errorMessage.createOTP})}})}]),angular.module("payFailureTravel",["CoreComponentApp","LocalStorageModule","ngMessages"]).controller("payFailureTravelController",["RestAPI","$scope","$rootScope","$location","$http","localStorageService","$timeout","$sce",function(RestAPI,$scope,$rootScope,$location,$http,localStorageService,$timeout,$sce){agencyPortalEnabled&&($scope.agencyPortalEnabled=agencyPortalEnabled),$scope.redirectURL=function(){if(isAPICall){$scope.rampUniqueId="",$scope.rampRedirectURL="";var url="",request={};localStorageService.get("rampUniqueId")&&localStorageService.get("rampRedirectURL")?($scope.rampUniqueId=JSON.parse(localStorageService.get("rampUniqueId")),$scope.rampRedirectURL=JSON.parse(localStorageService.get("rampRedirectURL")),url="https://"+$scope.rampRedirectURL,request.rampUniqueId=$scope.rampUniqueId,request.message="failure"):url=$rootScope.affilateRedirection,$http({method:"POST",url:url,data:request}).success(function(callback,status){var Response=JSON.parse(callback);$window.location.href=$rootScope.affilateURL,console.log("API Response : "+Response)}).error(function(data,status){$window.location.href=$rootScope.affilateURL}),$window.location.href=$rootScope.affilateURL}else $window.location.href=$rootScope.affilateURL},loadDatbase(function(){idepProdEnv&&($rootScope.modalSurvey=!0),$scope.p365Labels=travelPolicyLabels,$scope.statusCode=$location.search().statusCode?$location.search().statusCode:void 0,$rootScope.wordPressEnabled=wordPressEnabled,$rootScope.loaderContent={businessLine:"5",header:"Travel Insurance",desc:$sce.trustAsHtml($scope.p365Labels.common.proverbBuyProduct)},$rootScope.title=$scope.p365Labels.policies365Title.travelPayFailure,$scope.travelResponseToken=localStorageService.get("travelReponseToken"),$scope.selectedProduct=localStorageService.get("selectedProduct"),$scope.quoteUserInfo=localStorageService.get("quoteUserInfo"),messageIDVar=$scope.quoteUserInfo.messageId,$scope.$apply()}),1==imauticAutomation&&imatEvent("PaymentFailure")}]),angular.module("travelPolicyPurchase",["LocalStorageModule"]).controller("travelPolicyPurchaseController",["$scope","localStorageService",function($scope,localStorageService){$scope.policyDocument=localStorageService.get("policyDocDetails"),$scope.businessLineId=localStorageService.get("selectedBusinessLineId"),1==$scope.businessLineId?$scope.lineOfBusiness="Life":2==$scope.businessLineId?$scope.lineOfBusiness="Bike":3==$scope.businessLineId?$scope.lineOfBusiness="Car":5==$scope.businessLineId?$scope.lineOfBusiness="Travel":$scope.lineOfBusiness="Health"}]);