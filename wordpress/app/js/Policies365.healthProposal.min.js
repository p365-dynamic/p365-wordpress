var healthProposalRequestDef={carrierId:0,planId:0,documentType:"HealthProposalRequest",proposerInfo:{personalInfo:{salutation:"",firstName:"",middleName:"",lastName:"",gender:"",martialStatus:"",pancard:"",occupation:"",annualIncome:"",dateOfBirth:null},contactInfo:{houseNo:"",streetDetails:"",locality:"",pincode:0,city:"",state:"",emailId:"",mobile:"",phone:""}},insuredMembers:[],nomineeDetails:{firstName:"",middleName:"",lastName:"",gender:"",dateOfBirth:null,proposerRelationship:"",salutation:"",apointeeDetails:{firstName:"",middleName:"",lastName:"",gender:"",age:"",nomineeRelationship:"",dateOfBirth:null}},medicalQuestionarrie:[],socialStatusDetails:{socialStatus:"",unorganizedSector:"",belowPovertyLine:"",informalSector:"",phyicallyChallenged:""},previousPolicyDetails:{policyNumber:"",insurerName:"",insurerRegisCode:""},declartionDetails:[],coverageDetails:{carrierQuoteId:"",policyStartDate:"",policyEndDate:"",policyTerm:0,sumAssured:0,basePremium:0,serviceTax:0,cessTax:0,otherTax:0,totalPremium:0,riders:[]}},healthDieaseDef={dieaseCode:0,dieaseName:"",desc:"",applicable:null,startDate:"",data:null},medicalDieaseDef={questionCode:0,dieaseName:"",desc:"",applicable:null,startDate:"",data:null},healthRiderPremiumDef={riderId:0,premiumAmount:0,serviceTax:0,cessTax:0,otherTax:0,totalPremium:0,sumAssured:0},healthDeclartionDef={declartionType:"",declartionCode:"",accepted:!1,description:""},insuredMemberDef={salutation:"",firstName:"",middleName:"",lastName:"",dateOfBirth:null,relationship:"",gender:"",height:"",weight:0,occupation:"",preExistingDieases:"Y",dieaseDetails:[],carrierMedicalQuestion:[]},medicalQuestionDef={questionCode:"",question:"",questionDesc:"",applicable:null,data:null};angular.module("buyHealth",["CoreComponentApp","LocalStorageModule","checklist-model","ngMessages"]).controller("buyHealthController",["$scope","$rootScope","$timeout","RestAPI","localStorageService","$location","$http","$window","$sce","$filter",function($scope,$rootScope,$timeout,RestAPI,localStorageService,$location,$http,$window,$sce,$filter){$scope.healthProposalSectionHTML=wp_path+"buy/health/html/healthProposalSection.html",$scope.p365Labels=healthProposalLabels,$scope.premiumDetails={},$scope.saveProposal=!1,$scope.saveNomineeDetails=!1,$scope.savePersonalDetails=!1,$scope.saveInsuredDetails=!1,$scope.saveMedicalDetails=!1,$scope.redirectForPayment=!1,$scope.proposalId=null,$scope.prePopulateInsuredDetails=function(){$scope.proposalStatusForm=!1,$scope.proposalApp.proposerInfo.permanentAddress={},$scope.permanentAddressDetails={},$scope.proposalApp.insuredMembers=[],$scope.masterDieaseDetails={};for(var i=0;i<$scope.memberList.length;i++)if($scope.insuredMember=angular.copy($scope.insuredMemberDef),$scope.insuredMember.dateOfBirth=$scope.memberList[i].dob,"Male"==$scope.memberList[i].gender?($scope.insuredMember.gender="M",$scope.insuredMember.salutation="Mr"):($scope.insuredMember.gender="F",$scope.insuredMember.salutation="Ms"),$scope.insuredMember.carrierMedicalQuestion=[],$scope.productValidation.isIndividualNominee?($scope.insuredMember.nomineeDetails={},$scope.insuredMember.nomineeDetails.relationship=$scope.memberList[i].relation):$scope.productValidation.isIndividualNominee=!1,$scope.insuredMember.dieaseDetails.length>=1?$scope.insuredMember.preExistingDieases="Y":$scope.insuredMember.preExistingDieases="N",$scope.insuredMember.relationship=$scope.memberList[i].relation,$scope.insuredMember.relationshipCode=$scope.memberList[i].relationship,"Self"==$scope.insuredMember.relationship?($scope.insuredMember.firstName="undefined"!=String($scope.proposalApp.proposerInfo.personalInfo.firstName)?$scope.proposalApp.proposerInfo.personalInfo.firstName:"",$scope.selfAsInsured=$scope.insuredMember):"Spouse"==$scope.insuredMember.relationship?($scope.insuredMember.firstName="",$scope.spouseAsInsured=$scope.insuredMember):$scope.insuredMember.firstName="",$scope.insuredMember.lastName=$scope.proposalApp.proposerInfo.personalInfo.lastName,$scope.insuredMember.heightUnit="cm",$scope.insuredMember.weightUnit="kg",$scope.proposalApp.insuredMembers.push($scope.insuredMember),$scope.memberList[i].dieaseDetails)for(var diseaseCount=0;diseaseCount<$scope.memberList[i].dieaseDetails.length;diseaseCount++){var key=$scope.insuredMember.relationshipCode+"-"+$scope.memberList[i].dieaseDetails[diseaseCount].masterDieaseCode;$scope.masterDieaseDetails[key]=$scope.memberList[i].dieaseDetails[diseaseCount]}},$scope.checkForPanCardValidation=function(){$scope.productValidation.panCardRequired||(Number($scope.proposalApp.coverageDetails.totalPremium)>=$scope.productValidation.panAmount?$scope.productValidation.panCardRequired=!0:$scope.productValidation.panCardRequired=!1)},$scope.backToResultScreen=function(){$location.path("/healthResult")},$scope.prePopulateProposerDetails=function(){$scope.userGeoDetails=localStorageService.get("commAddressDetails");localStorageService.get("quoteUserInfo");$scope.memberList=$scope.selectedProductInputParam.personalInfo.selectedFamilyMembers,$scope.proposalApp.proposerInfo.personalInfo.gender=$scope.selectedProductInputParam.quoteParam.selfGender,$scope.proposalApp.proposerInfo.personalInfo.riders=$scope.selectedProductInputParam.quoteParam.riders,$scope.userGeoDetails.area?$scope.proposalApp.proposerInfo.contactInfo.locality=$scope.userGeoDetails.area:$scope.proposalApp.proposerInfo.contactInfo.locality="",$scope.userGeoDetails.city?$scope.proposalApp.proposerInfo.contactInfo.city=$scope.userGeoDetails.city:$scope.proposalApp.proposerInfo.contactInfo.city={},$scope.proposalApp.proposerInfo.contactInfo.state=$scope.userGeoDetails.state?$scope.userGeoDetails.state:"",$scope.proposalApp.proposerInfo.contactInfo.pincode=$scope.userGeoDetails.pincode?$scope.userGeoDetails.pincode:"",$scope.quoteUserInfo&&($scope.proposalApp.proposerInfo.contactInfo.emailId=$scope.quoteUserInfo.emailId?$scope.quoteUserInfo.emailId:"",$scope.proposalApp.proposerInfo.contactInfo.mobile=$scope.quoteUserInfo.mobileNumber?$scope.quoteUserInfo.mobileNumber:"",$scope.proposalApp.proposerInfo.personalInfo.lastName=$scope.quoteUserInfo.lastName?$scope.quoteUserInfo.lastName:"",$scope.proposalApp.proposerInfo.personalInfo.firstName=$scope.quoteUserInfo.firstName?$scope.quoteUserInfo.firstName:"",$scope.proposalApp.proposerInfo.personalInfo.lastName=$scope.quoteUserInfo.lastName?$scope.quoteUserInfo.lastName:""),$scope.proposalApp.proposerInfo.personalInfo.salutation="M"==$scope.proposalApp.proposerInfo.personalInfo.gender?"Mr":"Ms",$scope.proposalApp.coverageDetails.policyTerm=$scope.policyTermList[0].term,$scope.proposalApp.coverageDetails.policyTermUnit=$scope.policyTermList[0].unit;for(var i=0;i<$scope.memberList.length;i++)if("Self"==$scope.memberList[i].relation){$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth=$scope.memberList[i].dob,$scope.proposerAge=getAgeFromDOB($scope.proposalApp.proposerInfo.personalInfo.dateOfBirth),$scope.storedDOB=angular.copy($scope.proposalApp.proposerInfo.personalInfo.dateOfBirth),$scope.selectedGender=angular.copy($scope.proposalApp.proposerInfo.personalInfo.gender);break}$scope.newPinCode=angular.copy($scope.proposalApp.proposerInfo.contactInfo),$scope.checkForPanCardValidation(),$scope.prePopulateInsuredDetails()},$scope.changeRegAddress=function(){$scope.permanentAddressDetails.isAddressSameAsCommun?($scope.permanentAddressDetails.houseNo=$scope.proposalApp.proposerInfo.contactInfo.houseNo,$scope.permanentAddressDetails.streetDetails=$scope.proposalApp.proposerInfo.contactInfo.streetDetails,$scope.permanentAddressDetails.pincode=$scope.proposalApp.proposerInfo.contactInfo.pincode,$scope.permanentAddressDetails.locality=$scope.proposalApp.proposerInfo.contactInfo.locality,$scope.permanentAddressDetails.city=$scope.proposalApp.proposerInfo.contactInfo.city,$scope.permanentAddressDetails.state=$scope.proposalApp.proposerInfo.contactInfo.state,$scope.proposalApp.proposerInfo.personalInfo.pincode=$scope.proposalApp.proposerInfo.contactInfo.pincode,$scope.proposalApp.proposerInfo.personalInfo.locality=$scope.proposalApp.proposerInfo.contactInfo.locality,$scope.proposalApp.proposerInfo.personalInfo.city=$scope.proposalApp.proposerInfo.contactInfo.city,$scope.proposalApp.proposerInfo.personalInfo.state=$scope.proposalApp.proposerInfo.contactInfo.state,$scope.proposalApp.proposerInfo.permanentAddress.pincode=$scope.proposalApp.proposerInfo.contactInfo.pincode,$scope.proposalApp.proposerInfo.permanentAddress.locality=$scope.proposalApp.proposerInfo.contactInfo.locality,$scope.proposalApp.proposerInfo.permanentAddress.city=$scope.proposalApp.proposerInfo.contactInfo.city,$scope.proposalApp.proposerInfo.permanentAddress.state=$scope.proposalApp.proposerInfo.contactInfo.state):($scope.permanentAddressDetails.houseNo="",$scope.permanentAddressDetails.streetDetails="",$scope.permanentAddressDetails.pincode="",$scope.permanentAddressDetails.locality="",$scope.permanentAddressDetails.city="",$scope.permanentAddressDetails.state=""),$scope.proposalApp.proposerInfo.permanentAddress=$scope.permanentAddressDetails},$scope.prePopulateInsuranceDetails=function(){$scope.diseaseShow=!1,$scope.proposalApp.socialStatusDetails.socialStatus="No",$scope.proposalApp.socialStatusDetails.unorganizedSector="No",$scope.proposalApp.socialStatusDetails.belowPovertyLine="No",$scope.proposalApp.socialStatusDetails.informalSector="No",$scope.proposalApp.socialStatusDetails.phyicallyChallenged="No",$scope.insuranceDetails.preDiseaseStatus=$scope.selectedProductInputParam.personalInfo.preDiseaseStatus,"Yes"==$scope.insuranceDetails.preDiseaseStatus?($scope.preDiseaseApplicable="true",$scope.diseaseShow=!0):$scope.preDiseaseApplicable="false",$scope.prePopulateProposerDetails()},$scope.populateCoverageDetails=function(){var polEndDate;if($scope.selectedProduct=localStorageService.get("healthSelectedProduct"),$scope.insuranceInfo={},$scope.insuranceInfo.policyStartDate=new Date((new Date).setDate((new Date).getDate()+1)),convertDateFormatToString($scope.insuranceInfo.policyStartDate,function(formattedPolStartDate){$scope.proposalApp.coverageDetails.policyStartDate=formattedPolStartDate}),"undefined"!==String($scope.insuranceInfo.policyStartDate)){var futureDate=new Date((new Date).setDate((new Date).getDate()+Number($scope.productValidation.policyStartDateLimit)));if($scope.insuranceInfo.policyStartDate<=new Date||$scope.insuranceInfo.policyStartDate>futureDate){var todayDate=new Date((new Date).setDate((new Date).getDate()+1));$scope.proposalApp.coverageDetails.policyStartDate=Number(todayDate.getDate())+"/"+(Number(todayDate.getMonth())+1)+"/"+todayDate.getFullYear(),polEndDate=new Date(todayDate.setFullYear(todayDate.getFullYear()+1)),$scope.proposalApp.coverageDetails.policyEndDate=Number(polEndDate.getDate())+"/"+(Number(polEndDate.getMonth())+1)+"/"+polEndDate.getFullYear()}else{var tempPolicyExpiryDate=$scope.insuranceInfo.policyStartDate;polEndDate=new Date(tempPolicyExpiryDate.setFullYear(tempPolicyExpiryDate.getFullYear()+1)),polEndDate=new Date(polEndDate.setDate(polEndDate.getDate()-1)),convertDateFormatToString(polEndDate,function(formattedPolEndDate){$scope.proposalApp.coverageDetails.policyEndDate=formattedPolEndDate})}}$scope.proposalApp.proposerInfo.personalInfo.riders=$scope.selectedProductInputParam.quoteParam.riders,$scope.proposalApp.coverageDetails.sumAssured=$scope.selectedProduct.sumInsured,$scope.proposalApp.coverageDetails.totalPremium=$scope.selectedProduct.annualPremium,$scope.proposalApp.coverageDetails.basePremium=$scope.selectedProduct.basicPremium,$scope.proposalApp.coverageDetails.serviceTax=$scope.selectedProduct.serviceTax,$scope.selectedProduct.totalCount&&($scope.proposalApp.coverageDetails.totalCount=$scope.selectedProduct.totalCount),$scope.proposalApp.carrierId=Number($scope.selectedProduct.carrierId),$scope.proposalApp.planId=Number($scope.selectedProduct.planId),$scope.proposalApp.coverageDetails.carrierQuoteId=$scope.selectedProduct.carrierQuoteId,$scope.proposalApp.coverageDetails.deductible=$scope.selectedProduct.deductible,$scope.newdeductible=angular.copy($scope.proposalApp.coverageDetails.deductible),$scope.selectedProduct.deductibleAmount&&($scope.proposalApp.coverageDetails.deductible=$scope.selectedProduct.deductibleAmount),null!=$scope.proposalApp.proposerInfo.personalInfo.riders&&($scope.proposalApp.coverageDetails.riders=$scope.proposalApp.proposerInfo.personalInfo.riders),$scope.productValidation.selfMarriedRestricted,$scope.prePopulateInsuranceDetails()},$scope.init=function(){$scope.numRecords=4,$scope.page=1,$scope.treatmentGiven=[{value:"Out Patient"},{value:"treatmentGiven"}],$scope.proposalApp=healthProposalRequestDef,$scope.healthDieaseDef=healthDieaseDef,$scope.medicalDieaseDef=medicalDieaseDef,$scope.healthRiderPremiumDef=healthRiderPremiumDef,$scope.healthDeclartionDef=healthDeclartionDef,$scope.insuredMemberDef=insuredMemberDef,$scope.riderDef=healthRiderPremiumDef,$scope.undertakingList=religareUndertakingList,$scope.annualIncomesRange=annualIncomesGeneric,$scope.yesNoStatus=yesNoStatusGeneric,$scope.proposerInfo={},$scope.authenticate={},$scope.insuranceDetails={},$scope.insuredDetails={},$scope.insuredList=[],$scope.policyTermList=[],$scope.screenOneStatus=!0,$scope.screenTwoStatus=!1,$scope.screenThreeStatus=!1,$scope.screenFourStatus=!1,$scope.screenFiveStatus=!1,$scope.updateBtnStatus=!1,$scope.addBtnStatus=!0,$scope.insuredFormValid=!0,$scope.proposalFormValid=!0,$scope.loading=!1,$scope.diseaseQuestionFormError="",$scope.accordion="1",$scope.salutationsList=[{value:"Mr",display:"Mr."},{value:"Ms",display:"Ms."},{value:"Mrs",display:"Mrs."}],$scope.maritalStatusType=maritalStatusListGeneric,$scope.diabetesMellitusTermList=diabetesMellitusTermListGeneric,$scope.nomineeRelationType=nomineeRelationTypeGeneric,$scope.appointeeRelationType=nomineeRelationTypeGeneric,$scope.nomineeRelationTypeFuture=nomineeRelationFutureTypeGeneric,$scope.diseaseQuestionList=religareDiseaseQuestionList,$scope.genderType=genderTypeGeneric,$scope.monthList=healthmonthListGeneric,$scope.policyTermList=getPolicyTerms($scope.productValidation.policyTermLimit),1e3==$scope.productValidation.policyStartDateLimit&&($scope.productValidation.policyStartDateLimit=getDays(getCurrentFinancialYearDate(),1)),localStorageService.get("professionalQuoteParams")&&localStorageService.get("professionalQuoteParams").commonInfo?$scope.commonInfo=localStorageService.get("professionalQuoteParams").commonInfo:localStorageService.get("quoteUserInfo")&&($scope.commonInfo=localStorageService.get("quoteUserInfo"),$scope.commonInfo.salutation="F"==$scope.proposalApp.proposerInfo.personalInfo.gender?"Miss":"Mr"),$scope.populateCoverageDetails(),$scope.updateSalutation=function(relation){$scope.productValidation.isNomineeSalutationRequired&&("Spouse"==relation?"M"==$scope.proposalApp.proposerInfo.personalInfo.gender?($scope.salutationsList=[{value:"Mrs",display:"Mrs."}],$scope.proposalApp.nomineeDetails.salutation="Mrs"):($scope.salutationsList=[{value:"Mr",display:"Mr."}],$scope.proposalApp.nomineeDetails.salutation="Mr"):"Son"==relation||"Brother"==relation||"Father"==relation?($scope.salutationsList=[{value:"Mr",display:"Mr."}],$scope.proposalApp.nomineeDetails.salutation="Mr"):"Daughter"!=relation&&"Mother"!=relation&&"Sister"!=relation||("Mother"==relation?($scope.salutationsList=[{value:"Mrs",display:"Mrs."}],$scope.proposalApp.nomineeDetails.salutation="Mrs"):($scope.salutationsList=[{value:"Ms",display:"Ms."},{value:"Mrs",display:"Mrs."}],$scope.proposalApp.nomineeDetails.salutation="Ms")))},$scope.deductibleDiv=!1,$scope.deductibleDropdown=function(){$scope.selectedProduct.deductible&&($scope.deductibleDiv=!0,$scope.selectedProduct.sumInsured<=3e5?$scope.deductibleRange=deductiblePlanA:$scope.selectedProduct.sumInsured>=4e5&&$scope.selectedProduct.sumInsured<=1e6?$scope.deductibleRange=deductiblePlanB:$scope.deductibleRange=deductiblePlanC)},$scope.deductibleDropdown();var searchData={documentType:"DiseaseQuestion"};searchData.carrierId=$scope.selectedProduct.carrierId,searchData.planId=$scope.selectedProduct.planId,searchData.riders=$scope.proposalApp.coverageDetails.riders,getDocUsingParam(RestAPI,"getHealthQuestionList",searchData,function(callback){$scope.medicalQuestionarrier=callback.data;for(var i=0;i<$scope.medicalQuestionarrier.length;i++)"PREXDISEA"==$scope.medicalQuestionarrier[i].questionCode&&"true"==$scope.medicalQuestionarrier[i].applicable&&($scope.diseaseShow,$scope.clicktoShowDisease());$scope.checkForStartHealth=!1;var searchDiseaseData={documentType:"DiseaseMapping"};searchDiseaseData.carrierId=$scope.selectedProduct.carrierId,searchDiseaseData.planId=$scope.selectedProduct.planId,searchDiseaseData.riders=$scope.proposalApp.coverageDetails.riders,getDocUsingParam(RestAPI,"getHealthQuestionList",searchDiseaseData,function(callback){$scope.diseaseList=callback.data,$scope.numberOfPages=Math.ceil($scope.diseaseList.length/$scope.numRecords),$scope.diseaseListDisable=angular.copy($scope.diseaseList);for(var i=0;i<$scope.diseaseListDisable.length;i++)$scope.diseaseListDisable[i].subParentId=$scope.diseaseListDisable[i].parentId})})},$scope.isDieaseApplicable=function(relationshipCode,masterDieasesCode){var key=relationshipCode+"-"+masterDieasesCode;return null!=$scope.masterDieaseDetails[key]},$scope.isDisableApplicable=function(parentId){for(var i=0;i<$scope.diseaseListDisable.length;i++)return parentId!=$scope.diseaseListDisable[i].subParentId},$scope.setDropDown3=function(dropDown){$scope.dropdownValue3=JSON.parse(dropDown)},$scope.setDropDown4=function(dropDown){$scope.dropdownValue4=JSON.parse(dropDown)},$scope.getAnnualIncome=function(income){$scope.proposalApp.proposerInfo.personalInfo.annualIncome=income.annualIncome},$scope.changeOccupation=function(){"undefined"!=String($scope.selfAsInsured)&&($scope.selfAsInsured.occupation=$scope.proposalApp.proposerInfo.personalInfo.occupation)},$scope.changeGender=function(){if("undefined"!=String($scope.selectedGender)||null!=$scope.selectedGender)if($scope.proposalApp.proposerInfo.personalInfo.salutation="M"==$scope.proposalApp.proposerInfo.personalInfo.gender?"Mr":"Ms",$scope.selfAsInsured.gender=$scope.proposalApp.proposerInfo.personalInfo.gender,$scope.selfAsInsured.salutation="M"==$scope.selfAsInsured.gender?"Mr":"Ms",$scope.commonInfo&&($scope.commonInfo.salutation="F"==$scope.selfAsInsured.gender?"Miss":"Mr"),"M"==$scope.selfAsInsured.gender&&$scope.spouseAsInsured?($scope.spouseAsInsured.gender="F",$scope.spouseAsInsured.salutation="M"==$scope.spouseAsInsured.gender?"Mr":"Ms"):"F"==$scope.selfAsInsured.gender&&$scope.spouseAsInsured&&($scope.spouseAsInsured.gender="M",$scope.spouseAsInsured.salutation="M"==$scope.spouseAsInsured.gender?"Mr":"Ms"),$scope.selectedGender!=$scope.proposalApp.proposerInfo.personalInfo.gender)$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.genderChangeMsg,"No","Yes",function(confirmStatus){if(confirmStatus){$scope.loading=!0,$scope.selectedProductInputParamForPin.quoteParam.selfGender=$scope.proposalApp.proposerInfo.personalInfo.gender;for(var i=0;i<$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers.length;i++)"Self"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation&&($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender=$scope.selfAsInsured.gender,$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].salutation=$scope.selfAsInsured.salutation),"Spouse"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation&&($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender=$scope.spouseAsInsured.gender,$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].salutation=$scope.spouseAsInsured.salutation),"M"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender&&($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender="Male"),"F"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender&&($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender="Female");for(i=0;i<$scope.selectedProductInputParamForPin.quoteParam.dependent.length;i++)"S"==$scope.selectedProductInputParamForPin.quoteParam.dependent[i].relationShip&&($scope.selectedProductInputParamForPin.quoteParam.dependent[i].gender=$scope.selectedProductInputParamForPin.quoteParam.selfGender),"SP"==$scope.selectedProductInputParamForPin.quoteParam.dependent[i].relationShip&&"M"==$scope.selectedProductInputParamForPin.quoteParam.selfGender&&($scope.selectedProductInputParamForPin.quoteParam.dependent[i].gender="F"),"SP"==$scope.selectedProductInputParamForPin.quoteParam.dependent[i].relationShip&&"F"==$scope.selectedProductInputParamForPin.quoteParam.selfGender&&($scope.selectedProductInputParamForPin.quoteParam.dependent[i].gender="M");null!=$scope.selectedProduct.childPlanId&&($scope.selectedProductInputParamForPin.childPlanId=Number($scope.selectedProduct.childPlanId)),$scope.selectedProductInputParamForPin.sumInsured=$scope.selectedProduct.sumInsured,localStorageService.get("quoteUserInfo").mobileNumber&&($scope.selectedProductInputParamForPin.mobileNumber=localStorageService.get("quoteUserInfo").mobileNumber),$scope.quote=localStorageService.get("healthQuoteInputParamaters"),$scope.quote.personalInfo=$scope.selectedProductInputParamForPin.personalInfo,$scope.quote.quoteParam=$scope.selectedProductInputParamForPin.quoteParam,localStorageService.set("healthQuoteInputParamaters",$scope.quote),localStorageService.get("PROF_QUOTE_ID")&&($scope.selectedProductInputParamForPin.PROF_QUOTE_ID=localStorageService.get("PROF_QUOTE_ID")),RestAPI.invoke($scope.p365Labels.getRequest.quoteHealth,$scope.selectedProductInputParamForPin).then(function(callback){if($scope.healthRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success)$scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("HEALTH_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.healthRecalculateQuoteRequest=callback.data,$scope.healthQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.healthRecalculateQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=$scope.p365Labels.transactionName.healthQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var healthQuoteResponse=JSON.parse(callback);if($scope.responseRecalculateCodeList.push(healthQuoteResponse.responseCode),healthQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId&&(healthQuoteResponse.data.quotes[0].childPlanId?healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId&&($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,healthQuoteResponse.data.quotes[0].basicPremium&&($scope.proposalApp.coverageDetails.basePremium=healthQuoteResponse.data.quotes[0].basicPremium),healthQuoteResponse.data.quotes[0].serviceTax&&($scope.proposalApp.coverageDetails.serviceTax=healthQuoteResponse.data.quotes[0].serviceTax),$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId)):($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,healthQuoteResponse.data.quotes[0].basicPremium&&($scope.proposalApp.coverageDetails.basePremium=healthQuoteResponse.data.quotes[0].basicPremium),healthQuoteResponse.data.quotes[0].serviceTax&&($scope.proposalApp.coverageDetails.serviceTax=healthQuoteResponse.data.quotes[0].serviceTax),$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId))),healthQuoteResponse.data.quotes[0].id=healthQuoteResponse.messageId,$scope.quoteCalcResponse.push(healthQuoteResponse.data.quotes[0]);else if(null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId)if($scope.selectedProduct.childPlanId){if(healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId){$scope.loading=!1,$scope.proposalApp.proposerInfo.personalInfo.gender="";var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgGender;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}else{$scope.loading=!1,$scope.proposalApp.proposerInfo.personalInfo.gender="";screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgGender;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})});else{$scope.loading=!1,$scope.proposalApp.proposerInfo.personalInfo.gender="";var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgGender;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}),$scope.selectedGender=$scope.proposalApp.proposerInfo.personalInfo.gender,$scope.proposalApp.proposerInfo.personalInfo.gender=$scope.selectedGender;for(var j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].gender=$scope.proposalApp.proposerInfo.personalInfo.gender)}else{$scope.loading=!1,$scope.proposalApp.proposerInfo.personalInfo.gender=$scope.selectedGender,$scope.commonInfo&&($scope.commonInfo.salutation="F"==$scope.proposalApp.proposerInfo.personalInfo.gender?"Miss":"Mr"),$scope.selectedGender=$scope.proposalApp.proposerInfo.personalInfo.gender;for(j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].gender=$scope.proposalApp.proposerInfo.personalInfo.gender)}});else{$scope.proposalApp.proposerInfo.personalInfo.gender=$scope.selectedGender,$scope.commonInfo&&($scope.commonInfo.salutation="F"==$scope.proposalApp.proposerInfo.personalInfo.gender?"Miss":"Mr"),$scope.selectedGender=$scope.proposalApp.proposerInfo.personalInfo.gender;for(var j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].gender=$scope.proposalApp.proposerInfo.personalInfo.gender)}},$scope.getYearList=function(dateofBirth){var dateArr=dateofBirth.split("/"),newDOB=dateArr[1]+"/"+dateArr[0]+"/"+dateArr[2];return listRegistrationYear("buyScreen",calculateAgeByDOB(newDOB))},$scope.setDieaseStartDate=function(insuredDieaseDetails){null!=insuredDieaseDetails.startMonth?insuredDieaseDetails.startDate="01/"+insuredDieaseDetails.startMonth+"/"+insuredDieaseDetails.startYear:null!=insuredDieaseDetails.startYear&&(insuredDieaseDetails.startDate="01/01/"+insuredDieaseDetails.startYear)},$scope.closeDiseaseQuestionModal=function(selInsuredInfo){for(var deleteList=[],i=0;i<$scope.diseaseQuestionList.length;i++)1==p365Includes(selInsuredInfo.selectedDiseaseQuestions,$scope.diseaseQuestionList[i].id)&&1==$scope.diseaseQuestionList[i].existSinceError&&(deleteList.push($scope.diseaseQuestionList[i].id),$scope.diseaseQuestionList[i].existSinceError=!1);0==selInsuredInfo.selectedDiseaseQuestions.length&&(selInsuredInfo.preExistingDisease="No"),selInsuredInfo.selectedDiseaseQuestions=selInsuredInfo.selectedDiseaseQuestions.filter(function(obj){return-1===deleteList.indexOf(obj)}),$scope.diseaseQuestionFormError="",$scope.modalHealthQuestion=!1},$scope.getDiseaseQuestions=function(getDiseaseQuestions){return selInsuredInfo.selectedDiseaseQuestions},$scope.checkDiseaseQuestion=function(selId,selStatus){for(var i=0;i<$scope.diseaseQuestionList.length;i++)$scope.diseaseQuestionList[i].id==selId&&($scope.diseaseQuestionList[i].status=1==selStatus?"Yes":"No")},$scope.submitDiseaseQuestions=function(selInsuredInfo){if(!$scope.healthQuestionForm.$invalid&&$scope.validateDiseaseQuestionForm()){$scope.diseaseQuestionFormError="";for(var i=0;i<$scope.diseaseQuestionList.length;i++)delete $scope.diseaseQuestionList[i].$$hashKey;0==selInsuredInfo.selectedDiseaseQuestions.length&&(selInsuredInfo.preExistingDisease="No"),selInsuredInfo.diseaseQuestionList=$scope.diseaseQuestionList,$scope.modalHealthQuestion=!1}else $scope.diseaseQuestionFormError="Do not let left any selected field empty or invalid."},$scope.submitDieaseList=function($mdMenu,ev){$scope.diseaseShow=!1},$scope.changeInsuredHospitalCash=function(selInsuredInfo){"1"==selInsuredInfo.hospitalCash?$rootScope.P365Confirm("Policies365","You have Hospital Cash benefit of Rs. 1000 for each completed day of hospitalization subject to max. of 7 days per hospitalization and 14 days for a policy period. This will increase your premium by Rs.403 ( Premium 350+ Service Tax of Rs. 53) over what is quoted.  Are you sure want to proceed?","No","Yes",function(confirmStatus){confirmStatus?$scope.selectedProduct.annualPremium=Number($scope.selectedProduct.annualPremium)+403:selInsuredInfo.hospitalCash="0"}):$scope.selectedProduct.annualPremium=Number($scope.selectedProduct.annualPremium)-403},$scope.changeInsuredPersonalAccident=function(selInsuredInfo){for(var adultLimit=Number($scope.productValidation.personalAccidentCoverLimit.adult),childLimit=Number($scope.productValidation.personalAccidentCoverLimit.child),totalCount=0,i=0;i<$scope.insuredList.length;i++)"true"==$scope.insuredList[i].isPersonalAccidentApplicable&&(totalCount+=1);"true"==selInsuredInfo.isPersonalAccidentApplicable&&(totalCount<=childLimit+adultLimit?"Son"==selInsuredInfo.relation||"Daughter"==selInsuredInfo.relation?childLimit<1&&(selInsuredInfo.isPersonalAccidentApplicable="false",$rootScope.P365Alert("Policies365",$scope.productValidation.messages.personalAccidentCover,"Ok")):adultLimit<1&&(selInsuredInfo.isPersonalAccidentApplicable="false",$rootScope.P365Alert("Policies365",$scope.productValidation.messages.personalAccidentCover,"Ok")):(selInsuredInfo.isPersonalAccidentApplicable="false",$rootScope.P365Alert("Policies365",$scope.productValidation.messages.personalAccidentCover,"Ok")))},$scope.validateExistSince=function(selInsuredInfo,selExistSince,selIndex){if("undefined"!=String(selExistSince)){var todayDate=new Date,diseaseExistDateArray=selExistSince.split("/"),diseaseExistDate=new Date(diseaseExistDateArray[1]+"/"+diseaseExistDateArray[0]+"/"+diseaseExistDateArray[2]),InsuredDOBArray=selInsuredInfo.dateOfBirth.split("/");diseaseExistDate<new Date(InsuredDOBArray[1]+"/"+InsuredDOBArray[0]+"/"+InsuredDOBArray[2])||diseaseExistDate>todayDate?($scope.diseaseQuestionList[selIndex].existSinceError=!0,selExistSince=InsuredDOBArray[0]+"/"+InsuredDOBArray[1]+"/"+InsuredDOBArray[2]):$scope.diseaseQuestionList[selIndex].existSinceError=!1}else $scope.diseaseQuestionList[selIndex].existSinceError=!0},$scope.validateDiseaseQuestionForm=function(){for(var i=0;i<$scope.diseaseQuestionList.length;i++)if(1==$scope.diseaseQuestionList[i].existSinceError)return!1;return!0},$scope.initHealthBuyScreen=function(){if($scope.selectedProduct.selectedFamilyMembers)for(var i=0;i<$scope.selectedProduct.selectedFamilyMembers.length;i++){if("CH"==$scope.selectedProduct.selectedFamilyMembers[i].relationship)var childMinDOBOption=$scope.selectedProduct.selectedFamilyMembers[i].minDOB,childMaxDOBOption=$scope.selectedProduct.selectedFamilyMembers[i].maxDOB;if("SP"==$scope.selectedProduct.selectedFamilyMembers[i].relationship||"A"==$scope.selectedProduct.selectedFamilyMembers[i].relationship)var selfMinDOBOption=$scope.selectedProduct.selectedFamilyMembers[i].minDOB,selfMaxDOBOption=$scope.selectedProduct.selectedFamilyMembers[i].maxDOB;if("S"==$scope.selectedProduct.selectedFamilyMembers[i].relationship){var selfInsuredMinDOBOption=$scope.selectedProduct.selectedFamilyMembers[i].minDOB;$scope.selectedProduct.selectedFamilyMembers[i].maxDOB}var selfInsuredDOBOption={};selfMinDOBOption&&selfMaxDOBOption?(selfInsuredDOBOption.minimumDateStringFormat=selfMinDOBOption,selfInsuredDOBOption.maximumDateStringFormat=selfMaxDOBOption):(selfInsuredDOBOption.minimumYearLimit="-"+$scope.productValidation.insuredAdultAgeMax.age+"Y",selfInsuredDOBOption.maximumYearLimit="-"+$scope.productValidation.insuredAdultAgeMin.age+"Y"),selfInsuredDOBOption.changeMonth=!0,selfInsuredDOBOption.changeYear=!0,selfInsuredDOBOption.dateFormat="dd/mm/yy",$scope["selfInsuredDateOptions"+i]=setP365DatePickerProperties(selfInsuredDOBOption);var selfInsuredDOBOptionDiseaseS={};selfInsuredMinDOBOption&&(selfInsuredDOBOptionDiseaseS.minimumDateStringFormat=selfInsuredMinDOBOption,selfInsuredDOBOptionDiseaseS.maximumDateStringFormat="0"),selfInsuredDOBOptionDiseaseS.changeMonth=!0,selfInsuredDOBOptionDiseaseS.changeYear=!0,selfInsuredDOBOptionDiseaseS.dateFormat="dd/mm/yy",$scope["selfInsuredDOBOptionDiseaseS"+i]=setP365DatePickerProperties(selfInsuredDOBOptionDiseaseS);var selfInsuredDOBOptionDiseaseSP={};if(selfMinDOBOption&&selfMaxDOBOption&&(selfInsuredDOBOptionDiseaseSP.minimumDateStringFormat=selfMinDOBOption,selfInsuredDOBOptionDiseaseSP.maximumDateStringFormat="0"),selfInsuredDOBOptionDiseaseSP.changeMonth=!0,selfInsuredDOBOptionDiseaseSP.changeYear=!0,selfInsuredDOBOptionDiseaseSP.dateFormat="dd/mm/yy",$scope["selfInsuredDOBOptionDiseaseSP"+i]=setP365DatePickerProperties(selfInsuredDOBOptionDiseaseSP),null!=$scope.productValidation.insuredChildAgeMax){var childInsuredDateOption={};childMinDOBOption&&childMaxDOBOption&&($scope.productValidation.hdfcChildMinYearLimit?(childInsuredDateOption.minimumYearLimit="-"+$scope.productValidation.hdfcInsuredChildAgeMax+"Y - 1D",childInsuredDateOption.maximumYearLimit="-"+$scope.productValidation.hdfcInsuredChildAgeMin+"D"):(childInsuredDateOption.minimumDateStringFormat=childMinDOBOption,childInsuredDateOption.maximumDateStringFormat=childMaxDOBOption)),childInsuredDateOption.changeMonth=!0,childInsuredDateOption.changeYear=!0,childInsuredDateOption.dateFormat="dd/mm/yy",$scope["childInsuredDateOptions"+i]=setP365DatePickerProperties(childInsuredDateOption)}if(null!=$scope.productValidation.insuredChildAgeMax){var childInsuredDateOptionDisease={};childMinDOBOption&&childMaxDOBOption&&(childInsuredDateOptionDisease.minimumDateStringFormat=childMinDOBOption,childInsuredDateOptionDisease.maximumDateStringFormat="0"),childInsuredDateOptionDisease.changeMonth=!0,childInsuredDateOptionDisease.changeYear=!0,childInsuredDateOptionDisease.dateFormat="dd/mm/yy",$scope["childInsuredDateOptionDisease"+i]=setP365DatePickerProperties(childInsuredDateOptionDisease)}}var proposerDOBOption={};$scope.productValidation.hdfcMinYearLimit?proposerDOBOption.minimumYearLimit="-"+$scope.productValidation.hdfcProposerMaxAge+"Y - 1D":proposerDOBOption.minimumYearLimit="-"+$scope.productValidation.proposerAgeMax.age+"Y",proposerDOBOption.maximumYearLimit="-"+$scope.productValidation.proposerAgeMin.age+"Y",proposerDOBOption.changeMonth=!0,proposerDOBOption.changeYear=!0,proposerDOBOption.dateFormat="dd/mm/yy",$scope.proposerDOBOptions=setP365DatePickerProperties(proposerDOBOption);var nomineeDOBOption={};nomineeDOBOption.minimumYearLimit="-"+$scope.productValidation.proposerAgeMax.age+"Y",nomineeDOBOption.maximumYearLimit="-1Y",nomineeDOBOption.changeMonth=!0,nomineeDOBOption.changeYear=!0,nomineeDOBOption.dateFormat="dd/mm/yy",$scope.nomineeDOBOptions=setP365DatePickerProperties(nomineeDOBOption);var appointeeDOBOption={};appointeeDOBOption.minimumYearLimit="-"+$scope.productValidation.proposerAgeMax.age+"Y",appointeeDOBOption.maximumYearLimit="-18Y",appointeeDOBOption.changeMonth=!0,appointeeDOBOption.changeYear=!0,appointeeDOBOption.dateFormat="dd/mm/yy",$scope.appointeeDOBOptions=setP365DatePickerProperties(appointeeDOBOption);var DOBOption={minimumYearLimit:"-50Y",maximumYearLimit:"-0Y",changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy"};if($scope.regularDOBOptions=setP365DatePickerProperties(DOBOption),$scope.permanentAddressDetails.isAddressSameAsCommun=!0,$scope.permanentAddressDetails.isAddressSameAsCommun){$scope.permanentAddressDetails.houseNo=$scope.proposalApp.proposerInfo.contactInfo.houseNo,$scope.permanentAddressDetails.streetDetails=$scope.proposalApp.proposerInfo.contactInfo.streetDetails,$scope.permanentAddressDetails.pincode=$scope.proposalApp.proposerInfo.contactInfo.pincode,$scope.permanentAddressDetails.locality=$scope.proposalApp.proposerInfo.contactInfo.locality,$scope.permanentAddressDetails.city=$scope.proposalApp.proposerInfo.contactInfo.city,$scope.permanentAddressDetails.state=$scope.proposalApp.proposerInfo.contactInfo.state,$scope.proposalApp.proposerInfo.personalInfo=$scope.permanentAddressDetails;var quoteUserInfo=localStorageService.get("quoteUserInfo");$scope.proposalApp.proposerInfo.personalInfo.gender=$scope.selectedProductInputParam.quoteParam.selfGender,!$scope.iposRequest.docId&&quoteUserInfo&&($scope.proposalApp.proposerInfo.personalInfo.lastName="undefined"!==String(quoteUserInfo.lastName)?quoteUserInfo.lastName:"",$scope.proposalApp.proposerInfo.personalInfo.firstName="undefined"!==String(quoteUserInfo.firstName)?quoteUserInfo.firstName:""),$scope.proposalApp.proposerInfo.personalInfo.salutation="M"==$scope.proposalApp.proposerInfo.personalInfo.gender?"Mr":"Ms";for(i=0;i<$scope.memberList.length;i++)if("Self"==$scope.memberList[i].relation){$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth=$scope.memberList[i].dob,$scope.proposerAge=getAgeFromDOB($scope.proposalApp.proposerInfo.personalInfo.dateOfBirth);break}}},$scope.initWatch=function(){$scope.proposalApp.proposerInfo.personalInfo.martialStatus=$scope.maritalStatusType[0].name,$scope.proposalApp.nomineeDetails.dateOfBirth&&($scope.nomineeAge=getAgeFromDOB($scope.proposalApp.nomineeDetails.dateOfBirth)),$scope.$watch("selectedProduct.sumInsured",function(newValue){$scope.deductibleDropdown()}),$scope.$watch("proposalApp.proposerInfo.contactInfo.streetDetails",function(newValue){$scope.permanentAddressDetails.isAddressSameAsCommun&&$scope.changeRegAddress()}),$scope.$watch("proposalApp.proposerInfo.contactInfo.houseNo",function(newValue){$scope.permanentAddressDetails.isAddressSameAsCommun&&$scope.changeRegAddress()}),$scope.$watch("proposalApp.proposerInfo.personalInfo.firstName",function(newValue){for(var j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].firstName=$scope.proposalApp.proposerInfo.personalInfo.firstName)}),$scope.$watch("proposalApp.proposerInfo.personalInfo.lastName",function(newValue){for(var j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].lastName=$scope.proposalApp.proposerInfo.personalInfo.lastName)})},$scope.validateMaritalStatus=function(){$scope.productValidation.proposerAgeCheck?$scope.validateData():$scope.productValidation.individualFloaterPlan&&"MARRIED"==$scope.proposalApp.proposerInfo.personalInfo.martialStatus&&($scope.modalIndividualFloaterPlan=!0)},$scope.updateFirstName=function(name){$scope.proposalApp.proposerInfo.personalInfo.firstName=name},$scope.updateLastName=function(name){$scope.proposalApp.proposerInfo.personalInfo.lastName=name},$scope.calculateProposerAge=function(proposerDob){"undefined"!==String(nomineeDob)&&($scope.proposerAge=getAgeFromDOB(proposalApp.proposerInfo.personalInfo.dateOfBirth))},$scope.calculateNomineeAge=function(nomineeDob){"undefined"!==String(nomineeDob)&&($scope.nomineeAge=getAgeFromDOB($scope.proposalApp.nomineeDetails.dateOfBirth))},$scope.calculateApointeeAge=function(apointeeDob){"undefined"!==String(apointeeDob)&&($scope.proposalApp.nomineeDetails.apointeeDetails.age=calculateAgeByDOB(String($scope.proposalApp.nomineeDetails.apointeeDetails.dateOfBirth)))};var bmiArr=[];$scope.bmiMsg=!1,$scope.bmiValidation=function(insuredInfo,index){if(!isNaN(insuredInfo.weight)&&!isNaN(insuredInfo.height)&&String(insuredInfo.weight).length>0&&String(insuredInfo.height).length>0){var height=Number(insuredInfo.height),bmi=Number(insuredInfo.weight)/(height*height)*1e4,bmiVal=Math.round(bmi);if($scope.productValidation.bmirequotecalc){if(bmi>Number($scope.productValidation.bmiMaxLimit)||bmi<Number($scope.productValidation.bmiMinLimit))return $rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.regretPolicyMsg,"Ok"),insuredInfo.height="",insuredInfo.weight="",!1;if(bmi>30&&bmi<=34)$scope.reCalcQuoteOnBMI(bmiVal,insuredInfo);else if(bmi<18.5||bmi>34){var screenCnfrmError=$scope.p365Labels.errorMessage.regretPolicyMsg;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok"),insuredInfo.height="",insuredInfo.weight=""}}else if($scope.productValidation.isBmiValidationApplicable||void 0==$scope.productValidation.isBmiValidationApplicable){if(bmi>Number($scope.productValidation.bmiMaxLimit)||bmi<Number($scope.productValidation.bmiMinLimit))return $rootScope.P365Alert("Policies365",$scope.p365Labels.validationMessages.invalidOptionBuyPolicy,"Ok"),insuredInfo.height="",insuredInfo.weight="",!1}else{Number($scope.productValidation.bmiMaxLimit),bmiArr[index]=bmi;for(var i=0;i<bmiArr.length;i++){if(bmiArr[i]>$scope.productValidation.maxValidBmi||bmiArr[i]<$scope.productValidation.minValidBmi){$scope.bmiMsg=!0;break}$scope.bmiMsg=!1}$scope.productValidation.hdfcBMI&&$scope.bmiMsg&&($scope.proposalApp.hdfcBMI=!0)}}},$scope.reCalcQuoteOnBMI=function(bmiVal,selInsuredInfo){$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.bmiChangeMsg,"No","Yes",function(confirmStatus){if(confirmStatus){$scope.loading=!0;for(var i=0;i<$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers.length;i++)if($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation==selInsuredInfo.relationship){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].bmi=bmiVal;break}for(i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==selInsuredInfo.relationship){$scope.proposalApp.insuredMembers[i].bmi=bmiVal;break}null!=$scope.selectedProduct.childPlanId&&($scope.selectedProductInputParamForPin.childPlanId=Number($scope.selectedProduct.childPlanId)),$scope.selectedProductInputParamForPin.sumInsured=Number($scope.selectedProduct.sumInsured),localStorageService.get("PROF_QUOTE_ID")&&($scope.selectedProductInputParamForPin.PROF_QUOTE_ID=localStorageService.get("PROF_QUOTE_ID")),RestAPI.invoke($scope.p365Labels.getRequest.quoteHealth,$scope.selectedProductInputParamForPin).then(function(callback){if($scope.healthRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success)$scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("HEALTH_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.healthRecalculateQuoteRequest=callback.data,$scope.healthQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.healthRecalculateQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=$scope.p365Labels.transactionName.healthQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var healthQuoteResponse=JSON.parse(callback);if($scope.responseRecalculateCodeList.push(healthQuoteResponse.responseCode),healthQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId&&(healthQuoteResponse.data.quotes[0].childPlanId?healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId&&($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,healthQuoteResponse.data.quotes[0].basicPremium&&($scope.proposalApp.coverageDetails.basePremium=healthQuoteResponse.data.quotes[0].basicPremium),healthQuoteResponse.data.quotes[0].serviceTax&&($scope.proposalApp.coverageDetails.serviceTax=healthQuoteResponse.data.quotes[0].serviceTax),$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId)):($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,healthQuoteResponse.data.quotes[0].basicPremium&&($scope.proposalApp.coverageDetails.basePremium=healthQuoteResponse.data.quotes[0].basicPremium),healthQuoteResponse.data.quotes[0].serviceTax&&($scope.proposalApp.coverageDetails.serviceTax=healthQuoteResponse.data.quotes[0].serviceTax),$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId))),healthQuoteResponse.data.quotes[0].id=healthQuoteResponse.messageId,$scope.quoteCalcResponse.push(healthQuoteResponse.data.quotes[0]);else if(null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId)if($scope.selectedProduct.childPlanId){if(healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId){$scope.loading=!1,selInsuredInfo.height="",selInsuredInfo.weight="";for(var i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==selInsuredInfo.relationship){$scope.proposalApp.insuredMembers[i].bmi=0;break}var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgBmi;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}else{$scope.loading=!1,selInsuredInfo.height="",selInsuredInfo.weight="";for(i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==selInsuredInfo.relationship){$scope.proposalApp.insuredMembers[i].bmi=0;break}screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgBmi;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})});else{$scope.loading=!1,selInsuredInfo.height="",selInsuredInfo.weight="";for(var i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==selInsuredInfo.relationship){$scope.proposalApp.insuredMembers[i].bmi=0;break}var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgBmi;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}})}else{$scope.loading=!1,selInsuredInfo.height="",selInsuredInfo.weight="";for(i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==selInsuredInfo.relationship){$scope.proposalApp.insuredMembers[i].bmi=0;break}}})},$scope.getPinCodeAreaList=function(areaName){var docType;return docType=isNaN(areaName)?"Area":"Pincode",$http.get(getServiceLink+docType+"&q="+areaName).then(function(response){return JSON.parse(response.data).data})},$scope.$watch("noResults",function(newValue){1==newValue&&($scope.proposalApp.proposerInfo.contactInfo.pincode="",$scope.proposalApp.proposerInfo.contactInfo.locality="",$scope.proposalApp.proposerInfo.contactInfo.city="",$scope.proposalApp.proposerInfo.contactInfo.state="")}),$scope.changeDateOfBirth=function(){if("undefined"!=String($scope.storedDOB)||null!=$scope.storedDOB)if($scope.storedDOB!=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth)$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.DobChangeMsg,"No","Yes",function(confirmStatus){if(confirmStatus){$scope.loading=!0;for(var i=0;i<$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers.length;i++)"Self"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation&&($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].dob=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth,$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].age=getProposerAgeFromDOB($scope.proposalApp.proposerInfo.personalInfo.dateOfBirth));$scope.selectedProductInputParamForPin.quoteParam.selfAge=getProposerAgeFromDOB($scope.proposalApp.proposerInfo.personalInfo.dateOfBirth);for(var j=0;j<$scope.selectedProductInputParamForPin.quoteParam.dependent.length;j++)"S"==$scope.selectedProductInputParamForPin.quoteParam.dependent[j].relationShip&&($scope.selectedProductInputParamForPin.quoteParam.dependent[j].age=getProposerAgeFromDOB($scope.proposalApp.proposerInfo.personalInfo.dateOfBirth));null!=$scope.selectedProduct.childPlanId&&($scope.selectedProductInputParamForPin.childPlanId=Number($scope.selectedProduct.childPlanId)),$scope.selectedProductInputParamForPin.sumInsured=$scope.selectedProduct.sumInsured,localStorageService.get("quoteUserInfo").mobileNumber&&($scope.selectedProductInputParamForPin.mobileNumber=localStorageService.get("quoteUserInfo").mobileNumber),localStorageService.set("healthQuoteInputParamaters",$scope.selectedProductInputParamForPin),localStorageService.get("PROF_QUOTE_ID")&&($scope.selectedProductInputParamForPin.PROF_QUOTE_ID=localStorageService.get("PROF_QUOTE_ID")),RestAPI.invoke($scope.p365Labels.getRequest.quoteHealth,$scope.selectedProductInputParamForPin).then(function(callback){if($scope.healthRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success)$scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("HEALTH_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.healthRecalculateQuoteRequest=callback.data,$scope.healthQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.healthRecalculateQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=$scope.p365Labels.transactionName.healthQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var healthQuoteResponse=JSON.parse(callback);if($scope.responseRecalculateCodeList.push(healthQuoteResponse.responseCode),healthQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId&&(healthQuoteResponse.data.quotes[0].childPlanId?healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId&&($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,healthQuoteResponse.data.quotes[0].basicPremium&&($scope.proposalApp.coverageDetails.basePremium=healthQuoteResponse.data.quotes[0].basicPremium),healthQuoteResponse.data.quotes[0].serviceTax&&($scope.proposalApp.coverageDetails.serviceTax=healthQuoteResponse.data.quotes[0].serviceTax),$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId)):($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,healthQuoteResponse.data.quotes[0].basicPremium&&($scope.proposalApp.coverageDetails.basePremium=healthQuoteResponse.data.quotes[0].basicPremium),healthQuoteResponse.data.quotes[0].serviceTax&&($scope.proposalApp.coverageDetails.serviceTax=healthQuoteResponse.data.quotes[0].serviceTax),$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId))),healthQuoteResponse.data.quotes[0].id=healthQuoteResponse.messageId,$scope.quoteCalcResponse.push(healthQuoteResponse.data.quotes[0]);else if(null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId)if($scope.selectedProduct.childPlanId){if(healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId){$scope.loading=!1,$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth="";var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgDob;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}else{$scope.loading=!1,$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth="";screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgDob;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})});else{$scope.loading=!1,$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth="";var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgDob;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}),$scope.storedDOB=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth,$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth=$scope.storedDOB;for(j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].dateOfBirth=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth)}else{$scope.loading=!1,$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth=$scope.storedDOB,$scope.storedDOB=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth;for(j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].dateOfBirth=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth)}});else{$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth=$scope.storedDOB,$scope.storedDOB=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth;for(var j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].dateOfBirth=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth)}},$scope.validateData=function(){$scope.proposerAge<$scope.productValidation.maleMinAgeSingle&&$scope.proposalApp.proposerInfo.personalInfo.martialStatus==$scope.productValidation.checkSingleStatus&&"M"==$scope.proposalApp.proposerInfo.personalInfo.gender?($scope.proposalDetailsForm.dateofbirth.$setValidity("dateofbirth",!0),$scope.proposalDetailsForm.gender.$setValidity("gender",!0),$scope.proposalDetailsForm.maritalStatus.$setValidity("maritalStatus",!0),$scope.errorMsg=!0):$scope.proposerAge<$scope.productValidation.maleMinAgeMarried&&$scope.proposalApp.proposerInfo.personalInfo.martialStatus==$scope.productValidation.checkMarriedStatus&&"M"==$scope.proposalApp.proposerInfo.personalInfo.gender?($scope.proposalDetailsForm.dateofbirth.$setValidity("dateofbirth",!1),$scope.proposalDetailsForm.gender.$setValidity("gender",!1),$scope.proposalDetailsForm.maritalStatus.$setValidity("maritalStatus",!1),$scope.errorMsg=!0):$scope.proposerAge<$scope.productValidation.femaleMinAge&&"F"==$scope.proposalApp.proposerInfo.personalInfo.gender?($scope.proposalDetailsForm.dateofbirth.$setValidity("dateofbirth",!0),$scope.proposalDetailsForm.gender.$setValidity("gender",!0),$scope.proposalDetailsForm.maritalStatus.$setValidity("maritalStatus",!0),$scope.errorMsg=!0):($scope.proposalDetailsForm.dateofbirth.$setValidity("dateofbirth",!0),$scope.proposalDetailsForm.gender.$setValidity("gender",!0),$scope.proposalDetailsForm.maritalStatus.$setValidity("maritalStatus",!0),$scope.errorMsg=!1,$scope.changeDateOfBirth(),$scope.changeGender())},$scope.validateDOB=function(){$scope.selfAsInsured.dateOfBirth=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth,$scope.proposerAge=getAgeFromDOB($scope.proposalApp.proposerInfo.personalInfo.dateOfBirth),$scope.productValidation.proposerAgeCheck?$scope.validateData():$scope.changeDateOfBirth()},$scope.validateGender=function(){$scope.productValidation.proposerAgeCheck?$scope.validateData():$scope.changeGender()},$scope.onSelectPinOrArea=function(item){if($scope.newPinCode.pincode!=item.pincode?$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.locationChangeMsg,"No","Yes",function(confirmStatus){confirmStatus?($scope.loading=!0,$scope.newPinCode.pincode=item.pincode,$scope.newPinCode.locality=item.area,$scope.newPinCode.city=item.district,$scope.newPinCode.state=item.state,$scope.selectedProductInputParamForPin.personalInfo.pincode=item.pincode,$scope.selectedProductInputParamForPin.personalInfo.displayArea=item.area,$scope.selectedProductInputParamForPin.personalInfo.city=item.district,$scope.selectedProductInputParamForPin.personalInfo.state=item.state,null!=$scope.selectedProduct.childPlanId&&($scope.selectedProductInputParamForPin.childPlanId=Number($scope.selectedProduct.childPlanId)),$scope.selectedProductInputParamForPin.sumInsured=$scope.selectedProduct.sumInsured,localStorageService.get("quoteUserInfo").mobileNumber&&($scope.selectedProductInputParamForPin.mobileNumber=localStorageService.get("quoteUserInfo").mobileNumber),localStorageService.get("PROF_QUOTE_ID")&&($scope.selectedProductInputParamForPin.PROF_QUOTE_ID=localStorageService.get("PROF_QUOTE_ID")),RestAPI.invoke($scope.p365Labels.getRequest.quoteHealth,$scope.selectedProductInputParamForPin).then(function(callback){if($scope.healthRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success)$scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("HEALTH_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.healthRecalculateQuoteRequest=callback.data,$scope.healthQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.healthRecalculateQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=$scope.p365Labels.transactionName.healthQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var healthQuoteResponse=JSON.parse(callback);if($scope.responseRecalculateCodeList.push(healthQuoteResponse.responseCode),healthQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId&&(healthQuoteResponse.data.quotes[0].childPlanId?healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId&&($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,healthQuoteResponse.data.quotes[0].basicPremium&&($scope.proposalApp.coverageDetails.basePremium=healthQuoteResponse.data.quotes[0].basicPremium),healthQuoteResponse.data.quotes[0].serviceTax&&($scope.proposalApp.coverageDetails.serviceTax=healthQuoteResponse.data.quotes[0].serviceTax),$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId)):($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,healthQuoteResponse.data.quotes[0].basicPremium&&($scope.proposalApp.coverageDetails.basePremium=healthQuoteResponse.data.quotes[0].basicPremium),healthQuoteResponse.data.quotes[0].serviceTax&&($scope.proposalApp.coverageDetails.serviceTax=healthQuoteResponse.data.quotes[0].serviceTax),$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId))),healthQuoteResponse.data.quotes[0].id=healthQuoteResponse.messageId,$scope.quoteCalcResponse.push(healthQuoteResponse.data.quotes[0]);else if(null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId)if($scope.selectedProduct.childPlanId){if(healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId){$scope.loading=!1,$scope.proposalApp.proposerInfo.contactInfo.pincode="";var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsg;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}else{$scope.loading=!1,$scope.proposalApp.proposerInfo.contactInfo.pincode="";screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsg;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})});else{$scope.loading=!1,$scope.proposalApp.proposerInfo.contactInfo.pincode="";var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsg;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}),$scope.proposalApp.proposerInfo.contactInfo.pincode=item.pincode,$scope.proposalApp.proposerInfo.contactInfo.locality=item.area,$scope.proposalApp.proposerInfo.contactInfo.city=item.district,$scope.proposalApp.proposerInfo.contactInfo.state=item.state):($scope.proposalApp.proposerInfo.contactInfo.pincode=$scope.newPinCode.pincode,$scope.proposalApp.proposerInfo.contactInfo.locality=$scope.newPinCode.locality,$scope.proposalApp.proposerInfo.contactInfo.city=$scope.newPinCode.city,$scope.proposalApp.proposerInfo.contactInfo.state=$scope.newPinCode.state,$scope.proposalApp.proposerInfo.personalInfo.pincode=$scope.newPinCode.pincode,$scope.proposalApp.proposerInfo.personalInfo.locality=$scope.newPinCode.locality,$scope.proposalApp.proposerInfo.personalInfo.city=$scope.newPinCode.city,$scope.proposalApp.proposerInfo.personalInfo.state=$scope.newPinCode.state,$scope.proposalApp.proposerInfo.permanentAddress.pincode=$scope.newPinCode.pincode,$scope.proposalApp.proposerInfo.permanentAddress.locality=$scope.newPinCode.locality,$scope.proposalApp.proposerInfo.permanentAddress.city=$scope.newPinCode.city,$scope.proposalApp.proposerInfo.permanentAddress.state=$scope.newPinCode.state),$scope.proposalApp.proposerInfo.contactInfo&&$scope.proposalApp.proposerInfo.contactInfo.streetDetails&&(item.displayArea=$scope.proposalApp.proposerInfo.contactInfo.streetDetails),localStorageService.set("commAddressDetails",item)}):($scope.proposalApp.proposerInfo.contactInfo.pincode=$scope.newPinCode.pincode,$scope.proposalApp.proposerInfo.contactInfo.locality=$scope.newPinCode.locality,$scope.proposalApp.proposerInfo.contactInfo.city=$scope.newPinCode.city,$scope.proposalApp.proposerInfo.contactInfo.state=$scope.newPinCode.state,$scope.proposalApp.proposerInfo.personalInfo.pincode=$scope.newPinCode.pincode,$scope.proposalApp.proposerInfo.personalInfo.locality=$scope.newPinCode.locality,$scope.proposalApp.proposerInfo.personalInfo.city=$scope.newPinCode.city,$scope.proposalApp.proposerInfo.personalInfo.state=$scope.newPinCode.state,$scope.proposalApp.proposerInfo.permanentAddress.pincode=$scope.newPinCode.pincode,$scope.proposalApp.proposerInfo.permanentAddress.locality=$scope.newPinCode.locality,$scope.proposalApp.proposerInfo.permanentAddress.city=$scope.newPinCode.city,$scope.proposalApp.proposerInfo.permanentAddress.state=$scope.newPinCode.state,$scope.proposalApp.proposerInfo.contactInfo&&$scope.proposalApp.proposerInfo.contactInfo.streetDetails&&(item.displayArea=$scope.proposalApp.proposerInfo.contactInfo.streetDetails),localStorageService.set("commAddressDetails",item)),$scope.permanentAddressDetails.isAddressSameAsCommun){$scope.permanentAddressDetails.houseNo=$scope.proposalApp.proposerInfo.contactInfo.houseNo,$scope.permanentAddressDetails.streetDetails=$scope.proposalApp.proposerInfo.contactInfo.streetDetails,$scope.permanentAddressDetails.pincode=$scope.proposalApp.proposerInfo.contactInfo.pincode,$scope.permanentAddressDetails.locality=$scope.proposalApp.proposerInfo.contactInfo.locality,$scope.permanentAddressDetails.city=$scope.proposalApp.proposerInfo.contactInfo.city,$scope.permanentAddressDetails.state=$scope.proposalApp.proposerInfo.contactInfo.state,localStorageService.set("parmAddressDetails",$scope.permanentAddressDetails),$scope.proposalApp.proposerInfo.personalInfo=$scope.permanentAddressDetails;var quoteUserInfo=localStorageService.get("quoteUserInfo");$scope.proposalApp.proposerInfo.personalInfo.gender=$scope.selectedProductInputParam.quoteParam.selfGender,$scope.iposRequest.docId||($scope.proposalApp.proposerInfo.personalInfo.lastName="undefined"!==String(quoteUserInfo.lastName)?quoteUserInfo.lastName:"",$scope.proposalApp.proposerInfo.personalInfo.firstName="undefined"!==String(quoteUserInfo.firstName)?quoteUserInfo.firstName:""),$scope.proposalApp.proposerInfo.personalInfo.salutation="M"==$scope.proposalApp.proposerInfo.personalInfo.gender?"Mr":"Ms",$scope.proposalApp.proposerInfo.personalInfo.pincode=item.pincode,$scope.proposalApp.proposerInfo.personalInfo.locality=item.area,$scope.proposalApp.proposerInfo.personalInfo.city=item.district,$scope.proposalApp.proposerInfo.personalInfo.state=item.state,$scope.proposalApp.proposerInfo.permanentAddress.pincode=item.pincode,$scope.proposalApp.proposerInfo.permanentAddress.locality=item.area,$scope.proposalApp.proposerInfo.permanentAddress.city=item.district,$scope.proposalApp.proposerInfo.permanentAddress.state=item.state}},$scope.onSelectPermanentPinOrArea=function(item){$scope.permanentAddressDetails.locality=item.area,$scope.permanentAddressDetails.city=item.district,$scope.permanentAddressDetails.pincode=item.pincode,$scope.permanentAddressDetails.state=item.state,localStorageService.set("parmAddressDetails",$scope.permanentAddressDetails)},$scope.getPinCodeAreaList=function(AreaName){var docType;return docType=isNaN(AreaName)?"Area":"Pincode",$http.get(getServiceLink+docType+"&q="+AreaName).then(function(responseReg){return JSON.parse(responseReg.data).data})},$scope.$watch("noResultsReg",function(newValueReg){1==newValueReg&&($scope.permanentAddressDetails.locality="",$scope.permanentAddressDetails.city="",$scope.permanentAddressDetails.pincode="",$scope.permanentAddressDetails.state="")}),$scope.resetCommunicationAddress=function(){"undefined"!=String($scope.proposerDetails.address)&&0!=$scope.proposerDetails.address.length||($scope.proposerDetails.pincode="",$scope.proposerDetails.state="",$scope.proposerDetails.city="",$scope.proposerDetails.doorNo="")},$scope.getdeductible=function(){$scope.newdeductible!=$scope.proposalApp.coverageDetails.deductible?$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.deductibleChangeMsg,"No","Yes",function(confirmStatus){confirmStatus?($scope.loading=!0,$scope.selectedProductInputParamForPin.quoteParam.deductible=$scope.proposalApp.coverageDetails.deductible,$scope.selectedProductInputParamForPin.childPlanId=Number($scope.selectedProduct.childPlanId),$scope.selectedProductInputParamForPin.sumInsured=$scope.selectedProduct.sumInsured,localStorageService.get("quoteUserInfo").mobileNumber&&($scope.selectedProductInputParamForPin.mobileNumber=localStorageService.get("quoteUserInfo").mobileNumber),localStorageService.get("PROF_QUOTE_ID")&&($scope.selectedProductInputParamForPin.PROF_QUOTE_ID=localStorageService.get("PROF_QUOTE_ID")),RestAPI.invoke($scope.p365Labels.getRequest.quoteHealth,$scope.selectedProductInputParamForPin).then(function(callback){$scope.healthRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success&&($scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("HEALTH_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.healthRecalculateQuoteRequest=callback.data,$scope.healthQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.healthRecalculateQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=$scope.p365Labels.transactionName.healthQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var healthQuoteResponse=JSON.parse(callback);if($scope.responseRecalculateCodeList.push(healthQuoteResponse.responseCode),healthQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId&&(void 0!=healthQuoteResponse.data.quotes[0].childPlanId?healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId&&($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,healthQuoteResponse.data.quotes[0].basicPremium&&($scope.proposalApp.coverageDetails.basePremium=healthQuoteResponse.data.quotes[0].basicPremium),healthQuoteResponse.data.quotes[0].serviceTax&&($scope.proposalApp.coverageDetails.serviceTax=healthQuoteResponse.data.quotes[0].serviceTax),$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId)):($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,healthQuoteResponse.data.quotes[0].basicPremium&&($scope.proposalApp.coverageDetails.basePremium=healthQuoteResponse.data.quotes[0].basicPremium),healthQuoteResponse.data.quotes[0].serviceTax&&($scope.proposalApp.coverageDetails.serviceTax=healthQuoteResponse.data.quotes[0].serviceTax),$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId))),healthQuoteResponse.data.quotes[0].id=healthQuoteResponse.messageId,$scope.quoteCalcResponse.push(healthQuoteResponse.data.quotes[0]);else if(null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId)if(void 0!=$scope.selectedProduct.childPlanId){if(healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId){$scope.loading=!1;var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgDeductible;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}else{$scope.loading=!1;screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgDeductible;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})}))}),$scope.newdeductible=$scope.proposalApp.coverageDetails.deductible,$scope.proposalApp.coverageDetails.deductible=$scope.newdeductible):$scope.proposalApp.coverageDetails.deductible=$scope.newdeductible}):$scope.proposalApp.coverageDetails.deductible=$scope.newdeductible},$scope.resetRegistrationAddress=function(){"undefined"!=String($scope.vehicleDetails.address)&&0!=$scope.vehicleDetails.address.length||($scope.vehicleDetails.pincode="",$scope.vehicleDetails.state="",$scope.vehicleDetails.city="",$scope.vehicleDetails.doorNo="")},$scope.calcDefaultAreaDetails=function(areaCode){$http.get(getServiceLink+"Pincode&q="+areaCode).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.p365Labels.responseCode.success&&$scope.onSelectPinOrArea(areaDetails.data[0])})},$scope.calcDefaultRegAreaDetails=function(areaCode){$http.get(getServiceLink+"Pincode&q="+areaCode).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.p365Labels.responseCode.success&&$scope.onSelectPermanentPinOrArea(areaDetails.data[0])})},$scope.$on("setCommAddressByAPI",function(){setTimeout(function(){var googleAddressObject=angular.copy($rootScope.chosenCommPlaceDetails);getAddressFields(googleAddressObject,function(fomattedAddress,formattedCity,formattedState,formattedPincode){$scope.proposalApp.proposerInfo.contactInfo.streetDetails=fomattedAddress,"undefined"!=String(formattedPincode)&&""!=formattedPincode?$scope.calcDefaultAreaDetails(formattedPincode):($scope.proposalApp.proposerInfo.contactInfo.pincode="",$scope.proposalApp.proposerInfo.contactInfo.locality="",$scope.proposalApp.proposerInfo.contactInfo.city="",$scope.proposalApp.proposerInfo.contactInfo.state=""),$scope.$apply()})},10)}),$scope.$on("setRegAddressByAPI",function(){setTimeout(function(){var googleAddressObject=angular.copy($rootScope.chosenRegPlaceDetails);getAddressFields(googleAddressObject,function(fomattedAddress,formattedCity,formattedState,formattedPincode){$scope.permanentAddressDetails.streetDetails=fomattedAddress,"undefined"!=String(formattedPincode)&&""!=formattedPincode?$scope.calcDefaultRegAreaDetails(formattedPincode):($scope.permanentAddressDetails.pincode="",$scope.permanentAddressDetails.locality="",$scope.permanentAddressDetails.city="",$scope.permanentAddressDetails.state=""),$scope.$apply()})},10)}),$scope.openMenu=function($mdOpenMenu,ev){$mdOpenMenu(ev),$scope.hideDisease=function(){$mdMenu.hide()}},$scope.clicktoDisable=function(){setTimeout(function(){$(".md-click-catcher").css("pointer-events","none")},100)},$scope.clicktoShowDisease=function(){$scope.diseaseShow=!0},$scope.clicktoHideDisease=function(){$scope.diseaseShow=!1},$scope.bmiError=!1,$scope.isRegreatPolicyMsg=!1;var quesArr=[],regreatPolicyArr=[];if($scope.inputTypeCheck=function(sel,quesId,mquestion){if("true"==sel)if($scope.selectedQuestions=quesId,$scope.productValidation.isBmiValidationApplicable||void 0==$scope.productValidation.isBmiValidationApplicable||quesArr.push(quesId),"Y"==mquestion.isRegretPolicy){regreatPolicyArr.push(quesId);var screenCnfrmError=$scope.p365Labels.errorMessage.regretPolicyMsg;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}else regreatPolicyArr.length>0&&regreatPolicyArr.splice(-1,quesId);else{$scope.productValidation.isBmiValidationApplicable||void 0==$scope.productValidation.isBmiValidationApplicable||quesArr.length>0&&quesArr.splice(-1,quesId);for(var i=0;i<$scope.proposalApp.insuredMembers.length;i++)for(var j=0;j<$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.length;j++)quesId==$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].questionCode&&($scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].applicable="false");if("N"==mquestion.isRegretPolicy){regreatPolicyArr.push(quesId);screenCnfrmError=$scope.p365Labels.errorMessage.regretPolicyMsg;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}else regreatPolicyArr.length>0&&regreatPolicyArr.splice(-1,quesId)}quesArr.length>0?$scope.bmiError=!0:$scope.bmiError=!1,regreatPolicyArr.length>0?$scope.isRegreatPolicyMsg=!0:$scope.isRegreatPolicyMsg=!1},$scope.TermsCheck=function(sel){$scope.checkForStartHealth="true"!=sel},$scope.mediError=!1,$scope.mediCheck=function(sel){"true"==sel?($scope.checkForStartHealth=!0,$scope.mediError=!0):($scope.checkForStartHealth=!1,$scope.mediError=!1)},$scope.showTermsDiv=!1,$rootScope.showTerms=function(){$scope.showTermsDiv=!0},$rootScope.closeTerms=function(){$scope.showTermsDiv=!1},$scope.next=function(){$scope.page=$scope.page+1},$scope.back=function(){$scope.page=$scope.page-1},$scope.questionLength=[],$scope.selDiseaseList=[],$scope.stateChanged=function(qId,relationship,id){if(1==qId.applicable){for(var i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==relationship)for(var j=0;j<$scope.proposalApp.insuredMembers[i].dieaseDetails.length;j++)$scope.proposalApp.insuredMembers[i].dieaseDetails[j].masterDiseaseCode==qId.masterDiseaseCode&&($scope.proposalApp.insuredMembers[id].dieaseDetails[j].applicable=!0)}else for(i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==relationship)for(j=0;j<$scope.proposalApp.insuredMembers[i].dieaseDetails.length;j++)$scope.proposalApp.insuredMembers[i].dieaseDetails[j].masterDiseaseCode==qId.masterDiseaseCode&&($scope.proposalApp.insuredMembers[id].dieaseDetails[j].applicable=!1);for(i=0;i<$scope.questionLength.length;i++)if($scope.questionLength[i].dieaseCode==qId.dieaseCode){$scope.questionLength.splice(i,1);break}$scope.questionLength.push(qId)},$scope.stateChangedMedical=function(ques,sel,relation){var i,j;$scope.productValidation.smokingFlag&&"SMOKE"==ques.questionCode&&$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.smokingStatusChangeMsg,"No","Yes",function(confirmStatus){if(confirmStatus){if($scope.loading=!0,1==sel){for(i=0;i<$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers.length;i++)if($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation==relation){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking="Y",$scope.proposalApp.insuredMembers[i].isSmoking="Y";break}}else for(i=0;i<$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers.length;i++)if($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation==relation){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking="N",$scope.proposalApp.insuredMembers[i].isSmoking="N";break}null!=$scope.selectedProduct.childPlanId&&($scope.selectedProductInputParamForPin.childPlanId=Number($scope.selectedProduct.childPlanId)),$scope.selectedProductInputParamForPin.sumInsured=$scope.selectedProduct.sumInsured,localStorageService.get("quoteUserInfo").mobileNumber&&($scope.selectedProductInputParamForPin.mobileNumber=localStorageService.get("quoteUserInfo").mobileNumber),localStorageService.get("PROF_QUOTE_ID")&&($scope.selectedProductInputParamForPin.PROF_QUOTE_ID=localStorageService.get("PROF_QUOTE_ID")),RestAPI.invoke($scope.p365Labels.getRequest.quoteHealth,$scope.selectedProductInputParamForPin).then(function(callback){if($scope.healthRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success)$scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("HEALTH_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.healthRecalculateQuoteRequest=callback.data,$scope.healthQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.healthRecalculateQuoteRequest,function(obj,i){var request={},header={};header.messageId=messageIDVar,header.campaignID=campaignIDVar,header.source=sourceOrigin,header.transactionName=$scope.p365Labels.transactionName.healthQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var healthQuoteResponse=JSON.parse(callback);if($scope.responseRecalculateCodeList.push(healthQuoteResponse.responseCode),healthQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId&&(healthQuoteResponse.data.quotes[0].childPlanId?healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId&&($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,healthQuoteResponse.data.quotes[0].basicPremium&&($scope.proposalApp.coverageDetails.basePremium=healthQuoteResponse.data.quotes[0].basicPremium),healthQuoteResponse.data.quotes[0].serviceTax&&($scope.proposalApp.coverageDetails.serviceTax=healthQuoteResponse.data.quotes[0].serviceTax),$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId)):($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,healthQuoteResponse.data.quotes[0].basicPremium&&($scope.proposalApp.coverageDetails.basePremium=healthQuoteResponse.data.quotes[0].basicPremium),healthQuoteResponse.data.quotes[0].serviceTax&&($scope.proposalApp.coverageDetails.serviceTax=healthQuoteResponse.data.quotes[0].serviceTax),$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId))),healthQuoteResponse.data.quotes[0].id=healthQuoteResponse.messageId,$scope.quoteCalcResponse.push(healthQuoteResponse.data.quotes[0]);else if(null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId){for($scope.loading=!1,i=0;i<$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers.length;i++)if($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation==relation){if("Y"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking="N",$scope.proposalApp.insuredMembers[i].isSmoking="N";break}if("N"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking="Y",$scope.proposalApp.insuredMembers[i].isSmoking="Y";break}}for(i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==relation)for(j=0;j<$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.length;j++)if(ques.questionId==$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].questionCode){if(1==sel){$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].applicable="false";break}if(0==sel){$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].applicable=!0;break}}var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgSmoking;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})});else{for($scope.loading=!1,i=0;i<$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers.length;i++)if($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation==relation&&$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking){if("Y"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking="N",$scope.proposalApp.insuredMembers[i].isSmoking="N";break}if("N"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking="Y",$scope.proposalApp.insuredMembers[i].isSmoking="Y";break}}for(i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==relation)for(j=0;j<$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.length;j++)if(ques.questionId==$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].questionCode){if(1==sel){$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].applicable="false";break}if(0==sel){$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].applicable=!0;break}}var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgSmoking;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}})}else for($scope.loading=!1,i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==relation)for(j=0;j<$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.length;j++)if(ques.questionId==$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].questionCode){if(1==sel){$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].applicable="false";break}if(0==sel){$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].applicable=!0;break}}})},$scope.changeInsuredHeight=function(insuredInfo,index){if($scope.productValidation.bmiValidationFlag){var insuredAge=getAgeFromDOB(insuredInfo.dateOfBirth);if(insuredAge<=$scope.productValidation.bmiChildMinAgeLimit)return;insuredAge>$scope.productValidation.bmiChildMinAgeLimit&&$scope.bmiValidation(insuredInfo,index)}},$scope.changeInsuredWeight=function(insuredInfo,index){if($scope.productValidation.bmiValidationFlag){var insuredAge=getAgeFromDOB(insuredInfo.dateOfBirth);if(insuredAge<=$scope.productValidation.bmiChildMinAgeLimit)return;insuredAge>$scope.productValidation.bmiChildMinAgeLimit&&$scope.bmiValidation(insuredInfo,index)}},$scope.Section1Inactive=!1,$scope.Section2Inactive=!0,$scope.Section3Inactive=!0,$scope.Section4Inactive=!0,$scope.Section5Inactive=!0,$scope.Section6Inactive=!0,$scope.submitProposerInfo=function(){$scope.accordion="2",$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!1,$scope.screenFourStatus=!1,$scope.screenFiveStatus=!1,$scope.screenSixStatus=!1,$scope.Section2Inactive=!1,1==imauticAutomation&&imatEvent("ProposalFilled"),$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled&&($scope.saveProposal=!0,$scope.savePersonalDetails=!0,$scope.saveNomineeDetails=!1,$scope.saveInsuredDetails=!1,$scope.saveMedicalDetails=!1,$scope.submitProposalData())},$scope.submitAddressDetails=function(){$scope.accordion="3",$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!1,$scope.screenFiveStatus=!1,$scope.screenSixStatus=!1,$scope.Section3Inactive=!1,$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled&&($scope.saveProposal=!0,$scope.savePersonalDetails=!0,$scope.saveNomineeDetails=!1,$scope.saveInsuredDetails=!1,$scope.saveMedicalDetails=!1,$scope.submitProposalData())},$scope.editProposerInfo=function(){$scope.screenOneStatus=!0,$scope.screenTwoStatus=!1,$scope.screenThreeStatus=!1,$scope.screenFiveStatus=!1,$scope.screenSixStatus=!1,$scope.accordion="1"},$scope.submitInsuredInfo=function(){$scope.accordion="4",$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!0,$scope.screenFiveStatus=!1,$scope.screenSixStatus=!1,$scope.Section4Inactive=!1,$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled&&($scope.saveProposal=!0,$scope.saveInsuredDetails=!0,$scope.savePersonalDetails=!0,$scope.saveMedicalDetails=!1,$scope.saveNomineeDetails=!1,$scope.submitProposalData())},$scope.editInsuredInfo=function(){$scope.screenOneStatus=!1,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.accordion="3"},$scope.editAddressInfo=function(){$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!1,$scope.accordion="2"},$scope.submitNomineeInfo=function(){$scope.accordion="5",$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!0,$scope.screenFiveStatus=!0,$scope.screenSixStatus=!1,$scope.Section5Inactive=!1,$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled&&($scope.saveProposal=!0,$scope.saveInsuredDetails=!0,$scope.saveNomineeDetails=!0,$scope.savePersonalDetails=!0,$scope.saveMedicalDetails=!1,$scope.submitProposalData())},$scope.editNomineeInfo=function(){$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!0,$scope.accordion="4"},$scope.submitMedicalInfo=function(){$scope.accordion="6",$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!0,$scope.screenFiveStatus=!0,$scope.screenSixStatus=!0,$scope.Section6Inactive=!1,$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled&&($scope.saveProposal=!0,$scope.saveInsuredDetails=!0,$scope.saveNomineeDetails=!0,$scope.savePersonalDetails=!0,$scope.saveMedicalDetails=!0,$scope.submitProposalData())},$scope.editMedicalInfo=function(){$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!0,$scope.screenFiveStatus=!0,$scope.accordion="5"},$scope.showAuthenticateForm=function(){var validateAuthParam={paramMap:{}};validateAuthParam.mobileNumber=$scope.proposalApp.proposerInfo.contactInfo.mobile,validateAuthParam.funcType=$scope.p365Labels.functionType.optAuth,validateAuthParam.paramMap.OTP=$scope.p365Labels.functionType.otpGenerate,getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.sendSMS,validateAuthParam,function(createOTP){createOTP.responseCode==$scope.p365Labels.responseCode.success?($scope.createOTPError="",$scope.modalOTP=!0):createOTP.responseCode==$scope.p365Labels.responseCode.blockedMobile?($scope.createOTPError=createOTP.message,$scope.modalOTPError=!0):($scope.createOTPError=$scope.p365Labels.errorMessage.createOTP,$scope.modalOTPError=!0)})},$scope.hideModal=function(){$scope.modalOTP=!1,$scope.authenticate.enteredOTP=""},$scope.hideModalError=function(){$scope.modalOTPError=!1},$scope.resendOTP=function(){var validateAuthParam={paramMap:{}};validateAuthParam.mobileNumber=$scope.proposalApp.proposerInfo.contactInfo.mobile,validateAuthParam.funcType=$scope.p365Labels.functionType.optAuth,validateAuthParam.paramMap.OTP=$scope.p365Labels.functionType.otpGenerate,getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.sendSMS,validateAuthParam,function(createOTP){createOTP.responseCode==$scope.p365Labels.responseCode.success?$scope.invalidOTPError="":createOTP.responseCode==$scope.p365Labels.responseCode.userNotExist?$scope.invalidOTPError=createOTP.message:createOTP.responseCode==$scope.p365Labels.responseCode.blockedMobile?($scope.invalidOTPError=createOTP.message,$scope.disableOTP=!0):createOTP.responseCode==$scope.p365Labels.responseCode.mobileInvalidCode?$scope.invalidOTPError=createOTP.message:$scope.invalidOTPError=$scope.p365Labels.errorMessage.createOTP})},$scope.validateAuthenticateForm=function(){var proposalSubmitConfirmMsg="Please make sure you have entered the right Mobile Number and Email ID. All our communication will be sent to your Mobile "+$scope.proposalApp.proposerInfo.contactInfo.mobile+" or Email "+$scope.proposalApp.proposerInfo.contactInfo.emailId+". Is the entered Mobile No. and Email ID right?";$rootScope.P365Confirm("Policies365",proposalSubmitConfirmMsg,"No","Yes",function(confirmStatus){confirmStatus&&($scope.OTPFlag?$scope.showAuthenticateForm():$scope.OTPFlag||$scope.proceedForPayment())})},$scope.proceedForPayment=function(){if($scope.OTPFlag){var authenticateUserParam={};authenticateUserParam.mobileNumber=$scope.proposalApp.proposerInfo.contactInfo.mobile,authenticateUserParam.OTP=Number($scope.authenticate.enteredOTP),getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.validateOTP,authenticateUserParam,function(createOTP){if(createOTP.responseCode==$scope.p365Labels.responseCode.success){if($scope.modalOTP=!1,$scope.modalOTPError=!1,$scope.proposalFormValid){for(var i=0;i<$scope.proposalApp.insuredMembers.length;i++)for(var j=0;j<$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.length;j++)null!=$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j]&&void 0!=$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j]&&"undefined"!=String($scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j])||($scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.splice(j,1),j-=1);$scope.proceedForConfirm()}}else createOTP.responseCode==$scope.p365Labels.responseCode.noRecordsFound?$scope.invalidOTPError=$scope.p365Labels.validationMessages.invalidOTP:createOTP.responseCode==$scope.p365Labels.responseCode.expiredOTP?$scope.invalidOTPError=$scope.p365Labels.validationMessages.expiredOTP:createOTP.responseCode==$scope.p365Labels.responseCode.blockedMobile?$scope.invalidOTPError=createOTP.message:$scope.invalidOTPError=$scope.p365Labels.validationMessages.authOTP})}else if($scope.proposalFormValid){for(var i=0;i<$scope.proposalApp.insuredMembers.length;i++)for(var j=0;j<$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.length;j++)null!=$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j]&&void 0!=$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j]&&"undefined"!=String($scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j])||($scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.splice(j,1),j-=1);$scope.proceedForConfirm()}},$scope.redirectToPaymentGateway=function(){$scope.paymentURLParam?$rootScope.affilateUser||$rootScope.agencyPortalEnabled?$window.top.location.href=$scope.paymentServiceResponse.paymentURL+$scope.paymentURLParam:$window.location.href=$scope.paymentServiceResponse.paymentURL+$scope.paymentURLParam:$timeout(function(){$scope.paymentForm.setAction($scope.paymentServiceResponse.paymentURL),$scope.paymentForm.commit(),$scope.$apply()},500)},$scope.proceedForConfirm=function(){$scope.modalOTP=!1,$scope.authenticate.enteredOTP="",$scope.modalOTPError=!1,$(".nomineeInfo").removeClass("active"),$(".nomineeInfo").addClass("complete"),$scope.loading=!0,$scope.disablePaymentButton=!0,$scope.proposalApp.QUOTE_ID=localStorageService.get("HEALTH_UNIQUE_QUOTE_ID"),$scope.proposalApp.insuranceCompany=$scope.selectedProduct.insuranceCompany,$scope.proposalApp.planName=$scope.selectedProduct.planName,$scope.proposalApp.quoteType=$scope.p365Labels.businessLineType.health,$scope.proposalApp.businessLineId=$scope.p365Labels.businessLineType.health,$scope.selectedProduct.childPlanId&&($scope.proposalApp.childPlanId=$scope.selectedProduct.childPlanId),$scope.selectedProduct.intlTreatmentUS_CANADA&&($scope.proposalApp.coverageDetails.intlTreatmentUS_CANADA=$scope.selectedProduct.intlTreatmentUS_CANADA);for(var i=0;i<$scope.proposalApp.insuredMembers.length;i++)$scope.proposalApp.insuredMembers[i].height=Number($scope.proposalApp.insuredMembers[i].height),$scope.proposalApp.insuredMembers[i].weight=Number($scope.proposalApp.insuredMembers[i].weight);$rootScope.wordPressEnabled?$scope.proposalApp.source=sourceOrigin:$rootScope.baseEnvEnabled&&$rootScope.agencyPortalEnabled?($scope.proposalApp.baseEnvStatus=!1,$scope.proposalApp.source=sourceOrigin):($scope.proposalApp.baseEnvStatus=baseEnvEnabled,$scope.proposalApp.source=sourceOrigin),campaignSource.utm_source&&($scope.proposalApp.utm_source=campaignSource.utm_source),campaignSource.utm_medium&&($scope.proposalApp.utm_medium=campaignSource.utm_medium),localStorageService.set("medicalFinalProposeForm",$scope.proposalApp),$scope.proposalApp.QUOTE_ID?RestAPI.invoke("submitHealthProposal",$scope.proposalApp).then(function(proposeFormResponse){if(proposeFormResponse.responseCode==$scope.p365Labels.responseCode.success)$scope.proposalId=proposeFormResponse.data.proposalId,$scope.encryptedProposalId=proposeFormResponse.data.encryptedProposalId,localStorageService.set("proposalIdEncrypted",$scope.encryptedProposalId),$scope.responseToken=proposeFormResponse.data,$scope.responseToken.businessLineId=$scope.p365Labels.businessLineType.health,$scope.responseToken.QUOTE_ID=localStorageService.get("HEALTH_UNIQUE_QUOTE_ID"),localStorageService.set("medicalReponseToken",$scope.responseToken),getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.paymentService,$scope.responseToken,function(paymentDetails){if(paymentDetails.responseCode==$scope.p365Labels.responseCode.success){$scope.paymentServiceResponse=paymentDetails.data,1==imauticAutomation&&imatHealthProposal(localStorageService,$scope,"MakePayment",function(shortURLResponse){});for(var paymentURLParamListLength=$scope.paymentServiceResponse.paramterList.length,i=0;i<paymentURLParamListLength;i++)"SourceTxnId"==$scope.paymentServiceResponse.paramterList[i].name&&"SourceTxnId"==$scope.paymentServiceResponse.paramterList[i].ngModel&&olarkCustomParam($scope.paymentServiceResponse.paramterList[i].value,$scope.p365Labels.businessLineType.health,"","proposal");if("GET"==$scope.paymentServiceResponse.method){$scope.paymentURLParam="?";for(paymentURLParamListLength=$scope.paymentServiceResponse.paramterList.length,i=0;i<paymentURLParamListLength;i++)$scope.paymentURLParam+=i<paymentURLParamListLength-1?$scope.paymentServiceResponse.paramterList[i].name+"="+$scope.paymentServiceResponse.paramterList[i].value+"&":$scope.paymentServiceResponse.paramterList[i].name+"="+$scope.paymentServiceResponse.paramterList[i].value;$scope.redirectForPayment=!0,$scope.loading=!1,$scope.modalIPOS=!0}else $scope.paymentURLParam=null,$scope.redirectForPayment=!0,$scope.loading=!1,$scope.modalIPOS=!0}else{1==imauticAutomation&&imatEvent("ProposalFailed"),$scope.loading=!1,$scope.disablePaymentButton=!1;var buyScreenCnfrmError=paymentDetails.responseCode+" : "+$scope.p365Labels.validationMessages.buyScreenCnfrmError.replace("INSURER_NAME",$scope.selectedProduct.insuranceCompany);$rootScope.P365Alert("Policies365",buyScreenCnfrmError,"Ok")}});else if(proposeFormResponse.responseCode==$scope.p365Labels.responseCode.error)$scope.loading=!1,$scope.disablePaymentButton=!1,$rootScope.P365Alert("Error",proposeFormResponse.data,"Ok");else{$scope.loading=!1,$scope.disablePaymentButton=!1;var buyScreenCnfrmError=$scope.p365Labels.validationMessages.buyScreenCnfrmError.replace("INSURER_NAME",$scope.selectedProduct.insuranceCompany);$rootScope.P365Alert("Policies365",buyScreenCnfrmError,"Ok")}}):($scope.loading=!1,$scope.disablePaymentButton=!1,$rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.generalisedErrMsg,"Ok"))},$rootScope.signout=function(){$rootScope.userLoginStatus=!1;var userLoginInfo={username:void 0};userLoginInfo.status=$rootScope.userLoginStatus,localStorageService.set("userLoginInfo",userLoginInfo),$location.path("/quote")},$scope.missionCompled=function(){$scope.loading=!1},$scope.sendProposalEmail=function(){var proposalDetailsEmail={paramMap:{}};proposalDetailsEmail.funcType=$scope.p365Labels.functionType.proposalDetailsTemplate,proposalDetailsEmail.isBCCRequired="Y",proposalDetailsEmail.username=$scope.proposalApp.proposerInfo.contactInfo.emailId.trim(),proposalDetailsEmail.paramMap.customerName=$scope.proposalApp.proposerInfo.personalInfo.firstName.trim()+" "+$scope.proposalApp.proposerInfo.personalInfo.lastName.trim(),proposalDetailsEmail.paramMap.selectedPolicyType=$scope.p365Labels.insuranceType.health,proposalDetailsEmail.paramMap.quoteId=$scope.responseToken.QUOTE_ID,proposalDetailsEmail.paramMap.premiumAmount=String($scope.selectedProduct.annualPremium),proposalDetailsEmail.paramMap.docId=String($scope.responseToken.encryptedProposalId),proposalDetailsEmail.paramMap.LOB=String($scope.p365Labels.businessLineType.health),proposalDetailsEmail.paramMap.url=$scope.shortURLResponse.data.shortURL,RestAPI.invoke($scope.p365Labels.transactionName.sendEmail,proposalDetailsEmail).then(function(emailResponse){if(emailResponse.responseCode==$scope.p365Labels.responseCode.success)if(1==baseEnvEnabled&&1==agencyPortalEnabled){var frameURL=agencyPortalUrl+proposalDetailsEmail.paramMap.docId+"&lob="+proposalDetailsEmail.paramMap.LOB;$scope.URLforPayment=$sce.trustAsResourceUrl(frameURL),$scope.loading=!1,$scope.modalAP=!0}else{$scope.redirectForPayment=!1,$scope.loading=!1,$scope.modalIPOS=!0;var createRecordDetails={};createRecordDetails.parent_id=$scope.iposRequest.parent_id,createRecordDetails.parent_type=$scope.iposRequest.parent_type,createRecordDetails.requestType=$scope.iposRequest.requestType,RestAPI.invoke($scope.p365Labels.transactionName.createRecord,createRecordDetails).then(function(createRecordResponse){})}else $rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.emailSentFailed,"Ok"),$scope.loading=!1})},$scope.submitProposalData=function(){if($(".nomineeInfo").removeClass("active"),$(".nomineeInfo").addClass("complete"),$scope.savePersonalDetails&&$scope.proposalApp.proposalId&&delete $scope.proposalApp.proposalId,$scope.saveInsuredDetails&&localStorageService.get("proposalId")&&($scope.proposalId=localStorageService.get("proposalId"),$scope.proposalApp.proposalId=$scope.proposalId),$scope.saveNomineeDetails&&localStorageService.get("proposalId")&&($scope.proposalId=localStorageService.get("proposalId"),$scope.proposalApp.proposalId=$scope.proposalId),$scope.saveMedicalDetails&&localStorageService.get("proposalId")&&($scope.proposalId=localStorageService.get("proposalId"),$scope.proposalApp.proposalId=$scope.proposalId),$scope.saveProposal||localStorageService.get("proposalId")&&($scope.proposalId=localStorageService.get("proposalId"),$scope.proposalApp.proposalId=$scope.proposalId),$scope.proposalApp.insuranceCompany=$scope.selectedProduct.insuranceCompany,$scope.proposalApp.planName=$scope.selectedProduct.planName,$scope.proposalApp.carrierId=$scope.selectedProduct.carrierId,$scope.proposalApp.productId=Number($location.search().productId),$scope.proposalApp.planId=$scope.selectedProduct.planId,$scope.proposalApp.requestType=$scope.p365Labels.request.healthPropRequestType,$scope.proposalApp.carrierProposalStatus=!1,$rootScope.wordPressEnabled?$scope.proposalApp.source=sourceOrigin:($scope.proposalApp.baseEnvStatus=baseEnvEnabled,$scope.proposalApp.source=sourceOrigin),$scope.proposalApp.QUOTE_ID=$scope.iposRequest.docId,$scope.loading=!0,$scope.proposalApp.businessLineId="4",$scope.saveProposal)$scope.proposalApp.isCleared&&delete $scope.proposalApp.isCleared,RestAPI.invoke("saveProposalService",$scope.proposalApp).then(function(proposeFormResponse){proposeFormResponse.responseCode==$scope.p365Labels.responseCode.success?($scope.proposalId=proposeFormResponse.data,localStorageService.set("proposalId",$scope.proposalId),$scope.loading=!1,$scope.saveProposal=!1):($scope.loading=!1,$scope.saveProposal=!1)});else{if($scope.proposalApp.isCleared=!0,delete $scope.proposalApp.proposalId,$rootScope.agencyPortalEnabled){const localdata=JSON.parse(localStorage.getItem("finalLocalStorage"));$scope.proposalApp.requestSource=sourceOrigin,localdata&&($scope.proposalApp.userName=localdata.username,$scope.proposalApp.agencyId=localdata.agencyId),campaignSource.utm_source&&($scope.proposalApp.utm_source=campaignSource.utm_source),campaignSource.utm_medium&&($scope.proposalApp.utm_medium=campaignSource.utm_medium)}$scope.proposalApp.QUOTE_ID?RestAPI.invoke("submitHealthProposal",$scope.proposalApp).then(function(proposeFormResponse){if(proposeFormResponse.responseCode==$scope.p365Labels.responseCode.success)if($scope.responseToken=proposeFormResponse.data,$scope.responseToken.businessLineId=$scope.p365Labels.businessLineType.health,$scope.responseToken.QUOTE_ID=$scope.iposRequest.docId,$scope.proposalId=proposeFormResponse.data.proposalId,$scope.encryptedProposalId=proposeFormResponse.data.encryptedProposalId,localStorageService.set("proposalIdEncrypted",$scope.encryptedProposalId),localStorageService.set("medicalReponseToken",$scope.responseToken),1==imauticAutomation)imatHealthProposal(localStorageService,$scope,"SubmitProposal",function(shortURLResponse){shortURLResponse.responseCode==$scope.p365Labels.responseCode.success?($scope.shortURLResponse=shortURLResponse,console.log("$scope.shortURLResponse in medical buy product is:",$scope.shortURLResponse),$scope.sendProposalEmail()):(console.log(shortURLResponse.message),$rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.emailSentFailed,"Ok"),$scope.loading=!1)});else{var body={};body.longURL=sharePaymentLink+String($scope.responseToken.encryptedProposalId)+"&lob="+String($scope.p365Labels.businessLineType.health),$http({method:"POST",url:getShortURLLink,data:body}).success(function(shortURLResponse){shortURLResponse.responseCode==$scope.p365Labels.responseCode.success?($scope.shortURLResponse=shortURLResponse,$scope.sendProposalEmail()):($rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.emailSentFailed,"Ok"),$scope.loading=!1)})}else if(proposeFormResponse.responseCode==$scope.p365Labels.responseCode.error)$scope.loading=!1,$scope.disablePaymentButton=!1,$rootScope.P365Alert("Error",proposeFormResponse.data,"Ok");else{$scope.loading=!1;var serverError=$scope.p365Labels.errorMessage.serverError;$rootScope.P365Alert("Policies365",serverError,"Ok")}}):($scope.loading=!1,$rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.generalisedErrMsg,"Ok"))}},$scope.hideModalIPOS=function(){$scope.modalIPOS=!1,1==$scope.redirectForPayment&&$scope.redirectToPaymentGateway()},$scope.hideModalAP=function(){$scope.modalAP=!1},$scope.selectedProduct=localStorageService.get("healthSelectedProduct"),$scope.iposRequest={},$scope.iposRequest.docId=localStorageService.get("HEALTH_UNIQUE_QUOTE_ID"),$scope.iposRequest.carrierId=$scope.selectedProduct.carrierId,$scope.iposRequest.planId=$scope.selectedProduct.planId,$rootScope.wordPressEnabled){$scope.p365Labels=healthProposalLabels,$scope.quoteUserInfo=localStorageService.get("quoteUserInfo"),$rootScope.loaderContent={businessLine:"4",header:"Health Insurance",desc:$sce.trustAsHtml($scope.p365Labels.common.proverbBuyProduct)},$rootScope.title=$scope.p365Labels.policies365Title.medicalBuyQuote,$scope.selectedProductInputParamForPin=angular.copy(localStorageService.get("healthQuoteInputParamaters")),$scope.selectedProductInputParam=localStorageService.get("healthQuoteInputParamaters"),$scope.userGeoDetails=localStorageService.get("commAddressDetails"),$scope.occupationList=localStorageService.get("healthBuyOccupationList"),$scope.carrierList=localStorageService.get("carrierList"),$scope.buyTooltip=localStorageService.get("buyScreenTooltip");var buyScreens=localStorageService.get("buyScreen");$scope.proposalDetailsTemplate=$sce.trustAsHtml(buyScreens.templates[0].template),$scope.insurerInfoTemplate=$sce.trustAsHtml(buyScreens.templates[1].template),$scope.nomineeInfoTemplate=$sce.trustAsHtml(buyScreens.templates[2].template),$scope.medicalInfoTemplate=$sce.trustAsHtml(buyScreens.templates[3].template),$scope.prevPolicyDetailsTemplate=$sce.trustAsHtml(buyScreens.templates[4].template),$scope.personalIdDetailsTemplate=$sce.trustAsHtml(buyScreens.templates[5].template),$scope.productValidation=buyScreens.validation,$scope.redirectUrl=buyScreens.redirectSuccessUrl,$scope.requestFormat=buyScreens.requestFormat,$scope.transactionName=buyScreens.transaction.proposalService.name,$scope.init(),$scope.initHealthBuyScreen(),$scope.initWatch(),$scope.OTPFlag=$scope.productValidation.OTPFlag,$scope.productValidation.acceptedPreExistDisease&&($scope.proposalApp.acceptedPreExistDisease={},$scope.proposalApp.acceptedPreExistDisease.applicable="false"),$scope.productValidation.individualFloaterPlan&&"MARRIED"==$scope.proposalApp.proposerInfo.personalInfo.martialStatus&&($scope.modalIndividualFloaterPlan=!0)}else $scope.p365Labels=healthProposalLabels,$scope.quoteUserInfo=localStorageService.get("quoteUserInfo"),$scope.userGeoDetails={},RestAPI.invoke("quoteDataReader",$scope.iposRequest).then(function(quoteData){if(quoteData.responseCode==$scope.p365Labels.responseCode.success){$scope.quoteInfo=quoteData.data,$scope.selectedProductInputParamForPin=angular.copy($scope.quoteInfo.quoteRequest),$scope.selectedProductInputParam=$scope.quoteInfo.quoteRequest,$scope.quoteCalcResponse=$scope.quoteInfo.quoteResponse;for(var j=0;j<$scope.quoteCalcResponse.length;j++)$scope.quoteCalcResponse[j].id=j+1;for(var i=0;i<$scope.quoteCalcResponse.length;i++)if($scope.quoteCalcResponse[i].carrierId==$scope.iposRequest.carrierId&&$scope.quoteCalcResponse[i].planId==$scope.iposRequest.planId){$scope.premiumDetails.selectedProductDetails=$scope.quoteCalcResponse[i],$scope.selectedProduct=$scope.premiumDetails.selectedProductDetails;break}$scope.changeInsuranceCompany=function(){$location.path("/buyHealth").search({quoteId:localStorageService.get("HEALTH_UNIQUE_QUOTE_ID"),carrierId:$scope.premiumDetails.selectedProductDetails.carrierId,productId:$scope.premiumDetails.selectedProductDetails.planId,lob:localStorageService.get("selectedBusinessLineId")})};var buyScreenParam={documentType:"proposalScreenConfig"};buyScreenParam.carrierId=Number($scope.iposRequest.carrierId),buyScreenParam.businessLineId=Number($scope.p365Labels.businessLineType.health),buyScreenParam.productId=Number($scope.iposRequest.planId),$scope.userGeoDetails.area=$scope.quoteInfo.quoteRequest.personalInfo.displayArea,$scope.userGeoDetails.pincode=$scope.quoteInfo.quoteRequest.personalInfo.pincode,$scope.userGeoDetails.state=$scope.quoteInfo.quoteRequest.personalInfo.state,$scope.userGeoDetails.city=$scope.quoteInfo.quoteRequest.personalInfo.city,localStorageService.set("healthSelectedProduct",$scope.selectedProduct),getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.productDataReader,buyScreenParam,function(buyScreen){if(buyScreen.responseCode==$scope.p365Labels.responseCode.success){var buyScreens=buyScreen.data;$scope.proposalDetailsTemplate=$sce.trustAsHtml(buyScreens.templates[0].template),$scope.insurerInfoTemplate=$sce.trustAsHtml(buyScreens.templates[1].template),$scope.nomineeInfoTemplate=$sce.trustAsHtml(buyScreens.templates[2].template),$scope.medicalInfoTemplate=$sce.trustAsHtml(buyScreens.templates[3].template),$scope.prevPolicyDetailsTemplate=$sce.trustAsHtml(buyScreens.templates[4].template),$scope.personalIdDetailsTemplate=$sce.trustAsHtml(buyScreens.templates[5].template),$scope.productValidation=buyScreens.validation,$scope.redirectUrl=buyScreens.redirectSuccessUrl,$scope.requestFormat=buyScreens.requestFormat,$scope.transactionName=buyScreens.transaction.proposalService.name;var occupationDocId=$scope.p365Labels.documentType.healthOccupation+"-"+$scope.selectedProduct.carrierId+"-"+$scope.selectedProduct.planId;getDocUsingId(RestAPI,occupationDocId,function(occupationList){$scope.occupationList=occupationList.Occupation,getListFromDB(RestAPI,"",$scope.p365Labels.documentType.healthCarrier,$scope.p365Labels.request.findAppConfig,function(carrierList){if(carrierList.responseCode==$scope.p365Labels.responseCode.success){$scope.carrierList=carrierList.data;var docId=$scope.p365Labels.documentType.buyScreen+"-"+Number($scope.selectedProductInputParam.quoteParam.quoteType);getDocUsingId(RestAPI,docId,function(buyScreenTooltip){$scope.buyTooltip=buyScreenTooltip.toolTips,$scope.init(),$scope.initHealthBuyScreen(),$scope.initWatch()})}else $rootScope.P365Alert("Policies365",$scope.p365Labels.validationMessages.iposFormErrorMsg,"Ok")})})}else $scope.loading=!1,$rootScope.P365Alert("Policies365",$scope.p365Labels.validationMessages.iposFormErrorMsg,"Ok")})}else $rootScope.P365Alert("Policies365",$scope.p365Labels.validationMessages.iposFormErrorMsg,"Ok")})}]),angular.module("proposalresdatahealth",["CoreComponentApp","LocalStorageModule","checklist-model","ngMessages"]).controller("proposalResponseDataHealthController",["$scope","$rootScope","$timeout","RestAPI","localStorageService","$location","$window","$http","$filter","$interval","$sce",function($scope,$rootScope,$timeout,RestAPI,localStorageService,$location,$window,$http,$filter,$interval,$sce){loadDatbase(function(){$scope.healthProposalSectionHTML=wp_path+"buy/health/html/healthProposalSection.html",$scope.p365Labels=healthProposalLabels,$rootScope.loading=!0,$scope.saveProposal=!1,$scope.screenOneStatus=!0,$scope.screenTwoStatus=!1,$scope.screenThreeStatus=!1,$scope.screenFourStatus=!1,$scope.redirectForPayment=!1,$scope.screenFiveStatus=!1,$scope.accordion="1",$scope.editProposerInfo=function(){$scope.screenOneStatus=!0,$scope.screenTwoStatus=!1,$scope.screenThreeStatus=!1,$scope.screenFiveStatus=!1,$scope.screenSixStatus=!1,$scope.accordion="1",$scope.disableAllFields()},$scope.editInsuredInfo=function(){$scope.screenOneStatus=!1,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.accordion="3",$scope.disableAllFields()},$scope.editAddressInfo=function(){$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!1,$scope.accordion="2",$scope.disableAllFields()},$scope.editNomineeInfo=function(){$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!0,$scope.accordion="4",$scope.disableAllFields()},$scope.editMedicalInfo=function(){$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!0,$scope.screenFiveStatus=!0,$scope.accordion="5",$scope.disableAllFields()},$scope.Section2Inactive=!0,$scope.Section3Inactive=!0,$scope.Section4Inactive=!0,$scope.Section5Inactive=!0,$scope.submitProposerInfo=function(){$scope.accordion="2",$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!1,$scope.screenFourStatus=!1,$scope.screenFiveStatus=!1,$scope.screenSixStatus=!1,$scope.Section2Inactive=!1,$scope.disableAllFields(),1==imauticAutomation&&imatEvent("ProposalFilled"),$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled&&($scope.proposalDetailsForm.$dirty||$scope.changeCompanyName)&&($scope.saveProposal=!0,$scope.submitProposalData(),$scope.proposalDetailsForm.$dirty=!1,$scope.changeCompanyName=!1)},$scope.submitAddressDetails=function(){$scope.accordion="3",$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!1,$scope.screenFiveStatus=!1,$scope.screenSixStatus=!1,$scope.Section3Inactive=!1,$scope.disableAllFields(),$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled&&($scope.proposalDetailsForm.$dirty||$scope.changeCompanyName)&&($scope.saveProposal=!0,$scope.submitProposalData(),$scope.proposalDetailsForm.$dirty=!1,$scope.changeCompanyName=!1)},$scope.submitInsuredInfo=function(){$scope.accordion="4",$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!0,$scope.screenFiveStatus=!1,$scope.screenSixStatus=!1,$scope.Section4Inactive=!1,$scope.disableAllFields(),$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled&&$scope.addInsuredForm.$dirty&&($scope.saveProposal=!0,$scope.submitProposalData(),$scope.addInsuredForm.$dirty=!1)},$scope.submitNomineeInfo=function(){$scope.accordion="5",$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!0,$scope.screenFiveStatus=!0,$scope.screenSixStatus=!1,$scope.Section5Inactive=!1,$scope.disableAllFields(),$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled&&$scope.addNomineeForm.$dirty&&($scope.saveProposal=!0,$scope.submitProposalData(),$scope.addNomineeForm.$dirty=!1)},$scope.submitMedicalInfo=function(){$scope.accordion="6",$scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!0,$scope.screenFiveStatus=!0,$scope.screenSixStatus=!0,$scope.Section6Inactive=!1,$scope.disableAllFields(),$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled&&$scope.medicalDetailsForm.$dirty&&($scope.saveProposal=!0,$scope.submitProposalData(),$scope.medicalDetailsForm.$dirty=!1)},$scope.disableAllFields=function(){$scope.proposalStatus&&"completed"==$scope.proposalStatus.statusPaym&&setTimeout(function(){$("form md-option").attr("disabled","disabled"),$("form md-select").attr("disabled","disabled"),$("input").attr("disabled","disabled"),$("md-radio-button").attr("disabled","disabled"),$("md-checkbox").attr("disabled","disabled"),$scope.insuranceDetailsForm.$invalid=!0},1e3)},$scope.policytransaction={},$scope.proposerInfo={},$scope.proposerDetails={},$scope.vehicleInfo={},$scope.vehicleDetails={},$scope.nominationInfo={},$scope.nominationDetails={},$scope.appointeeInfo={},$scope.appointeeDetails={},$scope.authenticate={},$scope.insuranceInfo={},$scope.insuranceDetails={},$scope.proposalApp={},$scope.coverageDetails={},$scope.medicalQuestionarrier=[],$scope.proposalStatus=[],$scope.proposalStatusForm=[],$scope.declartionDetails=[],$scope.proposalApp.declartionDetails=[],$scope.proposalApp.declartionDetails.accepted={},$scope.quoteUserInfo={},$scope.salutationsList=[{value:"Mr",display:"Mr."},{value:"Ms",display:"Ms."},{value:"Mrs",display:"Mrs."}],$scope.genderType=genderTypeGeneric,$scope.maritalStatusType=maritalStatusListGeneric,$scope.nomineeRelationType=nomineeRelationTypeGeneric,$scope.appointeeRelationType=nomineeRelationTypeGeneric,$scope.monthList=healthmonthListGeneric,$scope.undertakingList=religareUndertakingList,$scope.annualIncomesRange=annualIncomesGeneric,$scope.modalPropScreenError=!1,$scope.selectedProduct={},$scope.insuranceDetails={},$scope.premiumDetails=[],$scope.proposerDetails=[],$scope.nominationInfo=[],$scope.nominationDetails={},$scope.insuranceInfo=[],$scope.selectedProductInputParam=[],$scope.proposalApp.coverageDetails={},$scope.proposalRequest={},$scope.proposalRequest.coverageDetails=[],$scope.personalInfo={},$scope.proposerInfo={},$scope.proposalApp.proposerInfo={},$scope.productValidation=[],$scope.proposalApp.nomineeDetails={},$scope.proposalApp.nomineeDetails.apointeeDetails={},$scope.proposalApp.proposerInfo.personalInfo={},$scope.proposalApp.proposerInfo.contactInfo={},$scope.proposalApp.insuredMembers=[],$scope.permanentAddressDetails={},$scope.insuredInfo=[],$scope.insuredInfo.height=[],$scope.insuredInfo.weight=[],$scope.insuredMembers=[],$scope.medicalQuestionarrie=[],$scope.mQuestion=[],$scope.mQuestion.questionCode={},$scope.occupationList=[],$scope.proposalApp.previousPolicyDetails={},$scope.previousPolicyDetails=[],$scope.nomineeAge={},$scope.proposalRequest.medicalQuestionarrie=[],$scope.memberList=[],$scope.proposalApp.proposerInfo.permanentAddress={},$scope.proposalApp.socialStatusDetails={},$scope.coverageDetails.riders=[],$scope.healthProposalResponse={},$scope.paymentResponse={},$scope.healthPolicyResponse={},$scope.income={},$scope.income.annualIncome={},$scope.diseaseList=[],$scope.insuredMemberDef=insuredMemberDef;var proposalDocParam={};proposalDocParam.proposalId=$location.search().proposalId,proposalDocParam.businessLineId=$scope.p365Labels.businessLineType.health,$scope.iposRequest={},$scope.iposRequest.parent_id="undefined"!=String($rootScope.parent_id)?$rootScope.parent_id:$location.search().recordId,$scope.iposRequest.parent_type="undefined"!=String($rootScope.parent_type)?$rootScope.parent_type:$location.search().moduleName,$scope.iposRequest.requestType=$scope.p365Labels.request.createProposalRecord,RestAPI.invoke("proposalDataReader",proposalDocParam).then(function(proposalDataResponse){if(proposalDataResponse.responsecode==$scope.p365Labels.responseCode.success){$scope.responseProduct=proposalDataResponse.data.PolicyTransaction,$scope.proposalApp.documentType="HealthProposalRequest",$scope.proposalApp.QUOTE_ID=$scope.responseProduct.QUOTE_ID,$scope.proposalApp.carrierId=$scope.responseProduct.carrierId,$scope.proposalApp.planId=$scope.responseProduct.productId,messageIDVar=$scope.responseProduct.leadMessageId,campaign_id=$scope.responseProduct.campaign_id,requestSource=$scope.responseProduct.requestSource,sourceOrigin=$scope.responseProduct.source,$scope.proposalApp.username=$scope.responseProduct.username,$scope.proposalApp.agencyId=$scope.responseProduct.agencyId,$scope.proposalApp.coverageDetails=$scope.responseProduct.proposalRequest.coverageDetails,$scope.responseProduct.referralCode&&($scope.proposalApp.referralCode=$scope.responseProduct.referralCode);var buyScreenParam={documentType:"proposalScreenConfig"};buyScreenParam.businessLineId=Number($scope.p365Labels.businessLineType.health),buyScreenParam.carrierId=$scope.responseProduct.carrierId,buyScreenParam.productId=Number($scope.responseProduct.productId),buyScreenParam.QUOTE_ID=$scope.proposalApp.QUOTE_ID,getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.productDataReader,buyScreenParam,function(buyScreen){if(buyScreen.responseCode==$scope.p365Labels.responseCode.success){var buyScreens=buyScreen.data;$scope.proposalDetailsTemplate=$sce.trustAsHtml(buyScreens.templates[0].template),$scope.insurerInfoTemplate=$sce.trustAsHtml(buyScreens.templates[1].template),$scope.nomineeInfoTemplate=$sce.trustAsHtml(buyScreens.templates[2].template),$scope.medicalInfoTemplate=$sce.trustAsHtml(buyScreens.templates[3].template),$scope.prevPolicyDetailsTemplate=$sce.trustAsHtml(buyScreens.templates[4].template),$scope.personalIdDetailsTemplate=$sce.trustAsHtml(buyScreens.templates[5].template),$scope.productValidation=buyScreens.validation,$scope.OTPFlag=$scope.productValidation.OTPFlag,$scope.productValidation.acceptedPreExistDisease&&($scope.proposalApp.acceptedPreExistDisease={},$scope.proposalApp.acceptedPreExistDisease.applicable="false"),$scope.productValidation.individualFloaterPlan&&"MARRIED"==$scope.responseProduct.proposerInfo.personalInfo.martialStatus&&($scope.modalIndividualFloaterPlan=!0),getDocUsingIdQuoteDB(RestAPI,$scope.proposalApp.QUOTE_ID,function(quoteCalcDetails){var quoteCalcRequest={};quoteCalcRequest=quoteCalcDetails.quoteRequest,$scope.quoteCalcResponse=quoteCalcDetails.quoteResponse,quoteCalcRequest.sumInsured=$scope.responseProduct.proposalRequest.coverageDetails.sumAssured;for(var j=0;j<$scope.quoteCalcResponse.length;j++)$scope.quoteCalcResponse[j].id=j+1;for(var i=0;i<$scope.quoteCalcResponse.length;i++)if($scope.quoteCalcResponse[i].carrierId==$scope.responseProduct.carrierId&&$scope.quoteCalcResponse[i].planId==$scope.responseProduct.productId){if(!$scope.responseProduct.childPlanId){$scope.premiumDetails.selectedProductDetails=$scope.quoteCalcResponse[i],$scope.selectedProduct=$scope.premiumDetails.selectedProductDetails;break}if($scope.quoteCalcResponse[i].childPlanId==$scope.responseProduct.childPlanId){$scope.premiumDetails.selectedProductDetails=$scope.quoteCalcResponse[i],$scope.selectedProduct=$scope.premiumDetails.selectedProductDetails;break}}$scope.changeInsuranceCompany=function(){$scope.selectedProduct=$scope.premiumDetails.selectedProductDetails,$scope.proposalApp.coverageDetails.totalPremium=$scope.selectedProduct.annualPremium,null!=$scope.selectedProduct.carrierQuoteId&&"undefined"!=String($scope.selectedProduct.carrierQuoteId)&&""!=$scope.selectedProduct.carrierQuoteId&&($scope.proposalApp.coverageDetails.carrierQuoteId=$scope.selectedProduct.carrierQuoteId),null!=$scope.selectedProduct.serviceTax&&"undefined"!=String($scope.selectedProduct.serviceTax)?$scope.proposalApp.coverageDetails.serviceTax=$scope.selectedProduct.serviceTax:$scope.proposalApp.coverageDetails.serviceTax=void 0,$scope.proposalApp.coverageDetails.sumAssured=$scope.selectedProduct.sumInsured,$scope.changeCompanyName=!0},localStorageService.set("healthQuoteInputParamaters",quoteCalcRequest),$scope.selectedProductInputParamForPin=angular.copy(localStorageService.get("healthQuoteInputParamaters")),$scope.selectedProductInputParam=localStorageService.get("healthQuoteInputParamaters"),$scope.productValidation.requotecalc?RestAPI.invoke($scope.p365Labels.getRequest.quoteHealth,quoteCalcRequest).then(function(callback){$scope.healthRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success?($scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("HEALTH_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.healthRecalculateQuoteRequest=callback.data,$scope.healthQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.healthRecalculateQuoteRequest,function(obj,i){var request={},header={};header.transactionName=$scope.p365Labels.transactionName.healthQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var healthQuoteResponse=JSON.parse(callback);healthQuoteResponse.responseCode==$scope.p365Labels.responseCode.success?(null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.responseProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.responseProduct.productId&&($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId),$scope.proposalDataReader()),healthQuoteResponse.data.quotes[0].id=healthQuoteResponse.messageId,$scope.quoteCalcResponse.push(healthQuoteResponse.data.quotes[0])):null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.responseProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.responseProduct.productId&&($scope.loading=!1,$scope.propScreenError=$scope.p365Labels.validationMessages.generalisedErrMsg,$scope.modalPropScreenError=!0)})})):($scope.propScreenError=$scope.p365Labels.validationMessages.generalisedErrMsg,$scope.modalPropScreenError=!0)}):$scope.proposalDataReader()})}}),$scope.redirectToQuote=function(){$location.path("/quote")}}else{$scope.loading=!1;var buyScreenCnfrmError=$scope.p365Labels.validationMessages.buyScreenCnfrmError.replace("INSURER_NAME",$scope.selectedProduct.insuranceCompany);$rootScope.P365Alert("Policies365",buyScreenCnfrmError,"Ok")}$scope.proposalDataReader=function(){getDocUsingId(RestAPI,"relationshipdetailslist",function(relationList){$scope.relationList=relationList.relationships;var occupationDocId=$scope.p365Labels.documentType.healthOccupation+"-"+$scope.responseProduct.carrierId+"-"+$scope.responseProduct.productId;getDocUsingId(RestAPI,occupationDocId,function(occupationList){localStorageService.set("healthBuyOccupationList",occupationList.Occupation),$scope.occupationList=occupationList.Occupation})}),$scope.selectedProduct.planName=$scope.responseProduct.planName,$scope.selectedProduct.insuranceCompany=$scope.responseProduct.insuranceCompany,$rootScope.loading=!1,$scope.proposalApp.coverageDetails.sumAssured=$scope.responseProduct.proposalRequest.coverageDetails.sumAssured,$scope.proposalApp.proposerInfo=$scope.responseProduct.proposalRequest.proposerInfo,$scope.storedDOB=angular.copy($scope.proposalApp.proposerInfo.personalInfo.dateOfBirth),$scope.selectedGender=angular.copy($scope.proposalApp.proposerInfo.personalInfo.gender),$scope.quoteUserInfo.firstName=$scope.proposalApp.proposerInfo.personalInfo.firstName,$scope.quoteUserInfo.lastName=$scope.proposalApp.proposerInfo.personalInfo.lastName,$scope.quoteUserInfo.emailId=$scope.proposalApp.proposerInfo.contactInfo.emailId,$scope.quoteUserInfo.mobileNumber=$scope.proposalApp.proposerInfo.contactInfo.mobile,$scope.quoteUserInfo.termsCondition=!0,localStorageService.set("quoteUserInfo",$scope.quoteUserInfo);for(var i=0;i<$scope.annualIncomesRange.length;i++)$scope.annualIncomesRange[i].annualIncome==$scope.responseProduct.proposalRequest.proposerInfo.personalInfo.annualIncome&&($scope.annualIncome=$scope.annualIncomesRange[i]);$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled&&($scope.screenOneStatus=!0,$scope.screenTwoStatus=!0,$scope.screenThreeStatus=!0,$scope.screenFourStatus=!0,$scope.screenFiveStatus=!0,$scope.Section1Inactive=!1,$scope.Section2Inactive=!0,$scope.Section3Inactive=!0,$scope.Section4Inactive=!0,$scope.Section5Inactive=!0,$scope.accordion="1"),$scope.checkForPanCardValidation();var proposerDOBOption={};if(proposerDOBOption.minimumYearLimit="-"+$scope.productValidation.proposerAgeMax.age+"Y",proposerDOBOption.maximumYearLimit="-"+$scope.productValidation.proposerAgeMin.age+"Y",proposerDOBOption.changeMonth=!0,proposerDOBOption.changeYear=!0,proposerDOBOption.dateFormat="dd/mm/yy",$scope.proposerDOBOptions=setP365DatePickerProperties(proposerDOBOption),$scope.selectedProduct.selectedFamilyMembers)for(i=0;i<$scope.selectedProduct.selectedFamilyMembers.length;i++){if("CH"==$scope.selectedProduct.selectedFamilyMembers[i].relationship)var childMinDOBOption=$scope.selectedProduct.selectedFamilyMembers[i].minDOB,childMaxDOBOption=$scope.selectedProduct.selectedFamilyMembers[i].maxDOB;if("SP"==$scope.selectedProduct.selectedFamilyMembers[i].relationship||"A"==$scope.selectedProduct.selectedFamilyMembers[i].relationship)var selfMinDOBOption=$scope.selectedProduct.selectedFamilyMembers[i].minDOB,selfMaxDOBOption=$scope.selectedProduct.selectedFamilyMembers[i].maxDOB;var selfInsuredDOBOption={};if(selfMinDOBOption&&selfMaxDOBOption?(selfInsuredDOBOption.minimumDateStringFormat=selfMinDOBOption,selfInsuredDOBOption.maximumDateStringFormat=selfMaxDOBOption):(selfInsuredDOBOption.minimumYearLimit="-"+$scope.productValidation.insuredAdultAgeMax.age+"Y",selfInsuredDOBOption.maximumYearLimit="-"+$scope.productValidation.insuredAdultAgeMin.age+"Y"),selfInsuredDOBOption.changeMonth=!0,selfInsuredDOBOption.changeYear=!0,selfInsuredDOBOption.dateFormat="dd/mm/yy",$scope["selfInsuredDateOptions"+i]=setP365DatePickerProperties(selfInsuredDOBOption),null!=$scope.productValidation.insuredChildAgeMax){var childInsuredDateOption={};childMinDOBOption&&childMaxDOBOption?(childInsuredDateOption.minimumDateStringFormat=childMinDOBOption,childInsuredDateOption.maximumDateStringFormat=childMaxDOBOption):(childInsuredDateOption.minimumYearLimit="-"+$scope.productValidation.insuredChildAgeMax.age+"Y",childInsuredDateOption.maximumYearLimit="-"+$scope.productValidation.insuredChildAgeMin.age+"Y"),childInsuredDateOption.changeMonth=!0,childInsuredDateOption.changeYear=!0,childInsuredDateOption.dateFormat="dd/mm/yy",$scope["childInsuredDateOptions"+i]=setP365DatePickerProperties(childInsuredDateOption)}}var nomineeDOBOption={};nomineeDOBOption.minimumYearLimit="-"+$scope.productValidation.proposerAgeMax.age+"Y",nomineeDOBOption.maximumYearLimit="-1Y",nomineeDOBOption.changeMonth=!0,nomineeDOBOption.changeYear=!0,nomineeDOBOption.dateFormat="dd/mm/yy",$scope.nomineeDOBOptions=setP365DatePickerProperties(nomineeDOBOption);var appointeeDOBOption={};appointeeDOBOption.minimumYearLimit="-"+$scope.productValidation.proposerAgeMax.age+"Y",appointeeDOBOption.maximumYearLimit="-18Y",appointeeDOBOption.changeMonth=!0,appointeeDOBOption.changeYear=!0,appointeeDOBOption.dateFormat="dd/mm/yy",$scope.appointeeDOBOptions=setP365DatePickerProperties(appointeeDOBOption);var DOBOption={};DOBOption.minimumYearLimit="-50Y",DOBOption.maximumYearLimit="-0Y",DOBOption.changeMonth=!0,DOBOption.changeYear=!0,DOBOption.dateFormat="dd/mm/yy",$scope.regularDOBOptions=setP365DatePickerProperties(DOBOption),$scope.proposalApp.proposerInfo.personalInfo.occupation=$scope.responseProduct.proposalRequest.proposerInfo.personalInfo.occupation,$scope.permanentAddressDetails=$scope.responseProduct.proposalRequest.proposerInfo.permanentAddress,$scope.proposalApp.proposerInfo.personalInfo.isAddressSameAsCommun=$scope.permanentAddressDetails.isAddressSameAsCommun,$scope.proposalApp.proposerInfo.personalInfo.houseNo=$scope.responseProduct.proposalRequest.proposerInfo.contactInfo.houseNo,$scope.proposalApp.proposerInfo.personalInfo.streetDetails=$scope.responseProduct.proposalRequest.proposerInfo.contactInfo.streetDetails,$scope.proposalApp.insuredMembers=$scope.responseProduct.proposalRequest.insuredMembers,$scope.proposalApp.nomineeDetails=$scope.responseProduct.proposalRequest.nomineeDetails,$scope.productValidation.isNomineeSalutationRequired&&($scope.proposalApp.nomineeDetails.salutation=$scope.responseProduct.proposalRequest.nomineeDetails.salutation),null!==$scope.responseProduct.proposalRequest.nomineeDetails.dateOfBirth&&($scope.nomineeAge=getAgeFromDOB($scope.proposalApp.nomineeDetails.dateOfBirth)),$scope.nomineeAge<18&&($scope.proposalApp.nomineeDetails.apointeeDetails=$scope.responseProduct.proposalRequest.nomineeDetails.apointeeDetails),$scope.numRecords=4,$scope.page=1,$scope.masterDieaseDetails={};for(i=0;i<$scope.proposalApp.insuredMembers.length;i++)for(var diseaseCount=0;diseaseCount<$scope.proposalApp.insuredMembers[i].dieaseDetails.length;diseaseCount++){var key=$scope.proposalApp.insuredMembers[i].relationshipCode+"-"+$scope.proposalApp.insuredMembers[i].dieaseDetails[diseaseCount].masterDiseaseCode;$scope.masterDieaseDetails[key]=$scope.proposalApp.insuredMembers[i].dieaseDetails[diseaseCount]}var searchData={documentType:"DiseaseQuestion"};searchData.carrierId=$scope.responseProduct.carrierId,searchData.planId=$scope.responseProduct.productId,searchData.riders=$scope.responseProduct.proposalRequest.coverageDetails.riders,getDocUsingParam(RestAPI,"getHealthQuestionList",searchData,function(callback){$scope.medicalQuestionarrier=callback.data;for(var i=0;i<$scope.responseProduct.proposalRequest.medicalQuestionarrie.length;i++)"PREXDISEA"==$scope.responseProduct.proposalRequest.medicalQuestionarrie[i].questionCode&&"true"==$scope.responseProduct.proposalRequest.medicalQuestionarrie[i].applicable&&($scope.diseaseShow=!0,$scope.preDiseaseApplicable="true",$scope.clicktoShowDisease());for(i=0;i<$scope.medicalQuestionarrier.length;i++)for(var j=0;j<$scope.responseProduct.proposalRequest.medicalQuestionarrie.length;j++)if($scope.medicalQuestionarrier[i].questionCode==$scope.responseProduct.proposalRequest.medicalQuestionarrie[j].questionCode){$scope.medicalQuestionarrier[i].applicable=$scope.responseProduct.proposalRequest.medicalQuestionarrie[j].applicable;break}var searchDiseaseData={documentType:"DiseaseMapping"};searchDiseaseData.carrierId=$scope.responseProduct.carrierId,searchDiseaseData.planId=$scope.responseProduct.productId,searchDiseaseData.riders=$scope.responseProduct.proposalRequest.coverageDetails.riders,getDocUsingParam(RestAPI,"getHealthQuestionList",searchDiseaseData,function(callback){if(callback.data){$scope.diseaseList=callback.data,$scope.numberOfPages=Math.ceil($scope.diseaseList.length/$scope.numRecords),$scope.diseaseListDisable=angular.copy($scope.diseaseList);for(var i=0;i<$scope.diseaseListDisable.length;i++)$scope.diseaseListDisable[i].subParentId=$scope.diseaseListDisable[i].parentId}})}),$scope.isDieaseApplicable=function(relationshipCode,masterDieasesCode){var key=relationshipCode+"-"+masterDieasesCode;return null!=$scope.masterDieaseDetails[key]&&1==$scope.masterDieaseDetails[key].applicable},$scope.isDisableApplicable=function(parentId){for(var i=0;i<$scope.diseaseListDisable.length;i++)return parentId!=$scope.diseaseListDisable[i].subParentId},$scope.diseaseShow=!1,$scope.clicktoShowDisease=function(){$scope.diseaseShow=!0},$scope.clicktoHideDisease=function(){$scope.diseaseShow=!1},$scope.bmiError=!1,$scope.isRegreatPolicyMsg=!1;var quesArr=[],regreatPolicyArr=[];$scope.inputTypeCheck=function(sel,quesId,mquestion){if("true"==sel)if($scope.selectedQuestions=quesId,$scope.productValidation.isBmiValidationApplicable||void 0==$scope.productValidation.isBmiValidationApplicable||quesArr.push(quesId),"Y"==mquestion.isRegretPolicy){regreatPolicyArr.push(quesId);var screenCnfrmError=$scope.p365Labels.errorMessage.regretPolicyMsg;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}else regreatPolicyArr.length>0&&regreatPolicyArr.splice(-1,quesId);else{$scope.productValidation.isBmiValidationApplicable||void 0==$scope.productValidation.isBmiValidationApplicable||quesArr.length>0&&quesArr.splice(-1,quesId);for(var i=0;i<$scope.proposalApp.insuredMembers.length;i++)for(var j=0;j<$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.length;j++)quesId==$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].questionCode&&($scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].applicable="false");if("N"==mquestion.isRegretPolicy){regreatPolicyArr.push(quesId);screenCnfrmError=$scope.p365Labels.errorMessage.regretPolicyMsg;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}else regreatPolicyArr.length>0&&regreatPolicyArr.splice(-1,quesId)}quesArr.length>0?$scope.bmiError=!0:$scope.bmiError=!1,regreatPolicyArr.length>0?$scope.isRegreatPolicyMsg=!0:$scope.isRegreatPolicyMsg=!1},$scope.TermsCheck=function(sel){$scope.checkForStartHealth="true"!=sel},$scope.mediError=!1,$scope.mediCheck=function(sel){"true"==sel?($scope.checkForStartHealth=!0,$scope.mediError=!0):($scope.checkForStartHealth=!1,$scope.mediError=!1)},$scope.showTermsDiv=!1,$rootScope.showTerms=function(){$scope.showTermsDiv=!0},$rootScope.closeTerms=function(){$scope.showTermsDiv=!1},$scope.next=function(){$scope.page=$scope.page+1},$scope.back=function(){$scope.page=$scope.page-1},$scope.questionLength=[],$scope.selDiseaseList=[],$scope.stateChanged=function(qId,relationship,id){if(1==qId.applicable){for(var i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==relationship)for(var j=0;j<$scope.proposalApp.insuredMembers[i].dieaseDetails.length;j++)$scope.proposalApp.insuredMembers[i].dieaseDetails[j].masterDiseaseCode==qId.masterDiseaseCode&&($scope.proposalApp.insuredMembers[id].dieaseDetails[j].applicable=!0)}else for(i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==relationship)for(j=0;j<$scope.proposalApp.insuredMembers[i].dieaseDetails.length;j++)$scope.proposalApp.insuredMembers[i].dieaseDetails[j].masterDiseaseCode==qId.masterDiseaseCode&&($scope.proposalApp.insuredMembers[id].dieaseDetails[j].applicable=!1);for(i=0;i<$scope.questionLength.length;i++)if($scope.questionLength[i].dieaseCode==qId.dieaseCode){$scope.questionLength.splice(i,1);break}$scope.questionLength.push(qId)},$scope.stateChangedMedical=function(ques,sel,relation){var i,j;$scope.productValidation.smokingFlag&&"SMOKE"==ques.questionCode&&$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.smokingStatusChangeMsg,"No","Yes",function(confirmStatus){if(confirmStatus){if($scope.loading=!0,1==sel){for(i=0;i<$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers.length;i++)if($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation==relation){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking="Y",$scope.proposalApp.insuredMembers[i].isSmoking="Y";break}}else for(i=0;i<$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers.length;i++)if($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation==relation){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking="N",$scope.proposalApp.insuredMembers[i].isSmoking="N";break}$scope.selectedProduct.childPlanId&&($scope.selectedProductInputParamForPin.childPlanId=Number($scope.selectedProduct.childPlanId)),$scope.selectedProductInputParamForPin.sumInsured=$scope.selectedProduct.sumInsured,localStorageService.get("quoteUserInfo").mobileNumber&&($scope.selectedProductInputParamForPin.mobileNumber=localStorageService.get("quoteUserInfo").mobileNumber),RestAPI.invoke($scope.p365Labels.getRequest.quoteHealth,$scope.selectedProductInputParamForPin).then(function(callback){if($scope.healthRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success)$scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("HEALTH_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.healthRecalculateQuoteRequest=callback.data,$scope.healthQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.healthRecalculateQuoteRequest,function(obj,i){var request={},header={};header.transactionName=$scope.p365Labels.transactionName.healthQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var healthQuoteResponse=JSON.parse(callback);if($scope.responseRecalculateCodeList.push(healthQuoteResponse.responseCode),healthQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId&&(healthQuoteResponse.data.quotes[0].childPlanId?healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId&&($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId)):($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId))),healthQuoteResponse.data.quotes[0].id=healthQuoteResponse.messageId,$scope.quoteCalcResponse.push(healthQuoteResponse.data.quotes[0]);else if(null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId){for($scope.loading=!1,i=0;i<$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers.length;i++)if($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation==relation){if("Y"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking="N",$scope.proposalApp.insuredMembers[i].isSmoking="N";break}if("N"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking="Y",$scope.proposalApp.insuredMembers[i].isSmoking="Y";break}}for(i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==relation)for(j=0;j<$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.length;j++)if(ques.questionId==$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].questionCode){if(1==sel){$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].applicable="false";break}if(0==sel){$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].applicable=!0;break}}var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgSmoking;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})});else{for($scope.loading=!1,i=0;i<$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers.length;i++)if($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation==relation&&$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking){if("Y"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking="N",$scope.proposalApp.insuredMembers[i].isSmoking="N";break}if("N"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].isSmoking="Y",$scope.proposalApp.insuredMembers[i].isSmoking="Y";break}}for(i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==relation)for(j=0;j<$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.length;j++)if(ques.questionId==$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].questionCode){if(1==sel){$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].applicable="false";break}if(0==sel){$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].applicable=!0;break}}var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgSmoking;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}})}else for($scope.loading=!1,i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==relation)for(j=0;j<$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.length;j++)if(ques.questionId==$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].questionCode){if(1==sel){$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].applicable="false";break}if(0==sel){$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j].applicable=!0;break}}})},$scope.proposalApp.previousPolicyDetails.policyNumber=$scope.responseProduct.proposalRequest.previousPolicyDetails.policyNumber,$scope.proposalApp.socialStatusDetails.socialStatus=$scope.responseProduct.proposalRequest.socialStatusDetails.socialStatus,$scope.proposalApp.socialStatusDetails.belowPovertyLine=$scope.responseProduct.proposalRequest.socialStatusDetails.belowPovertyLine,$scope.proposalApp.socialStatusDetails.informalSector=$scope.responseProduct.proposalRequest.socialStatusDetails.informalSector,$scope.proposalApp.socialStatusDetails.phyicallyChallenged=$scope.responseProduct.proposalRequest.socialStatusDetails.phyicallyChallenged,$scope.proposalApp.socialStatusDetails.unorganizedSector=$scope.responseProduct.proposalRequest.socialStatusDetails.unorganizedSector,$scope.proposalApp.declartionDetails[0].accepted=$scope.responseProduct.proposalRequest.declartionDetails[0].accepted,$scope.proposalStatusform=!0,null!=$scope.responseProduct.healthProposalResponse&&($scope.proposalStatus.statusDateProp=$scope.responseProduct.healthProposalResponse.updatedDate,$scope.proposalStatus.statusProp="completed"),null!=$scope.responseProduct.paymentResponse&&(1==$scope.responseProduct.paymentResponse.transactionStatusCode?($scope.proposalStatus.statusDatePaym=$scope.responseProduct.paymentResponse.updatedDate,$scope.proposalStatus.statusPaym="completed",$scope.disableAllFields=function(){setTimeout(function(){$("form md-option").attr("disabled","disabled"),$("form md-select").attr("disabled","disabled"),$("input").attr("disabled","disabled"),$("md-radio-button").attr("disabled","disabled"),$("md-checkbox").attr("disabled","disabled"),$scope.insuranceDetailsForm.$invalid=!0},1e3)}):0==$scope.responseProduct.paymentResponse.transactionStatusCode?($scope.proposalStatus.statusDatePaym=$scope.responseProduct.paymentResponse.updatedDate,$scope.proposalStatus.statusPaym="failed"):($scope.proposalStatus.statusPaym="pending",$scope.proposalStatus.statusPoli="pending")),null!=$scope.responseProduct.healthPolicyResponse&&(1==$scope.responseProduct.healthPolicyResponse.transactionStatusCode?($scope.proposalStatus.statusDatePoli=$scope.responseProduct.healthPolicyResponse.updatedDate,$scope.proposalStatus.statusPoli="completed"):0==$scope.responseProduct.healthPolicyResponse.transactionStatusCode&&($scope.proposalStatus.statusDatePoli=$scope.responseProduct.healthPolicyResponse.updatedDate,$scope.proposalStatus.statusPoli="failed")),$scope.showAuthenticateForm=function(){var validateAuthParam={paramMap:{}};validateAuthParam.mobileNumber=$scope.proposalApp.proposerInfo.contactInfo.mobile,validateAuthParam.funcType=$scope.p365Labels.functionType.optAuth,validateAuthParam.paramMap.OTP=$scope.p365Labels.functionType.otpGenerate,getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.sendSMS,validateAuthParam,function(createOTP){createOTP.responseCode==$scope.p365Labels.responseCode.success?($scope.createOTPError="",$scope.modalOTP=!0):createOTP.responseCode==$scope.p365Labels.responseCode.blockedMobile?($scope.createOTPError=createOTP.message,$scope.modalOTPError=!0):($scope.createOTPError=$scope.p365Labels.errorMessage.createOTP,$scope.modalOTPError=!0)})},$scope.hideModal=function(){$scope.modalOTP=!1},$scope.hideModalError=function(){$scope.modalOTPError=!1},$scope.resendOTP=function(){var validateAuthParam={paramMap:{}};validateAuthParam.mobileNumber=$scope.proposalApp.proposerInfo.contactInfo.mobile,validateAuthParam.funcType=$scope.p365Labels.functionType.optAuth,validateAuthParam.paramMap.OTP=$scope.p365Labels.functionType.otpGenerate,getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.sendSMS,validateAuthParam,function(createOTP){createOTP.responseCode==$scope.p365Labels.responseCode.success?$scope.invalidOTPError="":createOTP.responseCode==$scope.p365Labels.responseCode.userNotExist?$scope.invalidOTPError=createOTP.message:createOTP.responseCode==$scope.p365Labels.responseCode.blockedMobile?($scope.invalidOTPError=createOTP.message,$scope.disableOTP=!0):createOTP.responseCode==$scope.p365Labels.responseCode.mobileInvalidCode?$scope.invalidOTPError=createOTP.message:$scope.invalidOTPError=$scope.p365Labels.errorMessage.createOTP})},$scope.validateAuthenticateForm=function(){var proposalSubmitConfirmMsg="Please make sure you have entered the right Mobile Number and Email ID. All our communication will be sent to your Mobile "+$scope.proposalApp.proposerInfo.contactInfo.mobile+" or Email "+$scope.proposalApp.proposerInfo.contactInfo.emailId+". Is the entered Mobile No. and Email ID right?";$rootScope.P365Confirm("Policies365",proposalSubmitConfirmMsg,"No","Yes",function(confirmStatus){confirmStatus&&($scope.OTPFlag?$scope.showAuthenticateForm():$scope.OTPFlag||$scope.proceedForPayment())})};var bmiArr=[];$scope.bmiMsg=!1,$scope.bmiValidation=function(insuredInfo,index){if(!isNaN(insuredInfo.weight)&&!isNaN(insuredInfo.height)&&String(insuredInfo.weight).length>0&&String(insuredInfo.height).length>0){var height=Number(insuredInfo.height),bmi=Number(insuredInfo.weight)/(height*height)*1e4,bmiVal=Math.round(bmi);if($scope.productValidation.bmirequotecalc){if(bmi>Number($scope.productValidation.bmiMaxLimit)||bmi<Number($scope.productValidation.bmiMinLimit))return $rootScope.P365Alert("Policies365",$scope.p365Labels.validationMessages.invalidOptionBuyPolicy,"Ok"),insuredInfo.height="",insuredInfo.weight="",!1;if(bmi>30&&bmi<=34)$scope.reCalcQuoteOnBMI(bmiVal,insuredInfo);else if(bmi<18.5||bmi>34){var screenCnfrmError=$scope.p365Labels.errorMessage.regretPolicyMsg;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok"),insuredInfo.height="",insuredInfo.weight=""}}else if($scope.productValidation.isBmiValidationApplicable||void 0==$scope.productValidation.isBmiValidationApplicable){if(bmi>Number($scope.productValidation.bmiMaxLimit)||bmi<Number($scope.productValidation.bmiMinLimit))return $rootScope.P365Alert("Policies365",$scope.p365Labels.validationMessages.invalidOptionBuyPolicy,"Ok"),insuredInfo.height="",insuredInfo.weight="",!1}else{Number($scope.productValidation.bmiMaxLimit),bmiArr[index]=bmi;for(var i=0;i<bmiArr.length;i++){if(bmiArr[i]>33){$scope.bmiMsg=!0;break}$scope.bmiMsg=!1}}}},$scope.reCalcQuoteOnBMI=function(bmiVal,selInsuredInfo){$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.bmiChangeMsg,"No","Yes",function(confirmStatus){if(confirmStatus){$scope.loading=!0;for(var i=0;i<$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers.length;i++)if($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation==selInsuredInfo.relationship){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].bmi=bmiVal;break}for(i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==selInsuredInfo.relationship){$scope.proposalApp.insuredMembers[i].bmi=bmiVal;break}null!=$scope.selectedProduct.childPlanId&&($scope.selectedProductInputParamForPin.childPlanId=Number($scope.selectedProduct.childPlanId)),$scope.selectedProductInputParamForPin.sumInsured=Number($scope.selectedProduct.sumInsured),RestAPI.invoke($scope.p365Labels.getRequest.quoteHealth,$scope.selectedProductInputParamForPin).then(function(callback){if($scope.healthRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success)$scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("HEALTH_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.healthRecalculateQuoteRequest=callback.data,$scope.healthQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.healthRecalculateQuoteRequest,function(obj,i){var request={},header={};header.transactionName=$scope.p365Labels.transactionName.healthQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var healthQuoteResponse=JSON.parse(callback);if($scope.responseRecalculateCodeList.push(healthQuoteResponse.responseCode),healthQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId&&(healthQuoteResponse.data.quotes[0].childPlanId?healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId&&($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId)):($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId))),healthQuoteResponse.data.quotes[0].id=healthQuoteResponse.messageId,$scope.quoteCalcResponse.push(healthQuoteResponse.data.quotes[0]);else if(null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId)if($scope.selectedProduct.childPlanId){if(healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId){$scope.loading=!1;var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgBmi;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}else{$scope.loading=!1,selInsuredInfo.height="",selInsuredInfo.weight="";for(var i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==selInsuredInfo.relationship){$scope.proposalApp.insuredMembers[i].bmi=0;break}screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgBmi;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})});else{$scope.loading=!1,selInsuredInfo.height="",selInsuredInfo.weight="";for(var i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==selInsuredInfo.relationship){$scope.proposalApp.insuredMembers[i].bmi=0;break}var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgBmi;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}})}else{$scope.loading=!1,selInsuredInfo.height="",selInsuredInfo.weight="";for(i=0;i<$scope.proposalApp.insuredMembers.length;i++)if($scope.proposalApp.insuredMembers[i].relationship==selInsuredInfo.relationship){$scope.proposalApp.insuredMembers[i].bmi=0;break}}})},$scope.changeInsuredHeight=function(insuredInfo,index){if($scope.productValidation.bmiValidationFlag){var insuredAge=getAgeFromDOB(insuredInfo.dateOfBirth);if(insuredAge<=$scope.productValidation.bmiChildMinAgeLimit)return;insuredAge>$scope.productValidation.bmiChildMinAgeLimit&&$scope.bmiValidation(insuredInfo,index)}},$scope.changeInsuredWeight=function(insuredInfo,index){if($scope.productValidation.bmiValidationFlag){var insuredAge=getAgeFromDOB(insuredInfo.dateOfBirth);if(insuredAge<=$scope.productValidation.bmiChildMinAgeLimit)return;insuredAge>$scope.productValidation.bmiChildMinAgeLimit&&$scope.bmiValidation(insuredInfo,index)}},$scope.proceedForPayment=function(){if($scope.OTPFlag){var authenticateUserParam={};authenticateUserParam.mobileNumber=$scope.proposalApp.proposerInfo.contactInfo.mobile,authenticateUserParam.OTP=Number($scope.authenticate.enteredOTP),getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.validateOTP,authenticateUserParam,function(createOTP){if(createOTP.responseCode==$scope.p365Labels.responseCode.success){$scope.modalOTP=!1,$scope.modalOTPError=!1;for(var i=0;i<$scope.proposalApp.insuredMembers.length;i++)for(var j=0;j<$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.length;j++)null!=$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j]&&void 0!=$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j]&&"undefined"!=String($scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j])||($scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.splice(j,1),j-=1);$scope.proceedForConfirm()}else createOTP.responseCode==$scope.p365Labels.responseCode.noRecordsFound?$scope.invalidOTPError=$scope.p365Labels.validationMessages.invalidOTP:createOTP.responseCode==$scope.p365Labels.responseCode.expiredOTP?$scope.invalidOTPError=$scope.p365Labels.validationMessages.expiredOTP:createOTP.responseCode==$scope.p365Labels.responseCode.blockedMobile?$scope.invalidOTPError=createOTP.message:$scope.invalidOTPError=$scope.p365Labels.validationMessages.authOTP})}else{for(var i=0;i<$scope.proposalApp.insuredMembers.length;i++)for(var j=0;j<$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.length;j++)null!=$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j]&&void 0!=$scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j]&&"undefined"!=String($scope.proposalApp.insuredMembers[i].carrierMedicalQuestion[j])||($scope.proposalApp.insuredMembers[i].carrierMedicalQuestion.splice(j,1),j-=1);$scope.proceedForConfirm()}},$scope.validateData=function(){$scope.proposerAge<$scope.productValidation.maleMinAgeSingle&&$scope.proposalApp.proposerInfo.personalInfo.martialStatus==$scope.productValidation.checkSingleStatus&&"M"==$scope.proposalApp.proposerInfo.personalInfo.gender?($scope.proposalDetailsForm.dateofbirth.$setValidity("dateofbirth",!0),$scope.proposalDetailsForm.gender.$setValidity("gender",!0),$scope.proposalDetailsForm.maritalStatus.$setValidity("maritalStatus",!0),$scope.errorMsg=!0):$scope.proposerAge<$scope.productValidation.maleMinAgeMarried&&$scope.proposalApp.proposerInfo.personalInfo.martialStatus==$scope.productValidation.checkMarriedStatus&&"M"==$scope.proposalApp.proposerInfo.personalInfo.gender?($scope.proposalDetailsForm.dateofbirth.$setValidity("dateofbirth",!1),$scope.proposalDetailsForm.gender.$setValidity("gender",!1),$scope.proposalDetailsForm.maritalStatus.$setValidity("maritalStatus",!1),$scope.errorMsg=!0):$scope.proposerAge<$scope.productValidation.femaleMinAge&&"F"==$scope.proposalApp.proposerInfo.personalInfo.gender?($scope.proposalDetailsForm.dateofbirth.$setValidity("dateofbirth",!0),$scope.proposalDetailsForm.gender.$setValidity("gender",!0),$scope.proposalDetailsForm.maritalStatus.$setValidity("maritalStatus",!0),$scope.errorMsg=!0):($scope.proposalDetailsForm.dateofbirth.$setValidity("dateofbirth",!0),$scope.proposalDetailsForm.gender.$setValidity("gender",!0),$scope.proposalDetailsForm.maritalStatus.$setValidity("maritalStatus",!0),$scope.errorMsg=!1,$scope.changeDateOfBirth(),$scope.changeGender())},$scope.validateDOB=function(){$scope.proposerAge=getAgeFromDOB($scope.proposalApp.proposerInfo.personalInfo.dateOfBirth),$scope.productValidation.proposerAgeCheck?$scope.validateData():$scope.changeDateOfBirth()},$scope.validateGender=function(){$scope.productValidation.proposerAgeCheck?$scope.validateData():$scope.changeGender()},$scope.validateMaritalStatus=function(){$scope.productValidation.proposerAgeCheck?$scope.validateData():$scope.productValidation.individualFloaterPlan&&"MARRIED"==$scope.proposalApp.proposerInfo.personalInfo.martialStatus&&($scope.modalIndividualFloaterPlan=!0)},$scope.submitDieaseList=function($mdMenu,ev){$scope.diseaseShow=!1},$scope.changeOccupation=function(){"undefined"!=String($scope.selfAsInsured)&&($scope.selfAsInsured.occupation=$scope.proposalApp.proposerInfo.personalInfo.occupation)},$scope.sendProposalEmail=function(){var proposalDetailsEmail={paramMap:{}};proposalDetailsEmail.funcType=$scope.p365Labels.functionType.proposalDetailsTemplate,proposalDetailsEmail.username=$scope.proposalApp.proposerInfo.contactInfo.emailId.trim(),proposalDetailsEmail.isBCCRequired="Y",proposalDetailsEmail.paramMap.customerName=$scope.proposalApp.proposerInfo.personalInfo.firstName.trim()+" "+$scope.proposalApp.proposerInfo.personalInfo.lastName.trim(),proposalDetailsEmail.paramMap.selectedPolicyType=$scope.p365Labels.insuranceType.health,proposalDetailsEmail.paramMap.quoteId=$scope.responseToken.QUOTE_ID,proposalDetailsEmail.paramMap.premiumAmount=String($scope.selectedProduct.annualPremium),proposalDetailsEmail.paramMap.docId=$scope.responseToken.proposalId,proposalDetailsEmail.paramMap.LOB=String($scope.p365Labels.businessLineType.health),proposalDetailsEmail.paramMap.url=$scope.shortURLResponse.data.shortURL,RestAPI.invoke($scope.p365Labels.transactionName.sendEmail,proposalDetailsEmail).then(function(emailResponse){if(emailResponse.responseCode==$scope.p365Labels.responseCode.success)if(1==baseEnvEnabled&&1==agencyPortalEnabled){var frameURL=agencyPortalUrl+proposalDetailsEmail.paramMap.docId+"&lob="+proposalDetailsEmail.paramMap.LOB;$scope.URLforPayment=$sce.trustAsResourceUrl(frameURL),$scope.loading=!1,$scope.modalAP=!0}else{$scope.redirectForPayment=!1,$scope.loading=!1,$scope.modalIPOS=!0;var createRecordDetails={};createRecordDetails.parent_id=$scope.iposRequest.parent_id,createRecordDetails.parent_type=$scope.iposRequest.parent_type,createRecordDetails.requestType=$scope.iposRequest.requestType,RestAPI.invoke($scope.p365Labels.transactionName.createRecord,createRecordDetails).then(function(createRecordResponse){})}else $rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.emailSentFailed,"Ok"),$scope.loading=!1})},$scope.submitProposalData=function(){if($(".nomineeInfo").removeClass("active"),$(".nomineeInfo").addClass("complete"),$scope.proposalApp.QUOTE_ID=$scope.responseProduct.QUOTE_ID,$scope.proposalApp.insuranceCompany=$scope.selectedProduct.insuranceCompany,$scope.proposalApp.planName=$scope.selectedProduct.planName,$scope.proposalApp.carrierId=$scope.selectedProduct.carrierId,$scope.proposalApp.productId=$scope.selectedProduct.planId,$scope.proposalApp.planId=$scope.selectedProduct.planId,$scope.proposalApp.requestType=$scope.p365Labels.request.healthPropRequestType,$scope.proposalApp.carrierProposalStatus=!1,$scope.proposalApp.businessLineId="4",$scope.proposalApp.proposalId=$scope.responseProduct.proposalId,$rootScope.wordPressEnabled?$scope.proposalApp.source=sourceOrigin:($scope.proposalApp.baseEnvStatus=baseEnvEnabled,$scope.proposalApp.source=sourceOrigin),$scope.loading=!0,$scope.saveProposal)$scope.proposalApp.isCleared&&delete $scope.proposalApp.isCleared,RestAPI.invoke("saveProposalService",$scope.proposalApp).then(function(proposeFormResponse){proposeFormResponse.responseCode==$scope.p365Labels.responseCode.success?($scope.proposalId=proposeFormResponse.data,localStorageService.set("proposalId",$scope.proposalId),$scope.loading=!1,$scope.saveProposal=!1):($scope.loading=!1,$scope.saveProposal=!1)});else{if($scope.proposalApp.isCleared=!0,delete $scope.proposalApp.proposalId,$rootScope.agencyPortalEnabled){const localdata=JSON.parse(localStorage.getItem("finalLocalStorage"));$scope.proposalApp.requestSource=requestSource,localdata&&($scope.proposalApp.userName=localdata.username,$scope.proposalApp.agencyId=localdata.agencyId)}$scope.proposalApp.QUOTE_ID?RestAPI.invoke("submitHealthProposal",$scope.proposalApp).then(function(proposeFormResponse){if(proposeFormResponse.responseCode==$scope.p365Labels.responseCode.success)$scope.responseToken=proposeFormResponse.data,$scope.responseToken.businessLineId=$scope.p365Labels.businessLineType.health,$scope.proposalId=proposeFormResponse.data.proposalId,$scope.encryptedProposalId=proposeFormResponse.data.encryptedProposalId,localStorageService.set("proposalIdEncrypted",$scope.encryptedProposalId),$scope.responseToken.QUOTE_ID=$scope.iposRequest.docId,localStorageService.set("medicalReponseToken",$scope.responseToken),getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.paymentService,$scope.responseToken,function(paymentDetails){if(1==imauticAutomation)imatHealthProposal(localStorageService,$scope,"SubmitProposal",function(shortURLResponse){shortURLResponse.responseCode==$scope.p365Labels.responseCode.success?($scope.shortURLResponse=shortURLResponse,console.log("$scope.shortURLResponse in health buy product is:",$scope.shortURLResponse),$scope.sendProposalEmail()):(console.log(shortURLResponse.message),$rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.emailSentFailed,"Ok"),$scope.loading=!1)});else{$scope.redirectForPayment=!1,$scope.loading=!1,$scope.modalIPOS=!0;var body={};body.longURL=sharePaymentLink+String($scope.responseToken.proposalId)+"&lob="+String($scope.p365Labels.businessLineType.health),$http({method:"POST",url:getShortURLLink,data:body}).success(function(shortURLResponse){shortURLResponse.responseCode==$scope.p365Labels.responseCode.success?($scope.shortURLResponse=shortURLResponse,$scope.sendProposalEmail()):($rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.emailSentFailed,"Ok"),$scope.loading=!1)})}});else if(proposeFormResponse.responseCode==$scope.p365Labels.responseCode.error)$scope.loading=!1,$scope.disablePaymentButton=!1,$rootScope.P365Alert("Error",proposeFormResponse.data,"Ok");else{1==imauticAutomation&&imatEvent("ProposalFailed"),$scope.loading=!1;var serverError=$scope.p365Labels.errorMessage.serverError;$rootScope.P365Alert("Policies365",serverError,"Ok")}}):($scope.loading=!1,$rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.generalisedErrMsg,"Ok"))}},$scope.hideModalIPOS=function(){$scope.modalIPOS=!1,$scope.authenticate.enteredOTP="",1==$scope.redirectForPayment&&$scope.redirectToPaymentGateway()},$scope.redirectToPaymentGateway=function(){$scope.paymentURLParam?$rootScope.affilateUser||$rootScope.agencyPortalEnabled?$window.top.location.href=$scope.paymentServiceResponse.paymentURL+$scope.paymentURLParam:$window.location.href=$scope.paymentServiceResponse.paymentURL+$scope.paymentURLParam:$timeout(function(){$scope.paymentForm.setAction($scope.paymentServiceResponse.paymentURL),$scope.paymentForm.commit(),$scope.$apply()},500)},$scope.proceedForConfirm=function(){$scope.modalOTP=!1,$scope.authenticate.enteredOTP="",$scope.modalOTPError=!1,$(".nomineeInfo").removeClass("active"),$(".nomineeInfo").addClass("complete"),$scope.loading=!0,$scope.disablePaymentButton=!0,$scope.annualIncome&&($scope.proposalApp.proposerInfo.personalInfo.annualIncome=$scope.annualIncome.annualIncome),localStorageService.get("HEALTH_UNIQUE_QUOTE_ID")&&($scope.proposalApp.QUOTE_ID=localStorageService.get("HEALTH_UNIQUE_QUOTE_ID")),$scope.proposalApp.insuranceCompany=$scope.selectedProduct.insuranceCompany,$scope.proposalApp.planName=$scope.selectedProduct.planName,$scope.selectedProduct.childPlanId&&($scope.proposalApp.childPlanId=$scope.selectedProduct.childPlanId),$scope.selectedProduct.intlTreatmentUS_CANADA&&($scope.proposalApp.coverageDetails.intlTreatmentUS_CANADA=$scope.selectedProduct.intlTreatmentUS_CANADA);for(var i=0;i<$scope.proposalApp.insuredMembers.length;i++)$scope.proposalApp.insuredMembers[i].height=Number($scope.proposalApp.insuredMembers[i].height),$scope.proposalApp.insuredMembers[i].weight=Number($scope.proposalApp.insuredMembers[i].weight);$rootScope.wordPressEnabled?$scope.proposalApp.source=sourceOrigin:($scope.proposalApp.baseEnvStatus=baseEnvEnabled,$scope.proposalApp.source=sourceOrigin),localStorageService.set("healthSelectedProduct",$scope.selectedProduct),localStorageService.set("medicalFinalProposeForm",$scope.proposalApp),$scope.proposalApp.QUOTE_ID?RestAPI.invoke("submitHealthProposal",$scope.proposalApp).then(function(proposeFormResponse){if(proposeFormResponse.responseCode==$scope.p365Labels.responseCode.success)$scope.proposalId=proposeFormResponse.data.proposalId,$scope.encryptedProposalId=proposeFormResponse.data.encryptedProposalId,localStorageService.set("proposalIdEncrypted",$scope.encryptedProposalId),1==imauticAutomation&&imatHealthProposal(localStorageService,$scope,"MakePayment"),$scope.responseToken=proposeFormResponse.data,$scope.responseToken.businessLineId=$scope.p365Labels.businessLineType.health,$scope.responseToken.QUOTE_ID=$scope.proposalApp.QUOTE_ID,$scope.responseToken.UNIQUE_QUOTE_ID_ENCRYPTED=$scope.proposalApp.encryptedQuoteId,localStorageService.set("medicalReponseToken",$scope.responseToken),getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.paymentService,$scope.responseToken,function(paymentDetails){if(paymentDetails.responseCode==$scope.p365Labels.responseCode.success)if($scope.paymentServiceResponse=paymentDetails.data,"GET"==$scope.paymentServiceResponse.method){$scope.paymentURLParam="?";for(var paymentURLParamListLength=$scope.paymentServiceResponse.paramterList.length,i=0;i<paymentURLParamListLength;i++)$scope.paymentURLParam+=i<paymentURLParamListLength-1?$scope.paymentServiceResponse.paramterList[i].name+"="+$scope.paymentServiceResponse.paramterList[i].value+"&":$scope.paymentServiceResponse.paramterList[i].name+"="+$scope.paymentServiceResponse.paramterList[i].value;$scope.redirectForPayment=!0,$scope.loading=!1,$scope.modalIPOS=!0}else $scope.paymentURLParam=null,$scope.redirectForPayment=!0,$scope.loading=!1,$scope.modalIPOS=!0;else{$scope.loading=!1;var buyScreenCnfrmError=paymentDetails.responseCode+" : "+$scope.p365Labels.validationMessages.buyScreenCnfrmError.replace("INSURER_NAME",$scope.selectedProduct.insuranceCompany);$rootScope.P365Alert("Policies365",buyScreenCnfrmError,"Ok")}});else if(proposeFormResponse.responseCode==$scope.p365Labels.responseCode.error)$scope.loading=!1,$rootScope.P365Alert("Error",proposeFormResponse.data,"Ok");else{$scope.loading=!1;var buyScreenCnfrmError=$scope.p365Labels.validationMessages.buyScreenCnfrmError.replace("INSURER_NAME",$scope.selectedProduct.insuranceCompany);$rootScope.P365Alert("Policies365",buyScreenCnfrmError,"Ok")}}):($scope.loading=!1,$scope.disablePaymentButton=!1,$rootScope.P365Alert("Policies365",$scope.p365Labels.errorMessage.generalisedErrMsg,"Ok"))}},$scope.updateSalutation=function(relation){$scope.productValidation.isNomineeSalutationRequired&&("Spouse"==relation?"M"==$scope.proposalApp.proposerInfo.personalInfo.gender?($scope.salutationsList=[{value:"Mrs",display:"Mrs."}],$scope.proposalApp.nomineeDetails.salutation="Mrs"):($scope.salutationsList=[{value:"Mr",display:"Mr."}],$scope.proposalApp.nomineeDetails.salutation="Mr"):"Son"==relation||"Brother"==relation||"Father"==relation?($scope.salutationsList=[{value:"Mr",display:"Mr."}],$scope.proposalApp.nomineeDetails.salutation="Mr"):"Daughter"!=relation&&"Mother"!=relation&&"Sister"!=relation||("Mother"==relation?($scope.salutationsList=[{value:"Mrs",display:"Mrs."}],$scope.proposalApp.nomineeDetails.salutation="Mrs"):($scope.salutationsList=[{value:"Ms",display:"Ms."},{value:"Mrs",display:"Mrs."}],$scope.proposalApp.nomineeDetails.salutation="Ms")))},$scope.getPinCodeAreaList=function(areaName){var docType;return docType=isNaN(areaName)?"Area":"Pincode",$http.get(getServiceLink+docType+"&q="+areaName).then(function(response){return JSON.parse(response.data).data})},$scope.getYearList=function(dateofBirth){var dateArr=dateofBirth.split("/"),newDOB=dateArr[1]+"/"+dateArr[0]+"/"+dateArr[2];return listRegistrationYear("buyScreen",calculateAgeByDOB(newDOB))},$scope.$on("setCommAddressByAPI",function(){setTimeout(function(){var googleAddressObject=angular.copy($scope.chosenCommPlaceDetails);getAddressFields(googleAddressObject,function(fomattedAddress,formattedCity,formattedState,formattedPincode){$scope.proposalApp.proposerInfo.contactInfo.streetDetails=fomattedAddress,"undefined"!=String(formattedPincode)&&""!=formattedPincode?$scope.calcDefaultAreaDetails(formattedPincode):($scope.proposalApp.proposerInfo.contactInfo.pincode="",$scope.proposalApp.proposerInfo.contactInfo.locality="",$scope.proposalApp.proposerInfo.contactInfo.city="",$scope.proposalApp.proposerInfo.contactInfo.state=""),$scope.$apply()})},10)}),$scope.$on("setRegAddressByAPI",function(){setTimeout(function(){var googleAddressObject=angular.copy($scope.chosenRegPlaceDetails);getAddressFields(googleAddressObject,function(fomattedAddress,formattedCity,formattedState,formattedPincode){$scope.permanentAddressDetails.streetDetails=fomattedAddress,"undefined"!=String(formattedPincode)&&""!=formattedPincode?$scope.calcDefaultRegAreaDetails(formattedPincode):($scope.permanentAddressDetails.pincode="",$scope.permanentAddressDetails.locality="",$scope.permanentAddressDetails.city="",$scope.permanentAddressDetails.state=""),$scope.$apply()})},10)}),$scope.calcDefaultAreaDetails=function(areaCode){$http.get(getServiceLink+"Pincode&q="+areaCode).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.p365Labels.responseCode.success&&$scope.onSelectPinOrArea(areaDetails.data[0])})},$scope.calcDefaultRegAreaDetails=function(areaCode){$http.get(getServiceLink+"Pincode&q="+areaCode).then(function(response){var areaDetails=JSON.parse(response.data);areaDetails.responseCode==$scope.p365Labels.responseCode.success&&$scope.onSelectPermanentPinOrArea(areaDetails.data[0])})},$scope.newPinCode=angular.copy($scope.proposalApp.proposerInfo.contactInfo),$scope.onSelectPinOrArea=function(item){if($scope.newPinCode.pincode!=item.pincode?$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.locationChangeMsg,"No","Yes",function(confirmStatus){confirmStatus?($scope.loading=!0,$scope.newPinCode.pincode=item.pincode,$scope.newPinCode.locality=item.area,$scope.newPinCode.city=item.district,$scope.newPinCode.state=item.state,$scope.selectedProductInputParamForPin.personalInfo.pincode=item.pincode,$scope.selectedProductInputParamForPin.personalInfo.displayArea=item.area,$scope.selectedProductInputParamForPin.personalInfo.city=item.district,$scope.selectedProductInputParamForPin.personalInfo.state=item.state,null!=$scope.selectedProduct.childPlanId&&($scope.selectedProductInputParamForPin.childPlanId=Number($scope.selectedProduct.childPlanId)),$scope.selectedProductInputParamForPin.sumInsured=$scope.selectedProduct.sumInsured,localStorageService.get("quoteUserInfo").mobileNumber&&($scope.selectedProductInputParamForPin.mobileNumber=localStorageService.get("quoteUserInfo").mobileNumber),RestAPI.invoke($scope.p365Labels.getRequest.quoteHealth,$scope.selectedProductInputParamForPin).then(function(callback){if($scope.healthRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success)$scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("HEALTH_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.healthRecalculateQuoteRequest=callback.data,$scope.healthQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.healthRecalculateQuoteRequest,function(obj,i){var request={},header={};header.transactionName=$scope.p365Labels.transactionName.healthQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var healthQuoteResponse=JSON.parse(callback);if($scope.responseRecalculateCodeList.push(healthQuoteResponse.responseCode),healthQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId&&(healthQuoteResponse.data.quotes[0].childPlanId?healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId&&($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId)):($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId))),healthQuoteResponse.data.quotes[0].id=healthQuoteResponse.messageId,$scope.quoteCalcResponse.push(healthQuoteResponse.data.quotes[0]);else if(null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId)if($scope.selectedProduct.childPlanId){if(healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId){$scope.loading=!1,$scope.proposalApp.proposerInfo.contactInfo.pincode="";var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsg;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}else{$scope.loading=!1,$scope.proposalApp.proposerInfo.contactInfo.pincode="";screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsg;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})});else{$scope.loading=!1,$scope.proposalApp.proposerInfo.contactInfo.pincode="";var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsg;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}),$scope.proposalApp.proposerInfo.contactInfo.pincode=item.pincode,$scope.proposalApp.proposerInfo.contactInfo.locality=item.area,$scope.proposalApp.proposerInfo.contactInfo.city=item.district,$scope.proposalApp.proposerInfo.contactInfo.state=item.state):($scope.proposalApp.proposerInfo.contactInfo.pincode=$scope.newPinCode.pincode,$scope.proposalApp.proposerInfo.contactInfo.locality=$scope.newPinCode.locality,$scope.proposalApp.proposerInfo.contactInfo.city=$scope.newPinCode.city,$scope.proposalApp.proposerInfo.contactInfo.state=$scope.newPinCode.state,$scope.proposalApp.proposerInfo.personalInfo.pincode=$scope.newPinCode.pincode,$scope.proposalApp.proposerInfo.personalInfo.locality=$scope.newPinCode.locality,$scope.proposalApp.proposerInfo.personalInfo.city=$scope.newPinCode.city,$scope.proposalApp.proposerInfo.personalInfo.state=$scope.newPinCode.state,$scope.proposalApp.proposerInfo.permanentAddress.pincode=$scope.newPinCode.pincode,$scope.proposalApp.proposerInfo.permanentAddress.locality=$scope.newPinCode.locality,$scope.proposalApp.proposerInfo.permanentAddress.city=$scope.newPinCode.city,$scope.proposalApp.proposerInfo.permanentAddress.state=$scope.newPinCode.state),localStorageService.set("commAddressDetails",item)}):($scope.proposalApp.proposerInfo.contactInfo.pincode=$scope.newPinCode.pincode,$scope.proposalApp.proposerInfo.contactInfo.locality=$scope.newPinCode.locality,$scope.proposalApp.proposerInfo.contactInfo.city=$scope.newPinCode.city,$scope.proposalApp.proposerInfo.contactInfo.state=$scope.newPinCode.state,$scope.proposalApp.proposerInfo.personalInfo.pincode=$scope.newPinCode.pincode,$scope.proposalApp.proposerInfo.personalInfo.locality=$scope.newPinCode.locality,$scope.proposalApp.proposerInfo.personalInfo.city=$scope.newPinCode.city,$scope.proposalApp.proposerInfo.personalInfo.state=$scope.newPinCode.state,$scope.proposalApp.proposerInfo.permanentAddress.pincode=$scope.newPinCode.pincode,$scope.proposalApp.proposerInfo.permanentAddress.locality=$scope.newPinCode.locality,$scope.proposalApp.proposerInfo.permanentAddress.city=$scope.newPinCode.city,$scope.proposalApp.proposerInfo.permanentAddress.state=$scope.newPinCode.state,localStorageService.set("commAddressDetails",item)),$scope.permanentAddressDetails.isAddressSameAsCommun){$scope.permanentAddressDetails.houseNo=$scope.proposalApp.proposerInfo.contactInfo.houseNo,$scope.permanentAddressDetails.streetDetails=$scope.proposalApp.proposerInfo.contactInfo.streetDetails,$scope.permanentAddressDetails.pincode=$scope.proposalApp.proposerInfo.contactInfo.pincode,$scope.permanentAddressDetails.locality=$scope.proposalApp.proposerInfo.contactInfo.locality,$scope.permanentAddressDetails.city=$scope.proposalApp.proposerInfo.contactInfo.city,$scope.permanentAddressDetails.state=$scope.proposalApp.proposerInfo.contactInfo.state,localStorageService.set("parmAddressDetails",$scope.permanentAddressDetails),$scope.proposalApp.proposerInfo.personalInfo=$scope.permanentAddressDetails;var quoteUserInfo=localStorageService.get("quoteUserInfo");$scope.proposalApp.proposerInfo.personalInfo.gender=$scope.selectedProductInputParam.quoteParam.selfGender,$scope.proposalApp.proposerInfo.personalInfo.lastName="undefined"!==String(quoteUserInfo.lastName)?quoteUserInfo.lastName:"",$scope.proposalApp.proposerInfo.personalInfo.firstName="undefined"!==String(quoteUserInfo.firstName)?quoteUserInfo.firstName:"",$scope.proposalApp.proposerInfo.personalInfo.salutation="M"==$scope.proposalApp.proposerInfo.personalInfo.gender?"Mr":"Ms",$scope.proposalApp.proposerInfo.personalInfo.pincode=item.pincode,$scope.proposalApp.proposerInfo.personalInfo.locality=item.area,$scope.proposalApp.proposerInfo.personalInfo.city=item.district,$scope.proposalApp.proposerInfo.personalInfo.state=item.state,$scope.proposalApp.proposerInfo.permanentAddress.pincode=item.pincode,$scope.proposalApp.proposerInfo.permanentAddress.locality=item.area,$scope.proposalApp.proposerInfo.permanentAddress.city=item.district,$scope.proposalApp.proposerInfo.permanentAddress.state=item.state}},$scope.onSelectPermanentPinOrArea=function(item){$scope.permanentAddressDetails.locality=item.area,$scope.permanentAddressDetails.city=item.district,$scope.permanentAddressDetails.pincode=item.pincode,$scope.permanentAddressDetails.state=item.state,localStorageService.set("parmAddressDetails",$scope.permanentAddressDetails)},$scope.$watch("proposalApp.proposerInfo.contactInfo.streetDetails",function(newValue){$scope.permanentAddressDetails.isAddressSameAsCommun&&$scope.changeRegAddress()}),$scope.$watch("proposalApp.proposerInfo.contactInfo.houseNo",function(newValue){$scope.permanentAddressDetails.isAddressSameAsCommun&&$scope.changeRegAddress()}),$scope.$watch("proposalApp.proposerInfo.personalInfo.firstName",function(newValue){for(var j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].firstName=$scope.proposalApp.proposerInfo.personalInfo.firstName)}),$scope.$watch("proposalApp.proposerInfo.personalInfo.lastName",function(newValue){for(var j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].lastName=$scope.proposalApp.proposerInfo.personalInfo.lastName)}),$scope.checkForPanCardValidation=function(){$scope.productValidation.panCardRequired||(Number($scope.proposalApp.coverageDetails.totalPremium)>=$scope.productValidation.panAmount?$scope.productValidation.panCardRequired=!0:$scope.productValidation.panCardRequired=!1)},$scope.changeRegAddress=function(){$scope.permanentAddressDetails.isAddressSameAsCommun?($scope.permanentAddressDetails.houseNo=$scope.proposalApp.proposerInfo.contactInfo.houseNo,$scope.permanentAddressDetails.streetDetails=$scope.proposalApp.proposerInfo.contactInfo.streetDetails,$scope.permanentAddressDetails.pincode=$scope.proposalApp.proposerInfo.contactInfo.pincode,$scope.permanentAddressDetails.locality=$scope.proposalApp.proposerInfo.contactInfo.locality,$scope.permanentAddressDetails.city=$scope.proposalApp.proposerInfo.contactInfo.city,$scope.permanentAddressDetails.state=$scope.proposalApp.proposerInfo.contactInfo.state,$scope.proposalApp.proposerInfo.personalInfo.pincode=$scope.proposalApp.proposerInfo.contactInfo.pincode,$scope.proposalApp.proposerInfo.personalInfo.locality=$scope.proposalApp.proposerInfo.contactInfo.locality,$scope.proposalApp.proposerInfo.personalInfo.city=$scope.proposalApp.proposerInfo.contactInfo.city,$scope.proposalApp.proposerInfo.personalInfo.state=$scope.proposalApp.proposerInfo.contactInfo.state,$scope.proposalApp.proposerInfo.permanentAddress.pincode=$scope.proposalApp.proposerInfo.contactInfo.pincode,$scope.proposalApp.proposerInfo.permanentAddress.locality=$scope.proposalApp.proposerInfo.contactInfo.locality,$scope.proposalApp.proposerInfo.permanentAddress.city=$scope.proposalApp.proposerInfo.contactInfo.city,$scope.proposalApp.proposerInfo.permanentAddress.state=$scope.proposalApp.proposerInfo.contactInfo.state):($scope.permanentAddressDetails.houseNo="",$scope.permanentAddressDetails.streetDetails="",$scope.permanentAddressDetails.pincode="",$scope.permanentAddressDetails.locality="",$scope.permanentAddressDetails.city="",$scope.permanentAddressDetails.state=""),$scope.proposalApp.proposerInfo.permanentAddress=$scope.permanentAddressDetails},$scope.changeGender=function(){if("undefined"!=String($scope.selectedGender)||null!=$scope.selectedGender)if($scope.proposalApp.proposerInfo.personalInfo.salutation="M"==$scope.proposalApp.proposerInfo.personalInfo.gender?"Mr":"Ms",$scope.insuredMembers.gender=$scope.proposalApp.proposerInfo.personalInfo.gender,$scope.insuredMembers.salutation="M"==$scope.insuredMembers.gender?"Mr":"Ms",$scope.selectedGender!=$scope.proposalApp.proposerInfo.personalInfo.gender)$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.genderChangeMsg,"No","Yes",function(confirmStatus){if(confirmStatus){$scope.loading=!0,$scope.selectedProductInputParamForPin.quoteParam.selfGender=$scope.proposalApp.proposerInfo.personalInfo.gender;for(var i=0;i<$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers.length;i++){if("Self"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation&&($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender=$scope.insuredMembers.gender,"M"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender?$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender="Male":"F"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender&&($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender="Female"),$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].salutation=$scope.insuredMembers.salutation),"Spouse"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation&&"Male"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender="Female",$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].salutation="Ms";break}if("Spouse"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation&&"Female"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender){$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].gender="Male",$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].salutation="Mr";break}}for(i=0;i<$scope.selectedProductInputParamForPin.quoteParam.dependent.length;i++)"S"==$scope.selectedProductInputParamForPin.quoteParam.dependent[i].relationShip&&($scope.selectedProductInputParamForPin.quoteParam.dependent[i].gender=$scope.selectedProductInputParamForPin.quoteParam.selfGender),"SP"==$scope.selectedProductInputParamForPin.quoteParam.dependent[i].relationShip&&"M"==$scope.selectedProductInputParamForPin.quoteParam.selfGender&&($scope.selectedProductInputParamForPin.quoteParam.dependent[i].gender="F"),"SP"==$scope.selectedProductInputParamForPin.quoteParam.dependent[i].relationShip&&"F"==$scope.selectedProductInputParamForPin.quoteParam.selfGender&&($scope.selectedProductInputParamForPin.quoteParam.dependent[i].gender="M");$scope.selectedProduct.childPlanId&&($scope.selectedProductInputParamForPin.childPlanId=Number($scope.selectedProduct.childPlanId)),$scope.selectedProductInputParamForPin.sumInsured=$scope.selectedProduct.sumInsured,localStorageService.get("quoteUserInfo").mobileNumber&&($scope.selectedProductInputParamForPin.mobileNumber=localStorageService.get("quoteUserInfo").mobileNumber),RestAPI.invoke($scope.p365Labels.getRequest.quoteHealth,$scope.selectedProductInputParamForPin).then(function(callback){if($scope.healthRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success)$scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("HEALTH_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.healthRecalculateQuoteRequest=callback.data,$scope.healthQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.healthRecalculateQuoteRequest,function(obj,i){var request={},header={};header.transactionName=$scope.p365Labels.transactionName.healthQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var healthQuoteResponse=JSON.parse(callback);if($scope.responseRecalculateCodeList.push(healthQuoteResponse.responseCode),healthQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId&&(healthQuoteResponse.data.quotes[0].childPlanId?healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId&&($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId)):($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId))),healthQuoteResponse.data.quotes[0].id=healthQuoteResponse.messageId,$scope.quoteCalcResponse.push(healthQuoteResponse.data.quotes[0]);else if(null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId)if($scope.selectedProduct.childPlanId){if(healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId){$scope.loading=!1;var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgGender;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}else{$scope.loading=!1;screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgGender;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})});else{$scope.loading=!1,$scope.proposalApp.proposerInfo.personalInfo.gender="";var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgGender;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}),$scope.selectedGender=$scope.proposalApp.proposerInfo.personalInfo.gender,$scope.proposalApp.proposerInfo.personalInfo.gender=$scope.selectedGender;for(var j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].gender=$scope.proposalApp.proposerInfo.personalInfo.gender)}else{$scope.loading=!1,$scope.proposalApp.proposerInfo.personalInfo.gender=$scope.selectedGender,$scope.selectedGender=$scope.proposalApp.proposerInfo.personalInfo.gender;for(j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].gender=$scope.proposalApp.proposerInfo.personalInfo.gender)}});else{$scope.proposalApp.proposerInfo.personalInfo.gender=$scope.selectedGender,$scope.selectedGender=$scope.proposalApp.proposerInfo.personalInfo.gender;for(var j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].gender=$scope.proposalApp.proposerInfo.personalInfo.gender)}},$scope.changeDateOfBirth=function(){if("undefined"!=String($scope.storedDOB)||null!=$scope.storedDOB)if($scope.storedDOB!=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth)$rootScope.P365Confirm($scope.p365Labels.common.p365prompt,$scope.p365Labels.common.DobChangeMsg,"No","Yes",function(confirmStatus){if(confirmStatus){$scope.loading=!0;for(var i=0;i<$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers.length;i++)"Self"==$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].relation&&($scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].dob=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth,$scope.selectedProductInputParamForPin.personalInfo.selectedFamilyMembers[i].age=getAgeFromDOB($scope.proposalApp.proposerInfo.personalInfo.dateOfBirth));$scope.selectedProductInputParamForPin.quoteParam.selfAge=getAgeFromDOB($scope.proposalApp.proposerInfo.personalInfo.dateOfBirth);for(var j=0;j<$scope.selectedProductInputParamForPin.quoteParam.dependent.length;j++)"S"==$scope.selectedProductInputParamForPin.quoteParam.dependent[j].relationShip&&($scope.selectedProductInputParamForPin.quoteParam.dependent[j].age=getAgeFromDOB($scope.proposalApp.proposerInfo.personalInfo.dateOfBirth));$scope.selectedProduct.childPlanId&&($scope.selectedProductInputParamForPin.childPlanId=Number($scope.selectedProduct.childPlanId)),$scope.selectedProductInputParamForPin.sumInsured=$scope.selectedProduct.sumInsured,localStorageService.get("quoteUserInfo").mobileNumber&&($scope.selectedProductInputParamForPin.mobileNumber=localStorageService.get("quoteUserInfo").mobileNumber),RestAPI.invoke($scope.p365Labels.getRequest.quoteHealth,$scope.selectedProductInputParamForPin).then(function(callback){if($scope.healthRecalculateQuoteRequest=[],callback.responseCode==$scope.p365Labels.responseCode.success)$scope.responseRecalculateCodeList=[],localStorageService.set("QUOTE_ID",callback.QUOTE_ID),localStorageService.set("HEALTH_UNIQUE_QUOTE_ID",callback.QUOTE_ID),$scope.healthRecalculateQuoteRequest=callback.data,$scope.healthQuoteResult=[],$scope.quoteCalcResponse=[],angular.forEach($scope.healthRecalculateQuoteRequest,function(obj,i){var request={},header={};header.transactionName=$scope.p365Labels.transactionName.healthQuoteResult,header.deviceId=deviceIdOrigin,request.header=header,request.body=obj,$http({method:"POST",url:getQuoteCalcLink,data:request}).success(function(callback,status){var healthQuoteResponse=JSON.parse(callback);if($scope.responseRecalculateCodeList.push(healthQuoteResponse.responseCode),healthQuoteResponse.responseCode==$scope.p365Labels.responseCode.success)null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId&&(healthQuoteResponse.data.quotes[0].childPlanId?healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId&&($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,healthQuoteResponse.data.quotes[0].basicPremium&&($scope.proposalApp.coverageDetails.basePremium=healthQuoteResponse.data.quotes[0].basicPremium),healthQuoteResponse.data.quotes[0].serviceTax&&($scope.proposalApp.coverageDetails.serviceTax=healthQuoteResponse.data.quotes[0].serviceTax),$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId)):($scope.loading=!1,$scope.proposalApp.coverageDetails.totalPremium=healthQuoteResponse.data.quotes[0].annualPremium,healthQuoteResponse.data.quotes[0].basicPremium&&($scope.proposalApp.coverageDetails.basePremium=healthQuoteResponse.data.quotes[0].basicPremium),healthQuoteResponse.data.quotes[0].serviceTax&&($scope.proposalApp.coverageDetails.serviceTax=healthQuoteResponse.data.quotes[0].serviceTax),$scope.premiumDetails.selectedProductDetails=healthQuoteResponse.data.quotes[0],$scope.selectedProduct=healthQuoteResponse.data.quotes[0],$scope.checkForPanCardValidation(),void 0==healthQuoteResponse.data.quotes[0].carrierQuoteId&&""==healthQuoteResponse.data.quotes[0].carrierQuoteId&&null==healthQuoteResponse.data.quotes[0].carrierQuoteId||($scope.proposalApp.coverageDetails.carrierQuoteId=healthQuoteResponse.data.quotes[0].carrierQuoteId))),healthQuoteResponse.data.quotes[0].id=healthQuoteResponse.messageId,$scope.quoteCalcResponse.push(healthQuoteResponse.data.quotes[0]);else if(null!=healthQuoteResponse.data&&healthQuoteResponse.data.quotes[0].carrierId==$scope.selectedProduct.carrierId&&healthQuoteResponse.data.quotes[0].planId==$scope.selectedProduct.planId)if($scope.selectedProduct.childPlanId){if(healthQuoteResponse.data.quotes[0].childPlanId==$scope.selectedProduct.childPlanId){$scope.loading=!1,$scope.proposalApp.proposerInfo.personalInfo.gender="";var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgGender;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}else{$scope.loading=!1,$scope.proposalApp.proposerInfo.personalInfo.gender="";screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgGender;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}).error(function(data,status){$scope.responseRecalculateCodeList.push($scope.p365Labels.responseCode.systemError),$scope.loading=!1})});else{$scope.loading=!1,$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth="";var screenCnfrmError=$scope.selectedProduct.insuranceCompany+""+$scope.p365Labels.errorMessage.screenConfirmErrorMsgDob;$rootScope.P365Alert("Policies365",screenCnfrmError,"Ok")}}),$scope.storedDOB=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth,$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth=$scope.storedDOB;for(j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].dateOfBirth=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth)}else{$scope.loading=!1,$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth=$scope.storedDOB,$scope.storedDOB=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth;for(j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].dateOfBirth=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth)}});else{$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth=$scope.storedDOB,$scope.storedDOB=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth;for(var j=0;j<$scope.proposalApp.insuredMembers.length;j++)"Self"==$scope.proposalApp.insuredMembers[j].relationship&&($scope.proposalApp.insuredMembers[j].dateOfBirth=$scope.proposalApp.proposerInfo.personalInfo.dateOfBirth)}}}),$scope.backToResultScreen=function(){$scope.proposalApp.QUOTE_ID;if($location.path("/sharefromAPI").search({docId:$scope.responseToken.UNIQUE_QUOTE_ID_ENCRYPTED,LOB:$scope.p365Labels.businessLineType.health}),$rootScope.baseEnvEnabled&&!$rootScope.wordPressEnabled)$rootScope.mainTabsMenu[0].active=!0,$rootScope.mainTabsMenu[1].active=!1,$scope.responseToken.UNIQUE_QUOTE_ID_ENCRYPTED?$location.path("/sharefromAPI").search({docId:$scope.carProposeFormDetails.UNIQUE_QUOTE_ID_ENCRYPTED,LOB:$scope.p365Labels.businessLineType.car}):$location.path("/sharefromAPI").search({docId:$scope.proposalApp.QUOTE_ID,LOB:$scope.p365Labels.businessLineType.car});else if($scope.responseToken.UNIQUE_QUOTE_ID_ENCRYPTED){var shareURL=shareQuoteLink+$scope.responseToken.UNIQUE_QUOTE_ID_ENCRYPTED;console.log("encrypted quote id found with share url as: ",shareURL),$window.location.href=shareURL}else{shareURL=shareQuoteLink+$scope.proposalApp.QUOTE_ID;console.log(" no encrypted quote id found with share url as: ",shareURL),$window.location.href=shareURL}}})}]);