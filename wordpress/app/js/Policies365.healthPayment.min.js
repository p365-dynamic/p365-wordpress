"use strict";angular.module("paySuccessHealth",["CoreComponentApp","LocalStorageModule","ngMessages"]).controller("paySuccessHealthController",["RestAPI","$scope","$rootScope","$location","$http","localStorageService","$timeout","$sce",function(RestAPI,$scope,$rootScope,$location,$http,localStorageService,$timeout,$sce){var p365UIVar={mobileNumber:"+91 9962411255",mobileNumberTrim:"+919962411255",salesAssistNumber:"(022) 68284343",salesAssistNumberTrim:"02268284343",salesAssistNumberLanding:"022-68284343",claimsNumber:"(022) 42114299",claimsNumberTrim:"02242114299",claimsNumberLanding:"022-42114299",infoEmailId:"contact@policies365.com"};agencyPortalEnabled&&($scope.agencyPortalEnabled=agencyPortalEnabled,$scope.rampUniqueId="",localStorageService.get("rampUniqueId")&&($scope.rampUniqueId=JSON.parse(localStorageService.get("rampUniqueId")))),$scope.redirectURL=function(){localStorage.getItem("rampRedirectURL")?$window.location.href=localStorage.getItem("rampRedirectURL"):agencyPortalEnabled?idepProdEnv?$window.location.href="https://www.policies365.com":$window.location.href="https://www.policies365.com":$scope.pospBackButtonEnabled?$window.location.href="http://pospuat.policies365.com":$window.location.href=$rootScope.affilateURL},loadDatbase(function(){idepProdEnv&&($rootScope.modalSurvey=!0),wordPressEnabled?($rootScope.wordPressEnabled=wordPressEnabled,$rootScope.wp_path=wp_path):$rootScope.wp_path="",$scope.p365Labels=healthPolicyLabels,policies365Details?$scope.policies365Details=policies365Details:(console.log("retrieving p365 labels using UI"),$scope.policies365Details=p365UIVar),$rootScope.loaderContent={businessLine:"4",header:"Health Insurance",desc:$sce.trustAsHtml($scope.p365Labels.common.proverbBuyProduct)},$rootScope.title=$scope.p365Labels.policies365Title.healthPaySuccess,$scope.authenticate={},$location.search().proposalId?($scope.proposalId=$location.search().proposalId,console.log("proposal id found ..")):$location.search().proposalNo?($scope.proposalId=$location.search().proposalNo,console.log("proposal number found ..")):localStorageService.get("proposalIdEncrypted")&&($scope.proposalId=localStorageService.get("proposalIdEncrypted")),$scope.proposalId&&($scope.proposalId=$location.search().proposalId,$scope.proposalDocParam={},$scope.proposalDocParam.proposalId=$scope.proposalId,$scope.proposalDocParam.businessLineId=4,RestAPI.invoke("proposalDataReader",$scope.proposalDocParam).then(function(proposalDataResponse){proposalDataResponse.responsecode==$scope.p365Labels.responseCode.success?($scope.proposalDataResponse=proposalDataResponse.data.PolicyTransaction,console.log("$scope.proposalDataResponse in health is:",$scope.proposalDataResponse),$scope.proposalDataResponse.requestSource&&"posp"==$scope.proposalDataResponse.requestSource&&$location.search("userName",$scope.proposalDataResponse.userName),$scope.proposalRequest=angular.copy($scope.proposalDataResponse.proposalRequest),console.log("imauticAutomation flag is: ",imauticAutomation),$scope.proposalDataResponse.bikePolicyResponse.policyNo?(console.log("inside if block as policy number found"),1==imauticAutomation&&imatEvent("PaymentGenerated")):(console.log("inside else block as policy number found"),1==imauticAutomation&&imatEvent("PaymentSuccess")),localStorageService.get("quoteUserInfo")&&($scope.quoteUserInfo=localStorageService.get("quoteUserInfo"),$scope.quoteUserInfo.createLeadStatus=!0,localStorageService.set("quoteUserInfo",$scope.quoteUserInfo),$scope.quoteUserInfo&&(messageIDVar=$scope.quoteUserInfo.messageId)),$scope.loading=!1,$scope.showSuccessScreen=!1):($scope.loading=!1,$rootScope.P365Alert("Policies365","Some error Occurred ","Ok"))})),$scope.purchaseStatement=function(){for(var i=0;i<$scope.selectedPolicyDetails.insuredDetails.insuredMembers.length;i++)$scope.selectedPolicyDetails.insuredDetails.insuredMembers[i].dateOfBirth&&($scope.selectedPolicyDetails.insuredDetails.insuredMembers[i].age=calculateAgeByDOB(String($scope.selectedPolicyDetails.insuredDetails.insuredMembers[i].dateOfBirth)));localStorageService.set("policyDocDetails",$scope.selectedPolicyDetails),1==$scope.selectedPolicyDetails.businessLineId||(2==$scope.selectedPolicyDetails.businessLineId?$location.path("/bikepolicypurchase"):3==$scope.selectedPolicyDetails.businessLineId?$location.path("/carpolicypurchase"):$location.path("/medicalPurchasing"))},$scope.viewPolicy=function(){$scope.modalOTP=!0,$scope.resendOTP()},$scope.closeAuthenticateForm=function(){$scope.modalOTP=!1},$scope.authenticateUser=function(){$scope.disableOTP=!1;var authenticateUserParam={};authenticateUserParam.mobileNumber=$scope.proposalRequest.proposerInfo.contactInfo.mobile,authenticateUserParam.OTP=Number($scope.authenticate.enteredOTP),getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.validateOTP,authenticateUserParam,function(createOTP){if(createOTP.responseCode==$scope.p365Labels.responseCode.success){$scope.invalidOTPError="",$scope.modalOTP=!1;var userLoginInfo={};userLoginInfo.username=createOTP.data.firstName,userLoginInfo.mobileNumber=createOTP.data.mobile,userLoginInfo.status=!0,localStorageService.set("userLoginInfo",userLoginInfo),localStorageService.set("userProfileDetails",createOTP.data),$location.path("/dashboard")}else createOTP.responseCode==$scope.p365Labels.responseCode.noRecordsFound?$scope.invalidOTPError=$scope.p365Labels.validationMessages.invalidOTP:createOTP.responseCode==$scope.p365Labels.responseCode.expiredOTP?$scope.invalidOTPError=$scope.p365Labels.validationMessages.expiredOTP:$scope.invalidOTPError=$scope.p365Labels.validationMessages.authOTP})},$scope.resendOTP=function(){var validateLoginParam={paramMap:{}};validateLoginParam.mobileNumber=$scope.proposalRequest.proposerInfo.contactInfo.mobile,validateLoginParam.funcType=$scope.p365Labels.functionType.optAuth,validateLoginParam.paramMap.OTP=$scope.p365Labels.functionType.otpGenerate,getDocUsingParam(RestAPI,$scope.p365Labels.transactionName.sendSMS,validateLoginParam,function(createOTP){createOTP.responseCode==$scope.p365Labels.responseCode.success?$scope.invalidOTPError="":createOTP.responseCode==$scope.p365Labels.responseCode.blockedMobile?($scope.invalidOTPError=createOTP.message,$scope.disableOTP=!0):$scope.invalidOTPError=$scope.p365Labels.errorMessage.createOTP})}})}]),angular.module("payFailureHealth",["CoreComponentApp","LocalStorageModule","ngMessages"]).controller("payFailureHealthController",["RestAPI","$scope","$rootScope","$location","$http","localStorageService","$timeout","$sce",function(RestAPI,$scope,$rootScope,$location,$http,localStorageService,$timeout,$sce){var p365UIVar={mobileNumber:"+91 9962411255",mobileNumberTrim:"+919962411255",salesAssistNumber:"(022) 68284343",salesAssistNumberTrim:"02268284343",salesAssistNumberLanding:"022-68284343",claimsNumber:"(022) 42114299",claimsNumberTrim:"02242114299",claimsNumberLanding:"022-42114299",infoEmailId:"contact@policies365.com"};agencyPortalEnabled&&($scope.agencyPortalEnabled=agencyPortalEnabled),$location.search().source&&"posp"==$location.search().source&&($scope.pospBackButtonEnabled=!0),$scope.redirectURL=function(){localStorage.getItem("rampRedirectURL")?$window.location.href=localStorage.getItem("rampRedirectURL"):agencyPortalEnabled?idepProdEnv?$window.location.href="https://www.policies365.com":$window.location.href="https://www.policies365.com":$scope.pospBackButtonEnabled?$window.location.href="http://pospuat.policies365.com":$window.location.href=$rootScope.affilateURL},loadDatbase(function(){idepProdEnv&&($rootScope.modalSurvey=!0),wordPressEnabled?($rootScope.wordPressEnabled=wordPressEnabled,$rootScope.wp_path=wp_path):$rootScope.wp_path="",$scope.p365Labels=healthPolicyLabels,policies365Details?$scope.policies365Details=policies365Details:(console.log("retrieving p365 labels using UI"),$scope.policies365Details=p365UIVar),$scope.statusCode=$location.search().statusCode?$location.search().statusCode:void 0,$rootScope.loaderContent={businessLine:"4",header:"Health Insurance",desc:$sce.trustAsHtml($scope.p365Labels.common.proverbBuyProduct)},$rootScope.title=$scope.p365Labels.policies365Title.healthPayFailure,console.log("Common Labels Received."),$scope.medicalReponseToken=localStorageService.get("medicalReponseToken"),$scope.selectedProduct=localStorageService.get("healthSelectedProduct"),console.log("Seleced Product Details Received. : "+JSON.stringify($scope.selectedProduct)),$scope.quoteUserInfo=localStorageService.get("quoteUserInfo"),console.log("Quote User Info Received. : "+JSON.stringify($scope.quoteUserInfo)),$scope.quoteUserInfo&&(messageIDVar=$scope.quoteUserInfo.messageId,$scope.$apply()),$scope.proposalDocParam={},$scope.proposalDocParam.proposalId=localStorageService.get("proposalId"),$scope.proposalDocParam.businessLineId=4,RestAPI.invoke("proposalDataReader",$scope.proposalDocParam).then(function(proposalDataResponse){proposalDataResponse.responsecode==$scope.p365Labels.responseCode.success&&($scope.proposalDataResponse=proposalDataResponse.data.PolicyTransaction,console.log("$scope.proposalDataResponse in car failure",$scope.proposalDataResponse),$scope.proposalDataResponse.requestSource&&"posp"==$scope.proposalDataResponse.requestSource&&$location.search("userName",$scope.proposalDataResponse.userName),$scope.loading=!1)})}),1==imauticAutomation&&imatEvent("PaymentFailure")}]),angular.module("medicalPurchasing",["LocalStorageModule"]).controller("medicalPurchasingController",["$scope","localStorageService",function($scope,localStorageService){$scope.policyDocument=localStorageService.get("policyDocDetails")}]);